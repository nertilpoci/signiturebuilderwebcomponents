import{r as t,c as s,g as e,h as i,H as n}from"./p-Cj32UhRt.js";
/**
 * @licstart The following is the entire license notice for the
 * JavaScript code in this page
 *
 * Copyright 2024 Mozilla Foundation
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @licend The above is the entire license notice for the
 * JavaScript code in this page
 */const r=typeof process==="object"&&process+""==="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser");const o=[.001,0,0,.001,0,0];const h=1.35;const a={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256};const c={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3};const l="pdfjs_internal_editor_";const u={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,SIGNATURE:101};const f={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35,DRAW_STEP:41};const d={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048};const p={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4};const g={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3};const m={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};const A={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};const w={ERRORS:0,WARNINGS:1,INFOS:5};const b={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94};const y={moveTo:0,lineTo:1,curveTo:2,closePath:3};const v={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let x=w.WARNINGS;function M(t){if(Number.isInteger(t)){x=t}}function k(){return x}function S(t){if(x>=w.INFOS){console.log(`Info: ${t}`)}}function E(t){if(x>=w.WARNINGS){console.log(`Warning: ${t}`)}}function C(t){throw new Error(t)}function T(t,s){if(!t){C(s)}}function P(t){switch(t?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return true;default:return false}}function N(t,s=null,e=null){if(!t){return null}if(e&&typeof t==="string"){if(e.addDefaultProtocol&&t.startsWith("www.")){const s=t.match(/\./g);if(s?.length>=2){t=`http://${t}`}}if(e.tryConvertEncoding){try{t=Y(t)}catch{}}}const i=s?URL.parse(t,s):URL.parse(t);return P(i)?i:null}function I(t,s,e=false){const i=URL.parse(t);if(i){i.hash=s;return i.href}if(e&&N(t,"http://example.com")){return t.split("#",1)[0]+`${s?`#${s}`:""}`}return""}function D(t,s,e,i=false){Object.defineProperty(t,s,{value:e,enumerable:!i,configurable:true,writable:false});return e}const R=function t(){function s(t,s){this.message=t;this.name=s}s.prototype=new Error;s.constructor=s;return s}();class $ extends R{constructor(t,s){super(t,"PasswordException");this.code=s}}class F extends R{constructor(t,s){super(t,"UnknownErrorException");this.details=s}}class _ extends R{constructor(t){super(t,"InvalidPDFException")}}class O extends R{constructor(t,s,e){super(t,"ResponseException");this.status=s;this.missing=e}}class L extends R{constructor(t){super(t,"FormatError")}}class B extends R{constructor(t){super(t,"AbortException")}}function U(t){if(typeof t!=="object"||t?.length===undefined){C("Invalid argument for bytesToString")}const s=t.length;const e=8192;if(s<e){return String.fromCharCode.apply(null,t)}const i=[];for(let n=0;n<s;n+=e){const r=Math.min(n+e,s);const o=t.subarray(n,r);i.push(String.fromCharCode.apply(null,o))}return i.join("")}function j(t){if(typeof t!=="string"){C("Invalid argument for stringToBytes")}const s=t.length;const e=new Uint8Array(s);for(let i=0;i<s;++i){e[i]=t.charCodeAt(i)&255}return e}function H(t){return String.fromCharCode(t>>24&255,t>>16&255,t>>8&255,t&255)}function z(){const t=new Uint8Array(4);t[0]=1;const s=new Uint32Array(t.buffer,0,1);return s[0]===1}function G(){try{new Function("");return true}catch{return false}}class W{static get isLittleEndian(){return D(this,"isLittleEndian",z())}static get isEvalSupported(){return D(this,"isEvalSupported",G())}static get isOffscreenCanvasSupported(){return D(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas!=="undefined")}static get isImageDecoderSupported(){return D(this,"isImageDecoderSupported",typeof ImageDecoder!=="undefined")}static get platform(){if(typeof navigator!=="undefined"&&typeof navigator?.platform==="string"&&typeof navigator?.userAgent==="string"){const{platform:t,userAgent:s}=navigator;return D(this,"platform",{isAndroid:s.includes("Android"),isLinux:t.includes("Linux"),isMac:t.includes("Mac"),isWindows:t.includes("Win"),isFirefox:s.includes("Firefox")})}return D(this,"platform",{isAndroid:false,isLinux:false,isMac:false,isWindows:false,isFirefox:false})}static get isCSSRoundSupported(){return D(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}const V=Array.from(Array(256).keys(),(t=>t.toString(16).padStart(2,"0")));class X{static makeHexColor(t,s,e){return`#${V[t]}${V[s]}${V[e]}`}static scaleMinMax(t,s){let e;if(t[0]){if(t[0]<0){e=s[0];s[0]=s[2];s[2]=e}s[0]*=t[0];s[2]*=t[0];if(t[3]<0){e=s[1];s[1]=s[3];s[3]=e}s[1]*=t[3];s[3]*=t[3]}else{e=s[0];s[0]=s[1];s[1]=e;e=s[2];s[2]=s[3];s[3]=e;if(t[1]<0){e=s[1];s[1]=s[3];s[3]=e}s[1]*=t[1];s[3]*=t[1];if(t[2]<0){e=s[0];s[0]=s[2];s[2]=e}s[0]*=t[2];s[2]*=t[2]}s[0]+=t[4];s[1]+=t[5];s[2]+=t[4];s[3]+=t[5]}static transform(t,s){return[t[0]*s[0]+t[2]*s[1],t[1]*s[0]+t[3]*s[1],t[0]*s[2]+t[2]*s[3],t[1]*s[2]+t[3]*s[3],t[0]*s[4]+t[2]*s[5]+t[4],t[1]*s[4]+t[3]*s[5]+t[5]]}static applyTransform(t,s,e=0){const i=t[e];const n=t[e+1];t[e]=i*s[0]+n*s[2]+s[4];t[e+1]=i*s[1]+n*s[3]+s[5]}static applyTransformToBezier(t,s,e=0){const i=s[0];const n=s[1];const r=s[2];const o=s[3];const h=s[4];const a=s[5];for(let s=0;s<6;s+=2){const c=t[e+s];const l=t[e+s+1];t[e+s]=c*i+l*r+h;t[e+s+1]=c*n+l*o+a}}static applyInverseTransform(t,s){const e=t[0];const i=t[1];const n=s[0]*s[3]-s[1]*s[2];t[0]=(e*s[3]-i*s[2]+s[2]*s[5]-s[4]*s[3])/n;t[1]=(-e*s[1]+i*s[0]+s[4]*s[1]-s[5]*s[0])/n}static axialAlignedBoundingBox(t,s,e){const i=s[0];const n=s[1];const r=s[2];const o=s[3];const h=s[4];const a=s[5];const c=t[0];const l=t[1];const u=t[2];const f=t[3];let d=i*c+h;let p=d;let g=i*u+h;let m=g;let A=o*l+a;let w=A;let b=o*f+a;let y=b;if(n!==0||r!==0){const t=n*c;const s=n*u;const e=r*l;const i=r*f;d+=e;m+=e;g+=i;p+=i;A+=t;y+=t;b+=s;w+=s}e[0]=Math.min(e[0],d,g,p,m);e[1]=Math.min(e[1],A,b,w,y);e[2]=Math.max(e[2],d,g,p,m);e[3]=Math.max(e[3],A,b,w,y)}static inverseTransform(t){const s=t[0]*t[3]-t[1]*t[2];return[t[3]/s,-t[1]/s,-t[2]/s,t[0]/s,(t[2]*t[5]-t[4]*t[3])/s,(t[4]*t[1]-t[5]*t[0])/s]}static singularValueDecompose2dScale(t,s){const e=t[0];const i=t[1];const n=t[2];const r=t[3];const o=e**2+i**2;const h=e*n+i*r;const a=n**2+r**2;const c=(o+a)/2;const l=Math.sqrt(c**2-(o*a-h**2));s[0]=Math.sqrt(c+l||1);s[1]=Math.sqrt(c-l||1)}static normalizeRect(t){const s=t.slice(0);if(t[0]>t[2]){s[0]=t[2];s[2]=t[0]}if(t[1]>t[3]){s[1]=t[3];s[3]=t[1]}return s}static intersect(t,s){const e=Math.max(Math.min(t[0],t[2]),Math.min(s[0],s[2]));const i=Math.min(Math.max(t[0],t[2]),Math.max(s[0],s[2]));if(e>i){return null}const n=Math.max(Math.min(t[1],t[3]),Math.min(s[1],s[3]));const r=Math.min(Math.max(t[1],t[3]),Math.max(s[1],s[3]));if(n>r){return null}return[e,n,i,r]}static pointBoundingBox(t,s,e){e[0]=Math.min(e[0],t);e[1]=Math.min(e[1],s);e[2]=Math.max(e[2],t);e[3]=Math.max(e[3],s)}static rectBoundingBox(t,s,e,i,n){n[0]=Math.min(n[0],t,e);n[1]=Math.min(n[1],s,i);n[2]=Math.max(n[2],t,e);n[3]=Math.max(n[3],s,i)}static#t(t,s,e,i,n,r,o,h,a,c){if(a<=0||a>=1){return}const l=1-a;const u=a*a;const f=u*a;const d=l*(l*(l*t+3*a*s)+3*u*e)+f*i;const p=l*(l*(l*n+3*a*r)+3*u*o)+f*h;c[0]=Math.min(c[0],d);c[1]=Math.min(c[1],p);c[2]=Math.max(c[2],d);c[3]=Math.max(c[3],p)}static#s(t,s,e,i,n,r,o,h,a,c,l,u){if(Math.abs(a)<1e-12){if(Math.abs(c)>=1e-12){this.#t(t,s,e,i,n,r,o,h,-l/c,u)}return}const f=c**2-4*l*a;if(f<0){return}const d=Math.sqrt(f);const p=2*a;this.#t(t,s,e,i,n,r,o,h,(-c+d)/p,u);this.#t(t,s,e,i,n,r,o,h,(-c-d)/p,u)}static bezierBoundingBox(t,s,e,i,n,r,o,h,a){a[0]=Math.min(a[0],t,o);a[1]=Math.min(a[1],s,h);a[2]=Math.max(a[2],t,o);a[3]=Math.max(a[3],s,h);this.#s(t,e,n,o,s,i,r,h,3*(-t+3*(e-n)+o),6*(t-2*e+n),3*(e-t),a);this.#s(t,e,n,o,s,i,r,h,3*(-s+3*(i-r)+h),6*(s-2*i+r),3*(i-s),a)}}function Y(t){return decodeURIComponent(escape(t))}let Q=null;let K=null;function q(t){if(!Q){Q=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu;K=new Map([["ﬅ","ſt"]])}return t.replaceAll(Q,((t,s,e)=>s?s.normalize("NFKC"):K.get(e)))}function J(){if(typeof crypto.randomUUID==="function"){return crypto.randomUUID()}const t=new Uint8Array(32);crypto.getRandomValues(t);return U(t)}const Z="pdfjs_internal_id_";function tt(t,s,e){if(!Array.isArray(e)||e.length<2){return false}const[i,n,...r]=e;if(!t(i)&&!Number.isInteger(i)){return false}if(!s(n)){return false}const o=r.length;let h=true;switch(n.name){case"XYZ":if(o<2||o>3){return false}break;case"Fit":case"FitB":return o===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(o>1){return false}break;case"FitR":if(o!==4){return false}h=false;break;default:return false}for(const t of r){if(typeof t==="number"||h&&t===null){continue}return false}return true}function st(t,s,e){return Math.min(Math.max(t,s),e)}function et(t){if(Uint8Array.prototype.toBase64){return t.toBase64()}return btoa(U(t))}function it(t){if(Uint8Array.fromBase64){return Uint8Array.fromBase64(t)}return j(atob(t))}if(typeof Promise.try!=="function"){Promise.try=function(t,...s){return new Promise((e=>{e(t(...s))}))}}if(typeof Math.sumPrecise!=="function"){Math.sumPrecise=function(t){return t.reduce(((t,s)=>t+s),0)}}const nt="http://www.w3.org/2000/svg";class rt{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}async function ot(t,s="text"){if(pt(t,document.baseURI)){const e=await fetch(t);if(!e.ok){throw new Error(e.statusText)}switch(s){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"json":return e.json()}return e.text()}return new Promise(((e,i)=>{const n=new XMLHttpRequest;n.open("GET",t,true);n.responseType=s;n.onreadystatechange=()=>{if(n.readyState!==XMLHttpRequest.DONE){return}if(n.status===200||n.status===0){switch(s){case"arraybuffer":case"blob":case"json":e(n.response);return}e(n.responseText);return}i(new Error(n.statusText))};n.send(null)}))}class ht{constructor({viewBox:t,userUnit:s,scale:e,rotation:i,offsetX:n=0,offsetY:r=0,dontFlip:o=false}){this.viewBox=t;this.userUnit=s;this.scale=e;this.rotation=i;this.offsetX=n;this.offsetY=r;e*=s;const h=(t[2]+t[0])/2;const a=(t[3]+t[1])/2;let c,l,u,f;i%=360;if(i<0){i+=360}switch(i){case 180:c=-1;l=0;u=0;f=1;break;case 90:c=0;l=1;u=1;f=0;break;case 270:c=0;l=-1;u=-1;f=0;break;case 0:c=1;l=0;u=0;f=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}if(o){u=-u;f=-f}let d,p;let g,m;if(c===0){d=Math.abs(a-t[1])*e+n;p=Math.abs(h-t[0])*e+r;g=(t[3]-t[1])*e;m=(t[2]-t[0])*e}else{d=Math.abs(h-t[0])*e+n;p=Math.abs(a-t[1])*e+r;g=(t[2]-t[0])*e;m=(t[3]-t[1])*e}this.transform=[c*e,l*e,u*e,f*e,d-c*e*h-u*e*a,p-l*e*h-f*e*a];this.width=g;this.height=m}get rawDims(){const t=this.viewBox;return D(this,"rawDims",{pageWidth:t[2]-t[0],pageHeight:t[3]-t[1],pageX:t[0],pageY:t[1]})}clone({scale:t=this.scale,rotation:s=this.rotation,offsetX:e=this.offsetX,offsetY:i=this.offsetY,dontFlip:n=false}={}){return new ht({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:t,rotation:s,offsetX:e,offsetY:i,dontFlip:n})}convertToViewportPoint(t,s){const e=[t,s];X.applyTransform(e,this.transform);return e}convertToViewportRectangle(t){const s=[t[0],t[1]];X.applyTransform(s,this.transform);const e=[t[2],t[3]];X.applyTransform(e,this.transform);return[s[0],s[1],e[0],e[1]]}convertToPdfPoint(t,s){const e=[t,s];X.applyInverseTransform(e,this.transform);return e}}class at extends R{constructor(t,s=0){super(t,"RenderingCancelledException");this.extraDelay=s}}function ct(t){const s=t.length;let e=0;while(e<s&&t[e].trim()===""){e++}return t.substring(e,e+5).toLowerCase()==="data:"}function lt(t){return typeof t==="string"&&/\.pdf$/i.test(t)}function ut(t){[t]=t.split(/[#?]/,1);return t.substring(t.lastIndexOf("/")+1)}function ft(t,s="document.pdf"){if(typeof t!=="string"){return s}if(ct(t)){E('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.');return s}const e=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/;const i=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i;const n=e.exec(t);let r=i.exec(n[1])||i.exec(n[2])||i.exec(n[3]);if(r){r=r[0];if(r.includes("%")){try{r=i.exec(decodeURIComponent(r))[0]}catch{}}}return r||s}class dt{started=Object.create(null);times=[];time(t){if(t in this.started){E(`Timer is already running for ${t}`)}this.started[t]=Date.now()}timeEnd(t){if(!(t in this.started)){E(`Timer has not been started for ${t}`)}this.times.push({name:t,start:this.started[t],end:Date.now()});delete this.started[t]}toString(){const t=[];let s=0;for(const{name:t}of this.times){s=Math.max(t.length,s)}for(const{name:e,start:i,end:n}of this.times){t.push(`${e.padEnd(s)} ${n-i}ms\n`)}return t.join("")}}function pt(t,s){const e=s?URL.parse(t,s):URL.parse(t);return e?.protocol==="http:"||e?.protocol==="https:"}function gt(t){t.preventDefault()}function mt(t){t.preventDefault();t.stopPropagation()}class At{static#e;static toDateObject(t){if(!t||typeof t!=="string"){return null}this.#e||=new RegExp("^D:"+"(\\d{4})"+"(\\d{2})?"+"(\\d{2})?"+"(\\d{2})?"+"(\\d{2})?"+"(\\d{2})?"+"([Z|+|-])?"+"(\\d{2})?"+"'?"+"(\\d{2})?"+"'?");const s=this.#e.exec(t);if(!s){return null}const e=parseInt(s[1],10);let i=parseInt(s[2],10);i=i>=1&&i<=12?i-1:0;let n=parseInt(s[3],10);n=n>=1&&n<=31?n:1;let r=parseInt(s[4],10);r=r>=0&&r<=23?r:0;let o=parseInt(s[5],10);o=o>=0&&o<=59?o:0;let h=parseInt(s[6],10);h=h>=0&&h<=59?h:0;const a=s[7]||"Z";let c=parseInt(s[8],10);c=c>=0&&c<=23?c:0;let l=parseInt(s[9],10)||0;l=l>=0&&l<=59?l:0;if(a==="-"){r+=c;o+=l}else if(a==="+"){r-=c;o-=l}return new Date(Date.UTC(e,i,n,r,o,h))}}function wt(t,{scale:s=1,rotation:e=0}){const{width:i,height:n}=t.attributes.style;const r=[0,0,parseInt(i),parseInt(n)];return new ht({viewBox:r,userUnit:1,scale:s,rotation:e})}function bt(t){if(t.startsWith("#")){const s=parseInt(t.slice(1),16);return[(s&16711680)>>16,(s&65280)>>8,s&255]}if(t.startsWith("rgb(")){return t.slice(4,-1).split(",").map((t=>parseInt(t)))}if(t.startsWith("rgba(")){return t.slice(5,-1).split(",").map((t=>parseInt(t))).slice(0,3)}E(`Not a valid color format: "${t}"`);return[0,0,0]}function yt(t){const s=document.createElement("span");s.style.visibility="hidden";s.style.colorScheme="only light";document.body.append(s);for(const e of t.keys()){s.style.color=e;const i=window.getComputedStyle(s).color;t.set(e,bt(i))}s.remove()}function vt(t){const{a:s,b:e,c:i,d:n,e:r,f:o}=t.getTransform();return[s,e,i,n,r,o]}function xt(t){const{a:s,b:e,c:i,d:n,e:r,f:o}=t.getTransform().invertSelf();return[s,e,i,n,r,o]}function Mt(t,s,e=false,i=true){if(s instanceof ht){const{pageWidth:i,pageHeight:n}=s.rawDims;const{style:r}=t;const o=W.isCSSRoundSupported;const h=`var(--total-scale-factor) * ${i}px`,a=`var(--total-scale-factor) * ${n}px`;const c=o?`round(down, ${h}, var(--scale-round-x))`:`calc(${h})`,l=o?`round(down, ${a}, var(--scale-round-y))`:`calc(${a})`;if(!e||s.rotation%180===0){r.width=c;r.height=l}else{r.width=l;r.height=c}}if(i){t.setAttribute("data-main-rotation",s.rotation)}}class kt{constructor(){const{pixelRatio:t}=kt;this.sx=t;this.sy=t}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(t,s,e,i){let n=Infinity,r=Infinity,o=Infinity;if(e>0){n=Math.sqrt(e/(t*s))}if(i!==-1){r=i/t;o=i/s}const h=Math.min(n,r,o);if(this.sx>h||this.sy>h){this.sx=h;this.sy=h;return true}return false}static get pixelRatio(){return globalThis.devicePixelRatio||1}}const St=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];class Et{#i=null;#n=null;#r;#o=null;#h=null;#a=null;static#c=null;constructor(t){this.#r=t;Et.#c||=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"})}render(){const t=this.#i=document.createElement("div");t.classList.add("editToolbar","hidden");t.setAttribute("role","toolbar");const s=this.#r._uiManager._signal;t.addEventListener("contextmenu",gt,{signal:s});t.addEventListener("pointerdown",Et.#l,{signal:s});const e=this.#o=document.createElement("div");e.className="buttons";t.append(e);const i=this.#r.toolbarPosition;if(i){const{style:s}=t;const e=this.#r._uiManager.direction==="ltr"?1-i[0]:i[0];s.insetInlineEnd=`${100*e}%`;s.top=`calc(${100*i[1]}% + var(--editor-toolbar-vert-offset))`}this.#u();return t}get div(){return this.#i}static#l(t){t.stopPropagation()}#f(t){this.#r._focusEventsAllowed=false;mt(t)}#d(t){this.#r._focusEventsAllowed=true;mt(t)}#p(t){const s=this.#r._uiManager._signal;t.addEventListener("focusin",this.#f.bind(this),{capture:true,signal:s});t.addEventListener("focusout",this.#d.bind(this),{capture:true,signal:s});t.addEventListener("contextmenu",gt,{signal:s})}hide(){this.#i.classList.add("hidden");this.#n?.hideDropdown()}show(){this.#i.classList.remove("hidden");this.#h?.shown()}#u(){const{editorType:t,_uiManager:s}=this.#r;const e=document.createElement("button");e.className="delete";e.tabIndex=0;e.setAttribute("data-l10n-id",Et.#c[t]);this.#p(e);e.addEventListener("click",(t=>{s.delete()}),{signal:s._signal});this.#o.append(e)}get#g(){const t=document.createElement("div");t.className="divider";return t}async addAltText(t){const s=await t.render();this.#p(s);this.#o.prepend(s,this.#g);this.#h=t}addColorPicker(t){this.#n=t;const s=t.renderButton();this.#p(s);this.#o.prepend(s,this.#g)}async addEditSignatureButton(t){const s=this.#a=await t.renderEditButton(this.#r);this.#p(s);this.#o.prepend(s,this.#g)}updateEditSignatureButton(t){if(this.#a){this.#a.title=t}}remove(){this.#i.remove();this.#n?.destroy();this.#n=null}}class Ct{#o=null;#i=null;#m;constructor(t){this.#m=t}#A(){const t=this.#i=document.createElement("div");t.className="editToolbar";t.setAttribute("role","toolbar");t.addEventListener("contextmenu",gt,{signal:this.#m._signal});const s=this.#o=document.createElement("div");s.className="buttons";t.append(s);this.#w();return t}#b(t,s){let e=0;let i=0;for(const n of t){const t=n.y+n.height;if(t<e){continue}const r=n.x+(s?n.width:0);if(t>e){i=r;e=t;continue}if(s){if(r>i){i=r}}else if(r<i){i=r}}return[s?1-i:i,e]}show(t,s,e){const[i,n]=this.#b(s,e);const{style:r}=this.#i||=this.#A();t.append(this.#i);r.insetInlineEnd=`${100*i}%`;r.top=`calc(${100*n}% + var(--editor-toolbar-vert-offset))`}hide(){this.#i.remove()}#w(){const t=document.createElement("button");t.className="highlightButton";t.tabIndex=0;t.setAttribute("data-l10n-id",`pdfjs-highlight-floating-button1`);const s=document.createElement("span");t.append(s);s.className="visuallyHidden";s.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");const e=this.#m._signal;t.addEventListener("contextmenu",gt,{signal:e});t.addEventListener("click",(()=>{this.#m.highlightSelection("floating_button")}),{signal:e});this.#o.append(t)}}function Tt(t,s,e){for(const i of e){s.addEventListener(i,t[i].bind(t))}}class Pt{#y=0;get id(){return`${l}${this.#y++}`}}class Nt{#v=J();#y=0;#x=null;static get _isSVGFittingCanvas(){const t=`data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>`;const s=new OffscreenCanvas(1,3);const e=s.getContext("2d",{willReadFrequently:true});const i=new Image;i.src=t;const n=i.decode().then((()=>{e.drawImage(i,0,0,1,1,0,0,1,3);return new Uint32Array(e.getImageData(0,0,1,1).data.buffer)[0]===0}));return D(this,"_isSVGFittingCanvas",n)}async#M(t,s){this.#x||=new Map;let e=this.#x.get(t);if(e===null){return null}if(e?.bitmap){e.refCounter+=1;return e}try{e||={bitmap:null,id:`image_${this.#v}_${this.#y++}`,refCounter:0,isSvg:false};let t;if(typeof s==="string"){e.url=s;t=await ot(s,"blob")}else if(s instanceof File){t=e.file=s}else if(s instanceof Blob){t=s}if(t.type==="image/svg+xml"){const s=Nt._isSVGFittingCanvas;const i=new FileReader;const n=new Image;const r=new Promise(((t,r)=>{n.onload=()=>{e.bitmap=n;e.isSvg=true;t()};i.onload=async()=>{const t=e.svgUrl=i.result;n.src=await s?`${t}#svgView(preserveAspectRatio(none))`:t};n.onerror=i.onerror=r}));i.readAsDataURL(t);await r}else{e.bitmap=await createImageBitmap(t)}e.refCounter=1}catch(t){E(t);e=null}this.#x.set(t,e);if(e){this.#x.set(e.id,e)}return e}async getFromFile(t){const{lastModified:s,name:e,size:i,type:n}=t;return this.#M(`${s}_${e}_${i}_${n}`,t)}async getFromUrl(t){return this.#M(t,t)}async getFromBlob(t,s){const e=await s;return this.#M(t,e)}async getFromId(t){this.#x||=new Map;const s=this.#x.get(t);if(!s){return null}if(s.bitmap){s.refCounter+=1;return s}if(s.file){return this.getFromFile(s.file)}if(s.blobPromise){const{blobPromise:t}=s;delete s.blobPromise;return this.getFromBlob(s.id,t)}return this.getFromUrl(s.url)}getFromCanvas(t,s){this.#x||=new Map;let e=this.#x.get(t);if(e?.bitmap){e.refCounter+=1;return e}const i=new OffscreenCanvas(s.width,s.height);const n=i.getContext("2d");n.drawImage(s,0,0);e={bitmap:i.transferToImageBitmap(),id:`image_${this.#v}_${this.#y++}`,refCounter:1,isSvg:false};this.#x.set(t,e);this.#x.set(e.id,e);return e}getSvgUrl(t){const s=this.#x.get(t);if(!s?.isSvg){return null}return s.svgUrl}deleteId(t){this.#x||=new Map;const s=this.#x.get(t);if(!s){return}s.refCounter-=1;if(s.refCounter!==0){return}const{bitmap:e}=s;if(!s.url&&!s.file){const t=new OffscreenCanvas(e.width,e.height);const i=t.getContext("bitmaprenderer");i.transferFromImageBitmap(e);s.blobPromise=t.convertToBlob()}e.close?.();s.bitmap=null}isValidId(t){return t.startsWith(`image_${this.#v}_`)}}class It{#k=[];#S=false;#E;#C=-1;constructor(t=128){this.#E=t}add({cmd:t,undo:s,post:e,mustExec:i,type:n=NaN,overwriteIfSameType:r=false,keepUndo:o=false}){if(i){t()}if(this.#S){return}const h={cmd:t,undo:s,post:e,type:n};if(this.#C===-1){if(this.#k.length>0){this.#k.length=0}this.#C=0;this.#k.push(h);return}if(r&&this.#k[this.#C].type===n){if(o){h.undo=this.#k[this.#C].undo}this.#k[this.#C]=h;return}const a=this.#C+1;if(a===this.#E){this.#k.splice(0,1)}else{this.#C=a;if(a<this.#k.length){this.#k.splice(a)}}this.#k.push(h)}undo(){if(this.#C===-1){return}this.#S=true;const{undo:t,post:s}=this.#k[this.#C];t();s?.();this.#S=false;this.#C-=1}redo(){if(this.#C<this.#k.length-1){this.#C+=1;this.#S=true;const{cmd:t,post:s}=this.#k[this.#C];t();s?.();this.#S=false}}hasSomethingToUndo(){return this.#C!==-1}hasSomethingToRedo(){return this.#C<this.#k.length-1}cleanType(t){if(this.#C===-1){return}for(let s=this.#C;s>=0;s--){if(this.#k[s].type!==t){this.#k.splice(s+1,this.#C-s);this.#C=s;return}}this.#k.length=0;this.#C=-1}destroy(){this.#k=null}}class Dt{constructor(t){this.buffer=[];this.callbacks=new Map;this.allKeys=new Set;const{isMac:s}=W.platform;for(const[e,i,n={}]of t){for(const t of e){const e=t.startsWith("mac+");if(s&&e){this.callbacks.set(t.slice(4),{callback:i,options:n});this.allKeys.add(t.split("+").at(-1))}else if(!s&&!e){this.callbacks.set(t,{callback:i,options:n});this.allKeys.add(t.split("+").at(-1))}}}}#T(t){if(t.altKey){this.buffer.push("alt")}if(t.ctrlKey){this.buffer.push("ctrl")}if(t.metaKey){this.buffer.push("meta")}if(t.shiftKey){this.buffer.push("shift")}this.buffer.push(t.key);const s=this.buffer.join("+");this.buffer.length=0;return s}exec(t,s){if(!this.allKeys.has(s.key)){return}const e=this.callbacks.get(this.#T(s));if(!e){return}const{callback:i,options:{bubbles:n=false,args:r=[],checker:o=null}}=e;if(o&&!o(t,s)){return}i.bind(t,...r,s)();if(!n){mt(s)}}}class Rt{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const t=new Map([["CanvasText",null],["Canvas",null]]);yt(t);return D(this,"_colors",t)}convert(t){const s=bt(t);if(!window.matchMedia("(forced-colors: active)").matches){return s}for(const[t,e]of this._colors){if(e.every(((t,e)=>t===s[e]))){return Rt._colorsMapping.get(t)}}return s}getHexCode(t){const s=this._colors.get(t);if(!s){return t}return X.makeHexColor(...s)}}class $t{#P=new AbortController;#N=null;#I=new Map;#D=new Map;#R=null;#$=null;#F=null;#_=new It;#O=null;#L=null;#B=0;#U=new Set;#j=null;#H=null;#z=new Set;_editorUndoBar=null;#G=false;#W=false;#V=false;#X=null;#Y=null;#Q=null;#K=null;#q=false;#J=null;#Z=new Pt;#tt=false;#st=false;#et=null;#it=null;#nt=null;#rt=null;#ot=null;#ht=u.NONE;#at=new Set;#ct=null;#lt=null;#ut=null;#ft=null;#dt={isEditing:false,isEmpty:true,hasSomethingToUndo:false,hasSomethingToRedo:false,hasSelectedEditor:false,hasSelectedText:false};#pt=[0,0];#gt=null;#mt=null;#At=null;#wt=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const t=$t.prototype;const s=t=>t.#mt.contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&t.hasSomethingToControl();const e=(t,{target:s})=>{if(s instanceof HTMLInputElement){const{type:t}=s;return t!=="text"&&t!=="number"}return true};const i=this.TRANSLATE_SMALL;const n=this.TRANSLATE_BIG;return D(this,"_keyboardManager",new Dt([[["ctrl+a","mac+meta+a"],t.selectAll,{checker:e}],[["ctrl+z","mac+meta+z"],t.undo,{checker:e}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],t.redo,{checker:e}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],t.delete,{checker:e}],[["Enter","mac+Enter"],t.addNewEditorFromKeyboard,{checker:(t,{target:s})=>!(s instanceof HTMLButtonElement)&&t.#mt.contains(s)&&!t.isEnterHandled}],[[" ","mac+ "],t.addNewEditorFromKeyboard,{checker:(t,{target:s})=>!(s instanceof HTMLButtonElement)&&t.#mt.contains(document.activeElement)}],[["Escape","mac+Escape"],t.unselectAll],[["ArrowLeft","mac+ArrowLeft"],t.translateSelectedEditors,{args:[-i,0],checker:s}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t.translateSelectedEditors,{args:[-n,0],checker:s}],[["ArrowRight","mac+ArrowRight"],t.translateSelectedEditors,{args:[i,0],checker:s}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t.translateSelectedEditors,{args:[n,0],checker:s}],[["ArrowUp","mac+ArrowUp"],t.translateSelectedEditors,{args:[0,-i],checker:s}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t.translateSelectedEditors,{args:[0,-n],checker:s}],[["ArrowDown","mac+ArrowDown"],t.translateSelectedEditors,{args:[0,i],checker:s}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t.translateSelectedEditors,{args:[0,n],checker:s}]]))}constructor(t,s,e,i,n,r,o,h,a,c,l,u,f,d){const p=this._signal=this.#P.signal;this.#mt=t;this.#At=s;this.#R=e;this.#lt=i;this._eventBus=n;n._on("editingaction",this.onEditingAction.bind(this),{signal:p});n._on("pagechanging",this.onPageChanging.bind(this),{signal:p});n._on("scalechanging",this.onScaleChanging.bind(this),{signal:p});n._on("rotationchanging",this.onRotationChanging.bind(this),{signal:p});n._on("setpreference",this.onSetPreference.bind(this),{signal:p});n._on("switchannotationeditorparams",(t=>this.updateParams(t.type,t.value)),{signal:p});this.#bt();this.#yt();this.#vt();this.#$=r.annotationStorage;this.#X=r.filterFactory;this.#ut=o;this.#K=h||null;this.#G=a;this.#W=c;this.#V=l;this.#ot=u||null;this.viewParameters={realScale:rt.PDF_TO_CSS_UNITS,rotation:0};this.isShiftKeyDown=false;this._editorUndoBar=f||null;this._supportsPinchToZoom=d!==false}destroy(){this.#wt?.resolve();this.#wt=null;this.#P?.abort();this.#P=null;this._signal=null;for(const t of this.#D.values()){t.destroy()}this.#D.clear();this.#I.clear();this.#z.clear();this.#rt?.clear();this.#N=null;this.#at.clear();this.#_.destroy();this.#R?.destroy();this.#lt?.destroy();this.#J?.hide();this.#J=null;this.#nt?.destroy();this.#nt=null;if(this.#Y){clearTimeout(this.#Y);this.#Y=null}if(this.#gt){clearTimeout(this.#gt);this.#gt=null}this._editorUndoBar?.destroy()}combinedSignal(t){return AbortSignal.any([this._signal,t.signal])}get mlManager(){return this.#ot}get useNewAltTextFlow(){return this.#W}get useNewAltTextWhenAddingImage(){return this.#V}get hcmFilter(){return D(this,"hcmFilter",this.#ut?this.#X.addHCMFilter(this.#ut.foreground,this.#ut.background):"none")}get direction(){return D(this,"direction",getComputedStyle(this.#mt).direction)}get highlightColors(){return D(this,"highlightColors",this.#K?new Map(this.#K.split(",").map((t=>t.split("=").map((t=>t.trim()))))):null)}get highlightColorNames(){return D(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,(t=>t.reverse()))):null)}setCurrentDrawingSession(t){if(t){this.unselectAll();this.disableUserSelect(true)}else{this.disableUserSelect(false)}this.#L=t}setMainHighlightColorPicker(t){this.#nt=t}editAltText(t,s=false){this.#R?.editAltText(this,t,s)}getSignature(t){this.#lt?.getSignature({uiManager:this,editor:t})}get signatureManager(){return this.#lt}switchToMode(t,s){this._eventBus.on("annotationeditormodechanged",s,{once:true,signal:this._signal});this._eventBus.dispatch("showannotationeditorui",{source:this,mode:t})}setPreference(t,s){this._eventBus.dispatch("setpreference",{source:this,name:t,value:s})}onSetPreference({name:t,value:s}){switch(t){case"enableNewAltTextWhenAddingImage":this.#V=s;break}}onPageChanging({pageNumber:t}){this.#B=t-1}focusMainContainer(){this.#mt.focus()}findParent(t,s){for(const e of this.#D.values()){const{x:i,y:n,width:r,height:o}=e.div.getBoundingClientRect();if(t>=i&&t<=i+r&&s>=n&&s<=n+o){return e}}return null}disableUserSelect(t=false){this.#At.classList.toggle("noUserSelect",t)}addShouldRescale(t){this.#z.add(t)}removeShouldRescale(t){this.#z.delete(t)}onScaleChanging({scale:t}){this.commitOrRemove();this.viewParameters.realScale=t*rt.PDF_TO_CSS_UNITS;for(const t of this.#z){t.onScaleChanging()}this.#L?.onScaleChanging()}onRotationChanging({pagesRotation:t}){this.commitOrRemove();this.viewParameters.rotation=t}#xt({anchorNode:t}){return t.nodeType===Node.TEXT_NODE?t.parentElement:t}#Mt(t){const{currentLayer:s}=this;if(s.hasTextLayer(t)){return s}for(const s of this.#D.values()){if(s.hasTextLayer(t)){return s}}return null}highlightSelection(t=""){const s=document.getSelection();if(!s||s.isCollapsed){return}const{anchorNode:e,anchorOffset:i,focusNode:n,focusOffset:r}=s;const o=s.toString();const h=this.#xt(s);const a=h.closest(".textLayer");const c=this.getSelectionBoxes(a);if(!c){return}s.empty();const l=this.#Mt(a);const f=this.#ht===u.NONE;const d=()=>{l?.createAndAddNewEditor({x:0,y:0},false,{methodOfCreation:t,boxes:c,anchorNode:e,anchorOffset:i,focusNode:n,focusOffset:r,text:o});if(f){this.showAllEditors("highlight",true,true)}};if(f){this.switchToMode(u.HIGHLIGHT,d);return}d()}#kt(){const t=document.getSelection();if(!t||t.isCollapsed){return}const s=this.#xt(t);const e=s.closest(".textLayer");const i=this.getSelectionBoxes(e);if(!i){return}this.#J||=new Ct(this);this.#J.show(e,i,this.direction==="ltr")}addToAnnotationStorage(t){if(!t.isEmpty()&&this.#$&&!this.#$.has(t.id)){this.#$.setValue(t.id,t)}}#St(){const t=document.getSelection();if(!t||t.isCollapsed){if(this.#ct){this.#J?.hide();this.#ct=null;this.#Et({hasSelectedText:false})}return}const{anchorNode:s}=t;if(s===this.#ct){return}const e=this.#xt(t);const i=e.closest(".textLayer");if(!i){if(this.#ct){this.#J?.hide();this.#ct=null;this.#Et({hasSelectedText:false})}return}this.#J?.hide();this.#ct=s;this.#Et({hasSelectedText:true});if(this.#ht!==u.HIGHLIGHT&&this.#ht!==u.NONE){return}if(this.#ht===u.HIGHLIGHT){this.showAllEditors("highlight",true,true)}this.#q=this.isShiftKeyDown;if(!this.isShiftKeyDown){const t=this.#ht===u.HIGHLIGHT?this.#Mt(i):null;t?.toggleDrawing();const s=new AbortController;const e=this.combinedSignal(s);const n=e=>{if(e.type==="pointerup"&&e.button!==0){return}s.abort();t?.toggleDrawing(true);if(e.type==="pointerup"){this.#Ct("main_toolbar")}};window.addEventListener("pointerup",n,{signal:e});window.addEventListener("blur",n,{signal:e})}}#Ct(t=""){if(this.#ht===u.HIGHLIGHT){this.highlightSelection(t)}else if(this.#G){this.#kt()}}#bt(){document.addEventListener("selectionchange",this.#St.bind(this),{signal:this._signal})}#Tt(){if(this.#Q){return}this.#Q=new AbortController;const t=this.combinedSignal(this.#Q);window.addEventListener("focus",this.focus.bind(this),{signal:t});window.addEventListener("blur",this.blur.bind(this),{signal:t})}#Pt(){this.#Q?.abort();this.#Q=null}blur(){this.isShiftKeyDown=false;if(this.#q){this.#q=false;this.#Ct("main_toolbar")}if(!this.hasSelection){return}const{activeElement:t}=document;for(const s of this.#at){if(s.div.contains(t)){this.#it=[s,t];s._focusEventsAllowed=false;break}}}focus(){if(!this.#it){return}const[t,s]=this.#it;this.#it=null;s.addEventListener("focusin",(()=>{t._focusEventsAllowed=true}),{once:true,signal:this._signal});s.focus()}#vt(){if(this.#et){return}this.#et=new AbortController;const t=this.combinedSignal(this.#et);window.addEventListener("keydown",this.keydown.bind(this),{signal:t});window.addEventListener("keyup",this.keyup.bind(this),{signal:t})}#Nt(){this.#et?.abort();this.#et=null}#It(){if(this.#O){return}this.#O=new AbortController;const t=this.combinedSignal(this.#O);document.addEventListener("copy",this.copy.bind(this),{signal:t});document.addEventListener("cut",this.cut.bind(this),{signal:t});document.addEventListener("paste",this.paste.bind(this),{signal:t})}#Dt(){this.#O?.abort();this.#O=null}#yt(){const t=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:t});document.addEventListener("drop",this.drop.bind(this),{signal:t})}addEditListeners(){this.#vt();this.#It()}removeEditListeners(){this.#Nt();this.#Dt()}dragOver(t){for(const{type:s}of t.dataTransfer.items){for(const e of this.#H){if(e.isHandlingMimeForPasting(s)){t.dataTransfer.dropEffect="copy";t.preventDefault();return}}}}drop(t){for(const s of t.dataTransfer.items){for(const e of this.#H){if(e.isHandlingMimeForPasting(s.type)){e.paste(s,this.currentLayer);t.preventDefault();return}}}}copy(t){t.preventDefault();this.#N?.commitOrRemove();if(!this.hasSelection){return}const s=[];for(const t of this.#at){const e=t.serialize(true);if(e){s.push(e)}}if(s.length===0){return}t.clipboardData.setData("application/pdfjs",JSON.stringify(s))}cut(t){this.copy(t);this.delete()}async paste(t){t.preventDefault();const{clipboardData:s}=t;for(const t of s.items){for(const s of this.#H){if(s.isHandlingMimeForPasting(t.type)){s.paste(t,this.currentLayer);return}}}let e=s.getData("application/pdfjs");if(!e){return}try{e=JSON.parse(e)}catch(t){E(`paste: "${t.message}".`);return}if(!Array.isArray(e)){return}this.unselectAll();const i=this.currentLayer;try{const t=[];for(const s of e){const e=await i.deserialize(s);if(!e){return}t.push(e)}const s=()=>{for(const s of t){this.#Rt(s)}this.#$t(t)};const n=()=>{for(const s of t){s.remove()}};this.addCommands({cmd:s,undo:n,mustExec:true})}catch(t){E(`paste: "${t.message}".`)}}keydown(t){if(!this.isShiftKeyDown&&t.key==="Shift"){this.isShiftKeyDown=true}if(this.#ht!==u.NONE&&!this.isEditorHandlingKeyboard){$t._keyboardManager.exec(this,t)}}keyup(t){if(this.isShiftKeyDown&&t.key==="Shift"){this.isShiftKeyDown=false;if(this.#q){this.#q=false;this.#Ct("main_toolbar")}}}onEditingAction({name:t}){switch(t){case"undo":case"redo":case"delete":case"selectAll":this[t]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}#Et(t){const s=Object.entries(t).some((([t,s])=>this.#dt[t]!==s));if(s){this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#dt,t)});if(this.#ht===u.HIGHLIGHT&&t.hasSelectedEditor===false){this.#Ft([[f.HIGHLIGHT_FREE,true]])}}}#Ft(t){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:t})}setEditingState(t){if(t){this.#Tt();this.#It();this.#Et({isEditing:this.#ht!==u.NONE,isEmpty:this.#_t(),hasSomethingToUndo:this.#_.hasSomethingToUndo(),hasSomethingToRedo:this.#_.hasSomethingToRedo(),hasSelectedEditor:false})}else{this.#Pt();this.#Dt();this.#Et({isEditing:false});this.disableUserSelect(false)}}registerEditorTypes(t){if(this.#H){return}this.#H=t;for(const t of this.#H){this.#Ft(t.defaultPropertiesToUpdate)}}getId(){return this.#Z.id}get currentLayer(){return this.#D.get(this.#B)}getLayer(t){return this.#D.get(t)}get currentPageIndex(){return this.#B}addLayer(t){this.#D.set(t.pageIndex,t);if(this.#tt){t.enable()}else{t.disable()}}removeLayer(t){this.#D.delete(t.pageIndex)}async updateMode(t,s=null,e=false){if(this.#ht===t){return}if(this.#wt){await this.#wt.promise;if(!this.#wt){return}}this.#wt=Promise.withResolvers();this.#L?.commitOrRemove();this.#ht=t;if(t===u.NONE){this.setEditingState(false);this.#Ot();this._editorUndoBar?.hide();this.#wt.resolve();return}if(t===u.SIGNATURE){await(this.#lt?.loadSignatures())}this.setEditingState(true);await this.#Lt();this.unselectAll();for(const s of this.#D.values()){s.updateMode(t)}if(!s){if(e){this.addNewEditorFromKeyboard()}this.#wt.resolve();return}for(const t of this.#I.values()){if(t.annotationElementId===s){this.setSelected(t);t.enterInEditMode()}else{t.unselect()}}this.#wt.resolve()}addNewEditorFromKeyboard(){if(this.currentLayer.canCreateNewEmptyEditor()){this.currentLayer.addNewEditor()}}updateToolbar(t){if(t===this.#ht){return}this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:t})}updateParams(t,s){if(!this.#H){return}switch(t){case f.CREATE:this.currentLayer.addNewEditor(s);return;case f.HIGHLIGHT_DEFAULT_COLOR:this.#nt?.updateColor(s);break;case f.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}});(this.#ft||=new Map).set(t,s);this.showAllEditors("highlight",s);break}for(const e of this.#at){e.updateParams(t,s)}for(const e of this.#H){e.updateDefaultParams(t,s)}}showAllEditors(t,s,e=false){for(const e of this.#I.values()){if(e.editorType===t){e.show(s)}}const i=this.#ft?.get(f.HIGHLIGHT_SHOW_ALL)??true;if(i!==s){this.#Ft([[f.HIGHLIGHT_SHOW_ALL,s]])}}enableWaiting(t=false){if(this.#st===t){return}this.#st=t;for(const s of this.#D.values()){if(t){s.disableClick()}else{s.enableClick()}s.div.classList.toggle("waiting",t)}}async#Lt(){if(!this.#tt){this.#tt=true;const t=[];for(const s of this.#D.values()){t.push(s.enable())}await Promise.all(t);for(const t of this.#I.values()){t.enable()}}}#Ot(){this.unselectAll();if(this.#tt){this.#tt=false;for(const t of this.#D.values()){t.disable()}for(const t of this.#I.values()){t.disable()}}}getEditors(t){const s=[];for(const e of this.#I.values()){if(e.pageIndex===t){s.push(e)}}return s}getEditor(t){return this.#I.get(t)}addEditor(t){this.#I.set(t.id,t)}removeEditor(t){if(t.div.contains(document.activeElement)){if(this.#Y){clearTimeout(this.#Y)}this.#Y=setTimeout((()=>{this.focusMainContainer();this.#Y=null}),0)}this.#I.delete(t.id);if(t.annotationElementId){this.#rt?.delete(t.annotationElementId)}this.unselect(t);if(!t.annotationElementId||!this.#U.has(t.annotationElementId)){this.#$?.remove(t.id)}}addDeletedAnnotationElement(t){this.#U.add(t.annotationElementId);this.addChangedExistingAnnotation(t);t.deleted=true}isDeletedAnnotationElement(t){return this.#U.has(t)}removeDeletedAnnotationElement(t){this.#U.delete(t.annotationElementId);this.removeChangedExistingAnnotation(t);t.deleted=false}#Rt(t){const s=this.#D.get(t.pageIndex);if(s){s.addOrRebuild(t)}else{this.addEditor(t);this.addToAnnotationStorage(t)}}setActiveEditor(t){if(this.#N===t){return}this.#N=t;if(t){this.#Ft(t.propertiesToUpdate)}}get#Bt(){let t=null;for(t of this.#at){}return t}updateUI(t){if(this.#Bt===t){this.#Ft(t.propertiesToUpdate)}}updateUIForDefaultProperties(t){this.#Ft(t.defaultPropertiesToUpdate)}toggleSelected(t){if(this.#at.has(t)){this.#at.delete(t);t.unselect();this.#Et({hasSelectedEditor:this.hasSelection});return}this.#at.add(t);t.select();this.#Ft(t.propertiesToUpdate);this.#Et({hasSelectedEditor:true})}setSelected(t){this.#L?.commitOrRemove();for(const s of this.#at){if(s!==t){s.unselect()}}this.#at.clear();this.#at.add(t);t.select();this.#Ft(t.propertiesToUpdate);this.#Et({hasSelectedEditor:true})}isSelected(t){return this.#at.has(t)}get firstSelectedEditor(){return this.#at.values().next().value}unselect(t){t.unselect();this.#at.delete(t);this.#Et({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#at.size!==0}get isEnterHandled(){return this.#at.size===1&&this.firstSelectedEditor.isEnterHandled}undo(){this.#_.undo();this.#Et({hasSomethingToUndo:this.#_.hasSomethingToUndo(),hasSomethingToRedo:true,isEmpty:this.#_t()});this._editorUndoBar?.hide()}redo(){this.#_.redo();this.#Et({hasSomethingToUndo:true,hasSomethingToRedo:this.#_.hasSomethingToRedo(),isEmpty:this.#_t()})}addCommands(t){this.#_.add(t);this.#Et({hasSomethingToUndo:true,hasSomethingToRedo:false,isEmpty:this.#_t()})}cleanUndoStack(t){this.#_.cleanType(t)}#_t(){if(this.#I.size===0){return true}if(this.#I.size===1){for(const t of this.#I.values()){return t.isEmpty()}}return false}delete(){this.commitOrRemove();const t=this.currentLayer?.endDrawingSession(true);if(!this.hasSelection&&!t){return}const s=t?[t]:[...this.#at];const e=()=>{this._editorUndoBar?.show(i,s.length===1?s[0].editorType:s.length);for(const t of s){t.remove()}};const i=()=>{for(const t of s){this.#Rt(t)}};this.addCommands({cmd:e,undo:i,mustExec:true})}commitOrRemove(){this.#N?.commitOrRemove()}hasSomethingToControl(){return this.#N||this.hasSelection}#$t(t){for(const t of this.#at){t.unselect()}this.#at.clear();for(const s of t){if(s.isEmpty()){continue}this.#at.add(s);s.select()}this.#Et({hasSelectedEditor:this.hasSelection})}selectAll(){for(const t of this.#at){t.commit()}this.#$t(this.#I.values())}unselectAll(){if(this.#N){this.#N.commitOrRemove();if(this.#ht!==u.NONE){return}}if(this.#L?.commitOrRemove()){return}if(!this.hasSelection){return}for(const t of this.#at){t.unselect()}this.#at.clear();this.#Et({hasSelectedEditor:false})}translateSelectedEditors(t,s,e=false){if(!e){this.commitOrRemove()}if(!this.hasSelection){return}this.#pt[0]+=t;this.#pt[1]+=s;const[i,n]=this.#pt;const r=[...this.#at];const o=1e3;if(this.#gt){clearTimeout(this.#gt)}this.#gt=setTimeout((()=>{this.#gt=null;this.#pt[0]=this.#pt[1]=0;this.addCommands({cmd:()=>{for(const t of r){if(this.#I.has(t.id)){t.translateInPage(i,n);t.translationDone()}}},undo:()=>{for(const t of r){if(this.#I.has(t.id)){t.translateInPage(-i,-n);t.translationDone()}}},mustExec:false})}),o);for(const e of r){e.translateInPage(t,s);e.translationDone()}}setUpDragSession(){if(!this.hasSelection){return}this.disableUserSelect(true);this.#j=new Map;for(const t of this.#at){this.#j.set(t,{savedX:t.x,savedY:t.y,savedPageIndex:t.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#j){return false}this.disableUserSelect(false);const t=this.#j;this.#j=null;let s=false;for(const[{x:e,y:i,pageIndex:n},r]of t){r.newX=e;r.newY=i;r.newPageIndex=n;s||=e!==r.savedX||i!==r.savedY||n!==r.savedPageIndex}if(!s){return false}const e=(t,s,e,i)=>{if(this.#I.has(t.id)){const n=this.#D.get(i);if(n){t._setParentAndPosition(n,s,e)}else{t.pageIndex=i;t.x=s;t.y=e}}};this.addCommands({cmd:()=>{for(const[s,{newX:i,newY:n,newPageIndex:r}]of t){e(s,i,n,r)}},undo:()=>{for(const[s,{savedX:i,savedY:n,savedPageIndex:r}]of t){e(s,i,n,r)}},mustExec:true});return true}dragSelectedEditors(t,s){if(!this.#j){return}for(const e of this.#j.keys()){e.drag(t,s)}}rebuild(t){if(t.parent===null){const s=this.getLayer(t.pageIndex);if(s){s.changeParent(t);s.addOrRebuild(t)}else{this.addEditor(t);this.addToAnnotationStorage(t);t.rebuild()}}else{t.parent.addOrRebuild(t)}}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||this.#at.size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(t){return this.#N===t}getActive(){return this.#N}getMode(){return this.#ht}get imageManager(){return D(this,"imageManager",new Nt)}getSelectionBoxes(t){if(!t){return null}const s=document.getSelection();for(let e=0,i=s.rangeCount;e<i;e++){if(!t.contains(s.getRangeAt(e).commonAncestorContainer)){return null}}const{x:e,y:i,width:n,height:r}=t.getBoundingClientRect();let o;switch(t.getAttribute("data-main-rotation")){case"90":o=(t,s,o,h)=>({x:(s-i)/r,y:1-(t+o-e)/n,width:h/r,height:o/n});break;case"180":o=(t,s,o,h)=>({x:1-(t+o-e)/n,y:1-(s+h-i)/r,width:o/n,height:h/r});break;case"270":o=(t,s,o,h)=>({x:1-(s+h-i)/r,y:(t-e)/n,width:h/r,height:o/n});break;default:o=(t,s,o,h)=>({x:(t-e)/n,y:(s-i)/r,width:o/n,height:h/r});break}const h=[];for(let t=0,e=s.rangeCount;t<e;t++){const e=s.getRangeAt(t);if(e.collapsed){continue}for(const{x:t,y:s,width:i,height:n}of e.getClientRects()){if(i===0||n===0){continue}h.push(o(t,s,i,n))}}return h.length===0?null:h}addChangedExistingAnnotation({annotationElementId:t,id:s}){(this.#F||=new Map).set(t,s)}removeChangedExistingAnnotation({annotationElementId:t}){this.#F?.delete(t)}renderAnnotationElement(t){const s=this.#F?.get(t.data.id);if(!s){return}const e=this.#$.getRawValue(s);if(!e){return}if(this.#ht===u.NONE&&!e.hasBeenModified){return}e.renderAnnotationElement(t)}setMissingCanvas(t,s,e){const i=this.#rt?.get(t);if(!i){return}i.setCanvas(s,e);this.#rt.delete(t)}addMissingCanvas(t,s){(this.#rt||=new Map).set(t,s)}}class Ft{#h=null;#Ut=false;#jt=null;#Ht=null;#zt=null;#Gt=null;#Wt=false;#Vt=null;#r=null;#Xt=null;#Yt=null;#Qt=false;static#Kt=null;static _l10n=null;constructor(t){this.#r=t;this.#Qt=t._uiManager.useNewAltTextFlow;Ft.#Kt||=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"})}static initialize(t){Ft._l10n??=t}async render(){const t=this.#jt=document.createElement("button");t.className="altText";t.tabIndex="0";const s=this.#Ht=document.createElement("span");t.append(s);if(this.#Qt){t.classList.add("new");t.setAttribute("data-l10n-id",Ft.#Kt.missing);s.setAttribute("data-l10n-id",Ft.#Kt["missing-label"])}else{t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button");s.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label")}const e=this.#r._uiManager._signal;t.addEventListener("contextmenu",gt,{signal:e});t.addEventListener("pointerdown",(t=>t.stopPropagation()),{signal:e});const i=t=>{t.preventDefault();this.#r._uiManager.editAltText(this.#r);if(this.#Qt){this.#r._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:this.#qt}})}};t.addEventListener("click",i,{capture:true,signal:e});t.addEventListener("keydown",(s=>{if(s.target===t&&s.key==="Enter"){this.#Wt=true;i(s)}}),{signal:e});await this.#Jt();return t}get#qt(){return this.#h&&"added"||this.#h===null&&this.guessedText&&"review"||"missing"}finish(){if(!this.#jt){return}this.#jt.focus({focusVisible:this.#Wt});this.#Wt=false}isEmpty(){if(this.#Qt){return this.#h===null}return!this.#h&&!this.#Ut}hasData(){if(this.#Qt){return this.#h!==null||!!this.#Xt}return this.isEmpty()}get guessedText(){return this.#Xt}async setGuessedText(t){if(this.#h!==null){return}this.#Xt=t;this.#Yt=await Ft._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:t});this.#Jt()}toggleAltTextBadge(t=false){if(!this.#Qt||this.#h){this.#Vt?.remove();this.#Vt=null;return}if(!this.#Vt){const t=this.#Vt=document.createElement("div");t.className="noAltTextBadge";this.#r.div.append(t)}this.#Vt.classList.toggle("hidden",!t)}serialize(t){let s=this.#h;if(!t&&this.#Xt===s){s=this.#Yt}return{altText:s,decorative:this.#Ut,guessedText:this.#Xt,textWithDisclaimer:this.#Yt}}get data(){return{altText:this.#h,decorative:this.#Ut}}set data({altText:t,decorative:s,guessedText:e,textWithDisclaimer:i,cancel:n=false}){if(e){this.#Xt=e;this.#Yt=i}if(this.#h===t&&this.#Ut===s){return}if(!n){this.#h=t;this.#Ut=s}this.#Jt()}toggle(t=false){if(!this.#jt){return}if(!t&&this.#Gt){clearTimeout(this.#Gt);this.#Gt=null}this.#jt.disabled=!t}shown(){this.#r._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:this.#qt}})}destroy(){this.#jt?.remove();this.#jt=null;this.#Ht=null;this.#zt=null;this.#Vt?.remove();this.#Vt=null}async#Jt(){const t=this.#jt;if(!t){return}if(this.#Qt){t.classList.toggle("done",!!this.#h);t.setAttribute("data-l10n-id",Ft.#Kt[this.#qt]);this.#Ht?.setAttribute("data-l10n-id",Ft.#Kt[`${this.#qt}-label`]);if(!this.#h){this.#zt?.remove();return}}else{if(!this.#h&&!this.#Ut){t.classList.remove("done");this.#zt?.remove();return}t.classList.add("done");t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let s=this.#zt;if(!s){this.#zt=s=document.createElement("span");s.className="tooltip";s.setAttribute("role","tooltip");s.id=`alt-text-tooltip-${this.#r.id}`;const e=100;const i=this.#r._uiManager._signal;i.addEventListener("abort",(()=>{clearTimeout(this.#Gt);this.#Gt=null}),{once:true});t.addEventListener("mouseenter",(()=>{this.#Gt=setTimeout((()=>{this.#Gt=null;this.#zt.classList.add("show");this.#r._reportTelemetry({action:"alt_text_tooltip"})}),e)}),{signal:i});t.addEventListener("mouseleave",(()=>{if(this.#Gt){clearTimeout(this.#Gt);this.#Gt=null}this.#zt?.classList.remove("show")}),{signal:i})}if(this.#Ut){s.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip")}else{s.removeAttribute("data-l10n-id");s.textContent=this.#h}if(!s.parentNode){t.append(s)}const e=this.#r.getElementForAltText();e?.setAttribute("aria-describedby",s.id)}}class _t{#mt;#Zt=false;#ts=null;#ss;#es;#is;#ns;#rs=null;#os;#hs=null;#as;#cs=null;constructor({container:t,isPinchingDisabled:s=null,isPinchingStopped:e=null,onPinchStart:i=null,onPinching:n=null,onPinchEnd:r=null,signal:o}){this.#mt=t;this.#ts=e;this.#ss=s;this.#es=i;this.#is=n;this.#ns=r;this.#as=new AbortController;this.#os=AbortSignal.any([o,this.#as.signal]);t.addEventListener("touchstart",this.#ls.bind(this),{passive:false,signal:this.#os})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/kt.pixelRatio}#ls(t){if(this.#ss?.()){return}if(t.touches.length===1){if(this.#rs){return}const t=this.#rs=new AbortController;const s=AbortSignal.any([this.#os,t.signal]);const e=this.#mt;const i={capture:true,signal:s,passive:false};const n=t=>{if(t.pointerType==="touch"){this.#rs?.abort();this.#rs=null}};e.addEventListener("pointerdown",(t=>{if(t.pointerType==="touch"){mt(t);n(t)}}),i);e.addEventListener("pointerup",n,i);e.addEventListener("pointercancel",n,i);return}if(!this.#cs){this.#cs=new AbortController;const t=AbortSignal.any([this.#os,this.#cs.signal]);const s=this.#mt;const e={signal:t,capture:false,passive:false};s.addEventListener("touchmove",this.#us.bind(this),e);const i=this.#fs.bind(this);s.addEventListener("touchend",i,e);s.addEventListener("touchcancel",i,e);e.capture=true;s.addEventListener("pointerdown",mt,e);s.addEventListener("pointermove",mt,e);s.addEventListener("pointercancel",mt,e);s.addEventListener("pointerup",mt,e);this.#es?.()}mt(t);if(t.touches.length!==2||this.#ts?.()){this.#hs=null;return}let[s,e]=t.touches;if(s.identifier>e.identifier){[s,e]=[e,s]}this.#hs={touch0X:s.screenX,touch0Y:s.screenY,touch1X:e.screenX,touch1Y:e.screenY}}#us(t){if(!this.#hs||t.touches.length!==2){return}mt(t);let[s,e]=t.touches;if(s.identifier>e.identifier){[s,e]=[e,s]}const{screenX:i,screenY:n}=s;const{screenX:r,screenY:o}=e;const h=this.#hs;const{touch0X:a,touch0Y:c,touch1X:l,touch1Y:u}=h;const f=l-a;const d=u-c;const p=r-i;const g=o-n;const m=Math.hypot(p,g)||1;const A=Math.hypot(f,d)||1;if(!this.#Zt&&Math.abs(A-m)<=_t.MIN_TOUCH_DISTANCE_TO_PINCH){return}h.touch0X=i;h.touch0Y=n;h.touch1X=r;h.touch1Y=o;if(!this.#Zt){this.#Zt=true;return}const w=[(i+r)/2,(n+o)/2];this.#is?.(w,A,m)}#fs(t){if(t.touches.length>=2){return}if(this.#cs){this.#cs.abort();this.#cs=null;this.#ns?.()}if(!this.#hs){return}mt(t);this.#hs=null;this.#Zt=false}destroy(){this.#as?.abort();this.#as=null;this.#rs?.abort();this.#rs=null}}class Ot{#ds=null;#ps=null;#h=null;#gs=false;#ms=null;#As="";#ws=false;#bs=null;#ys=null;#vs=null;#xs=null;#Ms="";#ks=false;#Ss=null;#Es=false;#Cs=false;#Ts=false;#Ps=null;#Ns=0;#Is=0;#Ds=null;#Rs=null;_isCopy=false;_editToolbar=null;_initialOptions=Object.create(null);_initialData=null;_isVisible=true;_uiManager=null;_focusEventsAllowed=true;static _l10n=null;static _l10nResizer=null;#$s=false;#Fs=Ot._zIndex++;static _borderLineWidth=-1;static _colorManager=new Rt;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){const t=Ot.prototype._resizeWithKeyboard;const s=$t.TRANSLATE_SMALL;const e=$t.TRANSLATE_BIG;return D(this,"_resizerKeyboardManager",new Dt([[["ArrowLeft","mac+ArrowLeft"],t,{args:[-s,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t,{args:[-e,0]}],[["ArrowRight","mac+ArrowRight"],t,{args:[s,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t,{args:[e,0]}],[["ArrowUp","mac+ArrowUp"],t,{args:[0,-s]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t,{args:[0,-e]}],[["ArrowDown","mac+ArrowDown"],t,{args:[0,s]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t,{args:[0,e]}],[["Escape","mac+Escape"],Ot.prototype._stopResizingWithKeyboard]]))}constructor(t){this.parent=t.parent;this.id=t.id;this.width=this.height=null;this.pageIndex=t.parent.pageIndex;this.name=t.name;this.div=null;this._uiManager=t.uiManager;this.annotationElementId=null;this._willKeepAspectRatio=false;this._initialOptions.isCentered=t.isCentered;this._structTreeParentId=null;const{rotation:s,rawDims:{pageWidth:e,pageHeight:i,pageX:n,pageY:r}}=this.parent.viewport;this.rotation=s;this.pageRotation=(360+s-this._uiManager.viewParameters.rotation)%360;this.pageDimensions=[e,i];this.pageTranslation=[n,r];const[o,h]=this.parentDimensions;this.x=t.x/o;this.y=t.y/h;this.isAttachedToDOM=false;this.deleted=false}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get isDrawer(){return false}static get _defaultLineColor(){return D(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(t){const s=new Lt({id:t.parent.getNextId(),parent:t.parent,uiManager:t._uiManager});s.annotationElementId=t.annotationElementId;s.deleted=true;s._uiManager.addToAnnotationStorage(s)}static initialize(t,s){Ot._l10n??=t;Ot._l10nResizer||=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"});if(Ot._borderLineWidth!==-1){return}const e=getComputedStyle(document.documentElement);Ot._borderLineWidth=parseFloat(e.getPropertyValue("--outline-width"))||0}static updateDefaultParams(t,s){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(t){return false}static paste(t,s){C("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#$s}set _isDraggable(t){this.#$s=t;this.div?.classList.toggle("draggable",t)}get isEnterHandled(){return true}center(){const[t,s]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*s/(t*2);this.y+=this.width*t/(s*2);break;case 180:this.x+=this.width/2;this.y+=this.height/2;break;case 270:this.x+=this.height*s/(t*2);this.y-=this.width*t/(s*2);break;default:this.x-=this.width/2;this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(t){this._uiManager.addCommands(t)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#Fs}setParent(t){if(t!==null){this.pageIndex=t.pageIndex;this.pageDimensions=t.pageDimensions}else{this.#_s()}this.parent=t}focusin(t){if(!this._focusEventsAllowed){return}if(!this.#ks){this.parent.setSelected(this)}else{this.#ks=false}}focusout(t){if(!this._focusEventsAllowed){return}if(!this.isAttachedToDOM){return}const s=t.relatedTarget;if(s?.closest(`#${this.id}`)){return}t.preventDefault();if(!this.parent?.isMultipleSelection){this.commitOrRemove()}}commitOrRemove(){if(this.isEmpty()){this.remove()}else{this.commit()}}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(t,s,e,i){const[n,r]=this.parentDimensions;[e,i]=this.screenToPageTranslation(e,i);this.x=(t+e)/n;this.y=(s+i)/r;this.fixAndSetPosition()}_moveAfterPaste(t,s){const[e,i]=this.parentDimensions;this.setAt(t*e,s*i,this.width*e,this.height*i);this._onTranslated()}#Os([t,s],e,i){[e,i]=this.screenToPageTranslation(e,i);this.x+=e/t;this.y+=i/s;this._onTranslating(this.x,this.y);this.fixAndSetPosition()}translate(t,s){this.#Os(this.parentDimensions,t,s)}translateInPage(t,s){this.#Ss||=[this.x,this.y,this.width,this.height];this.#Os(this.pageDimensions,t,s);this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(t,s){this.#Ss||=[this.x,this.y,this.width,this.height];const{div:e,parentDimensions:[i,n]}=this;this.x+=t/i;this.y+=s/n;if(this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:t,y:s}=this.div.getBoundingClientRect();if(this.parent.findNewParent(this,t,s)){this.x-=Math.floor(this.x);this.y-=Math.floor(this.y)}}let{x:r,y:o}=this;const[h,a]=this.getBaseTranslation();r+=h;o+=a;const{style:c}=e;c.left=`${(100*r).toFixed(2)}%`;c.top=`${(100*o).toFixed(2)}%`;this._onTranslating(r,o);e.scrollIntoView({block:"nearest"})}_onTranslating(t,s){}_onTranslated(t,s){}get _hasBeenMoved(){return!!this.#Ss&&(this.#Ss[0]!==this.x||this.#Ss[1]!==this.y)}get _hasBeenResized(){return!!this.#Ss&&(this.#Ss[2]!==this.width||this.#Ss[3]!==this.height)}getBaseTranslation(){const[t,s]=this.parentDimensions;const{_borderLineWidth:e}=Ot;const i=e/t;const n=e/s;switch(this.rotation){case 90:return[-i,n];case 180:return[i,n];case 270:return[i,-n];default:return[-i,-n]}}get _mustFixPosition(){return true}fixAndSetPosition(t=this.rotation){const{div:{style:s},pageDimensions:[e,i]}=this;let{x:n,y:r,width:o,height:h}=this;o*=e;h*=i;n*=e;r*=i;if(this._mustFixPosition){switch(t){case 0:n=st(n,0,e-o);r=st(r,0,i-h);break;case 90:n=st(n,0,e-h);r=st(r,o,i);break;case 180:n=st(n,o,e);r=st(r,h,i);break;case 270:n=st(n,h,e);r=st(r,0,i-o);break}}this.x=n/=e;this.y=r/=i;const[a,c]=this.getBaseTranslation();n+=a;r+=c;s.left=`${(100*n).toFixed(2)}%`;s.top=`${(100*r).toFixed(2)}%`;this.moveInDOM()}static#Ls(t,s,e){switch(e){case 90:return[s,-t];case 180:return[-t,-s];case 270:return[-s,t];default:return[t,s]}}screenToPageTranslation(t,s){return Ot.#Ls(t,s,this.parentRotation)}pageTranslationToScreen(t,s){return Ot.#Ls(t,s,360-this.parentRotation)}#Bs(t){switch(t){case 90:{const[t,s]=this.pageDimensions;return[0,-t/s,s/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,s]=this.pageDimensions;return[0,t/s,-s/t,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:t,pageDimensions:[s,e]}=this;return[s*t,e*t]}setDims(t,s){const[e,i]=this.parentDimensions;const{style:n}=this.div;n.width=`${(100*t/e).toFixed(2)}%`;if(!this.#ws){n.height=`${(100*s/i).toFixed(2)}%`}}fixDims(){const{style:t}=this.div;const{height:s,width:e}=t;const i=e.endsWith("%");const n=!this.#ws&&s.endsWith("%");if(i&&n){return}const[r,o]=this.parentDimensions;if(!i){t.width=`${(100*parseFloat(e)/r).toFixed(2)}%`}if(!this.#ws&&!n){t.height=`${(100*parseFloat(s)/o).toFixed(2)}%`}}getInitialTranslation(){return[0,0]}#Us(){if(this.#bs){return}this.#bs=document.createElement("div");this.#bs.classList.add("resizers");const t=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"];const s=this._uiManager._signal;for(const e of t){const t=document.createElement("div");this.#bs.append(t);t.classList.add("resizer",e);t.setAttribute("data-resizer-name",e);t.addEventListener("pointerdown",this.#js.bind(this,e),{signal:s});t.addEventListener("contextmenu",gt,{signal:s});t.tabIndex=-1}this.div.prepend(this.#bs)}#js(t,s){s.preventDefault();const{isMac:e}=W.platform;if(s.button!==0||s.ctrlKey&&e){return}this.#h?.toggle(false);const i=this._isDraggable;this._isDraggable=false;this.#ys=[s.screenX,s.screenY];const n=new AbortController;const r=this._uiManager.combinedSignal(n);this.parent.togglePointerEvents(false);window.addEventListener("pointermove",this.#Hs.bind(this,t),{passive:true,capture:true,signal:r});window.addEventListener("touchmove",mt,{passive:false,signal:r});window.addEventListener("contextmenu",gt,{signal:r});this.#vs={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const o=this.parent.div.style.cursor;const h=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(s.target).cursor;const a=()=>{n.abort();this.parent.togglePointerEvents(true);this.#h?.toggle(true);this._isDraggable=i;this.parent.div.style.cursor=o;this.div.style.cursor=h;this.#zs()};window.addEventListener("pointerup",a,{signal:r});window.addEventListener("blur",a,{signal:r})}#Gs(t,s,e,i){this.width=e;this.height=i;this.x=t;this.y=s;const[n,r]=this.parentDimensions;this.setDims(n*e,r*i);this.fixAndSetPosition();this._onResized()}_onResized(){}#zs(){if(!this.#vs){return}const{savedX:t,savedY:s,savedWidth:e,savedHeight:i}=this.#vs;this.#vs=null;const n=this.x;const r=this.y;const o=this.width;const h=this.height;if(n===t&&r===s&&o===e&&h===i){return}this.addCommands({cmd:this.#Gs.bind(this,n,r,o,h),undo:this.#Gs.bind(this,t,s,e,i),mustExec:true})}static _round(t){return Math.round(t*1e4)/1e4}#Hs(t,s){const[e,i]=this.parentDimensions;const n=this.x;const r=this.y;const o=this.width;const h=this.height;const a=Ot.MIN_SIZE/e;const c=Ot.MIN_SIZE/i;const l=this.#Bs(this.rotation);const u=(t,s)=>[l[0]*t+l[2]*s,l[1]*t+l[3]*s];const f=this.#Bs(360-this.rotation);const d=(t,s)=>[f[0]*t+f[2]*s,f[1]*t+f[3]*s];let p;let g;let m=false;let A=false;switch(t){case"topLeft":m=true;p=(t,s)=>[0,0];g=(t,s)=>[t,s];break;case"topMiddle":p=(t,s)=>[t/2,0];g=(t,s)=>[t/2,s];break;case"topRight":m=true;p=(t,s)=>[t,0];g=(t,s)=>[0,s];break;case"middleRight":A=true;p=(t,s)=>[t,s/2];g=(t,s)=>[0,s/2];break;case"bottomRight":m=true;p=(t,s)=>[t,s];g=(t,s)=>[0,0];break;case"bottomMiddle":p=(t,s)=>[t/2,s];g=(t,s)=>[t/2,0];break;case"bottomLeft":m=true;p=(t,s)=>[0,s];g=(t,s)=>[t,0];break;case"middleLeft":A=true;p=(t,s)=>[0,s/2];g=(t,s)=>[t,s/2];break}const w=p(o,h);const b=g(o,h);let y=u(...b);const v=Ot._round(n+y[0]);const x=Ot._round(r+y[1]);let M=1;let k=1;let S,E;if(!s.fromKeyboard){const{screenX:t,screenY:e}=s;const[i,n]=this.#ys;[S,E]=this.screenToPageTranslation(t-i,e-n);this.#ys[0]=t;this.#ys[1]=e}else{({deltaX:S,deltaY:E}=s)}[S,E]=d(S/e,E/i);if(m){const t=Math.hypot(o,h);M=k=Math.max(Math.min(Math.hypot(b[0]-w[0]-S,b[1]-w[1]-E)/t,1/o,1/h),a/o,c/h)}else if(A){M=st(Math.abs(b[0]-w[0]-S),a,1)/o}else{k=st(Math.abs(b[1]-w[1]-E),c,1)/h}const C=Ot._round(o*M);const T=Ot._round(h*k);y=u(...g(C,T));const P=v-y[0];const N=x-y[1];this.#Ss||=[this.x,this.y,this.width,this.height];this.width=C;this.height=T;this.x=P;this.y=N;this.setDims(e*C,i*T);this.fixAndSetPosition();this._onResizing()}_onResizing(){}altTextFinish(){this.#h?.finish()}async addEditToolbar(){if(this._editToolbar||this.#Cs){return this._editToolbar}this._editToolbar=new Et(this);this.div.append(this._editToolbar.render());if(this.#h){await this._editToolbar.addAltText(this.#h)}return this._editToolbar}removeEditToolbar(){if(!this._editToolbar){return}this._editToolbar.remove();this._editToolbar=null;this.#h?.destroy()}addContainer(t){const s=this._editToolbar?.div;if(s){s.before(t)}else{this.div.append(t)}}getClientDimensions(){return this.div.getBoundingClientRect()}async addAltTextButton(){if(this.#h){return}Ft.initialize(Ot._l10n);this.#h=new Ft(this);if(this.#ds){this.#h.data=this.#ds;this.#ds=null}await this.addEditToolbar()}get altTextData(){return this.#h?.data}set altTextData(t){if(!this.#h){return}this.#h.data=t}get guessedAltText(){return this.#h?.guessedText}async setGuessedAltText(t){await(this.#h?.setGuessedText(t))}serializeAltText(t){return this.#h?.serialize(t)}hasAltText(){return!!this.#h&&!this.#h.isEmpty()}hasAltTextData(){return this.#h?.hasData()??false}render(){const t=this.div=document.createElement("div");t.setAttribute("data-editor-rotation",(360-this.rotation)%360);t.className=this.name;t.setAttribute("id",this.id);t.tabIndex=this.#gs?-1:0;t.setAttribute("role","application");if(this.defaultL10nId){t.setAttribute("data-l10n-id",this.defaultL10nId)}if(!this._isVisible){t.classList.add("hidden")}this.setInForeground();this.#Ws();const[s,e]=this.parentDimensions;if(this.parentRotation%180!==0){t.style.maxWidth=`${(100*e/s).toFixed(2)}%`;t.style.maxHeight=`${(100*s/e).toFixed(2)}%`}const[i,n]=this.getInitialTranslation();this.translate(i,n);Tt(this,t,["keydown","pointerdown"]);if(this.isResizable&&this._uiManager._supportsPinchToZoom){this.#Rs||=new _t({container:t,isPinchingDisabled:()=>!this.isSelected,onPinchStart:this.#Vs.bind(this),onPinching:this.#Xs.bind(this),onPinchEnd:this.#Ys.bind(this),signal:this._uiManager._signal})}this._uiManager._editorUndoBar?.hide();return t}#Vs(){this.#vs={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};this.#h?.toggle(false);this.parent.togglePointerEvents(false)}#Xs(t,s,e){const i=.7;let n=i*(e/s)+1-i;if(n===1){return}const r=this.#Bs(this.rotation);const o=(t,s)=>[r[0]*t+r[2]*s,r[1]*t+r[3]*s];const[h,a]=this.parentDimensions;const c=this.x;const l=this.y;const u=this.width;const f=this.height;const d=Ot.MIN_SIZE/h;const p=Ot.MIN_SIZE/a;n=Math.max(Math.min(n,1/u,1/f),d/u,p/f);const g=Ot._round(u*n);const m=Ot._round(f*n);if(g===u&&m===f){return}this.#Ss||=[c,l,u,f];const A=o(u/2,f/2);const w=Ot._round(c+A[0]);const b=Ot._round(l+A[1]);const y=o(g/2,m/2);this.x=w-y[0];this.y=b-y[1];this.width=g;this.height=m;this.setDims(h*g,a*m);this.fixAndSetPosition();this._onResizing()}#Ys(){this.#h?.toggle(true);this.parent.togglePointerEvents(true);this.#zs()}pointerdown(t){const{isMac:s}=W.platform;if(t.button!==0||t.ctrlKey&&s){t.preventDefault();return}this.#ks=true;if(this._isDraggable){this.#Qs(t);return}this.#Ks(t)}get isSelected(){return this._uiManager.isSelected(this)}#Ks(t){const{isMac:s}=W.platform;if(t.ctrlKey&&!s||t.shiftKey||t.metaKey&&s){this.parent.toggleSelected(this)}else{this.parent.setSelected(this)}}#Qs(t){const{isSelected:s}=this;this._uiManager.setUpDragSession();let e=false;const i=new AbortController;const n=this._uiManager.combinedSignal(i);const r={capture:true,passive:false,signal:n};const o=t=>{i.abort();this.#ms=null;this.#ks=false;if(!this._uiManager.endDragSession()){this.#Ks(t)}if(e){this._onStopDragging()}};if(s){this.#Ns=t.clientX;this.#Is=t.clientY;this.#ms=t.pointerId;this.#As=t.pointerType;window.addEventListener("pointermove",(t=>{if(!e){e=true;this._onStartDragging()}const{clientX:s,clientY:i,pointerId:n}=t;if(n!==this.#ms){mt(t);return}const[r,o]=this.screenToPageTranslation(s-this.#Ns,i-this.#Is);this.#Ns=s;this.#Is=i;this._uiManager.dragSelectedEditors(r,o)}),r);window.addEventListener("touchmove",mt,r);window.addEventListener("pointerdown",(t=>{if(t.pointerType===this.#As){if(this.#Rs||t.isPrimary){o(t)}}mt(t)}),r)}const h=t=>{if(!this.#ms||this.#ms===t.pointerId){o(t);return}mt(t)};window.addEventListener("pointerup",h,{signal:n});window.addEventListener("blur",h,{signal:n})}_onStartDragging(){}_onStopDragging(){}moveInDOM(){if(this.#Ps){clearTimeout(this.#Ps)}this.#Ps=setTimeout((()=>{this.#Ps=null;this.parent?.moveEditorInDOM(this)}),0)}_setParentAndPosition(t,s,e){t.changeParent(this);this.x=s;this.y=e;this.fixAndSetPosition();this._onTranslated()}getRect(t,s,e=this.rotation){const i=this.parentScale;const[n,r]=this.pageDimensions;const[o,h]=this.pageTranslation;const a=t/i;const c=s/i;const l=this.x*n;const u=this.y*r;const f=this.width*n;const d=this.height*r;switch(e){case 0:return[l+a+o,r-u-c-d+h,l+a+f+o,r-u-c+h];case 90:return[l+c+o,r-u+a+h,l+c+d+o,r-u+a+f+h];case 180:return[l-a-f+o,r-u+c+h,l-a+o,r-u+c+d+h];case 270:return[l-c-d+o,r-u-a-f+h,l-c+o,r-u-a+h];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(t,s){const[e,i,n,r]=t;const o=n-e;const h=r-i;switch(this.rotation){case 0:return[e,s-r,o,h];case 90:return[e,s-i,h,o];case 180:return[n,s-i,o,h];case 270:return[n,s-r,h,o];default:throw new Error("Invalid rotation")}}onceAdded(t){}isEmpty(){return false}enableEditMode(){this.#Cs=true}disableEditMode(){this.#Cs=false}isInEditMode(){return this.#Cs}shouldGetKeyboardEvents(){return this.#Ts}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:t,left:s,bottom:e,right:i}=this.getClientDimensions();const{innerHeight:n,innerWidth:r}=window;return s<r&&i>0&&t<n&&e>0}#Ws(){if(this.#xs||!this.div){return}this.#xs=new AbortController;const t=this._uiManager.combinedSignal(this.#xs);this.div.addEventListener("focusin",this.focusin.bind(this),{signal:t});this.div.addEventListener("focusout",this.focusout.bind(this),{signal:t})}rebuild(){this.#Ws()}rotate(t){}resize(){}serializeDeleted(){return{id:this.annotationElementId,deleted:true,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(t=false,s=null){C("An editor must be serializable")}static async deserialize(t,s,e){const i=new this.prototype.constructor({parent:s,id:s.getNextId(),uiManager:e});i.rotation=t.rotation;i.#ds=t.accessibilityData;i._isCopy=t.isCopy||false;const[n,r]=i.pageDimensions;const[o,h,a,c]=i.getRectInCurrentCoords(t.rect,r);i.x=o/n;i.y=h/r;i.width=a/n;i.height=c/r;return i}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){this.#xs?.abort();this.#xs=null;if(!this.isEmpty()){this.commit()}if(this.parent){this.parent.remove(this)}else{this._uiManager.removeEditor(this)}if(this.#Ps){clearTimeout(this.#Ps);this.#Ps=null}this.#_s();this.removeEditToolbar();if(this.#Ds){for(const t of this.#Ds.values()){clearTimeout(t)}this.#Ds=null}this.parent=null;this.#Rs?.destroy();this.#Rs=null}get isResizable(){return false}makeResizable(){if(this.isResizable){this.#Us();this.#bs.classList.remove("hidden")}}get toolbarPosition(){return null}keydown(t){if(!this.isResizable||t.target!==this.div||t.key!=="Enter"){return}this._uiManager.setSelected(this);this.#vs={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const s=this.#bs.children;if(!this.#ps){this.#ps=Array.from(s);const t=this.#qs.bind(this);const e=this.#Js.bind(this);const i=this._uiManager._signal;for(const s of this.#ps){const n=s.getAttribute("data-resizer-name");s.setAttribute("role","spinbutton");s.addEventListener("keydown",t,{signal:i});s.addEventListener("blur",e,{signal:i});s.addEventListener("focus",this.#Zs.bind(this,n),{signal:i});s.setAttribute("data-l10n-id",Ot._l10nResizer[n])}}const e=this.#ps[0];let i=0;for(const t of s){if(t===e){break}i++}const n=(360-this.rotation+this.parentRotation)%360/90*(this.#ps.length/4);if(n!==i){if(n<i){for(let t=0;t<i-n;t++){this.#bs.append(this.#bs.firstChild)}}else if(n>i){for(let t=0;t<n-i;t++){this.#bs.firstChild.before(this.#bs.lastChild)}}let t=0;for(const e of s){const s=this.#ps[t++];const i=s.getAttribute("data-resizer-name");e.setAttribute("data-l10n-id",Ot._l10nResizer[i])}}this.#te(0);this.#Ts=true;this.#bs.firstChild.focus({focusVisible:true});t.preventDefault();t.stopImmediatePropagation()}#qs(t){Ot._resizerKeyboardManager.exec(this,t)}#Js(t){if(this.#Ts&&t.relatedTarget?.parentNode!==this.#bs){this.#_s()}}#Zs(t){this.#Ms=this.#Ts?t:""}#te(t){if(!this.#ps){return}for(const s of this.#ps){s.tabIndex=t}}_resizeWithKeyboard(t,s){if(!this.#Ts){return}this.#Hs(this.#Ms,{deltaX:t,deltaY:s,fromKeyboard:true})}#_s(){this.#Ts=false;this.#te(-1);this.#zs()}_stopResizingWithKeyboard(){this.#_s();this.div.focus()}select(){this.makeResizable();this.div?.classList.add("selectedEditor");if(!this._editToolbar){this.addEditToolbar().then((()=>{if(this.div?.classList.contains("selectedEditor")){this._editToolbar?.show()}}));return}this._editToolbar?.show();this.#h?.toggleAltTextBadge(false)}unselect(){this.#bs?.classList.add("hidden");this.div?.classList.remove("selectedEditor");if(this.div?.contains(document.activeElement)){this._uiManager.currentLayer.div.focus({preventScroll:true})}this._editToolbar?.hide();this.#h?.toggleAltTextBadge(true)}updateParams(t,s){}disableEditing(){}enableEditing(){}enterInEditMode(){}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return this.#Es}set isEditing(t){this.#Es=t;if(!this.parent){return}if(t){this.parent.setSelected(this);this.parent.setActiveEditor(this)}else{this.parent.setActiveEditor(null)}}setAspectRatio(t,s){this.#ws=true;const e=t/s;const{style:i}=this.div;i.aspectRatio=e;i.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return true}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(t,s=false){if(s){this.#Ds||=new Map;const{action:s}=t;let e=this.#Ds.get(s);if(e){clearTimeout(e)}e=setTimeout((()=>{this._reportTelemetry(t);this.#Ds.delete(s);if(this.#Ds.size===0){this.#Ds=null}}),Ot._telemetryTimeout);this.#Ds.set(s,e);return}t.type||=this.editorType;this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:t}})}show(t=this._isVisible){this.div.classList.toggle("hidden",!t);this._isVisible=t}enable(){if(this.div){this.div.tabIndex=0}this.#gs=false}disable(){if(this.div){this.div.tabIndex=-1}this.#gs=true}renderAnnotationElement(t){let s=t.container.querySelector(".annotationContent");if(!s){s=document.createElement("div");s.classList.add("annotationContent",this.editorType);t.container.prepend(s)}else if(s.nodeName==="CANVAS"){const t=s;s=document.createElement("div");s.classList.add("annotationContent",this.editorType);t.before(s)}return s}resetAnnotationElement(t){const{firstChild:s}=t.container;if(s?.nodeName==="DIV"&&s.classList.contains("annotationContent")){s.remove()}}}class Lt extends Ot{constructor(t){super(t);this.annotationElementId=t.annotationElementId;this.deleted=true}serialize(){return this.serializeDeleted()}}const Bt=3285377520;const Ut=4294901760;const jt=65535;class Ht{constructor(t){this.h1=t?t&4294967295:Bt;this.h2=t?t&4294967295:Bt}update(t){let s,e;if(typeof t==="string"){s=new Uint8Array(t.length*2);e=0;for(let i=0,n=t.length;i<n;i++){const n=t.charCodeAt(i);if(n<=255){s[e++]=n}else{s[e++]=n>>>8;s[e++]=n&255}}}else if(ArrayBuffer.isView(t)){s=t.slice();e=s.byteLength}else{throw new Error("Invalid data format, must be a string or TypedArray.")}const i=e>>2;const n=e-i*4;const r=new Uint32Array(s.buffer,0,i);let o=0,h=0;let a=this.h1,c=this.h2;const l=3432918353,u=461845907;const f=l&jt,d=u&jt;for(let t=0;t<i;t++){if(t&1){o=r[t];o=o*l&Ut|o*f&jt;o=o<<15|o>>>17;o=o*u&Ut|o*d&jt;a^=o;a=a<<13|a>>>19;a=a*5+3864292196}else{h=r[t];h=h*l&Ut|h*f&jt;h=h<<15|h>>>17;h=h*u&Ut|h*d&jt;c^=h;c=c<<13|c>>>19;c=c*5+3864292196}}o=0;switch(n){case 3:o^=s[i*4+2]<<16;case 2:o^=s[i*4+1]<<8;case 1:o^=s[i*4];o=o*l&Ut|o*f&jt;o=o<<15|o>>>17;o=o*u&Ut|o*d&jt;if(i&1){a^=o}else{c^=o}}this.h1=a;this.h2=c}hexdigest(){let t=this.h1,s=this.h2;t^=s>>>1;t=t*3981806797&Ut|t*36045&jt;s=s*4283543511&Ut|((s<<16|t>>>16)*2950163797&Ut)>>>16;t^=s>>>1;t=t*444984403&Ut|t*60499&jt;s=s*3301882366&Ut|((s<<16|t>>>16)*3120437893&Ut)>>>16;t^=s>>>1;return(t>>>0).toString(16).padStart(8,"0")+(s>>>0).toString(16).padStart(8,"0")}}const zt=Object.freeze({map:null,hash:"",transfer:undefined});class Gt{#se=false;#ee=null;#ie=new Map;constructor(){this.onSetModified=null;this.onResetModified=null;this.onAnnotationEditor=null}getValue(t,s){const e=this.#ie.get(t);if(e===undefined){return s}return Object.assign(s,e)}getRawValue(t){return this.#ie.get(t)}remove(t){this.#ie.delete(t);if(this.#ie.size===0){this.resetModified()}if(typeof this.onAnnotationEditor==="function"){for(const t of this.#ie.values()){if(t instanceof Ot){return}}this.onAnnotationEditor(null)}}setValue(t,s){const e=this.#ie.get(t);let i=false;if(e!==undefined){for(const[t,n]of Object.entries(s)){if(e[t]!==n){i=true;e[t]=n}}}else{i=true;this.#ie.set(t,s)}if(i){this.#ne()}if(s instanceof Ot&&typeof this.onAnnotationEditor==="function"){this.onAnnotationEditor(s.constructor._type)}}has(t){return this.#ie.has(t)}get size(){return this.#ie.size}#ne(){if(!this.#se){this.#se=true;if(typeof this.onSetModified==="function"){this.onSetModified()}}}resetModified(){if(this.#se){this.#se=false;if(typeof this.onResetModified==="function"){this.onResetModified()}}}get print(){return new Wt(this)}get serializable(){if(this.#ie.size===0){return zt}const t=new Map,s=new Ht,e=[];const i=Object.create(null);let n=false;for(const[e,r]of this.#ie){const o=r instanceof Ot?r.serialize(false,i):r;if(o){t.set(e,o);s.update(`${e}:${JSON.stringify(o)}`);n||=!!o.bitmap}}if(n){for(const s of t.values()){if(s.bitmap){e.push(s.bitmap)}}}return t.size>0?{map:t,hash:s.hexdigest(),transfer:e}:zt}get editorStats(){let t=null;const s=new Map;for(const e of this.#ie.values()){if(!(e instanceof Ot)){continue}const i=e.telemetryFinalData;if(!i){continue}const{type:n}=i;if(!s.has(n)){s.set(n,Object.getPrototypeOf(e).constructor)}t||=Object.create(null);const r=t[n]||=new Map;for(const[t,s]of Object.entries(i)){if(t==="type"){continue}let e=r.get(t);if(!e){e=new Map;r.set(t,e)}const i=e.get(s)??0;e.set(s,i+1)}}for(const[e,i]of s){t[e]=i.computeTelemetryFinalData(t[e])}return t}resetModifiedIds(){this.#ee=null}get modifiedIds(){if(this.#ee){return this.#ee}const t=[];for(const s of this.#ie.values()){if(!(s instanceof Ot)||!s.annotationElementId||!s.serialize()){continue}t.push(s.annotationElementId)}return this.#ee={ids:new Set(t),hash:t.join(",")}}[Symbol.iterator](){return this.#ie.entries()}}class Wt extends Gt{#re;constructor(t){super();const{map:s,hash:e,transfer:i}=t.serializable;const n=structuredClone(s,i?{transfer:i}:null);this.#re={map:n,hash:e,transfer:i}}get print(){C("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#re}get modifiedIds(){return D(this,"modifiedIds",{ids:new Set,hash:""})}}class Vt{#oe=new Set;constructor({ownerDocument:t=globalThis.document,styleElement:s=null}){this._document=t;this.nativeFontFaces=new Set;this.styleElement=null;this.loadingRequests=[];this.loadTestFontId=0}addNativeFontFace(t){this.nativeFontFaces.add(t);this._document.fonts.add(t)}removeNativeFontFace(t){this.nativeFontFaces.delete(t);this._document.fonts.delete(t)}insertRule(t){if(!this.styleElement){this.styleElement=this._document.createElement("style");this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement)}const s=this.styleElement.sheet;s.insertRule(t,s.cssRules.length)}clear(){for(const t of this.nativeFontFaces){this._document.fonts.delete(t)}this.nativeFontFaces.clear();this.#oe.clear();if(this.styleElement){this.styleElement.remove();this.styleElement=null}}async loadSystemFont({systemFontInfo:t,disableFontFace:s,_inspectFont:e}){if(!t||this.#oe.has(t.loadedName)){return}T(!s,"loadSystemFont shouldn't be called when `disableFontFace` is set.");if(this.isFontLoadingAPISupported){const{loadedName:s,src:i,style:n}=t;const r=new FontFace(s,i,n);this.addNativeFontFace(r);try{await r.load();this.#oe.add(s);e?.(t)}catch{E(`Cannot load system font: ${t.baseFontName}, installing it could help to improve PDF rendering.`);this.removeNativeFontFace(r)}return}C("Not implemented: loadSystemFont without the Font Loading API.")}async bind(t){if(t.attached||t.missingFile&&!t.systemFontInfo){return}t.attached=true;if(t.systemFontInfo){await this.loadSystemFont(t);return}if(this.isFontLoadingAPISupported){const s=t.createNativeFontFace();if(s){this.addNativeFontFace(s);try{await s.loaded}catch(e){E(`Failed to load font '${s.family}': '${e}'.`);t.disableFontFace=true;throw e}}return}const s=t.createFontFaceRule();if(s){this.insertRule(s);if(this.isSyncFontLoadingSupported){return}await new Promise((s=>{const e=this._queueLoadingCallback(s);this._prepareFontLoadEvent(t,e)}))}}get isFontLoadingAPISupported(){const t=!!this._document?.fonts;return D(this,"isFontLoadingAPISupported",t)}get isSyncFontLoadingSupported(){return D(this,"isSyncFontLoadingSupported",r||W.platform.isFirefox)}_queueLoadingCallback(t){function s(){T(!i.done,"completeRequest() cannot be called twice.");i.done=true;while(e.length>0&&e[0].done){const t=e.shift();setTimeout(t.callback,0)}}const{loadingRequests:e}=this;const i={done:false,complete:s,callback:t};e.push(i);return i}get _loadTestFont(){const t=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQA"+"FQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAA"+"ALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgA"+"AAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1"+"AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD"+"6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACM"+"AooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4D"+"IP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAA"+"AAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUA"+"AQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgAB"+"AAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABY"+"AAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAA"+"AC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"+"AAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"+"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"+"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"+"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"+"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAA"+"AAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQAC"+"AQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3"+"Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTj"+"FQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return D(this,"_loadTestFont",t)}_prepareFontLoadEvent(t,s){function e(t,s){return t.charCodeAt(s)<<24|t.charCodeAt(s+1)<<16|t.charCodeAt(s+2)<<8|t.charCodeAt(s+3)&255}function i(t,s,e,i){const n=t.substring(0,s);const r=t.substring(s+e);return n+i+r}let n,r;const o=this._document.createElement("canvas");o.width=1;o.height=1;const h=o.getContext("2d");let a=0;function c(t,s){if(++a>30){E("Load test font never loaded.");s();return}h.font="30px "+t;h.fillText(".",0,20);const e=h.getImageData(0,0,1,1);if(e.data[3]>0){s();return}setTimeout(c.bind(null,t,s))}const l=`lt${Date.now()}${this.loadTestFontId++}`;let u=this._loadTestFont;const f=976;u=i(u,f,l.length,l);const d=16;const p=1482184792;let g=e(u,d);for(n=0,r=l.length-3;n<r;n+=4){g=g-p+e(l,n)|0}if(n<l.length){g=g-p+e(l+"XXX",n)|0}u=i(u,d,4,H(g));const m=`url(data:font/opentype;base64,${btoa(u)});`;const A=`@font-face {font-family:"${l}";src:${m}}`;this.insertRule(A);const w=this._document.createElement("div");w.style.visibility="hidden";w.style.width=w.style.height="10px";w.style.position="absolute";w.style.top=w.style.left="0px";for(const s of[t.loadedName,l]){const t=this._document.createElement("span");t.textContent="Hi";t.style.fontFamily=s;w.append(t)}this._document.body.append(w);c(l,(()=>{w.remove();s.complete()}))}}class Xt{constructor(t,s=null){this.compiledGlyphs=Object.create(null);for(const s in t){this[s]=t[s]}this._inspectFont=s}createNativeFontFace(){if(!this.data||this.disableFontFace){return null}let t;if(!this.cssFontInfo){t=new FontFace(this.loadedName,this.data,{})}else{const s={weight:this.cssFontInfo.fontWeight};if(this.cssFontInfo.italicAngle){s.style=`oblique ${this.cssFontInfo.italicAngle}deg`}t=new FontFace(this.cssFontInfo.fontFamily,this.data,s)}this._inspectFont?.(this);return t}createFontFaceRule(){if(!this.data||this.disableFontFace){return null}const t=`url(data:${this.mimetype};base64,${et(this.data)});`;let s;if(!this.cssFontInfo){s=`@font-face {font-family:"${this.loadedName}";src:${t}}`}else{let e=`font-weight: ${this.cssFontInfo.fontWeight};`;if(this.cssFontInfo.italicAngle){e+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`}s=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${e}src:${t}}`}this._inspectFont?.(this,t);return s}getPathGenerator(t,s){if(this.compiledGlyphs[s]!==undefined){return this.compiledGlyphs[s]}const e=this.loadedName+"_path_"+s;let i;try{i=t.get(e)}catch(t){E(`getPathGenerator - ignoring character: "${t}".`)}const n=new Path2D(i||"");if(!this.fontExtraProperties){t.delete(e)}return this.compiledGlyphs[s]=n}}const Yt={DATA:1,ERROR:2};const Qt={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function Kt(){}function qt(t){if(t instanceof B||t instanceof _||t instanceof $||t instanceof O||t instanceof F){return t}if(!(t instanceof Error||typeof t==="object"&&t!==null)){C('wrapReason: Expected "reason" to be a (possibly cloned) Error.')}switch(t.name){case"AbortException":return new B(t.message);case"InvalidPDFException":return new _(t.message);case"PasswordException":return new $(t.message,t.code);case"ResponseException":return new O(t.message,t.status,t.missing);case"UnknownErrorException":return new F(t.message,t.details)}return new F(t.message,t.toString())}class Jt{#he=new AbortController;constructor(t,s,e){this.sourceName=t;this.targetName=s;this.comObj=e;this.callbackId=1;this.streamId=1;this.streamSinks=Object.create(null);this.streamControllers=Object.create(null);this.callbackCapabilities=Object.create(null);this.actionHandler=Object.create(null);e.addEventListener("message",this.#ae.bind(this),{signal:this.#he.signal})}#ae({data:t}){if(t.targetName!==this.sourceName){return}if(t.stream){this.#ce(t);return}if(t.callback){const s=t.callbackId;const e=this.callbackCapabilities[s];if(!e){throw new Error(`Cannot resolve callback ${s}`)}delete this.callbackCapabilities[s];if(t.callback===Yt.DATA){e.resolve(t.data)}else if(t.callback===Yt.ERROR){e.reject(qt(t.reason))}else{throw new Error("Unexpected callback case")}return}const s=this.actionHandler[t.action];if(!s){throw new Error(`Unknown action from worker: ${t.action}`)}if(t.callbackId){const e=this.sourceName,i=t.sourceName,n=this.comObj;Promise.try(s,t.data).then((function(s){n.postMessage({sourceName:e,targetName:i,callback:Yt.DATA,callbackId:t.callbackId,data:s})}),(function(s){n.postMessage({sourceName:e,targetName:i,callback:Yt.ERROR,callbackId:t.callbackId,reason:qt(s)})}));return}if(t.streamId){this.#le(t);return}s(t.data)}on(t,s){const e=this.actionHandler;if(e[t]){throw new Error(`There is already an actionName called "${t}"`)}e[t]=s}send(t,s,e){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,data:s},e)}sendWithPromise(t,s,e){const i=this.callbackId++;const n=Promise.withResolvers();this.callbackCapabilities[i]=n;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,callbackId:i,data:s},e)}catch(t){n.reject(t)}return n.promise}sendWithStream(t,s,e,i){const n=this.streamId++,r=this.sourceName,o=this.targetName,h=this.comObj;return new ReadableStream({start:e=>{const a=Promise.withResolvers();this.streamControllers[n]={controller:e,startCall:a,pullCall:null,cancelCall:null,isClosed:false};h.postMessage({sourceName:r,targetName:o,action:t,streamId:n,data:s,desiredSize:e.desiredSize},i);return a.promise},pull:t=>{const s=Promise.withResolvers();this.streamControllers[n].pullCall=s;h.postMessage({sourceName:r,targetName:o,stream:Qt.PULL,streamId:n,desiredSize:t.desiredSize});return s.promise},cancel:t=>{T(t instanceof Error,"cancel must have a valid reason");const s=Promise.withResolvers();this.streamControllers[n].cancelCall=s;this.streamControllers[n].isClosed=true;h.postMessage({sourceName:r,targetName:o,stream:Qt.CANCEL,streamId:n,reason:qt(t)});return s.promise}},e)}#le(t){const s=t.streamId,e=this.sourceName,i=t.sourceName,n=this.comObj;const r=this,o=this.actionHandler[t.action];const h={enqueue(t,r=1,o){if(this.isCancelled){return}const h=this.desiredSize;this.desiredSize-=r;if(h>0&&this.desiredSize<=0){this.sinkCapability=Promise.withResolvers();this.ready=this.sinkCapability.promise}n.postMessage({sourceName:e,targetName:i,stream:Qt.ENQUEUE,streamId:s,chunk:t},o)},close(){if(this.isCancelled){return}this.isCancelled=true;n.postMessage({sourceName:e,targetName:i,stream:Qt.CLOSE,streamId:s});delete r.streamSinks[s]},error(t){T(t instanceof Error,"error must have a valid reason");if(this.isCancelled){return}this.isCancelled=true;n.postMessage({sourceName:e,targetName:i,stream:Qt.ERROR,streamId:s,reason:qt(t)})},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:false,desiredSize:t.desiredSize,ready:null};h.sinkCapability.resolve();h.ready=h.sinkCapability.promise;this.streamSinks[s]=h;Promise.try(o,t.data,h).then((function(){n.postMessage({sourceName:e,targetName:i,stream:Qt.START_COMPLETE,streamId:s,success:true})}),(function(t){n.postMessage({sourceName:e,targetName:i,stream:Qt.START_COMPLETE,streamId:s,reason:qt(t)})}))}#ce(t){const s=t.streamId,e=this.sourceName,i=t.sourceName,n=this.comObj;const r=this.streamControllers[s],o=this.streamSinks[s];switch(t.stream){case Qt.START_COMPLETE:if(t.success){r.startCall.resolve()}else{r.startCall.reject(qt(t.reason))}break;case Qt.PULL_COMPLETE:if(t.success){r.pullCall.resolve()}else{r.pullCall.reject(qt(t.reason))}break;case Qt.PULL:if(!o){n.postMessage({sourceName:e,targetName:i,stream:Qt.PULL_COMPLETE,streamId:s,success:true});break}if(o.desiredSize<=0&&t.desiredSize>0){o.sinkCapability.resolve()}o.desiredSize=t.desiredSize;Promise.try(o.onPull||Kt).then((function(){n.postMessage({sourceName:e,targetName:i,stream:Qt.PULL_COMPLETE,streamId:s,success:true})}),(function(t){n.postMessage({sourceName:e,targetName:i,stream:Qt.PULL_COMPLETE,streamId:s,reason:qt(t)})}));break;case Qt.ENQUEUE:T(r,"enqueue should have stream controller");if(r.isClosed){break}r.controller.enqueue(t.chunk);break;case Qt.CLOSE:T(r,"close should have stream controller");if(r.isClosed){break}r.isClosed=true;r.controller.close();this.#ue(r,s);break;case Qt.ERROR:T(r,"error should have stream controller");r.controller.error(qt(t.reason));this.#ue(r,s);break;case Qt.CANCEL_COMPLETE:if(t.success){r.cancelCall.resolve()}else{r.cancelCall.reject(qt(t.reason))}this.#ue(r,s);break;case Qt.CANCEL:if(!o){break}const h=qt(t.reason);Promise.try(o.onCancel||Kt,h).then((function(){n.postMessage({sourceName:e,targetName:i,stream:Qt.CANCEL_COMPLETE,streamId:s,success:true})}),(function(t){n.postMessage({sourceName:e,targetName:i,stream:Qt.CANCEL_COMPLETE,streamId:s,reason:qt(t)})}));o.sinkCapability.reject(h);o.isCancelled=true;delete this.streamSinks[s];break;default:throw new Error("Unexpected stream case")}}async#ue(t,s){await Promise.allSettled([t.startCall?.promise,t.pullCall?.promise,t.cancelCall?.promise]);delete this.streamControllers[s]}destroy(){this.#he?.abort();this.#he=null}}class Zt{#fe=false;constructor({enableHWA:t=false}){this.#fe=t}create(t,s){if(t<=0||s<=0){throw new Error("Invalid canvas size")}const e=this._createCanvas(t,s);return{canvas:e,context:e.getContext("2d",{willReadFrequently:!this.#fe})}}reset(t,s,e){if(!t.canvas){throw new Error("Canvas is not specified")}if(s<=0||e<=0){throw new Error("Invalid canvas size")}t.canvas.width=s;t.canvas.height=e}destroy(t){if(!t.canvas){throw new Error("Canvas is not specified")}t.canvas.width=0;t.canvas.height=0;t.canvas=null;t.context=null}_createCanvas(t,s){C("Abstract method `_createCanvas` called.")}}class ts extends Zt{constructor({ownerDocument:t=globalThis.document,enableHWA:s=false}){super({enableHWA:s});this._document=t}_createCanvas(t,s){const e=this._document.createElement("canvas");e.width=t;e.height=s;return e}}class ss{constructor({baseUrl:t=null,isCompressed:s=true}){this.baseUrl=t;this.isCompressed=s}async fetch({name:t}){if(!this.baseUrl){throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.")}if(!t){throw new Error("CMap name must be specified.")}const s=this.baseUrl+t+(this.isCompressed?".bcmap":"");return this._fetch(s).then((t=>({cMapData:t,isCompressed:this.isCompressed}))).catch((t=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${s}`)}))}async _fetch(t){C("Abstract method `_fetch` called.")}}class es extends ss{async _fetch(t){const s=await ot(t,this.isCompressed?"arraybuffer":"text");return s instanceof ArrayBuffer?new Uint8Array(s):j(s)}}class is{addFilter(t){return"none"}addHCMFilter(t,s){return"none"}addAlphaFilter(t){return"none"}addLuminosityFilter(t){return"none"}addHighlightHCMFilter(t,s,e,i,n){return"none"}destroy(t=false){}}class ns extends is{#de;#pe;#ge;#me;#Ae;#we;#y=0;constructor({docId:t,ownerDocument:s=globalThis.document}){super();this.#me=t;this.#Ae=s}get#x(){return this.#pe||=new Map}get#be(){return this.#we||=new Map}get#ye(){if(!this.#ge){const t=this.#Ae.createElement("div");const{style:s}=t;s.visibility="hidden";s.contain="strict";s.width=s.height=0;s.position="absolute";s.top=s.left=0;s.zIndex=-1;const e=this.#Ae.createElementNS(nt,"svg");e.setAttribute("width",0);e.setAttribute("height",0);this.#ge=this.#Ae.createElementNS(nt,"defs");t.append(e);e.append(this.#ge);this.#Ae.body.append(t)}return this.#ge}#ve(t){if(t.length===1){const s=t[0];const e=new Array(256);for(let t=0;t<256;t++){e[t]=s[t]/255}const i=e.join(",");return[i,i,i]}const[s,e,i]=t;const n=new Array(256);const r=new Array(256);const o=new Array(256);for(let t=0;t<256;t++){n[t]=s[t]/255;r[t]=e[t]/255;o[t]=i[t]/255}return[n.join(","),r.join(","),o.join(",")]}#xe(t){if(this.#de===undefined){this.#de="";const t=this.#Ae.URL;if(t!==this.#Ae.baseURI){if(ct(t)){E('#createUrl: ignore "data:"-URL for performance reasons.')}else{this.#de=I(t,"")}}}return`url(${this.#de}#${t})`}addFilter(t){if(!t){return"none"}let s=this.#x.get(t);if(s){return s}const[e,i,n]=this.#ve(t);const r=t.length===1?e:`${e}${i}${n}`;s=this.#x.get(r);if(s){this.#x.set(t,s);return s}const o=`g_${this.#me}_transfer_map_${this.#y++}`;const h=this.#xe(o);this.#x.set(t,h);this.#x.set(r,h);const a=this.#Me(o);this.#ke(e,i,n,a);return h}addHCMFilter(t,s){const e=`${t}-${s}`;const i="base";let n=this.#be.get(i);if(n?.key===e){return n.url}if(n){n.filter?.remove();n.key=e;n.url="none";n.filter=null}else{n={key:e,url:"none",filter:null};this.#be.set(i,n)}if(!t||!s){return n.url}const r=this.#Se(t);t=X.makeHexColor(...r);const o=this.#Se(s);s=X.makeHexColor(...o);this.#ye.style.color="";if(t==="#000000"&&s==="#ffffff"||t===s){return n.url}const h=new Array(256);for(let t=0;t<=255;t++){const s=t/255;h[t]=s<=.03928?s/12.92:((s+.055)/1.055)**2.4}const a=h.join(",");const c=`g_${this.#me}_hcm_filter`;const l=n.filter=this.#Me(c);this.#ke(a,a,a,l);this.#Ee(l);const u=(t,s)=>{const e=r[t]/255;const i=o[t]/255;const n=new Array(s+1);for(let t=0;t<=s;t++){n[t]=e+t/s*(i-e)}return n.join(",")};this.#ke(u(0,5),u(1,5),u(2,5),l);n.url=this.#xe(c);return n.url}addAlphaFilter(t){let s=this.#x.get(t);if(s){return s}const[e]=this.#ve([t]);const i=`alpha_${e}`;s=this.#x.get(i);if(s){this.#x.set(t,s);return s}const n=`g_${this.#me}_alpha_map_${this.#y++}`;const r=this.#xe(n);this.#x.set(t,r);this.#x.set(i,r);const o=this.#Me(n);this.#Ce(e,o);return r}addLuminosityFilter(t){let s=this.#x.get(t||"luminosity");if(s){return s}let e,i;if(t){[e]=this.#ve([t]);i=`luminosity_${e}`}else{i="luminosity"}s=this.#x.get(i);if(s){this.#x.set(t,s);return s}const n=`g_${this.#me}_luminosity_map_${this.#y++}`;const r=this.#xe(n);this.#x.set(t,r);this.#x.set(i,r);const o=this.#Me(n);this.#Te(o);if(t){this.#Ce(e,o)}return r}addHighlightHCMFilter(t,s,e,i,n){const r=`${s}-${e}-${i}-${n}`;let o=this.#be.get(t);if(o?.key===r){return o.url}if(o){o.filter?.remove();o.key=r;o.url="none";o.filter=null}else{o={key:r,url:"none",filter:null};this.#be.set(t,o)}if(!s||!e){return o.url}const[h,a]=[s,e].map(this.#Se.bind(this));let c=Math.round(.2126*h[0]+.7152*h[1]+.0722*h[2]);let l=Math.round(.2126*a[0]+.7152*a[1]+.0722*a[2]);let[u,f]=[i,n].map(this.#Se.bind(this));if(l<c){[c,l,u,f]=[l,c,f,u]}this.#ye.style.color="";const d=(t,s,e)=>{const i=new Array(256);const n=(l-c)/e;const r=t/255;const o=(s-t)/(255*e);let h=0;for(let t=0;t<=e;t++){const s=Math.round(c+t*n);const e=r+t*o;for(let t=h;t<=s;t++){i[t]=e}h=s+1}for(let t=h;t<256;t++){i[t]=i[h-1]}return i.join(",")};const p=`g_${this.#me}_hcm_${t}_filter`;const g=o.filter=this.#Me(p);this.#Ee(g);this.#ke(d(u[0],f[0],5),d(u[1],f[1],5),d(u[2],f[2],5),g);o.url=this.#xe(p);return o.url}destroy(t=false){if(t&&this.#we?.size){return}this.#ge?.parentNode.parentNode.remove();this.#ge=null;this.#pe?.clear();this.#pe=null;this.#we?.clear();this.#we=null;this.#y=0}#Te(t){const s=this.#Ae.createElementNS(nt,"feColorMatrix");s.setAttribute("type","matrix");s.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0");t.append(s)}#Ee(t){const s=this.#Ae.createElementNS(nt,"feColorMatrix");s.setAttribute("type","matrix");s.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0");t.append(s)}#Me(t){const s=this.#Ae.createElementNS(nt,"filter");s.setAttribute("color-interpolation-filters","sRGB");s.setAttribute("id",t);this.#ye.append(s);return s}#Pe(t,s,e){const i=this.#Ae.createElementNS(nt,s);i.setAttribute("type","discrete");i.setAttribute("tableValues",e);t.append(i)}#ke(t,s,e,i){const n=this.#Ae.createElementNS(nt,"feComponentTransfer");i.append(n);this.#Pe(n,"feFuncR",t);this.#Pe(n,"feFuncG",s);this.#Pe(n,"feFuncB",e)}#Ce(t,s){const e=this.#Ae.createElementNS(nt,"feComponentTransfer");s.append(e);this.#Pe(e,"feFuncA",t)}#Se(t){this.#ye.style.color=t;return bt(getComputedStyle(this.#ye).getPropertyValue("color"))}}class rs{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl){throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.")}if(!t){throw new Error("Font filename must be specified.")}const s=`${this.baseUrl}${t}`;return this._fetch(s).catch((t=>{throw new Error(`Unable to load font data at: ${s}`)}))}async _fetch(t){C("Abstract method `_fetch` called.")}}class os extends rs{async _fetch(t){const s=await ot(t,"arraybuffer");return new Uint8Array(s)}}class hs{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl){throw new Error("Ensure that the `wasmUrl` API parameter is provided.")}if(!t){throw new Error("Wasm filename must be specified.")}const s=`${this.baseUrl}${t}`;return this._fetch(s).catch((t=>{throw new Error(`Unable to load wasm data at: ${s}`)}))}async _fetch(t){C("Abstract method `_fetch` called.")}}class as extends hs{async _fetch(t){const s=await ot(t,"arraybuffer");return new Uint8Array(s)}}if(r){E("Please use the `legacy` build in Node.js environments.")}async function cs(t){const s=process.getBuiltinModule("fs");const e=await s.promises.readFile(t);return new Uint8Array(e)}class ls extends is{}class us extends Zt{_createCanvas(t,s){const e=process.getBuiltinModule("module").createRequire(import.meta.url);const i=e("@napi-rs/canvas");return i.createCanvas(t,s)}}class fs extends ss{async _fetch(t){return cs(t)}}class ds extends rs{async _fetch(t){return cs(t)}}class ps extends hs{async _fetch(t){return cs(t)}}const gs={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function ms(t,s){if(!s){return}const e=s[2]-s[0];const i=s[3]-s[1];const n=new Path2D;n.rect(s[0],s[1],e,i);t.clip(n)}class As{isModifyingCurrentTransform(){return false}getPattern(){C("Abstract method `getPattern` called.")}}class ws extends As{constructor(t){super();this._type=t[1];this._bbox=t[2];this._colorStops=t[3];this._p0=t[4];this._p1=t[5];this._r0=t[6];this._r1=t[7];this.matrix=null}_createGradient(t){let s;if(this._type==="axial"){s=t.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1])}else if(this._type==="radial"){s=t.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1)}for(const t of this._colorStops){s.addColorStop(t[0],t[1])}return s}getPattern(t,s,e,i){let n;if(i===gs.STROKE||i===gs.FILL){const r=s.current.getClippedPathBoundingBox(i,vt(t))||[0,0,0,0];const o=Math.ceil(r[2]-r[0])||1;const h=Math.ceil(r[3]-r[1])||1;const a=s.cachedCanvases.getCanvas("pattern",o,h);const c=a.context;c.clearRect(0,0,c.canvas.width,c.canvas.height);c.beginPath();c.rect(0,0,c.canvas.width,c.canvas.height);c.translate(-r[0],-r[1]);e=X.transform(e,[1,0,0,1,r[0],r[1]]);c.transform(...s.baseTransform);if(this.matrix){c.transform(...this.matrix)}ms(c,this._bbox);c.fillStyle=this._createGradient(c);c.fill();n=t.createPattern(a.canvas,"no-repeat");const l=new DOMMatrix(e);n.setTransform(l)}else{ms(t,this._bbox);n=this._createGradient(t)}return n}}function bs(t,s,e,i,n,r,o,h){const a=s.coords,c=s.colors;const l=t.data,u=t.width*4;let f;if(a[e+1]>a[i+1]){f=e;e=i;i=f;f=r;r=o;o=f}if(a[i+1]>a[n+1]){f=i;i=n;n=f;f=o;o=h;h=f}if(a[e+1]>a[i+1]){f=e;e=i;i=f;f=r;r=o;o=f}const d=(a[e]+s.offsetX)*s.scaleX;const p=(a[e+1]+s.offsetY)*s.scaleY;const g=(a[i]+s.offsetX)*s.scaleX;const m=(a[i+1]+s.offsetY)*s.scaleY;const A=(a[n]+s.offsetX)*s.scaleX;const w=(a[n+1]+s.offsetY)*s.scaleY;if(p>=w){return}const b=c[r],y=c[r+1],v=c[r+2];const x=c[o],M=c[o+1],k=c[o+2];const S=c[h],E=c[h+1],C=c[h+2];const T=Math.round(p),P=Math.round(w);let N,I,D,R;let $,F,_,O;for(let t=T;t<=P;t++){if(t<m){const s=t<p?0:(p-t)/(p-m);N=d-(d-g)*s;I=b-(b-x)*s;D=y-(y-M)*s;R=v-(v-k)*s}else{let s;if(t>w){s=1}else if(m===w){s=0}else{s=(m-t)/(m-w)}N=g-(g-A)*s;I=x-(x-S)*s;D=M-(M-E)*s;R=k-(k-C)*s}let s;if(t<p){s=0}else if(t>w){s=1}else{s=(p-t)/(p-w)}$=d-(d-A)*s;F=b-(b-S)*s;_=y-(y-E)*s;O=v-(v-C)*s;const e=Math.round(Math.min(N,$));const i=Math.round(Math.max(N,$));let n=u*t+e*4;for(let t=e;t<=i;t++){s=(N-t)/(N-$);if(s<0){s=0}else if(s>1){s=1}l[n++]=I-(I-F)*s|0;l[n++]=D-(D-_)*s|0;l[n++]=R-(R-O)*s|0;l[n++]=255}}}function ys(t,s,e){const i=s.coords;const n=s.colors;let r,o;switch(s.type){case"lattice":const h=s.verticesPerRow;const a=Math.floor(i.length/h)-1;const c=h-1;for(r=0;r<a;r++){let s=r*h;for(let r=0;r<c;r++,s++){bs(t,e,i[s],i[s+1],i[s+h],n[s],n[s+1],n[s+h]);bs(t,e,i[s+h+1],i[s+1],i[s+h],n[s+h+1],n[s+1],n[s+h])}}break;case"triangles":for(r=0,o=i.length;r<o;r+=3){bs(t,e,i[r],i[r+1],i[r+2],n[r],n[r+1],n[r+2])}break;default:throw new Error("illegal figure")}}class vs extends As{constructor(t){super();this._coords=t[2];this._colors=t[3];this._figures=t[4];this._bounds=t[5];this._bbox=t[6];this._background=t[7];this.matrix=null}_createMeshCanvas(t,s,e){const i=1.1;const n=3e3;const r=2;const o=Math.floor(this._bounds[0]);const h=Math.floor(this._bounds[1]);const a=Math.ceil(this._bounds[2])-o;const c=Math.ceil(this._bounds[3])-h;const l=Math.min(Math.ceil(Math.abs(a*t[0]*i)),n);const u=Math.min(Math.ceil(Math.abs(c*t[1]*i)),n);const f=a/l;const d=c/u;const p={coords:this._coords,colors:this._colors,offsetX:-o,offsetY:-h,scaleX:1/f,scaleY:1/d};const g=l+r*2;const m=u+r*2;const A=e.getCanvas("mesh",g,m);const w=A.context;const b=w.createImageData(l,u);if(s){const t=b.data;for(let e=0,i=t.length;e<i;e+=4){t[e]=s[0];t[e+1]=s[1];t[e+2]=s[2];t[e+3]=255}}for(const t of this._figures){ys(b,t,p)}w.putImageData(b,r,r);const y=A.canvas;return{canvas:y,offsetX:o-r*f,offsetY:h-r*d,scaleX:f,scaleY:d}}isModifyingCurrentTransform(){return true}getPattern(t,s,e,i){ms(t,this._bbox);const n=new Float32Array(2);if(i===gs.SHADING){X.singularValueDecompose2dScale(vt(t),n)}else if(this.matrix){X.singularValueDecompose2dScale(this.matrix,n);const[t,e]=n;X.singularValueDecompose2dScale(s.baseTransform,n);n[0]*=t;n[1]*=e}else{X.singularValueDecompose2dScale(s.baseTransform,n)}const r=this._createMeshCanvas(n,i===gs.SHADING?null:this._background,s.cachedCanvases);if(i!==gs.SHADING){t.setTransform(...s.baseTransform);if(this.matrix){t.transform(...this.matrix)}}t.translate(r.offsetX,r.offsetY);t.scale(r.scaleX,r.scaleY);return t.createPattern(r.canvas,"no-repeat")}}class xs extends As{getPattern(){return"hotpink"}}function Ms(t){switch(t[0]){case"RadialAxial":return new ws(t);case"Mesh":return new vs(t);case"Dummy":return new xs}throw new Error(`Unknown IR type: ${t[0]}`)}const ks={COLORED:1,UNCOLORED:2};class Ss{static MAX_PATTERN_SIZE=3e3;constructor(t,s,e,i){this.color=t[1];this.operatorList=t[2];this.matrix=t[3];this.bbox=t[4];this.xstep=t[5];this.ystep=t[6];this.paintType=t[7];this.tilingType=t[8];this.ctx=s;this.canvasGraphicsFactory=e;this.baseTransform=i}createPatternCanvas(t){const{bbox:s,operatorList:e,paintType:i,tilingType:n,color:r,canvasGraphicsFactory:o}=this;let{xstep:h,ystep:a}=this;h=Math.abs(h);a=Math.abs(a);S("TilingType: "+n);const c=s[0],l=s[1],u=s[2],f=s[3];const d=u-c;const p=f-l;const g=new Float32Array(2);X.singularValueDecompose2dScale(this.matrix,g);const[m,A]=g;X.singularValueDecompose2dScale(this.baseTransform,g);const w=m*g[0];const b=A*g[1];let y=d,v=p,x=false,M=false;const k=Math.ceil(h*w);const E=Math.ceil(a*b);const C=Math.ceil(d*w);const T=Math.ceil(p*b);if(k>=C){y=h}else{x=true}if(E>=T){v=a}else{M=true}const P=this.getSizeAndScale(y,this.ctx.canvas.width,w);const N=this.getSizeAndScale(v,this.ctx.canvas.height,b);const I=t.cachedCanvases.getCanvas("pattern",P.size,N.size);const D=I.context;const R=o.createCanvasGraphics(D);R.groupLevel=t.groupLevel;this.setFillAndStrokeStyleToContext(R,i,r);D.translate(-P.scale*c,-N.scale*l);R.transform(P.scale,0,0,N.scale,0,0);D.save();this.clipBbox(R,c,l,u,f);R.baseTransform=vt(R.ctx);R.executeOperatorList(e);R.endDrawing();D.restore();if(x||M){const s=I.canvas;if(x){y=h}if(M){v=a}const e=this.getSizeAndScale(y,this.ctx.canvas.width,w);const i=this.getSizeAndScale(v,this.ctx.canvas.height,b);const n=e.size;const r=i.size;const o=t.cachedCanvases.getCanvas("pattern-workaround",n,r);const u=o.context;const f=x?Math.floor(d/h):0;const g=M?Math.floor(p/a):0;for(let t=0;t<=f;t++){for(let e=0;e<=g;e++){u.drawImage(s,n*t,r*e,n,r,0,0,n,r)}}return{canvas:o.canvas,scaleX:e.scale,scaleY:i.scale,offsetX:c,offsetY:l}}return{canvas:I.canvas,scaleX:P.scale,scaleY:N.scale,offsetX:c,offsetY:l}}getSizeAndScale(t,s,e){const i=Math.max(Ss.MAX_PATTERN_SIZE,s);let n=Math.ceil(t*e);if(n>=i){n=i}else{e=n/t}return{scale:e,size:n}}clipBbox(t,s,e,i,n){const r=i-s;const o=n-e;t.ctx.rect(s,e,r,o);X.axialAlignedBoundingBox([s,e,i,n],vt(t.ctx),t.current.minMax);t.clip();t.endPath()}setFillAndStrokeStyleToContext(t,s,e){const i=t.ctx,n=t.current;switch(s){case ks.COLORED:const t=this.ctx;i.fillStyle=t.fillStyle;i.strokeStyle=t.strokeStyle;n.fillColor=t.fillStyle;n.strokeColor=t.strokeStyle;break;case ks.UNCOLORED:const r=X.makeHexColor(e[0],e[1],e[2]);i.fillStyle=r;i.strokeStyle=r;n.fillColor=r;n.strokeColor=r;break;default:throw new L(`Unsupported paint type: ${s}`)}}isModifyingCurrentTransform(){return false}getPattern(t,s,e,i){let n=e;if(i!==gs.SHADING){n=X.transform(n,s.baseTransform);if(this.matrix){n=X.transform(n,this.matrix)}}const r=this.createPatternCanvas(s);let o=new DOMMatrix(n);o=o.translate(r.offsetX,r.offsetY);o=o.scale(1/r.scaleX,1/r.scaleY);const h=t.createPattern(r.canvas,"repeat");h.setTransform(o);return h}}function Es({src:t,srcPos:s=0,dest:e,width:i,height:n,nonBlackColor:r=4294967295,inverseDecode:o=false}){const h=W.isLittleEndian?4278190080:255;const[a,c]=o?[r,h]:[h,r];const l=i>>3;const u=i&7;const f=t.length;e=new Uint32Array(e.buffer);let d=0;for(let i=0;i<n;i++){for(const i=s+l;s<i;s++){const i=s<f?t[s]:255;e[d++]=i&128?c:a;e[d++]=i&64?c:a;e[d++]=i&32?c:a;e[d++]=i&16?c:a;e[d++]=i&8?c:a;e[d++]=i&4?c:a;e[d++]=i&2?c:a;e[d++]=i&1?c:a}if(u===0){continue}const i=s<f?t[s++]:255;for(let t=0;t<u;t++){e[d++]=i&1<<7-t?c:a}}return{srcPos:s,destPos:d}}const Cs=16;const Ts=100;const Ps=15;const Ns=10;const Is=16;const Ds=new DOMMatrix;const Rs=new Float32Array(2);const $s=new Float32Array([Infinity,Infinity,-Infinity,-Infinity]);function Fs(t,s){if(t._removeMirroring){throw new Error("Context is already forwarding operations.")}t.__originalSave=t.save;t.__originalRestore=t.restore;t.__originalRotate=t.rotate;t.__originalScale=t.scale;t.__originalTranslate=t.translate;t.__originalTransform=t.transform;t.__originalSetTransform=t.setTransform;t.__originalResetTransform=t.resetTransform;t.__originalClip=t.clip;t.__originalMoveTo=t.moveTo;t.__originalLineTo=t.lineTo;t.__originalBezierCurveTo=t.bezierCurveTo;t.__originalRect=t.rect;t.__originalClosePath=t.closePath;t.__originalBeginPath=t.beginPath;t._removeMirroring=()=>{t.save=t.__originalSave;t.restore=t.__originalRestore;t.rotate=t.__originalRotate;t.scale=t.__originalScale;t.translate=t.__originalTranslate;t.transform=t.__originalTransform;t.setTransform=t.__originalSetTransform;t.resetTransform=t.__originalResetTransform;t.clip=t.__originalClip;t.moveTo=t.__originalMoveTo;t.lineTo=t.__originalLineTo;t.bezierCurveTo=t.__originalBezierCurveTo;t.rect=t.__originalRect;t.closePath=t.__originalClosePath;t.beginPath=t.__originalBeginPath;delete t._removeMirroring};t.save=function(){s.save();this.__originalSave()};t.restore=function(){s.restore();this.__originalRestore()};t.translate=function(t,e){s.translate(t,e);this.__originalTranslate(t,e)};t.scale=function(t,e){s.scale(t,e);this.__originalScale(t,e)};t.transform=function(t,e,i,n,r,o){s.transform(t,e,i,n,r,o);this.__originalTransform(t,e,i,n,r,o)};t.setTransform=function(t,e,i,n,r,o){s.setTransform(t,e,i,n,r,o);this.__originalSetTransform(t,e,i,n,r,o)};t.resetTransform=function(){s.resetTransform();this.__originalResetTransform()};t.rotate=function(t){s.rotate(t);this.__originalRotate(t)};t.clip=function(t){s.clip(t);this.__originalClip(t)};t.moveTo=function(t,e){s.moveTo(t,e);this.__originalMoveTo(t,e)};t.lineTo=function(t,e){s.lineTo(t,e);this.__originalLineTo(t,e)};t.bezierCurveTo=function(t,e,i,n,r,o){s.bezierCurveTo(t,e,i,n,r,o);this.__originalBezierCurveTo(t,e,i,n,r,o)};t.rect=function(t,e,i,n){s.rect(t,e,i,n);this.__originalRect(t,e,i,n)};t.closePath=function(){s.closePath();this.__originalClosePath()};t.beginPath=function(){s.beginPath();this.__originalBeginPath()}}class _s{constructor(t){this.canvasFactory=t;this.cache=Object.create(null)}getCanvas(t,s,e){let i;if(this.cache[t]!==undefined){i=this.cache[t];this.canvasFactory.reset(i,s,e)}else{i=this.canvasFactory.create(s,e);this.cache[t]=i}return i}delete(t){delete this.cache[t]}clear(){for(const t in this.cache){const s=this.cache[t];this.canvasFactory.destroy(s);delete this.cache[t]}}}function Os(t,s,e,i,n,r,o,h,a,c){const[l,u,f,d,p,g]=vt(t);if(u===0&&f===0){const m=o*l+p;const A=Math.round(m);const w=h*d+g;const b=Math.round(w);const y=(o+a)*l+p;const v=Math.abs(Math.round(y)-A)||1;const x=(h+c)*d+g;const M=Math.abs(Math.round(x)-b)||1;t.setTransform(Math.sign(l),0,0,Math.sign(d),A,b);t.drawImage(s,e,i,n,r,0,0,v,M);t.setTransform(l,u,f,d,p,g);return[v,M]}if(l===0&&d===0){const m=h*f+p;const A=Math.round(m);const w=o*u+g;const b=Math.round(w);const y=(h+c)*f+p;const v=Math.abs(Math.round(y)-A)||1;const x=(o+a)*u+g;const M=Math.abs(Math.round(x)-b)||1;t.setTransform(0,Math.sign(u),Math.sign(f),0,A,b);t.drawImage(s,e,i,n,r,0,0,M,v);t.setTransform(l,u,f,d,p,g);return[M,v]}t.drawImage(s,e,i,n,r,o,h,a,c);const m=Math.hypot(l,u);const A=Math.hypot(f,d);return[m*a,A*c]}class Ls{alphaIsShape=false;fontSize=0;fontSizeScale=1;textMatrix=null;textMatrixScale=1;fontMatrix=o;leading=0;x=0;y=0;lineX=0;lineY=0;charSpacing=0;wordSpacing=0;textHScale=1;textRenderingMode=p.FILL;textRise=0;fillColor="#000000";strokeColor="#000000";patternFill=false;patternStroke=false;fillAlpha=1;strokeAlpha=1;lineWidth=1;activeSMask=null;transferMaps="none";constructor(t,s){this.clipBox=new Float32Array([0,0,t,s]);this.minMax=$s.slice()}clone(){const t=Object.create(this);t.clipBox=this.clipBox.slice();t.minMax=this.minMax.slice();return t}getPathBoundingBox(t=gs.FILL,s=null){const e=this.minMax.slice();if(t===gs.STROKE){if(!s){C("Stroke bounding box must include transform.")}X.singularValueDecompose2dScale(s,Rs);const t=Rs[0]*this.lineWidth/2;const i=Rs[1]*this.lineWidth/2;e[0]-=t;e[1]-=i;e[2]+=t;e[3]+=i}return e}updateClipFromPath(){const t=X.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(t||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===Infinity}startNewPathAndClipBox(t){this.clipBox.set(t,0);this.minMax.set($s,0)}getClippedPathBoundingBox(t=gs.FILL,s=null){return X.intersect(this.clipBox,this.getPathBoundingBox(t,s))}}function Bs(t,s){if(s instanceof ImageData){t.putImageData(s,0,0);return}const e=s.height,i=s.width;const n=e%Is;const r=(e-n)/Is;const o=n===0?r:r+1;const h=t.createImageData(i,Is);let a=0,c;const l=s.data;const u=h.data;let f,d,p,m;if(s.kind===g.GRAYSCALE_1BPP){const s=l.byteLength;const e=new Uint32Array(u.buffer,0,u.byteLength>>2);const g=e.length;const m=i+7>>3;const A=4294967295;const w=W.isLittleEndian?4278190080:255;for(f=0;f<o;f++){p=f<r?Is:n;c=0;for(d=0;d<p;d++){const t=s-a;let n=0;const r=t>m?i:t*8-7;const o=r&-8;let h=0;let u=0;for(;n<o;n+=8){u=l[a++];e[c++]=u&128?A:w;e[c++]=u&64?A:w;e[c++]=u&32?A:w;e[c++]=u&16?A:w;e[c++]=u&8?A:w;e[c++]=u&4?A:w;e[c++]=u&2?A:w;e[c++]=u&1?A:w}for(;n<r;n++){if(h===0){u=l[a++];h=128}e[c++]=u&h?A:w;h>>=1}}while(c<g){e[c++]=0}t.putImageData(h,0,f*Is)}}else if(s.kind===g.RGBA_32BPP){d=0;m=i*Is*4;for(f=0;f<r;f++){u.set(l.subarray(a,a+m));a+=m;t.putImageData(h,0,d);d+=Is}if(f<o){m=i*n*4;u.set(l.subarray(a,a+m));t.putImageData(h,0,d)}}else if(s.kind===g.RGB_24BPP){p=Is;m=i*p;for(f=0;f<o;f++){if(f>=r){p=n;m=i*p}c=0;for(d=m;d--;){u[c++]=l[a++];u[c++]=l[a++];u[c++]=l[a++];u[c++]=255}t.putImageData(h,0,f*Is)}}else{throw new Error(`bad image kind: ${s.kind}`)}}function Us(t,s){if(s.bitmap){t.drawImage(s.bitmap,0,0);return}const e=s.height,i=s.width;const n=e%Is;const r=(e-n)/Is;const o=n===0?r:r+1;const h=t.createImageData(i,Is);let a=0;const c=s.data;const l=h.data;for(let s=0;s<o;s++){const e=s<r?Is:n;({srcPos:a}=Es({src:c,srcPos:a,dest:l,width:i,height:e,nonBlackColor:0}));t.putImageData(h,0,s*Is)}}function js(t,s){const e=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const i of e){if(t[i]!==undefined){s[i]=t[i]}}if(t.setLineDash!==undefined){s.setLineDash(t.getLineDash());s.lineDashOffset=t.lineDashOffset}}function Hs(t){t.strokeStyle=t.fillStyle="#000000";t.fillRule="nonzero";t.globalAlpha=1;t.lineWidth=1;t.lineCap="butt";t.lineJoin="miter";t.miterLimit=10;t.globalCompositeOperation="source-over";t.font="10px sans-serif";if(t.setLineDash!==undefined){t.setLineDash([]);t.lineDashOffset=0}const{filter:s}=t;if(s!=="none"&&s!==""){t.filter="none"}}function zs(t,s){if(s){return true}X.singularValueDecompose2dScale(t,Rs);const e=Math.fround(kt.pixelRatio*rt.PDF_TO_CSS_UNITS);return Rs[0]<=e&&Rs[1]<=e}const Gs=["butt","round","square"];const Ws=["miter","round","bevel"];const Vs={};const Xs={};class Ys{constructor(t,s,e,i,n,{optionalContentConfig:r,markedContentStack:o=null},h,a){this.ctx=t;this.current=new Ls(this.ctx.canvas.width,this.ctx.canvas.height);this.stateStack=[];this.pendingClip=null;this.pendingEOFill=false;this.res=null;this.xobjs=null;this.commonObjs=s;this.objs=e;this.canvasFactory=i;this.filterFactory=n;this.groupStack=[];this.baseTransform=null;this.baseTransformStack=[];this.groupLevel=0;this.smaskStack=[];this.smaskCounter=0;this.tempSMask=null;this.suspendedCtx=null;this.contentVisible=true;this.markedContentStack=o||[];this.optionalContentConfig=r;this.cachedCanvases=new _s(this.canvasFactory);this.cachedPatterns=new Map;this.annotationCanvasMap=h;this.viewportScale=1;this.outputScaleX=1;this.outputScaleY=1;this.pageColors=a;this._cachedScaleForStroking=[-1,0];this._cachedGetSinglePixelWidth=null;this._cachedBitmapsMap=new Map}getObject(t,s=null){if(typeof t==="string"){return t.startsWith("g_")?this.commonObjs.get(t):this.objs.get(t)}return s}beginDrawing({transform:t,viewport:s,transparency:e=false,background:i=null}){const n=this.ctx.canvas.width;const r=this.ctx.canvas.height;const o=this.ctx.fillStyle;this.ctx.fillStyle=i||"#ffffff";this.ctx.fillRect(0,0,n,r);this.ctx.fillStyle=o;if(e){const t=this.cachedCanvases.getCanvas("transparent",n,r);this.compositeCtx=this.ctx;this.transparentCanvas=t.canvas;this.ctx=t.context;this.ctx.save();this.ctx.transform(...vt(this.compositeCtx))}this.ctx.save();Hs(this.ctx);if(t){this.ctx.transform(...t);this.outputScaleX=t[0];this.outputScaleY=t[0]}this.ctx.transform(...s.transform);this.viewportScale=s.scale;this.baseTransform=vt(this.ctx)}executeOperatorList(t,s,e,i){const n=t.argsArray;const r=t.fnArray;let o=s||0;const h=n.length;if(h===o){return o}const a=h-o>Ns&&typeof e==="function";const c=a?Date.now()+Ps:0;let l=0;const u=this.commonObjs;const f=this.objs;let d;while(true){if(i!==undefined&&o===i.nextBreakPoint){i.breakIt(o,e);return o}d=r[o];if(d!==b.dependency){this[d].apply(this,n[o])}else{for(const t of n[o]){const s=t.startsWith("g_")?u:f;if(!s.has(t)){s.get(t,e);return o}}}o++;if(o===h){return o}if(a&&++l>Ns){if(Date.now()>c){e();return o}l=0}}}#Ne(){while(this.stateStack.length||this.inSMaskMode){this.restore()}this.current.activeSMask=null;this.ctx.restore();if(this.transparentCanvas){this.ctx=this.compositeCtx;this.ctx.save();this.ctx.setTransform(1,0,0,1,0,0);this.ctx.drawImage(this.transparentCanvas,0,0);this.ctx.restore();this.transparentCanvas=null}}endDrawing(){this.#Ne();this.cachedCanvases.clear();this.cachedPatterns.clear();for(const t of this._cachedBitmapsMap.values()){for(const s of t.values()){if(typeof HTMLCanvasElement!=="undefined"&&s instanceof HTMLCanvasElement){s.width=s.height=0}}t.clear()}this._cachedBitmapsMap.clear();this.#Ie()}#Ie(){if(this.pageColors){const t=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(t!=="none"){const s=this.ctx.filter;this.ctx.filter=t;this.ctx.drawImage(this.ctx.canvas,0,0);this.ctx.filter=s}}}_scaleImage(t,s){const e=t.width??t.displayWidth;const i=t.height??t.displayHeight;let n=Math.max(Math.hypot(s[0],s[1]),1);let r=Math.max(Math.hypot(s[2],s[3]),1);let o=e,h=i;let a="prescale1";let c,l;while(n>2&&o>1||r>2&&h>1){let s=o,e=h;if(n>2&&o>1){s=o>=16384?Math.floor(o/2)-1||1:Math.ceil(o/2);n/=o/s}if(r>2&&h>1){e=h>=16384?Math.floor(h/2)-1||1:Math.ceil(h)/2;r/=h/e}c=this.cachedCanvases.getCanvas(a,s,e);l=c.context;l.clearRect(0,0,s,e);l.drawImage(t,0,0,o,h,0,0,s,e);t=c.canvas;o=s;h=e;a=a==="prescale1"?"prescale2":"prescale1"}return{img:t,paintWidth:o,paintHeight:h}}_createMaskCanvas(t){const s=this.ctx;const{width:e,height:i}=t;const n=this.current.fillColor;const r=this.current.patternFill;const o=vt(s);let h,a,c,l;if((t.bitmap||t.data)&&t.count>1){const s=t.bitmap||t.data.buffer;a=JSON.stringify(r?o:[o.slice(0,4),n]);h=this._cachedBitmapsMap.get(s);if(!h){h=new Map;this._cachedBitmapsMap.set(s,h)}const e=h.get(a);if(e&&!r){const t=Math.round(Math.min(o[0],o[2])+o[4]);const s=Math.round(Math.min(o[1],o[3])+o[5]);return{canvas:e,offsetX:t,offsetY:s}}c=e}if(!c){l=this.cachedCanvases.getCanvas("maskCanvas",e,i);Us(l.context,t)}let u=X.transform(o,[1/e,0,0,-1/i,0,0]);u=X.transform(u,[1,0,0,1,0,-i]);const f=$s.slice();X.axialAlignedBoundingBox([0,0,e,i],u,f);const[d,p,g,m]=f;const A=Math.round(g-d)||1;const w=Math.round(m-p)||1;const b=this.cachedCanvases.getCanvas("fillCanvas",A,w);const y=b.context;const v=d;const x=p;y.translate(-v,-x);y.transform(...u);if(!c){c=this._scaleImage(l.canvas,xt(y));c=c.img;if(h&&r){h.set(a,c)}}y.imageSmoothingEnabled=zs(vt(y),t.interpolate);Os(y,c,0,0,c.width,c.height,0,0,e,i);y.globalCompositeOperation="source-in";const M=X.transform(xt(y),[1,0,0,1,-v,-x]);y.fillStyle=r?n.getPattern(s,this,M,gs.FILL):n;y.fillRect(0,0,e,i);if(h&&!r){this.cachedCanvases.delete("fillCanvas");h.set(a,b.canvas)}return{canvas:b.canvas,offsetX:Math.round(v),offsetY:Math.round(x)}}setLineWidth(t){if(t!==this.current.lineWidth){this._cachedScaleForStroking[0]=-1}this.current.lineWidth=t;this.ctx.lineWidth=t}setLineCap(t){this.ctx.lineCap=Gs[t]}setLineJoin(t){this.ctx.lineJoin=Ws[t]}setMiterLimit(t){this.ctx.miterLimit=t}setDash(t,s){const e=this.ctx;if(e.setLineDash!==undefined){e.setLineDash(t);e.lineDashOffset=s}}setRenderingIntent(t){}setFlatness(t){}setGState(t){for(const[s,e]of t){switch(s){case"LW":this.setLineWidth(e);break;case"LC":this.setLineCap(e);break;case"LJ":this.setLineJoin(e);break;case"ML":this.setMiterLimit(e);break;case"D":this.setDash(e[0],e[1]);break;case"RI":this.setRenderingIntent(e);break;case"FL":this.setFlatness(e);break;case"Font":this.setFont(e[0],e[1]);break;case"CA":this.current.strokeAlpha=e;break;case"ca":this.ctx.globalAlpha=this.current.fillAlpha=e;break;case"BM":this.ctx.globalCompositeOperation=e;break;case"SMask":this.current.activeSMask=e?this.tempSMask:null;this.tempSMask=null;this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(e);break}}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const t=this.inSMaskMode;if(this.current.activeSMask&&!t){this.beginSMaskMode()}else if(!this.current.activeSMask&&t){this.endSMaskMode()}}beginSMaskMode(){if(this.inSMaskMode){throw new Error("beginSMaskMode called while already in smask mode")}const t=this.ctx.canvas.width;const s=this.ctx.canvas.height;const e="smaskGroupAt"+this.groupLevel;const i=this.cachedCanvases.getCanvas(e,t,s);this.suspendedCtx=this.ctx;const n=this.ctx=i.context;n.setTransform(this.suspendedCtx.getTransform());js(this.suspendedCtx,n);Fs(n,this.suspendedCtx);this.setGState([["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode){throw new Error("endSMaskMode called while not in smask mode")}this.ctx._removeMirroring();js(this.ctx,this.suspendedCtx);this.ctx=this.suspendedCtx;this.suspendedCtx=null}compose(t){if(!this.current.activeSMask){return}if(!t){t=[0,0,this.ctx.canvas.width,this.ctx.canvas.height]}else{t[0]=Math.floor(t[0]);t[1]=Math.floor(t[1]);t[2]=Math.ceil(t[2]);t[3]=Math.ceil(t[3])}const s=this.current.activeSMask;const e=this.suspendedCtx;this.composeSMask(e,s,this.ctx,t);this.ctx.save();this.ctx.setTransform(1,0,0,1,0,0);this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height);this.ctx.restore()}composeSMask(t,s,e,i){const n=i[0];const r=i[1];const o=i[2]-n;const h=i[3]-r;if(o===0||h===0){return}this.genericComposeSMask(s.context,e,o,h,s.subtype,s.backdrop,s.transferMap,n,r,s.offsetX,s.offsetY);t.save();t.globalAlpha=1;t.globalCompositeOperation="source-over";t.setTransform(1,0,0,1,0,0);t.drawImage(e.canvas,0,0);t.restore()}genericComposeSMask(t,s,e,i,n,r,o,h,a,c,l){let u=t.canvas;let f=h-c;let d=a-l;if(r){const s=X.makeHexColor(...r);if(f<0||d<0||f+e>u.width||d+i>u.height){const t=this.cachedCanvases.getCanvas("maskExtension",e,i);const n=t.context;n.drawImage(u,-f,-d);n.globalCompositeOperation="destination-atop";n.fillStyle=s;n.fillRect(0,0,e,i);n.globalCompositeOperation="source-over";u=t.canvas;f=d=0}else{t.save();t.globalAlpha=1;t.setTransform(1,0,0,1,0,0);const n=new Path2D;n.rect(f,d,e,i);t.clip(n);t.globalCompositeOperation="destination-atop";t.fillStyle=s;t.fillRect(f,d,e,i);t.restore()}}s.save();s.globalAlpha=1;s.setTransform(1,0,0,1,0,0);if(n==="Alpha"&&o){s.filter=this.filterFactory.addAlphaFilter(o)}else if(n==="Luminosity"){s.filter=this.filterFactory.addLuminosityFilter(o)}const p=new Path2D;p.rect(h,a,e,i);s.clip(p);s.globalCompositeOperation="destination-in";s.drawImage(u,f,d,e,i,h,a,e,i);s.restore()}save(){if(this.inSMaskMode){js(this.ctx,this.suspendedCtx)}this.ctx.save();const t=this.current;this.stateStack.push(t);this.current=t.clone()}restore(){if(this.stateStack.length===0){if(this.inSMaskMode){this.endSMaskMode()}return}this.current=this.stateStack.pop();this.ctx.restore();if(this.inSMaskMode){js(this.suspendedCtx,this.ctx)}this.checkSMaskState();this.pendingClip=null;this._cachedScaleForStroking[0]=-1;this._cachedGetSinglePixelWidth=null}transform(t,s,e,i,n,r){this.ctx.transform(t,s,e,i,n,r);this._cachedScaleForStroking[0]=-1;this._cachedGetSinglePixelWidth=null}constructPath(t,s,e){let[i]=s;if(!e){i||=s[0]=new Path2D;this[t](i);return}if(!(i instanceof Path2D)){const t=s[0]=new Path2D;for(let s=0,e=i.length;s<e;){switch(i[s++]){case y.moveTo:t.moveTo(i[s++],i[s++]);break;case y.lineTo:t.lineTo(i[s++],i[s++]);break;case y.curveTo:t.bezierCurveTo(i[s++],i[s++],i[s++],i[s++],i[s++],i[s++]);break;case y.closePath:t.closePath();break;default:E(`Unrecognized drawing path operator: ${i[s-1]}`);break}}i=t}X.axialAlignedBoundingBox(e,vt(this.ctx),this.current.minMax);this[t](i)}closePath(){this.ctx.closePath()}stroke(t,s=true){const e=this.ctx;const i=this.current.strokeColor;e.globalAlpha=this.current.strokeAlpha;if(this.contentVisible){if(typeof i==="object"&&i?.getPattern){const s=i.isModifyingCurrentTransform()?e.getTransform():null;e.save();e.strokeStyle=i.getPattern(e,this,xt(e),gs.STROKE);if(s){const i=new Path2D;i.addPath(t,e.getTransform().invertSelf().multiplySelf(s));t=i}this.rescaleAndStroke(t,false);e.restore()}else{this.rescaleAndStroke(t,true)}}if(s){this.consumePath(t,this.current.getClippedPathBoundingBox(gs.STROKE,vt(this.ctx)))}e.globalAlpha=this.current.fillAlpha}closeStroke(t){this.stroke(t)}fill(t,s=true){const e=this.ctx;const i=this.current.fillColor;const n=this.current.patternFill;let r=false;if(n){const s=i.isModifyingCurrentTransform()?e.getTransform():null;e.save();e.fillStyle=i.getPattern(e,this,xt(e),gs.FILL);if(s){const i=new Path2D;i.addPath(t,e.getTransform().invertSelf().multiplySelf(s));t=i}r=true}const o=this.current.getClippedPathBoundingBox();if(this.contentVisible&&o!==null){if(this.pendingEOFill){e.fill(t,"evenodd");this.pendingEOFill=false}else{e.fill(t)}}if(r){e.restore()}if(s){this.consumePath(t,o)}}eoFill(t){this.pendingEOFill=true;this.fill(t)}fillStroke(t){this.fill(t,false);this.stroke(t,false);this.consumePath(t)}eoFillStroke(t){this.pendingEOFill=true;this.fillStroke(t)}closeFillStroke(t){this.fillStroke(t)}closeEOFillStroke(t){this.pendingEOFill=true;this.fillStroke(t)}endPath(t){this.consumePath(t)}rawFillPath(t){this.ctx.fill(t)}clip(){this.pendingClip=Vs}eoClip(){this.pendingClip=Xs}beginText(){this.current.textMatrix=null;this.current.textMatrixScale=1;this.current.x=this.current.lineX=0;this.current.y=this.current.lineY=0}endText(){const t=this.pendingTextPaths;const s=this.ctx;if(t===undefined){return}const e=new Path2D;const i=s.getTransform().invertSelf();for(const{transform:s,x:n,y:r,fontSize:o,path:h}of t){e.addPath(h,new DOMMatrix(s).preMultiplySelf(i).translate(n,r).scale(o,-o))}s.clip(e);delete this.pendingTextPaths}setCharSpacing(t){this.current.charSpacing=t}setWordSpacing(t){this.current.wordSpacing=t}setHScale(t){this.current.textHScale=t/100}setLeading(t){this.current.leading=-t}setFont(t,s){const e=this.commonObjs.get(t);const i=this.current;if(!e){throw new Error(`Can't find font for ${t}`)}i.fontMatrix=e.fontMatrix||o;if(i.fontMatrix[0]===0||i.fontMatrix[3]===0){E("Invalid font matrix for font "+t)}if(s<0){s=-s;i.fontDirection=-1}else{i.fontDirection=1}this.current.font=e;this.current.fontSize=s;if(e.isType3Font){return}const n=e.loadedName||"sans-serif";const r=e.systemFontInfo?.css||`"${n}", ${e.fallbackName}`;let h="normal";if(e.black){h="900"}else if(e.bold){h="bold"}const a=e.italic?"italic":"normal";let c=s;if(s<Cs){c=Cs}else if(s>Ts){c=Ts}this.current.fontSizeScale=s/c;this.ctx.font=`${a} ${h} ${c}px ${r}`}setTextRenderingMode(t){this.current.textRenderingMode=t}setTextRise(t){this.current.textRise=t}moveText(t,s){this.current.x=this.current.lineX+=t;this.current.y=this.current.lineY+=s}setLeadingMoveText(t,s){this.setLeading(-s);this.moveText(t,s)}setTextMatrix(t){const{current:s}=this;s.textMatrix=t;s.textMatrixScale=Math.hypot(t[0],t[1]);s.x=s.lineX=0;s.y=s.lineY=0}nextLine(){this.moveText(0,this.current.leading)}#De(t,s,e){const i=new Path2D;i.addPath(t,new DOMMatrix(e).invertSelf().multiplySelf(s));return i}paintChar(t,s,e,i,n){const r=this.ctx;const o=this.current;const h=o.font;const a=o.textRenderingMode;const c=o.fontSize/o.fontSizeScale;const l=a&p.FILL_STROKE_MASK;const u=!!(a&p.ADD_TO_PATH_FLAG);const f=o.patternFill&&!h.missingFile;const d=o.patternStroke&&!h.missingFile;let g;if(h.disableFontFace||u||f||d){g=h.getPathGenerator(this.commonObjs,t)}if(h.disableFontFace||f||d){r.save();r.translate(s,e);r.scale(c,-c);let t;if(l===p.FILL||l===p.FILL_STROKE){if(i){t=r.getTransform();r.setTransform(...i);r.fill(this.#De(g,t,i))}else{r.fill(g)}}if(l===p.STROKE||l===p.FILL_STROKE){if(n){t||=r.getTransform();r.setTransform(...n);const{a:s,b:e,c:i,d:o}=t;const h=X.inverseTransform(n);const a=X.transform([s,e,i,o,0,0],h);X.singularValueDecompose2dScale(a,Rs);r.lineWidth*=Math.max(Rs[0],Rs[1])/c;r.stroke(this.#De(g,t,n))}else{r.lineWidth/=c;r.stroke(g)}}r.restore()}else{if(l===p.FILL||l===p.FILL_STROKE){r.fillText(t,s,e)}if(l===p.STROKE||l===p.FILL_STROKE){r.strokeText(t,s,e)}}if(u){const t=this.pendingTextPaths||=[];t.push({transform:vt(r),x:s,y:e,fontSize:c,path:g})}}get isFontSubpixelAAEnabled(){const{context:t}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);t.scale(1.5,1);t.fillText("I",0,10);const s=t.getImageData(0,0,10,10).data;let e=false;for(let t=3;t<s.length;t+=4){if(s[t]>0&&s[t]<255){e=true;break}}return D(this,"isFontSubpixelAAEnabled",e)}showText(t){const s=this.current;const e=s.font;if(e.isType3Font){return this.showType3Text(t)}const i=s.fontSize;if(i===0){return undefined}const n=this.ctx;const r=s.fontSizeScale;const o=s.charSpacing;const h=s.wordSpacing;const a=s.fontDirection;const c=s.textHScale*a;const l=t.length;const u=e.vertical;const f=u?1:-1;const d=e.defaultVMetrics;const g=i*s.fontMatrix[0];const m=s.textRenderingMode===p.FILL&&!e.disableFontFace&&!s.patternFill;n.save();if(s.textMatrix){n.transform(...s.textMatrix)}n.translate(s.x,s.y+s.textRise);if(a>0){n.scale(c,-1)}else{n.scale(c,1)}let A,w;if(s.patternFill){n.save();const t=s.fillColor.getPattern(n,this,xt(n),gs.FILL);A=vt(n);n.restore();n.fillStyle=t}if(s.patternStroke){n.save();const t=s.strokeColor.getPattern(n,this,xt(n),gs.STROKE);w=vt(n);n.restore();n.strokeStyle=t}let b=s.lineWidth;const y=s.textMatrixScale;if(y===0||b===0){const t=s.textRenderingMode&p.FILL_STROKE_MASK;if(t===p.STROKE||t===p.FILL_STROKE){b=this.getSinglePixelWidth()}}else{b/=y}if(r!==1){n.scale(r,r);b/=r}n.lineWidth=b;if(e.isInvalidPDFjsFont){const e=[];let i=0;for(const s of t){e.push(s.unicode);i+=s.width}n.fillText(e.join(""),0,0);s.x+=i*g*c;n.restore();this.compose();return undefined}let v=0,x;for(x=0;x<l;++x){const s=t[x];if(typeof s==="number"){v+=f*s*i/1e3;continue}let c=false;const l=(s.isSpace?h:0)+o;const p=s.fontChar;const b=s.accent;let y,M;let k=s.width;if(u){const t=s.vmetric||d;const e=-(s.vmetric?t[1]:k*.5)*g;const i=t[2]*g;k=t?-t[0]:k;y=e/r;M=(v+i)/r}else{y=v/r;M=0}if(e.remeasure&&k>0){const t=n.measureText(p).width*1e3/i*r;if(k<t&&this.isFontSubpixelAAEnabled){const s=k/t;c=true;n.save();n.scale(s,1);y/=s}else if(k!==t){y+=(k-t)/2e3*i/r}}if(this.contentVisible&&(s.isInFont||e.missingFile)){if(m&&!b){n.fillText(p,y,M)}else{this.paintChar(p,y,M,A,w);if(b){const t=y+i*b.offset.x/r;const s=M-i*b.offset.y/r;this.paintChar(b.fontChar,t,s,A,w)}}}const S=u?k*g-l*a:k*g+l*a;v+=S;if(c){n.restore()}}if(u){s.y-=v}else{s.x+=v*c}n.restore();this.compose();return undefined}showType3Text(t){const s=this.ctx;const e=this.current;const i=e.font;const n=e.fontSize;const r=e.fontDirection;const h=i.vertical?1:-1;const a=e.charSpacing;const c=e.wordSpacing;const l=e.textHScale*r;const u=e.fontMatrix||o;const f=t.length;const d=e.textRenderingMode===p.INVISIBLE;let g,m,A,w;if(d||n===0){return}this._cachedScaleForStroking[0]=-1;this._cachedGetSinglePixelWidth=null;s.save();if(e.textMatrix){s.transform(...e.textMatrix)}s.translate(e.x,e.y+e.textRise);s.scale(l,r);for(g=0;g<f;++g){m=t[g];if(typeof m==="number"){w=h*m*n/1e3;this.ctx.translate(w,0);e.x+=w*l;continue}const r=(m.isSpace?c:0)+a;const o=i.charProcOperatorList[m.operatorListId];if(!o){E(`Type3 character "${m.operatorListId}" is not available.`)}else if(this.contentVisible){this.save();s.scale(n,n);s.transform(...u);this.executeOperatorList(o);this.restore()}const f=[m.width,0];X.applyTransform(f,u);A=f[0]*n+r;s.translate(A,0);e.x+=A*l}s.restore()}setCharWidth(t,s){}setCharWidthAndBounds(t,s,e,i,n,r){const o=new Path2D;o.rect(e,i,n-e,r-i);this.ctx.clip(o);this.endPath()}getColorN_Pattern(t){let s;if(t[0]==="TilingPattern"){const e=this.baseTransform||vt(this.ctx);const i={createCanvasGraphics:t=>new Ys(t,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};s=new Ss(t,this.ctx,i,e)}else{s=this._getPattern(t[1],t[2])}return s}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments);this.current.patternStroke=true}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments);this.current.patternFill=true}setStrokeRGBColor(t,s,e){this.ctx.strokeStyle=this.current.strokeColor=X.makeHexColor(t,s,e);this.current.patternStroke=false}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent";this.current.patternStroke=false}setFillRGBColor(t,s,e){this.ctx.fillStyle=this.current.fillColor=X.makeHexColor(t,s,e);this.current.patternFill=false}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent";this.current.patternFill=false}_getPattern(t,s=null){let e;if(this.cachedPatterns.has(t)){e=this.cachedPatterns.get(t)}else{e=Ms(this.getObject(t));this.cachedPatterns.set(t,e)}if(s){e.matrix=s}return e}shadingFill(t){if(!this.contentVisible){return}const s=this.ctx;this.save();const e=this._getPattern(t);s.fillStyle=e.getPattern(s,this,xt(s),gs.SHADING);const i=xt(s);if(i){const{width:t,height:e}=s.canvas;const n=$s.slice();X.axialAlignedBoundingBox([0,0,t,e],i,n);const[r,o,h,a]=n;this.ctx.fillRect(r,o,h-r,a-o)}else{this.ctx.fillRect(-1e10,-1e10,2e10,2e10)}this.compose(this.current.getClippedPathBoundingBox());this.restore()}beginInlineImage(){C("Should not call beginInlineImage")}beginImageData(){C("Should not call beginImageData")}paintFormXObjectBegin(t,s){if(!this.contentVisible){return}this.save();this.baseTransformStack.push(this.baseTransform);if(t){this.transform(...t)}this.baseTransform=vt(this.ctx);if(s){X.axialAlignedBoundingBox(s,this.baseTransform,this.current.minMax);const[t,e,i,n]=s;const r=new Path2D;r.rect(t,e,i-t,n-e);this.ctx.clip(r);this.endPath()}}paintFormXObjectEnd(){if(!this.contentVisible){return}this.restore();this.baseTransform=this.baseTransformStack.pop()}beginGroup(t){if(!this.contentVisible){return}this.save();if(this.inSMaskMode){this.endSMaskMode();this.current.activeSMask=null}const s=this.ctx;if(!t.isolated){S("TODO: Support non-isolated groups.")}if(t.knockout){E("Knockout groups not supported.")}const e=vt(s);if(t.matrix){s.transform(...t.matrix)}if(!t.bbox){throw new Error("Bounding box is required.")}let i=$s.slice();X.axialAlignedBoundingBox(t.bbox,vt(s),i);const n=[0,0,s.canvas.width,s.canvas.height];i=X.intersect(i,n)||[0,0,0,0];const r=Math.floor(i[0]);const o=Math.floor(i[1]);const h=Math.max(Math.ceil(i[2])-r,1);const a=Math.max(Math.ceil(i[3])-o,1);this.current.startNewPathAndClipBox([0,0,h,a]);let c="groupAt"+this.groupLevel;if(t.smask){c+="_smask_"+this.smaskCounter++%2}const l=this.cachedCanvases.getCanvas(c,h,a);const u=l.context;u.translate(-r,-o);u.transform(...e);let f=new Path2D;const[d,p,g,m]=t.bbox;f.rect(d,p,g-d,m-p);if(t.matrix){const s=new Path2D;s.addPath(f,new DOMMatrix(t.matrix));f=s}u.clip(f);if(t.smask){this.smaskStack.push({canvas:l.canvas,context:u,offsetX:r,offsetY:o,subtype:t.smask.subtype,backdrop:t.smask.backdrop,transferMap:t.smask.transferMap||null,startTransformInverse:null})}else{s.setTransform(1,0,0,1,0,0);s.translate(r,o);s.save()}js(s,u);this.ctx=u;this.setGState([["BM","source-over"],["ca",1],["CA",1]]);this.groupStack.push(s);this.groupLevel++}endGroup(t){if(!this.contentVisible){return}this.groupLevel--;const s=this.ctx;const e=this.groupStack.pop();this.ctx=e;this.ctx.imageSmoothingEnabled=false;if(t.smask){this.tempSMask=this.smaskStack.pop();this.restore()}else{this.ctx.restore();const t=vt(this.ctx);this.restore();this.ctx.save();this.ctx.setTransform(...t);const e=$s.slice();X.axialAlignedBoundingBox([0,0,s.canvas.width,s.canvas.height],t,e);this.ctx.drawImage(s.canvas,0,0);this.ctx.restore();this.compose(e)}}beginAnnotation(t,s,e,i,n){this.#Ne();Hs(this.ctx);this.ctx.save();this.save();if(this.baseTransform){this.ctx.setTransform(...this.baseTransform)}if(s){const i=s[2]-s[0];const r=s[3]-s[1];if(n&&this.annotationCanvasMap){e=e.slice();e[4]-=s[0];e[5]-=s[1];s=s.slice();s[0]=s[1]=0;s[2]=i;s[3]=r;X.singularValueDecompose2dScale(vt(this.ctx),Rs);const{viewportScale:n}=this;const o=Math.ceil(i*this.outputScaleX*n);const h=Math.ceil(r*this.outputScaleY*n);this.annotationCanvas=this.canvasFactory.create(o,h);const{canvas:a,context:c}=this.annotationCanvas;this.annotationCanvasMap.set(t,a);this.annotationCanvas.savedCtx=this.ctx;this.ctx=c;this.ctx.save();this.ctx.setTransform(Rs[0],0,0,-Rs[1],0,r*Rs[1]);Hs(this.ctx)}else{Hs(this.ctx);this.endPath();const t=new Path2D;t.rect(s[0],s[1],i,r);this.ctx.clip(t)}}this.current=new Ls(this.ctx.canvas.width,this.ctx.canvas.height);this.transform(...e);this.transform(...i)}endAnnotation(){if(this.annotationCanvas){this.ctx.restore();this.#Ie();this.ctx=this.annotationCanvas.savedCtx;delete this.annotationCanvas.savedCtx;delete this.annotationCanvas}}paintImageMaskXObject(t){if(!this.contentVisible){return}const s=t.count;t=this.getObject(t.data,t);t.count=s;const e=this.ctx;const i=this._createMaskCanvas(t);const n=i.canvas;e.save();e.setTransform(1,0,0,1,0,0);e.drawImage(n,i.offsetX,i.offsetY);e.restore();this.compose()}paintImageMaskXObjectRepeat(t,s,e=0,i=0,n,r){if(!this.contentVisible){return}t=this.getObject(t.data,t);const o=this.ctx;o.save();const h=vt(o);o.transform(s,e,i,n,0,0);const a=this._createMaskCanvas(t);o.setTransform(1,0,0,1,a.offsetX-h[4],a.offsetY-h[5]);for(let t=0,c=r.length;t<c;t+=2){const c=X.transform(h,[s,e,i,n,r[t],r[t+1]]);o.drawImage(a.canvas,c[4],c[5])}o.restore();this.compose()}paintImageMaskXObjectGroup(t){if(!this.contentVisible){return}const s=this.ctx;const e=this.current.fillColor;const i=this.current.patternFill;for(const n of t){const{data:t,width:r,height:o,transform:h}=n;const a=this.cachedCanvases.getCanvas("maskCanvas",r,o);const c=a.context;c.save();const l=this.getObject(t,n);Us(c,l);c.globalCompositeOperation="source-in";c.fillStyle=i?e.getPattern(c,this,xt(s),gs.FILL):e;c.fillRect(0,0,r,o);c.restore();s.save();s.transform(...h);s.scale(1,-1);Os(s,a.canvas,0,0,r,o,0,-1,1,1);s.restore()}this.compose()}paintImageXObject(t){if(!this.contentVisible){return}const s=this.getObject(t);if(!s){E("Dependent image isn't ready yet");return}this.paintInlineImageXObject(s)}paintImageXObjectRepeat(t,s,e,i){if(!this.contentVisible){return}const n=this.getObject(t);if(!n){E("Dependent image isn't ready yet");return}const r=n.width;const o=n.height;const h=[];for(let t=0,n=i.length;t<n;t+=2){h.push({transform:[s,0,0,e,i[t],i[t+1]],x:0,y:0,w:r,h:o})}this.paintInlineImageXObjectGroup(n,h)}applyTransferMapsToCanvas(t){if(this.current.transferMaps!=="none"){t.filter=this.current.transferMaps;t.drawImage(t.canvas,0,0);t.filter="none"}return t.canvas}applyTransferMapsToBitmap(t){if(this.current.transferMaps==="none"){return t.bitmap}const{bitmap:s,width:e,height:i}=t;const n=this.cachedCanvases.getCanvas("inlineImage",e,i);const r=n.context;r.filter=this.current.transferMaps;r.drawImage(s,0,0);r.filter="none";return n.canvas}paintInlineImageXObject(t){if(!this.contentVisible){return}const s=t.width;const e=t.height;const i=this.ctx;this.save();const{filter:n}=i;if(n!=="none"&&n!==""){i.filter="none"}i.scale(1/s,-1/e);let r;if(t.bitmap){r=this.applyTransferMapsToBitmap(t)}else if(typeof HTMLElement==="function"&&t instanceof HTMLElement||!t.data){r=t}else{const i=this.cachedCanvases.getCanvas("inlineImage",s,e);const n=i.context;Bs(n,t);r=this.applyTransferMapsToCanvas(n)}const o=this._scaleImage(r,xt(i));i.imageSmoothingEnabled=zs(vt(i),t.interpolate);Os(i,o.img,0,0,o.paintWidth,o.paintHeight,0,-e,s,e);this.compose();this.restore()}paintInlineImageXObjectGroup(t,s){if(!this.contentVisible){return}const e=this.ctx;let i;if(t.bitmap){i=t.bitmap}else{const s=t.width;const e=t.height;const n=this.cachedCanvases.getCanvas("inlineImage",s,e);const r=n.context;Bs(r,t);i=this.applyTransferMapsToCanvas(r)}for(const t of s){e.save();e.transform(...t.transform);e.scale(1,-1);Os(e,i,t.x,t.y,t.w,t.h,0,-1,1,1);e.restore()}this.compose()}paintSolidColorImageMask(){if(!this.contentVisible){return}this.ctx.fillRect(0,0,1,1);this.compose()}markPoint(t){}markPointProps(t,s){}beginMarkedContent(t){this.markedContentStack.push({visible:true})}beginMarkedContentProps(t,s){if(t==="OC"){this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(s)})}else{this.markedContentStack.push({visible:true})}this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop();this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(t,s){const e=this.current.isEmptyClip();if(this.pendingClip){this.current.updateClipFromPath()}if(!this.pendingClip){this.compose(s)}const i=this.ctx;if(this.pendingClip){if(!e){if(this.pendingClip===Xs){i.clip(t,"evenodd")}else{i.clip(t)}}this.pendingClip=null}this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const t=vt(this.ctx);if(t[1]===0&&t[2]===0){this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(t[0]),Math.abs(t[3]))}else{const s=Math.abs(t[0]*t[3]-t[2]*t[1]);const e=Math.hypot(t[0],t[2]);const i=Math.hypot(t[1],t[3]);this._cachedGetSinglePixelWidth=Math.max(e,i)/s}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:t}=this.current;const{a:s,b:e,c:i,d:n}=this.ctx.getTransform();let r,o;if(e===0&&i===0){const e=Math.abs(s);const i=Math.abs(n);if(e===i){if(t===0){r=o=1/e}else{const s=e*t;r=o=s<1?1/s:1}}else if(t===0){r=1/e;o=1/i}else{const s=e*t;const n=i*t;r=s<1?1/s:1;o=n<1?1/n:1}}else{const h=Math.abs(s*n-e*i);const a=Math.hypot(s,e);const c=Math.hypot(i,n);if(t===0){r=c/h;o=a/h}else{const s=t*h;r=c>s?c/s:1;o=a>s?a/s:1}}this._cachedScaleForStroking[0]=r;this._cachedScaleForStroking[1]=o}return this._cachedScaleForStroking}rescaleAndStroke(t,s){const{ctx:e,current:{lineWidth:i}}=this;const[n,r]=this.getScaleForStroking();if(n===r){e.lineWidth=(i||1)*n;e.stroke(t);return}const o=e.getLineDash();if(s){e.save()}e.scale(n,r);Ds.a=1/n;Ds.d=1/r;const h=new Path2D;h.addPath(t,Ds);if(o.length>0){const t=Math.max(n,r);e.setLineDash(o.map((s=>s/t)));e.lineDashOffset/=t}e.lineWidth=i||1;e.stroke(h);if(s){e.restore()}}isContentVisible(){for(let t=this.markedContentStack.length-1;t>=0;t--){if(!this.markedContentStack[t].visible){return false}}return true}}for(const t in b){if(Ys.prototype[t]!==undefined){Ys.prototype[b[t]]=Ys.prototype[t]}}class Qs{static#Re=null;static#$e="";static get workerPort(){return this.#Re}static set workerPort(t){if(!(typeof Worker!=="undefined"&&t instanceof Worker)&&t!==null){throw new Error("Invalid `workerPort` type.")}this.#Re=t}static get workerSrc(){return this.#$e}static set workerSrc(t){if(typeof t!=="string"){throw new Error("Invalid `workerSrc` type.")}this.#$e=t}}class Ks{#Fe;#_e;constructor({parsedData:t,rawData:s}){this.#Fe=t;this.#_e=s}getRaw(){return this.#_e}get(t){return this.#Fe.get(t)??null}[Symbol.iterator](){return this.#Fe.entries()}}const qs=Symbol("INTERNAL");class Js{#Oe=false;#Le=false;#Be=false;#Ue=true;constructor(t,{name:s,intent:e,usage:i,rbGroups:n}){this.#Oe=!!(t&a.DISPLAY);this.#Le=!!(t&a.PRINT);this.name=s;this.intent=e;this.usage=i;this.rbGroups=n}get visible(){if(this.#Be){return this.#Ue}if(!this.#Ue){return false}const{print:t,view:s}=this.usage;if(this.#Oe){return s?.viewState!=="OFF"}else if(this.#Le){return t?.printState!=="OFF"}return true}_setVisible(t,s,e=false){if(t!==qs){C("Internal method `_setVisible` called.")}this.#Be=e;this.#Ue=s}}class Zs{#je=null;#He=new Map;#ze=null;#Ge=null;constructor(t,s=a.DISPLAY){this.renderingIntent=s;this.name=null;this.creator=null;if(t===null){return}this.name=t.name;this.creator=t.creator;this.#Ge=t.order;for(const e of t.groups){this.#He.set(e.id,new Js(s,e))}if(t.baseState==="OFF"){for(const t of this.#He.values()){t._setVisible(qs,false)}}for(const s of t.on){this.#He.get(s)._setVisible(qs,true)}for(const s of t.off){this.#He.get(s)._setVisible(qs,false)}this.#ze=this.getHash()}#We(t){const s=t.length;if(s<2){return true}const e=t[0];for(let i=1;i<s;i++){const s=t[i];let n;if(Array.isArray(s)){n=this.#We(s)}else if(this.#He.has(s)){n=this.#He.get(s).visible}else{E(`Optional content group not found: ${s}`);return true}switch(e){case"And":if(!n){return false}break;case"Or":if(n){return true}break;case"Not":return!n;default:return true}}return e==="And"}isVisible(t){if(this.#He.size===0){return true}if(!t){S("Optional content group not defined.");return true}if(t.type==="OCG"){if(!this.#He.has(t.id)){E(`Optional content group not found: ${t.id}`);return true}return this.#He.get(t.id).visible}else if(t.type==="OCMD"){if(t.expression){return this.#We(t.expression)}if(!t.policy||t.policy==="AnyOn"){for(const s of t.ids){if(!this.#He.has(s)){E(`Optional content group not found: ${s}`);return true}if(this.#He.get(s).visible){return true}}return false}else if(t.policy==="AllOn"){for(const s of t.ids){if(!this.#He.has(s)){E(`Optional content group not found: ${s}`);return true}if(!this.#He.get(s).visible){return false}}return true}else if(t.policy==="AnyOff"){for(const s of t.ids){if(!this.#He.has(s)){E(`Optional content group not found: ${s}`);return true}if(!this.#He.get(s).visible){return true}}return false}else if(t.policy==="AllOff"){for(const s of t.ids){if(!this.#He.has(s)){E(`Optional content group not found: ${s}`);return true}if(this.#He.get(s).visible){return false}}return true}E(`Unknown optional content policy ${t.policy}.`);return true}E(`Unknown group type ${t.type}.`);return true}setVisibility(t,s=true,e=true){const i=this.#He.get(t);if(!i){E(`Optional content group not found: ${t}`);return}if(e&&s&&i.rbGroups.length){for(const s of i.rbGroups){for(const e of s){if(e!==t){this.#He.get(e)?._setVisible(qs,false,true)}}}}i._setVisible(qs,!!s,true);this.#je=null}setOCGState({state:t,preserveRB:s}){let e;for(const i of t){switch(i){case"ON":case"OFF":case"Toggle":e=i;continue}const t=this.#He.get(i);if(!t){continue}switch(e){case"ON":this.setVisibility(i,true,s);break;case"OFF":this.setVisibility(i,false,s);break;case"Toggle":this.setVisibility(i,!t.visible,s);break}}this.#je=null}get hasInitialVisibility(){return this.#ze===null||this.getHash()===this.#ze}getOrder(){if(!this.#He.size){return null}if(this.#Ge){return this.#Ge.slice()}return[...this.#He.keys()]}getGroup(t){return this.#He.get(t)||null}getHash(){if(this.#je!==null){return this.#je}const t=new Ht;for(const[s,e]of this.#He){t.update(`${s}:${e.visible}`)}return this.#je=t.hexdigest()}[Symbol.iterator](){return this.#He.entries()}}class te{constructor(t,{disableRange:s=false,disableStream:e=false}){T(t,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:i,initialData:n,progressiveDone:r,contentDispositionFilename:o}=t;this._queuedChunks=[];this._progressiveDone=r;this._contentDispositionFilename=o;if(n?.length>0){const t=n instanceof Uint8Array&&n.byteLength===n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer;this._queuedChunks.push(t)}this._pdfDataRangeTransport=t;this._isStreamingSupported=!e;this._isRangeSupported=!s;this._contentLength=i;this._fullRequestReader=null;this._rangeReaders=[];t.addRangeListener(((t,s)=>{this._onReceiveData({begin:t,chunk:s})}));t.addProgressListener(((t,s)=>{this._onProgress({loaded:t,total:s})}));t.addProgressiveReadListener((t=>{this._onReceiveData({chunk:t})}));t.addProgressiveDoneListener((()=>{this._onProgressiveDone()}));t.transportReady()}_onReceiveData({begin:t,chunk:s}){const e=s instanceof Uint8Array&&s.byteLength===s.buffer.byteLength?s.buffer:new Uint8Array(s).buffer;if(t===undefined){if(this._fullRequestReader){this._fullRequestReader._enqueue(e)}else{this._queuedChunks.push(e)}}else{const s=this._rangeReaders.some((function(s){if(s._begin!==t){return false}s._enqueue(e);return true}));T(s,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(t){if(t.total===undefined){this._rangeReaders[0]?.onProgress?.({loaded:t.loaded})}else{this._fullRequestReader?.onProgress?.({loaded:t.loaded,total:t.total})}}_onProgressiveDone(){this._fullRequestReader?.progressiveDone();this._progressiveDone=true}_removeRangeReader(t){const s=this._rangeReaders.indexOf(t);if(s>=0){this._rangeReaders.splice(s,1)}}getFullReader(){T(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const t=this._queuedChunks;this._queuedChunks=null;return new se(this,t,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(t,s){if(s<=this._progressiveDataLength){return null}const e=new ee(this,t,s);this._pdfDataRangeTransport.requestDataRange(t,s);this._rangeReaders.push(e);return e}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const s of this._rangeReaders.slice(0)){s.cancel(t)}this._pdfDataRangeTransport.abort()}}class se{constructor(t,s,e=false,i=null){this._stream=t;this._done=e||false;this._filename=lt(i)?i:null;this._queuedChunks=s||[];this._loaded=0;for(const t of this._queuedChunks){this._loaded+=t.byteLength}this._requests=[];this._headersReady=Promise.resolve();t._fullRequestReader=this;this.onProgress=null}_enqueue(t){if(this._done){return}if(this._requests.length>0){const s=this._requests.shift();s.resolve({value:t,done:false})}else{this._queuedChunks.push(t)}this._loaded+=t.byteLength}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0){const t=this._queuedChunks.shift();return{value:t,done:false}}if(this._done){return{value:undefined,done:true}}const t=Promise.withResolvers();this._requests.push(t);return t.promise}cancel(t){this._done=true;for(const t of this._requests){t.resolve({value:undefined,done:true})}this._requests.length=0}progressiveDone(){if(this._done){return}this._done=true}}class ee{constructor(t,s,e){this._stream=t;this._begin=s;this._end=e;this._queuedChunk=null;this._requests=[];this._done=false;this.onProgress=null}_enqueue(t){if(this._done){return}if(this._requests.length===0){this._queuedChunk=t}else{const s=this._requests.shift();s.resolve({value:t,done:false});for(const t of this._requests){t.resolve({value:undefined,done:true})}this._requests.length=0}this._done=true;this._stream._removeRangeReader(this)}get isStreamingSupported(){return false}async read(){if(this._queuedChunk){const t=this._queuedChunk;this._queuedChunk=null;return{value:t,done:false}}if(this._done){return{value:undefined,done:true}}const t=Promise.withResolvers();this._requests.push(t);return t.promise}cancel(t){this._done=true;for(const t of this._requests){t.resolve({value:undefined,done:true})}this._requests.length=0;this._stream._removeRangeReader(this)}}function ie(t){let s=true;let e=i("filename\\*","i").exec(t);if(e){e=e[1];let t=h(e);t=unescape(t);t=a(t);t=c(t);return r(t)}e=o(t);if(e){const t=c(e);return r(t)}e=i("filename","i").exec(t);if(e){e=e[1];let t=h(e);t=c(t);return r(t)}function i(t,s){return new RegExp("(?:^|;)\\s*"+t+"\\s*=\\s*"+"("+'[^";\\s][^;\\s]*'+"|"+'"(?:[^"\\\\]|\\\\"?)+"?'+")",s)}function n(t,e){if(t){if(!/^[\x00-\xFF]+$/.test(e)){return e}try{const i=new TextDecoder(t,{fatal:true});const n=j(e);e=i.decode(n);s=false}catch{}}return e}function r(t){if(s&&/[\x80-\xff]/.test(t)){t=n("utf-8",t);if(s){t=n("iso-8859-1",t)}}return t}function o(t){const s=[];let e;const n=i("filename\\*((?!0\\d)\\d+)(\\*?)","ig");while((e=n.exec(t))!==null){let[,t,i,n]=e;t=parseInt(t,10);if(t in s){if(t===0){break}continue}s[t]=[i,n]}const r=[];for(let t=0;t<s.length;++t){if(!(t in s)){break}let[e,i]=s[t];i=h(i);if(e){i=unescape(i);if(t===0){i=a(i)}}r.push(i)}return r.join("")}function h(t){if(t.startsWith('"')){const s=t.slice(1).split('\\"');for(let t=0;t<s.length;++t){const e=s[t].indexOf('"');if(e!==-1){s[t]=s[t].slice(0,e);s.length=t+1}s[t]=s[t].replaceAll(/\\(.)/g,"$1")}t=s.join('"')}return t}function a(t){const s=t.indexOf("'");if(s===-1){return t}const e=t.slice(0,s);const i=t.slice(s+1);const r=i.replace(/^[^']*'/,"");return n(e,r)}function c(t){if(!t.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(t)){return t}return t.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,(function(t,s,e,i){if(e==="q"||e==="Q"){i=i.replaceAll("_"," ");i=i.replaceAll(/=([0-9a-fA-F]{2})/g,(function(t,s){return String.fromCharCode(parseInt(s,16))}));return n(s,i)}try{i=atob(i)}catch{}return n(s,i)}))}return""}function ne(t,s){const e=new Headers;if(!t||!s||typeof s!=="object"){return e}for(const t in s){const i=s[t];if(i!==undefined){e.append(t,i)}}return e}function re(t){return URL.parse(t)?.origin??null}function oe({responseHeaders:t,isHttp:s,rangeChunkSize:e,disableRange:i}){const n={allowRangeRequests:false,suggestedLength:undefined};const r=parseInt(t.get("Content-Length"),10);if(!Number.isInteger(r)){return n}n.suggestedLength=r;if(r<=2*e){return n}if(i||!s){return n}if(t.get("Accept-Ranges")!=="bytes"){return n}const o=t.get("Content-Encoding")||"identity";if(o!=="identity"){return n}n.allowRangeRequests=true;return n}function he(t){const s=t.get("Content-Disposition");if(s){let t=ie(s);if(t.includes("%")){try{t=decodeURIComponent(t)}catch{}}if(lt(t)){return t}}return null}function ae(t,s){return new O(`Unexpected server response (${t}) while retrieving PDF "${s}".`,t,t===404||t===0&&s.startsWith("file:"))}function ce(t){return t===200||t===206}function le(t,s,e){return{method:"GET",headers:t,signal:e.signal,mode:"cors",credentials:s?"include":"same-origin",redirect:"follow"}}function ue(t){if(t instanceof Uint8Array){return t.buffer}if(t instanceof ArrayBuffer){return t}E(`getArrayBuffer - unexpected data format: ${t}`);return new Uint8Array(t).buffer}class fe{_responseOrigin=null;constructor(t){this.source=t;this.isHttp=/^https?:/i.test(t.url);this.headers=ne(this.isHttp,t.httpHeaders);this._fullRequestReader=null;this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){T(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once.");this._fullRequestReader=new de(this);return this._fullRequestReader}getRangeReader(t,s){if(s<=this._progressiveDataLength){return null}const e=new pe(this,t,s);this._rangeRequestReaders.push(e);return e}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const s of this._rangeRequestReaders.slice(0)){s.cancel(t)}}}class de{constructor(t){this._stream=t;this._reader=null;this._loaded=0;this._filename=null;const s=t.source;this._withCredentials=s.withCredentials||false;this._contentLength=s.length;this._headersCapability=Promise.withResolvers();this._disableRange=s.disableRange||false;this._rangeChunkSize=s.rangeChunkSize;if(!this._rangeChunkSize&&!this._disableRange){this._disableRange=true}this._abortController=new AbortController;this._isStreamingSupported=!s.disableStream;this._isRangeSupported=!s.disableRange;const e=new Headers(t.headers);const i=s.url;fetch(i,le(e,this._withCredentials,this._abortController)).then((s=>{t._responseOrigin=re(s.url);if(!ce(s.status)){throw ae(s.status,i)}this._reader=s.body.getReader();this._headersCapability.resolve();const e=s.headers;const{allowRangeRequests:n,suggestedLength:r}=oe({responseHeaders:e,isHttp:t.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=n;this._contentLength=r||this._contentLength;this._filename=he(e);if(!this._isStreamingSupported&&this._isRangeSupported){this.cancel(new B("Streaming is disabled."))}})).catch(this._headersCapability.reject);this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:t,done:s}=await this._reader.read();if(s){return{value:t,done:s}}this._loaded+=t.byteLength;this.onProgress?.({loaded:this._loaded,total:this._contentLength});return{value:ue(t),done:false}}cancel(t){this._reader?.cancel(t);this._abortController.abort()}}class pe{constructor(t,s,e){this._stream=t;this._reader=null;this._loaded=0;const i=t.source;this._withCredentials=i.withCredentials||false;this._readCapability=Promise.withResolvers();this._isStreamingSupported=!i.disableStream;this._abortController=new AbortController;const n=new Headers(t.headers);n.append("Range",`bytes=${s}-${e-1}`);const r=i.url;fetch(r,le(n,this._withCredentials,this._abortController)).then((s=>{const e=re(s.url);if(e!==t._responseOrigin){throw new Error(`Expected range response-origin "${e}" to match "${t._responseOrigin}".`)}if(!ce(s.status)){throw ae(s.status,r)}this._readCapability.resolve();this._reader=s.body.getReader()})).catch(this._readCapability.reject);this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:t,done:s}=await this._reader.read();if(s){return{value:t,done:s}}this._loaded+=t.byteLength;this.onProgress?.({loaded:this._loaded});return{value:ue(t),done:false}}cancel(t){this._reader?.cancel(t);this._abortController.abort()}}const ge=200;const me=206;function Ae(t){const s=t.response;if(typeof s!=="string"){return s}return j(s).buffer}class we{_responseOrigin=null;constructor({url:t,httpHeaders:s,withCredentials:e}){this.url=t;this.isHttp=/^https?:/i.test(t);this.headers=ne(this.isHttp,s);this.withCredentials=e||false;this.currXhrId=0;this.pendingRequests=Object.create(null)}request(t){const s=new XMLHttpRequest;const e=this.currXhrId++;const i=this.pendingRequests[e]={xhr:s};s.open("GET",this.url);s.withCredentials=this.withCredentials;for(const[t,e]of this.headers){s.setRequestHeader(t,e)}if(this.isHttp&&"begin"in t&&"end"in t){s.setRequestHeader("Range",`bytes=${t.begin}-${t.end-1}`);i.expectedStatus=me}else{i.expectedStatus=ge}s.responseType="arraybuffer";T(t.onError,"Expected `onError` callback to be provided.");s.onerror=()=>{t.onError(s.status)};s.onreadystatechange=this.onStateChange.bind(this,e);s.onprogress=this.onProgress.bind(this,e);i.onHeadersReceived=t.onHeadersReceived;i.onDone=t.onDone;i.onError=t.onError;i.onProgress=t.onProgress;s.send(null);return e}onProgress(t,s){const e=this.pendingRequests[t];if(!e){return}e.onProgress?.(s)}onStateChange(t,s){const e=this.pendingRequests[t];if(!e){return}const i=e.xhr;if(i.readyState>=2&&e.onHeadersReceived){e.onHeadersReceived();delete e.onHeadersReceived}if(i.readyState!==4){return}if(!(t in this.pendingRequests)){return}delete this.pendingRequests[t];if(i.status===0&&this.isHttp){e.onError(i.status);return}const n=i.status||ge;const r=n===ge&&e.expectedStatus===me;if(!r&&n!==e.expectedStatus){e.onError(i.status);return}const o=Ae(i);if(n===me){const t=i.getResponseHeader("Content-Range");const s=/bytes (\d+)-(\d+)\/(\d+)/.exec(t);if(s){e.onDone({begin:parseInt(s[1],10),chunk:o})}else{E(`Missing or invalid "Content-Range" header.`);e.onError(0)}}else if(o){e.onDone({begin:0,chunk:o})}else{e.onError(i.status)}}getRequestXhr(t){return this.pendingRequests[t].xhr}isPendingRequest(t){return t in this.pendingRequests}abortRequest(t){const s=this.pendingRequests[t].xhr;delete this.pendingRequests[t];s.abort()}}class be{constructor(t){this._source=t;this._manager=new we(t);this._rangeChunkSize=t.rangeChunkSize;this._fullRequestReader=null;this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(t){const s=this._rangeRequestReaders.indexOf(t);if(s>=0){this._rangeRequestReaders.splice(s,1)}}getFullReader(){T(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once.");this._fullRequestReader=new ye(this._manager,this._source);return this._fullRequestReader}getRangeReader(t,s){const e=new ve(this._manager,t,s);e.onClosed=this._onRangeRequestReaderClosed.bind(this);this._rangeRequestReaders.push(e);return e}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const s of this._rangeRequestReaders.slice(0)){s.cancel(t)}}}class ye{constructor(t,s){this._manager=t;this._url=s.url;this._fullRequestId=t.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)});this._headersCapability=Promise.withResolvers();this._disableRange=s.disableRange||false;this._contentLength=s.length;this._rangeChunkSize=s.rangeChunkSize;if(!this._rangeChunkSize&&!this._disableRange){this._disableRange=true}this._isStreamingSupported=false;this._isRangeSupported=false;this._cachedChunks=[];this._requests=[];this._done=false;this._storedError=undefined;this._filename=null;this.onProgress=null}_onHeadersReceived(){const t=this._fullRequestId;const s=this._manager.getRequestXhr(t);this._manager._responseOrigin=re(s.responseURL);const e=s.getAllResponseHeaders();const i=new Headers(e?e.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map((t=>{const[s,...e]=t.split(": ");return[s,e.join(": ")]})):[]);const{allowRangeRequests:n,suggestedLength:r}=oe({responseHeaders:i,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});if(n){this._isRangeSupported=true}this._contentLength=r||this._contentLength;this._filename=he(i);if(this._isRangeSupported){this._manager.abortRequest(t)}this._headersCapability.resolve()}_onDone(t){if(t){if(this._requests.length>0){const s=this._requests.shift();s.resolve({value:t.chunk,done:false})}else{this._cachedChunks.push(t.chunk)}}this._done=true;if(this._cachedChunks.length>0){return}for(const t of this._requests){t.resolve({value:undefined,done:true})}this._requests.length=0}_onError(t){this._storedError=ae(t,this._url);this._headersCapability.reject(this._storedError);for(const t of this._requests){t.reject(this._storedError)}this._requests.length=0;this._cachedChunks.length=0}_onProgress(t){this.onProgress?.({loaded:t.loaded,total:t.lengthComputable?t.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){await this._headersCapability.promise;if(this._storedError){throw this._storedError}if(this._cachedChunks.length>0){const t=this._cachedChunks.shift();return{value:t,done:false}}if(this._done){return{value:undefined,done:true}}const t=Promise.withResolvers();this._requests.push(t);return t.promise}cancel(t){this._done=true;this._headersCapability.reject(t);for(const t of this._requests){t.resolve({value:undefined,done:true})}this._requests.length=0;if(this._manager.isPendingRequest(this._fullRequestId)){this._manager.abortRequest(this._fullRequestId)}this._fullRequestReader=null}}class ve{constructor(t,s,e){this._manager=t;this._url=t.url;this._requestId=t.request({begin:s,end:e,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)});this._requests=[];this._queuedChunk=null;this._done=false;this._storedError=undefined;this.onProgress=null;this.onClosed=null}_onHeadersReceived(){const t=re(this._manager.getRequestXhr(this._requestId)?.responseURL);if(t!==this._manager._responseOrigin){this._storedError=new Error(`Expected range response-origin "${t}" to match "${this._manager._responseOrigin}".`);this._onError(0)}}_close(){this.onClosed?.(this)}_onDone(t){const s=t.chunk;if(this._requests.length>0){const t=this._requests.shift();t.resolve({value:s,done:false})}else{this._queuedChunk=s}this._done=true;for(const t of this._requests){t.resolve({value:undefined,done:true})}this._requests.length=0;this._close()}_onError(t){this._storedError??=ae(t,this._url);for(const t of this._requests){t.reject(this._storedError)}this._requests.length=0;this._queuedChunk=null}_onProgress(t){if(!this.isStreamingSupported){this.onProgress?.({loaded:t.loaded})}}get isStreamingSupported(){return false}async read(){if(this._storedError){throw this._storedError}if(this._queuedChunk!==null){const t=this._queuedChunk;this._queuedChunk=null;return{value:t,done:false}}if(this._done){return{value:undefined,done:true}}const t=Promise.withResolvers();this._requests.push(t);return t.promise}cancel(t){this._done=true;for(const t of this._requests){t.resolve({value:undefined,done:true})}this._requests.length=0;if(this._manager.isPendingRequest(this._requestId)){this._manager.abortRequest(this._requestId)}this._close()}}const xe=/^[a-z][a-z0-9\-+.]+:/i;function Me(t){if(xe.test(t)){return new URL(t)}const s=process.getBuiltinModule("url");return new URL(s.pathToFileURL(t))}class ke{constructor(t){this.source=t;this.url=Me(t.url);T(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs.");this._fullRequestReader=null;this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){T(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once.");this._fullRequestReader=new Se(this);return this._fullRequestReader}getRangeReader(t,s){if(s<=this._progressiveDataLength){return null}const e=new Ee(this,t,s);this._rangeRequestReaders.push(e);return e}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const s of this._rangeRequestReaders.slice(0)){s.cancel(t)}}}class Se{constructor(t){this._url=t.url;this._done=false;this._storedError=null;this.onProgress=null;const s=t.source;this._contentLength=s.length;this._loaded=0;this._filename=null;this._disableRange=s.disableRange||false;this._rangeChunkSize=s.rangeChunkSize;if(!this._rangeChunkSize&&!this._disableRange){this._disableRange=true}this._isStreamingSupported=!s.disableStream;this._isRangeSupported=!s.disableRange;this._readableStream=null;this._readCapability=Promise.withResolvers();this._headersCapability=Promise.withResolvers();const e=process.getBuiltinModule("fs");e.promises.lstat(this._url).then((t=>{this._contentLength=t.size;this._setReadableStream(e.createReadStream(this._url));this._headersCapability.resolve()}),(t=>{if(t.code==="ENOENT"){t=ae(0,this._url.href)}this._storedError=t;this._headersCapability.reject(t)}))}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;if(this._done){return{value:undefined,done:true}}if(this._storedError){throw this._storedError}const t=this._readableStream.read();if(t===null){this._readCapability=Promise.withResolvers();return this.read()}this._loaded+=t.length;this.onProgress?.({loaded:this._loaded,total:this._contentLength});const s=new Uint8Array(t).buffer;return{value:s,done:false}}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t;this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t;t.on("readable",(()=>{this._readCapability.resolve()}));t.on("end",(()=>{t.destroy();this._done=true;this._readCapability.resolve()}));t.on("error",(t=>{this._error(t)}));if(!this._isStreamingSupported&&this._isRangeSupported){this._error(new B("streaming is disabled"))}if(this._storedError){this._readableStream.destroy(this._storedError)}}}class Ee{constructor(t,s,e){this._url=t.url;this._done=false;this._storedError=null;this.onProgress=null;this._loaded=0;this._readableStream=null;this._readCapability=Promise.withResolvers();const i=t.source;this._isStreamingSupported=!i.disableStream;const n=process.getBuiltinModule("fs");this._setReadableStream(n.createReadStream(this._url,{start:s,end:e-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;if(this._done){return{value:undefined,done:true}}if(this._storedError){throw this._storedError}const t=this._readableStream.read();if(t===null){this._readCapability=Promise.withResolvers();return this.read()}this._loaded+=t.length;this.onProgress?.({loaded:this._loaded});const s=new Uint8Array(t).buffer;return{value:s,done:false}}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t;this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t;t.on("readable",(()=>{this._readCapability.resolve()}));t.on("end",(()=>{t.destroy();this._done=true;this._readCapability.resolve()}));t.on("error",(t=>{this._error(t)}));if(this._storedError){this._readableStream.destroy(this._storedError)}}}const Ce=1e5;const Te=30;class Pe{#Ve=Promise.withResolvers();#mt=null;#Xe=false;#Ye=!!globalThis.FontInspector?.enabled;#Qe=null;#Ke=null;#qe=0;#Je=0;#Ze=null;#ti=null;#si=0;#ei=0;#ii=Object.create(null);#ni=[];#ri=null;#oi=[];#hi=new WeakMap;#ai=null;static#ci=new Map;static#li=new Map;static#ui=new WeakMap;static#fi=null;static#di=new Set;constructor({textContentSource:t,container:s,viewport:e}){if(t instanceof ReadableStream){this.#ri=t}else if(typeof t==="object"){this.#ri=new ReadableStream({start(s){s.enqueue(t);s.close()}})}else{throw new Error('No "textContentSource" parameter specified.')}this.#mt=this.#ti=s;this.#ei=e.scale*kt.pixelRatio;this.#si=e.rotation;this.#Ke={div:null,properties:null,ctx:null};const{pageWidth:i,pageHeight:n,pageX:r,pageY:o}=e.rawDims;this.#ai=[1,0,0,-1,-r,o+n];this.#Je=i;this.#qe=n;Pe.#pi();Mt(s,e);this.#Ve.promise.finally((()=>{Pe.#di.delete(this);this.#Ke=null;this.#ii=null})).catch((()=>{}))}static get fontFamilyMap(){const{isWindows:t,isFirefox:s}=W.platform;return D(this,"fontFamilyMap",new Map([["sans-serif",`${t&&s?"Calibri, ":""}sans-serif`],["monospace",`${t&&s?"Lucida Console, ":""}monospace`]]))}render(){const t=()=>{this.#Ze.read().then((({value:s,done:e})=>{if(e){this.#Ve.resolve();return}this.#Qe??=s.lang;Object.assign(this.#ii,s.styles);this.#gi(s.items);t()}),this.#Ve.reject)};this.#Ze=this.#ri.getReader();Pe.#di.add(this);t();return this.#Ve.promise}update({viewport:t,onBefore:s=null}){const e=t.scale*kt.pixelRatio;const i=t.rotation;if(i!==this.#si){s?.();this.#si=i;Mt(this.#ti,{rotation:i})}if(e!==this.#ei){s?.();this.#ei=e;const t={div:null,properties:null,ctx:Pe.#mi(this.#Qe)};for(const s of this.#oi){t.properties=this.#hi.get(s);t.div=s;this.#Ai(t)}}}cancel(){const t=new B("TextLayer task cancelled.");this.#Ze?.cancel(t).catch((()=>{}));this.#Ze=null;this.#Ve.reject(t)}get textDivs(){return this.#oi}get textContentItemsStr(){return this.#ni}#gi(t){if(this.#Xe){return}this.#Ke.ctx??=Pe.#mi(this.#Qe);const s=this.#oi,e=this.#ni;for(const i of t){if(s.length>Ce){E("Ignoring additional textDivs for performance reasons.");this.#Xe=true;return}if(i.str===undefined){if(i.type==="beginMarkedContentProps"||i.type==="beginMarkedContent"){const t=this.#mt;this.#mt=document.createElement("span");this.#mt.classList.add("markedContent");if(i.id!==null){this.#mt.setAttribute("id",`${i.id}`)}t.append(this.#mt)}else if(i.type==="endMarkedContent"){this.#mt=this.#mt.parentNode}continue}e.push(i.str);this.#wi(i)}}#wi(t){const s=document.createElement("span");const e={angle:0,canvasWidth:0,hasText:t.str!=="",hasEOL:t.hasEOL,fontSize:0};this.#oi.push(s);const i=X.transform(this.#ai,t.transform);let n=Math.atan2(i[1],i[0]);const r=this.#ii[t.fontName];if(r.vertical){n+=Math.PI/2}let o=this.#Ye&&r.fontSubstitution||r.fontFamily;o=Pe.fontFamilyMap.get(o)||o;const h=Math.hypot(i[2],i[3]);const a=h*Pe.#bi(o,r,this.#Qe);let c,l;if(n===0){c=i[4];l=i[5]-a}else{c=i[4]+a*Math.sin(n);l=i[5]-a*Math.cos(n)}const u="calc(var(--total-scale-factor) *";const f=s.style;if(this.#mt===this.#ti){f.left=`${(100*c/this.#Je).toFixed(2)}%`;f.top=`${(100*l/this.#qe).toFixed(2)}%`}else{f.left=`${u}${c.toFixed(2)}px)`;f.top=`${u}${l.toFixed(2)}px)`}f.fontSize=`${u}${(Pe.#fi*h).toFixed(2)}px)`;f.fontFamily=o;e.fontSize=h;s.setAttribute("role","presentation");s.textContent=t.str;s.dir=t.dir;if(this.#Ye){s.dataset.fontName=r.fontSubstitutionLoadedName||t.fontName}if(n!==0){e.angle=n*(180/Math.PI)}let d=false;if(t.str.length>1){d=true}else if(t.str!==" "&&t.transform[0]!==t.transform[3]){const s=Math.abs(t.transform[0]),e=Math.abs(t.transform[3]);if(s!==e&&Math.max(s,e)/Math.min(s,e)>1.5){d=true}}if(d){e.canvasWidth=r.vertical?t.height:t.width}this.#hi.set(s,e);this.#Ke.div=s;this.#Ke.properties=e;this.#Ai(this.#Ke);if(e.hasText){this.#mt.append(s)}if(e.hasEOL){const t=document.createElement("br");t.setAttribute("role","presentation");this.#mt.append(t)}}#Ai(t){const{div:s,properties:e,ctx:i}=t;const{style:n}=s;let r="";if(Pe.#fi>1){r=`scale(${1/Pe.#fi})`}if(e.canvasWidth!==0&&e.hasText){const{fontFamily:t}=n;const{canvasWidth:o,fontSize:h}=e;Pe.#yi(i,h*this.#ei,t);const{width:a}=i.measureText(s.textContent);if(a>0){r=`scaleX(${o*this.#ei/a}) ${r}`}}if(e.angle!==0){r=`rotate(${e.angle}deg) ${r}`}if(r.length>0){n.transform=r}}static cleanup(){if(this.#di.size>0){return}this.#ci.clear();for(const{canvas:t}of this.#li.values()){t.remove()}this.#li.clear()}static#mi(t=null){let s=this.#li.get(t||="");if(!s){const e=document.createElement("canvas");e.className="hiddenCanvasElement";e.lang=t;document.body.append(e);s=e.getContext("2d",{alpha:false,willReadFrequently:true});this.#li.set(t,s);this.#ui.set(s,{size:0,family:""})}return s}static#yi(t,s,e){const i=this.#ui.get(t);if(s===i.size&&e===i.family){return}t.font=`${s}px ${e}`;i.size=s;i.family=e}static#pi(){if(this.#fi!==null){return}const t=document.createElement("div");t.style.opacity=0;t.style.lineHeight=1;t.style.fontSize="1px";t.style.position="absolute";t.textContent="X";document.body.append(t);this.#fi=t.getBoundingClientRect().height;t.remove()}static#bi(t,s,e){const i=this.#ci.get(t);if(i){return i}const n=this.#mi(e);n.canvas.width=n.canvas.height=Te;this.#yi(n,Te,t);const r=n.measureText("");const o=r.fontBoundingBoxAscent;const h=Math.abs(r.fontBoundingBoxDescent);n.canvas.width=n.canvas.height=0;let a=.8;if(o){a=o/(o+h)}else{if(W.platform.isFirefox){E("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference "+"in `about:config` to improve TextLayer rendering.")}if(s.ascent){a=s.ascent}else if(s.descent){a=1+s.descent}}this.#ci.set(t,a);return a}}class Ne{static textContent(t){const s=[];const e={items:s,styles:Object.create(null)};function i(t){if(!t){return}let e=null;const n=t.name;if(n==="#text"){e=t.value}else if(!Ne.shouldBuildText(n)){return}else if(t?.attributes?.textContent){e=t.attributes.textContent}else if(t.value){e=t.value}if(e!==null){s.push({str:e})}if(!t.children){return}for(const s of t.children){i(s)}}i(t);return e}static shouldBuildText(t){return!(t==="textarea"||t==="input"||t==="option"||t==="select")}}const Ie=65536;const De=100;function Re(t={}){if(typeof t==="string"||t instanceof URL){t={url:t}}else if(t instanceof ArrayBuffer||ArrayBuffer.isView(t)){t={data:t}}const s=new Ue;const{docId:e}=s;const i=t.url?$e(t.url):null;const n=t.data?Fe(t.data):null;const o=t.httpHeaders||null;const h=t.withCredentials===true;const a=t.password??null;const c=t.range instanceof je?t.range:null;const l=Number.isInteger(t.rangeChunkSize)&&t.rangeChunkSize>0?t.rangeChunkSize:Ie;let u=t.worker instanceof We?t.worker:null;const f=t.verbosity;const d=typeof t.docBaseUrl==="string"&&!ct(t.docBaseUrl)?t.docBaseUrl:null;const p=_e(t.cMapUrl);const g=t.cMapPacked!==false;const m=t.CMapReaderFactory||(r?fs:es);const A=_e(t.iccUrl);const w=_e(t.standardFontDataUrl);const b=t.StandardFontDataFactory||(r?ds:os);const y=_e(t.wasmUrl);const v=t.WasmFactory||(r?ps:as);const x=t.stopAtErrors!==true;const k=Number.isInteger(t.maxImageSize)&&t.maxImageSize>-1?t.maxImageSize:-1;const S=t.isEvalSupported!==false;const E=typeof t.isOffscreenCanvasSupported==="boolean"?t.isOffscreenCanvasSupported:!r;const C=typeof t.isImageDecoderSupported==="boolean"?t.isImageDecoderSupported:!r&&(W.platform.isFirefox||!globalThis.chrome);const T=Number.isInteger(t.canvasMaxAreaInBytes)?t.canvasMaxAreaInBytes:-1;const P=typeof t.disableFontFace==="boolean"?t.disableFontFace:r;const N=t.fontExtraProperties===true;const I=t.enableXfa===true;const D=t.ownerDocument||globalThis.document;const R=t.disableRange===true;const $=t.disableStream===true;const F=t.disableAutoFetch===true;const _=t.pdfBug===true;const O=t.CanvasFactory||(r?us:ts);const L=t.FilterFactory||(r?ls:ns);const B=t.enableHWA===true;const U=t.useWasm!==false;const j=c?c.length:t.length??NaN;const H=typeof t.useSystemFonts==="boolean"?t.useSystemFonts:!r&&!P;const z=typeof t.useWorkerFetch==="boolean"?t.useWorkerFetch:!!(m===es&&b===os&&v===as&&p&&w&&y&&pt(p,document.baseURI)&&pt(w,document.baseURI)&&pt(y,document.baseURI));const G=null;M(f);const V={canvasFactory:new O({ownerDocument:D,enableHWA:B}),filterFactory:new L({docId:e,ownerDocument:D}),cMapReaderFactory:z?null:new m({baseUrl:p,isCompressed:g}),standardFontDataFactory:z?null:new b({baseUrl:w}),wasmFactory:z?null:new v({baseUrl:y})};if(!u){const t={verbosity:f,port:Qs.workerPort};u=t.port?We.fromPort(t):new We(t);s._worker=u}const X={docId:e,apiVersion:"5.2.133",data:n,password:a,disableAutoFetch:F,rangeChunkSize:l,length:j,docBaseUrl:d,enableXfa:I,evaluatorOptions:{maxImageSize:k,disableFontFace:P,ignoreErrors:x,isEvalSupported:S,isOffscreenCanvasSupported:E,isImageDecoderSupported:C,canvasMaxAreaInBytes:T,fontExtraProperties:N,useSystemFonts:H,useWasm:U,useWorkerFetch:z,cMapUrl:p,iccUrl:A,standardFontDataUrl:w,wasmUrl:y}};const Y={ownerDocument:D,pdfBug:_,styleElement:G,loadingParams:{disableAutoFetch:F,enableXfa:I}};u.promise.then((function(){if(s.destroyed){throw new Error("Loading aborted")}if(u.destroyed){throw new Error("Worker was destroyed")}const t=u.messageHandler.sendWithPromise("GetDocRequest",X,n?[n.buffer]:null);let a;if(c){a=new te(c,{disableRange:R,disableStream:$})}else if(!n){if(!i){throw new Error("getDocument - no `url` parameter provided.")}let t;if(r){if(pt(i)){if(typeof fetch==="undefined"||typeof Response==="undefined"||!("body"in Response.prototype)){throw new Error("getDocument - the Fetch API was disabled in Node.js, see `--no-experimental-fetch`.")}t=fe}else{t=ke}}else{t=pt(i)?fe:be}a=new t({url:i,length:j,httpHeaders:o,withCredentials:h,rangeChunkSize:l,disableRange:R,disableStream:$})}return t.then((t=>{if(s.destroyed){throw new Error("Loading aborted")}if(u.destroyed){throw new Error("Worker was destroyed")}const i=new Jt(e,t,u.port);const n=new Ve(i,s,a,Y,V);s._transport=n;i.send("Ready",null)}))})).catch(s._capability.reject);return s}function $e(t){if(t instanceof URL){return t.href}if(typeof t==="string"){if(r){return t}const s=URL.parse(t,window.location);if(s){return s.href}}throw new Error("Invalid PDF url data: "+"either string or URL-object is expected in the url property.")}function Fe(t){if(r&&typeof Buffer!=="undefined"&&t instanceof Buffer){throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.")}if(t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength){return t}if(typeof t==="string"){return j(t)}if(t instanceof ArrayBuffer||ArrayBuffer.isView(t)||typeof t==="object"&&!isNaN(t?.length)){return new Uint8Array(t)}throw new Error("Invalid PDF binary data: either TypedArray, "+"string, or array-like object is expected in the data property.")}function _e(t){if(typeof t!=="string"){return null}if(t.endsWith("/")){return t}throw new Error(`Invalid factory url: "${t}" must include trailing slash.`)}const Oe=t=>typeof t==="object"&&Number.isInteger(t?.num)&&t.num>=0&&Number.isInteger(t?.gen)&&t.gen>=0;const Le=t=>typeof t==="object"&&typeof t?.name==="string";const Be=tt.bind(null,Oe,Le);class Ue{static#me=0;_capability=Promise.withResolvers();_transport=null;_worker=null;docId=`d${Ue.#me++}`;destroyed=false;onPassword=null;onProgress=null;get promise(){return this._capability.promise}async destroy(){this.destroyed=true;try{if(this._worker?.port){this._worker._pendingDestroy=true}await(this._transport?.destroy())}catch(t){if(this._worker?.port){delete this._worker._pendingDestroy}throw t}this._transport=null;this._worker?.destroy();this._worker=null}async getData(){return this._transport.getData()}}class je{constructor(t,s,e=false,i=null){this.length=t;this.initialData=s;this.progressiveDone=e;this.contentDispositionFilename=i;this._rangeListeners=[];this._progressListeners=[];this._progressiveReadListeners=[];this._progressiveDoneListeners=[];this._readyCapability=Promise.withResolvers()}addRangeListener(t){this._rangeListeners.push(t)}addProgressListener(t){this._progressListeners.push(t)}addProgressiveReadListener(t){this._progressiveReadListeners.push(t)}addProgressiveDoneListener(t){this._progressiveDoneListeners.push(t)}onDataRange(t,s){for(const e of this._rangeListeners){e(t,s)}}onDataProgress(t,s){this._readyCapability.promise.then((()=>{for(const e of this._progressListeners){e(t,s)}}))}onDataProgressiveRead(t){this._readyCapability.promise.then((()=>{for(const s of this._progressiveReadListeners){s(t)}}))}onDataProgressiveDone(){this._readyCapability.promise.then((()=>{for(const t of this._progressiveDoneListeners){t()}}))}transportReady(){this._readyCapability.resolve()}requestDataRange(t,s){C("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class He{constructor(t,s){this._pdfInfo=t;this._transport=s}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return D(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(t){return this._transport.getPage(t)}getPageIndex(t){return this._transport.getPageIndex(t)}getDestinations(){return this._transport.getDestinations()}getDestination(t){return this._transport.getDestination(t)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:t="display"}={}){const{renderingIntent:s}=this._transport.getRenderingIntent(t);return this._transport.getOptionalContentConfig(s)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(t=false){return this._transport.startCleanup(t||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(t){return this._transport.cachedPageNumber(t)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class ze{#vi=false;constructor(t,s,e,i=false){this._pageIndex=t;this._pageInfo=s;this._transport=e;this._stats=i?new dt:null;this._pdfBug=i;this.commonObjs=e.commonObjs;this.objs=new Ye;this._intentStates=new Map;this.destroyed=false}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:t,rotation:s=this.rotate,offsetX:e=0,offsetY:i=0,dontFlip:n=false}={}){return new ht({viewBox:this.view,userUnit:this.userUnit,scale:t,rotation:s,offsetX:e,offsetY:i,dontFlip:n})}getAnnotations({intent:t="display"}={}){const{renderingIntent:s}=this._transport.getRenderingIntent(t);return this._transport.getAnnotations(this._pageIndex,s)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return D(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:t,viewport:s,intent:e="display",annotationMode:i=c.ENABLE,transform:n=null,background:r=null,optionalContentConfigPromise:o=null,annotationCanvasMap:h=null,pageColors:l=null,printAnnotationStorage:u=null,isEditing:f=false}){this._stats?.time("Overall");const d=this._transport.getRenderingIntent(e,i,u,f);const{renderingIntent:p,cacheKey:g}=d;this.#vi=false;o||=this._transport.getOptionalContentConfig(p);let m=this._intentStates.get(g);if(!m){m=Object.create(null);this._intentStates.set(g,m)}if(m.streamReaderCancelTimeout){clearTimeout(m.streamReaderCancelTimeout);m.streamReaderCancelTimeout=null}const A=!!(p&a.PRINT);if(!m.displayReadyCapability){m.displayReadyCapability=Promise.withResolvers();m.operatorList={fnArray:[],argsArray:[],lastChunk:false,separateAnnots:null};this._stats?.time("Page Request");this._pumpOperatorList(d)}const w=t=>{m.renderTasks.delete(b);if(A){this.#vi=true}this.#xi();if(t){b.capability.reject(t);this._abortOperatorList({intentState:m,reason:t instanceof Error?t:new Error(t)})}else{b.capability.resolve()}if(this._stats){this._stats.timeEnd("Rendering");this._stats.timeEnd("Overall");if(globalThis.Stats?.enabled){globalThis.Stats.add(this.pageNumber,this._stats)}}};const b=new Ke({callback:w,params:{canvasContext:t,viewport:s,transform:n,background:r},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:h,operatorList:m.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!A,pdfBug:this._pdfBug,pageColors:l});(m.renderTasks||=new Set).add(b);const y=b.task;Promise.all([m.displayReadyCapability.promise,o]).then((([t,s])=>{if(this.destroyed){w();return}this._stats?.time("Rendering");if(!(s.renderingIntent&p)){throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` "+"and `PDFDocumentProxy.getOptionalContentConfig` methods.")}b.initializeGraphics({transparency:t,optionalContentConfig:s});b.operatorListChanged()})).catch(w);return y}getOperatorList({intent:t="display",annotationMode:s=c.ENABLE,printAnnotationStorage:e=null,isEditing:i=false}={}){function n(){if(o.operatorList.lastChunk){o.opListReadCapability.resolve(o.operatorList);o.renderTasks.delete(h)}}const r=this._transport.getRenderingIntent(t,s,e,i,true);let o=this._intentStates.get(r.cacheKey);if(!o){o=Object.create(null);this._intentStates.set(r.cacheKey,o)}let h;if(!o.opListReadCapability){h=Object.create(null);h.operatorListChanged=n;o.opListReadCapability=Promise.withResolvers();(o.renderTasks||=new Set).add(h);o.operatorList={fnArray:[],argsArray:[],lastChunk:false,separateAnnots:null};this._stats?.time("Page Request");this._pumpOperatorList(r)}return o.opListReadCapability.promise}streamTextContent({includeMarkedContent:t=false,disableNormalization:s=false}={}){const e=100;return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:t===true,disableNormalization:s===true},{highWaterMark:e,size(t){return t.items.length}})}getTextContent(t={}){if(this._transport._htmlForXfa){return this.getXfa().then((t=>Ne.textContent(t)))}const s=this.streamTextContent(t);return new Promise((function(t,e){function i(){n.read().then((function({value:s,done:e}){if(e){t(r);return}r.lang??=s.lang;Object.assign(r.styles,s.styles);r.items.push(...s.items);i()}),e)}const n=s.getReader();const r={items:[],styles:Object.create(null),lang:null};i()}))}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=true;const t=[];for(const s of this._intentStates.values()){this._abortOperatorList({intentState:s,reason:new Error("Page was destroyed."),force:true});if(s.opListReadCapability){continue}for(const e of s.renderTasks){t.push(e.completed);e.cancel()}}this.objs.clear();this.#vi=false;return Promise.all(t)}cleanup(t=false){this.#vi=true;const s=this.#xi();if(t&&s){this._stats&&=new dt}return s}#xi(){if(!this.#vi||this.destroyed){return false}for(const{renderTasks:t,operatorList:s}of this._intentStates.values()){if(t.size>0||!s.lastChunk){return false}}this._intentStates.clear();this.objs.clear();this.#vi=false;return true}_startRenderPage(t,s){const e=this._intentStates.get(s);if(!e){return}this._stats?.timeEnd("Page Request");e.displayReadyCapability?.resolve(t)}_renderPageChunk(t,s){for(let e=0,i=t.length;e<i;e++){s.operatorList.fnArray.push(t.fnArray[e]);s.operatorList.argsArray.push(t.argsArray[e])}s.operatorList.lastChunk=t.lastChunk;s.operatorList.separateAnnots=t.separateAnnots;for(const t of s.renderTasks){t.operatorListChanged()}if(t.lastChunk){this.#xi()}}_pumpOperatorList({renderingIntent:t,cacheKey:s,annotationStorageSerializable:e,modifiedIds:i}){const{map:n,transfer:r}=e;const o=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:t,cacheKey:s,annotationStorage:n,modifiedIds:i},r);const h=o.getReader();const a=this._intentStates.get(s);a.streamReader=h;const c=()=>{h.read().then((({value:t,done:s})=>{if(s){a.streamReader=null;return}if(this._transport.destroyed){return}this._renderPageChunk(t,a);c()}),(t=>{a.streamReader=null;if(this._transport.destroyed){return}if(a.operatorList){a.operatorList.lastChunk=true;for(const t of a.renderTasks){t.operatorListChanged()}this.#xi()}if(a.displayReadyCapability){a.displayReadyCapability.reject(t)}else if(a.opListReadCapability){a.opListReadCapability.reject(t)}else{throw t}}))};c()}_abortOperatorList({intentState:t,reason:s,force:e=false}){if(!t.streamReader){return}if(t.streamReaderCancelTimeout){clearTimeout(t.streamReaderCancelTimeout);t.streamReaderCancelTimeout=null}if(!e){if(t.renderTasks.size>0){return}if(s instanceof at){let e=De;if(s.extraDelay>0&&s.extraDelay<1e3){e+=s.extraDelay}t.streamReaderCancelTimeout=setTimeout((()=>{t.streamReaderCancelTimeout=null;this._abortOperatorList({intentState:t,reason:s,force:true})}),e);return}}t.streamReader.cancel(new B(s.message)).catch((()=>{}));t.streamReader=null;if(this._transport.destroyed){return}for(const[s,e]of this._intentStates){if(e===t){this._intentStates.delete(s);break}}this.cleanup()}get stats(){return this._stats}}class Ge{#Mi=new Map;#ki=Promise.resolve();postMessage(t,s){const e={data:structuredClone(t,s?{transfer:s}:null)};this.#ki.then((()=>{for(const[t]of this.#Mi){t.call(this,e)}}))}addEventListener(t,s,e=null){let i=null;if(e?.signal instanceof AbortSignal){const{signal:n}=e;if(n.aborted){E("LoopbackPort - cannot use an `aborted` signal.");return}const r=()=>this.removeEventListener(t,s);i=()=>n.removeEventListener("abort",r);n.addEventListener("abort",r)}this.#Mi.set(s,i)}removeEventListener(t,s){const e=this.#Mi.get(s);e?.();this.#Mi.delete(s)}terminate(){for(const[,t]of this.#Mi){t?.()}this.#Mi.clear()}}class We{static#Si=0;static#Ei=false;static#Ci;static{if(r){this.#Ei=true;Qs.workerSrc||="./pdf.worker.mjs"}this._isSameOrigin=(t,s)=>{const e=URL.parse(t);if(!e?.origin||e.origin==="null"){return false}const i=new URL(s,e);return e.origin===i.origin};this._createCDNWrapper=t=>{const s=`await import("${t}");`;return URL.createObjectURL(new Blob([s],{type:"text/javascript"}))}}constructor({name:t=null,port:s=null,verbosity:e=k()}={}){this.name=t;this.destroyed=false;this.verbosity=e;this._readyCapability=Promise.withResolvers();this._port=null;this._webWorker=null;this._messageHandler=null;if(s){if(We.#Ci?.has(s)){throw new Error("Cannot use more than one PDFWorker per port.")}(We.#Ci||=new WeakMap).set(s,this);this._initializeFromPort(s);return}this._initialize()}get promise(){return this._readyCapability.promise}#Ti(){this._readyCapability.resolve();this._messageHandler.send("configure",{verbosity:this.verbosity})}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(t){this._port=t;this._messageHandler=new Jt("main","worker",t);this._messageHandler.on("ready",(function(){}));this.#Ti()}_initialize(){if(We.#Ei||We.#Pi){this._setupFakeWorker();return}let{workerSrc:t}=We;try{if(!We._isSameOrigin(window.location,t)){t=We._createCDNWrapper(new URL(t,window.location).href)}const s=new Worker(t,{type:"module"});const e=new Jt("main","worker",s);const i=()=>{n.abort();e.destroy();s.terminate();if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"))}else{this._setupFakeWorker()}};const n=new AbortController;s.addEventListener("error",(()=>{if(!this._webWorker){i()}}),{signal:n.signal});e.on("test",(t=>{n.abort();if(this.destroyed||!t){i();return}this._messageHandler=e;this._port=s;this._webWorker=s;this.#Ti()}));e.on("ready",(t=>{n.abort();if(this.destroyed){i();return}try{r()}catch{this._setupFakeWorker()}}));const r=()=>{const t=new Uint8Array;e.send("test",t,[t.buffer])};r();return}catch{S("The worker has been disabled.")}this._setupFakeWorker()}_setupFakeWorker(){if(!We.#Ei){E("Setting up fake worker.");We.#Ei=true}We._setupFakeWorkerGlobal.then((t=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const s=new Ge;this._port=s;const e=`fake${We.#Si++}`;const i=new Jt(e+"_worker",e,s);t.setup(i,s);this._messageHandler=new Jt(e,e+"_worker",s);this.#Ti()})).catch((t=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${t.message}".`))}))}destroy(){this.destroyed=true;this._webWorker?.terminate();this._webWorker=null;We.#Ci?.delete(this._port);this._port=null;this._messageHandler?.destroy();this._messageHandler=null}static fromPort(t){if(!t?.port){throw new Error("PDFWorker.fromPort - invalid method signature.")}const s=this.#Ci?.get(t.port);if(s){if(s._pendingDestroy){throw new Error("PDFWorker.fromPort - the worker is being destroyed.\n"+"Please remember to await `PDFDocumentLoadingTask.destroy()`-calls.")}return s}return new We(t)}static get workerSrc(){if(Qs.workerSrc){return Qs.workerSrc}throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get#Pi(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}}static get _setupFakeWorkerGlobal(){const t=async()=>{if(this.#Pi){return this.#Pi}const t=await import(this.workerSrc);return t.WorkerMessageHandler};return D(this,"_setupFakeWorkerGlobal",t())}}class Ve{#Ni=new Map;#Ii=new Map;#Di=new Map;#Ri=new Map;#$i=null;constructor(t,s,e,i,n){this.messageHandler=t;this.loadingTask=s;this.commonObjs=new Ye;this.fontLoader=new Vt({ownerDocument:i.ownerDocument,styleElement:i.styleElement});this.loadingParams=i.loadingParams;this._params=i;this.canvasFactory=n.canvasFactory;this.filterFactory=n.filterFactory;this.cMapReaderFactory=n.cMapReaderFactory;this.standardFontDataFactory=n.standardFontDataFactory;this.wasmFactory=n.wasmFactory;this.destroyed=false;this.destroyCapability=null;this._networkStream=e;this._fullReader=null;this._lastProgress=null;this.downloadInfoCapability=Promise.withResolvers();this.setupMessageHandler()}#Fi(t,s=null){const e=this.#Ni.get(t);if(e){return e}const i=this.messageHandler.sendWithPromise(t,s);this.#Ni.set(t,i);return i}get annotationStorage(){return D(this,"annotationStorage",new Gt)}getRenderingIntent(t,s=c.ENABLE,e=null,i=false,n=false){let r=a.DISPLAY;let o=zt;switch(t){case"any":r=a.ANY;break;case"display":break;case"print":r=a.PRINT;break;default:E(`getRenderingIntent - invalid intent: ${t}`)}const h=r&a.PRINT&&e instanceof Wt?e:this.annotationStorage;switch(s){case c.DISABLE:r+=a.ANNOTATIONS_DISABLE;break;case c.ENABLE:break;case c.ENABLE_FORMS:r+=a.ANNOTATIONS_FORMS;break;case c.ENABLE_STORAGE:r+=a.ANNOTATIONS_STORAGE;o=h.serializable;break;default:E(`getRenderingIntent - invalid annotationMode: ${s}`)}if(i){r+=a.IS_EDITING}if(n){r+=a.OPLIST}const{ids:l,hash:u}=h.modifiedIds;const f=[r,o.hash,u];return{renderingIntent:r,cacheKey:f.join("_"),annotationStorageSerializable:o,modifiedIds:l}}destroy(){if(this.destroyCapability){return this.destroyCapability.promise}this.destroyed=true;this.destroyCapability=Promise.withResolvers();this.#$i?.reject(new Error("Worker was destroyed during onPassword callback"));const t=[];for(const s of this.#Ii.values()){t.push(s._destroy())}this.#Ii.clear();this.#Di.clear();this.#Ri.clear();if(this.hasOwnProperty("annotationStorage")){this.annotationStorage.resetModified()}const s=this.messageHandler.sendWithPromise("Terminate",null);t.push(s);Promise.all(t).then((()=>{this.commonObjs.clear();this.fontLoader.clear();this.#Ni.clear();this.filterFactory.destroy();Pe.cleanup();this._networkStream?.cancelAllRequests(new B("Worker was terminated."));this.messageHandler?.destroy();this.messageHandler=null;this.destroyCapability.resolve()}),this.destroyCapability.reject);return this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:t,loadingTask:s}=this;t.on("GetReader",((t,s)=>{T(this._networkStream,"GetReader - no `IPDFStream` instance available.");this._fullReader=this._networkStream.getFullReader();this._fullReader.onProgress=t=>{this._lastProgress={loaded:t.loaded,total:t.total}};s.onPull=()=>{this._fullReader.read().then((function({value:t,done:e}){if(e){s.close();return}T(t instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer.");s.enqueue(new Uint8Array(t),1,[t])})).catch((t=>{s.error(t)}))};s.onCancel=t=>{this._fullReader.cancel(t);s.ready.catch((t=>{if(this.destroyed){return}throw t}))}}));t.on("ReaderHeadersReady",(async t=>{await this._fullReader.headersReady;const{isStreamingSupported:e,isRangeSupported:i,contentLength:n}=this._fullReader;if(!e||!i){if(this._lastProgress){s.onProgress?.(this._lastProgress)}this._fullReader.onProgress=t=>{s.onProgress?.({loaded:t.loaded,total:t.total})}}return{isStreamingSupported:e,isRangeSupported:i,contentLength:n}}));t.on("GetRangeReader",((t,s)=>{T(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const e=this._networkStream.getRangeReader(t.begin,t.end);if(!e){s.close();return}s.onPull=()=>{e.read().then((function({value:t,done:e}){if(e){s.close();return}T(t instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer.");s.enqueue(new Uint8Array(t),1,[t])})).catch((t=>{s.error(t)}))};s.onCancel=t=>{e.cancel(t);s.ready.catch((t=>{if(this.destroyed){return}throw t}))}}));t.on("GetDoc",(({pdfInfo:t})=>{this._numPages=t.numPages;this._htmlForXfa=t.htmlForXfa;delete t.htmlForXfa;s._capability.resolve(new He(t,this))}));t.on("DocException",(t=>{s._capability.reject(qt(t))}));t.on("PasswordRequest",(t=>{this.#$i=Promise.withResolvers();try{if(!s.onPassword){throw qt(t)}const e=t=>{if(t instanceof Error){this.#$i.reject(t)}else{this.#$i.resolve({password:t})}};s.onPassword(e,t.code)}catch(t){this.#$i.reject(t)}return this.#$i.promise}));t.on("DataLoaded",(t=>{s.onProgress?.({loaded:t.length,total:t.length});this.downloadInfoCapability.resolve(t)}));t.on("StartRenderPage",(t=>{if(this.destroyed){return}const s=this.#Ii.get(t.pageIndex);s._startRenderPage(t.transparency,t.cacheKey)}));t.on("commonobj",(([s,e,i])=>{if(this.destroyed){return null}if(this.commonObjs.has(s)){return null}switch(e){case"Font":if("error"in i){const t=i.error;E(`Error during font loading: ${t}`);this.commonObjs.resolve(s,t);break}const n=this._params.pdfBug&&globalThis.FontInspector?.enabled?(t,s)=>globalThis.FontInspector.fontAdded(t,s):null;const r=new Xt(i,n);this.fontLoader.bind(r).catch((()=>t.sendWithPromise("FontFallback",{id:s}))).finally((()=>{if(!r.fontExtraProperties&&r.data){r.data=null}this.commonObjs.resolve(s,r)}));break;case"CopyLocalImage":const{imageRef:o}=i;T(o,"The imageRef must be defined.");for(const t of this.#Ii.values()){for(const[,e]of t.objs){if(e?.ref!==o){continue}if(!e.dataLen){return null}this.commonObjs.resolve(s,structuredClone(e));return e.dataLen}}break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(s,i);break;default:throw new Error(`Got unknown common object type ${e}`)}return null}));t.on("obj",(([t,s,e,i])=>{if(this.destroyed){return}const n=this.#Ii.get(s);if(n.objs.has(t)){return}if(n._intentStates.size===0){i?.bitmap?.close();return}switch(e){case"Image":case"Pattern":n.objs.resolve(t,i);break;default:throw new Error(`Got unknown object type ${e}`)}}));t.on("DocProgress",(t=>{if(this.destroyed){return}s.onProgress?.({loaded:t.loaded,total:t.total})}));t.on("FetchBinaryData",(async t=>{if(this.destroyed){throw new Error("Worker was destroyed.")}const s=this[t.type];if(!s){throw new Error(`${t.type} not initialized, see the \`useWorkerFetch\` parameter.`)}return s.fetch(t)}))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){if(this.annotationStorage.size<=0){E("saveDocument called while `annotationStorage` is empty, "+"please use the getData-method instead.")}const{map:t,transfer:s}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:t,filename:this._fullReader?.filename??null},s).finally((()=>{this.annotationStorage.resetModified()}))}getPage(t){if(!Number.isInteger(t)||t<=0||t>this._numPages){return Promise.reject(new Error("Invalid page request."))}const s=t-1,e=this.#Di.get(s);if(e){return e}const i=this.messageHandler.sendWithPromise("GetPage",{pageIndex:s}).then((e=>{if(this.destroyed){throw new Error("Transport destroyed")}if(e.refStr){this.#Ri.set(e.refStr,t)}const i=new ze(s,e,this,this._params.pdfBug);this.#Ii.set(s,i);return i}));this.#Di.set(s,i);return i}getPageIndex(t){if(!Oe(t)){return Promise.reject(new Error("Invalid pageIndex request."))}return this.messageHandler.sendWithPromise("GetPageIndex",{num:t.num,gen:t.gen})}getAnnotations(t,s){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:t,intent:s})}getFieldObjects(){return this.#Fi("GetFieldObjects")}hasJSActions(){return this.#Fi("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(t){if(typeof t!=="string"){return Promise.reject(new Error("Invalid destination request."))}return this.messageHandler.sendWithPromise("GetDestination",{id:t})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return this.#Fi("GetDocJSActions")}getPageJSActions(t){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:t})}getStructTree(t){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:t})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(t){return this.#Fi("GetOptionalContentConfig").then((s=>new Zs(s,t)))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const t="GetMetadata",s=this.#Ni.get(t);if(s){return s}const e=this.messageHandler.sendWithPromise(t,null).then((t=>({info:t[0],metadata:t[1]?new Ks(t[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null})));this.#Ni.set(t,e);return e}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(t=false){if(this.destroyed){return}await this.messageHandler.sendWithPromise("Cleanup",null);for(const t of this.#Ii.values()){const s=t.cleanup();if(!s){throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`)}}this.commonObjs.clear();if(!t){this.fontLoader.clear()}this.#Ni.clear();this.filterFactory.destroy(true);Pe.cleanup()}cachedPageNumber(t){if(!Oe(t)){return null}const s=t.gen===0?`${t.num}R`:`${t.num}R${t.gen}`;return this.#Ri.get(s)??null}}const Xe=Symbol("INITIAL_DATA");class Ye{#_i=Object.create(null);#Oi(t){return this.#_i[t]||={...Promise.withResolvers(),data:Xe}}get(t,s=null){if(s){const e=this.#Oi(t);e.promise.then((()=>s(e.data)));return null}const e=this.#_i[t];if(!e||e.data===Xe){throw new Error(`Requesting object that isn't resolved yet ${t}.`)}return e.data}has(t){const s=this.#_i[t];return!!s&&s.data!==Xe}delete(t){const s=this.#_i[t];if(!s||s.data===Xe){return false}delete this.#_i[t];return true}resolve(t,s=null){const e=this.#Oi(t);e.data=s;e.resolve()}clear(){for(const t in this.#_i){const{data:s}=this.#_i[t];s?.bitmap?.close()}this.#_i=Object.create(null)}*[Symbol.iterator](){for(const t in this.#_i){const{data:s}=this.#_i[t];if(s===Xe){continue}yield[t,s]}}}class Qe{#Li=null;onContinue=null;onError=null;constructor(t){this.#Li=t}get promise(){return this.#Li.capability.promise}cancel(t=0){this.#Li.cancel(null,t)}get separateAnnots(){const{separateAnnots:t}=this.#Li.operatorList;if(!t){return false}const{annotationCanvasMap:s}=this.#Li;return t.form||t.canvas&&s?.size>0}}class Ke{#Bi=null;static#Ui=new WeakSet;constructor({callback:t,params:s,objs:e,commonObjs:i,annotationCanvasMap:n,operatorList:r,pageIndex:o,canvasFactory:h,filterFactory:a,useRequestAnimationFrame:c=false,pdfBug:l=false,pageColors:u=null}){this.callback=t;this.params=s;this.objs=e;this.commonObjs=i;this.annotationCanvasMap=n;this.operatorListIdx=null;this.operatorList=r;this._pageIndex=o;this.canvasFactory=h;this.filterFactory=a;this._pdfBug=l;this.pageColors=u;this.running=false;this.graphicsReadyCallback=null;this.graphicsReady=false;this._useRequestAnimationFrame=c===true&&typeof window!=="undefined";this.cancelled=false;this.capability=Promise.withResolvers();this.task=new Qe(this);this._cancelBound=this.cancel.bind(this);this._continueBound=this._continue.bind(this);this._scheduleNextBound=this._scheduleNext.bind(this);this._nextBound=this._next.bind(this);this._canvas=s.canvasContext.canvas}get completed(){return this.capability.promise.catch((function(){}))}initializeGraphics({transparency:t=false,optionalContentConfig:s}){if(this.cancelled){return}if(this._canvas){if(Ke.#Ui.has(this._canvas)){throw new Error("Cannot use the same canvas during multiple render() operations. "+"Use different canvas or ensure previous operations were "+"cancelled or completed.")}Ke.#Ui.add(this._canvas)}if(this._pdfBug&&globalThis.StepperManager?.enabled){this.stepper=globalThis.StepperManager.create(this._pageIndex);this.stepper.init(this.operatorList);this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint()}const{canvasContext:e,viewport:i,transform:n,background:r}=this.params;this.gfx=new Ys(e,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:s},this.annotationCanvasMap,this.pageColors);this.gfx.beginDrawing({transform:n,viewport:i,transparency:t,background:r});this.operatorListIdx=0;this.graphicsReady=true;this.graphicsReadyCallback?.()}cancel(t=null,s=0){this.running=false;this.cancelled=true;this.gfx?.endDrawing();if(this.#Bi){window.cancelAnimationFrame(this.#Bi);this.#Bi=null}Ke.#Ui.delete(this._canvas);t||=new at(`Rendering cancelled, page ${this._pageIndex+1}`,s);this.callback(t);this.task.onError?.(t)}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.stepper?.updateOperatorList(this.operatorList);if(this.running){return}this._continue()}_continue(){this.running=true;if(this.cancelled){return}if(this.task.onContinue){this.task.onContinue(this._scheduleNextBound)}else{this._scheduleNext()}}_scheduleNext(){if(this._useRequestAnimationFrame){this.#Bi=window.requestAnimationFrame((()=>{this.#Bi=null;this._nextBound().catch(this._cancelBound)}))}else{Promise.resolve().then(this._nextBound).catch(this._cancelBound)}}async _next(){if(this.cancelled){return}this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper);if(this.operatorListIdx===this.operatorList.argsArray.length){this.running=false;if(this.operatorList.lastChunk){this.gfx.endDrawing();Ke.#Ui.delete(this._canvas);this.callback()}}}}const qe="5.2.133";const Je="4f7761353";function Ze(t){return Math.floor(Math.max(0,Math.min(1,t))*255).toString(16).padStart(2,"0")}function ti(t){return Math.max(0,Math.min(255,255*t))}class si{static CMYK_G([t,s,e,i]){return["G",1-Math.min(1,.3*t+.59*e+.11*s+i)]}static G_CMYK([t]){return["CMYK",0,0,0,1-t]}static G_RGB([t]){return["RGB",t,t,t]}static G_rgb([t]){t=ti(t);return[t,t,t]}static G_HTML([t]){const s=Ze(t);return`#${s}${s}${s}`}static RGB_G([t,s,e]){return["G",.3*t+.59*s+.11*e]}static RGB_rgb(t){return t.map(ti)}static RGB_HTML(t){return`#${t.map(Ze).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([t,s,e,i]){return["RGB",1-Math.min(1,t+i),1-Math.min(1,e+i),1-Math.min(1,s+i)]}static CMYK_rgb([t,s,e,i]){return[ti(1-Math.min(1,t+i)),ti(1-Math.min(1,e+i)),ti(1-Math.min(1,s+i))]}static CMYK_HTML(t){const s=this.CMYK_RGB(t).slice(1);return this.RGB_HTML(s)}static RGB_CMYK([t,s,e]){const i=1-t;const n=1-s;const r=1-e;const o=Math.min(i,n,r);return["CMYK",i,n,r,o]}}class ei{create(t,s,e=false){if(t<=0||s<=0){throw new Error("Invalid SVG dimensions")}const i=this._createSVG("svg:svg");i.setAttribute("version","1.1");if(!e){i.setAttribute("width",`${t}px`);i.setAttribute("height",`${s}px`)}i.setAttribute("preserveAspectRatio","none");i.setAttribute("viewBox",`0 0 ${t} ${s}`);return i}createElement(t){if(typeof t!=="string"){throw new Error("Invalid SVG element type")}return this._createSVG(t)}_createSVG(t){C("Abstract method `_createSVG` called.")}}class ii extends ei{_createSVG(t){return document.createElementNS(nt,t)}}class ni{static setupStorage(t,s,e,i,n){const r=i.getValue(s,{value:null});switch(e.name){case"textarea":if(r.value!==null){t.textContent=r.value}if(n==="print"){break}t.addEventListener("input",(t=>{i.setValue(s,{value:t.target.value})}));break;case"input":if(e.attributes.type==="radio"||e.attributes.type==="checkbox"){if(r.value===e.attributes.xfaOn){t.setAttribute("checked",true)}else if(r.value===e.attributes.xfaOff){t.removeAttribute("checked")}if(n==="print"){break}t.addEventListener("change",(t=>{i.setValue(s,{value:t.target.checked?t.target.getAttribute("xfaOn"):t.target.getAttribute("xfaOff")})}))}else{if(r.value!==null){t.setAttribute("value",r.value)}if(n==="print"){break}t.addEventListener("input",(t=>{i.setValue(s,{value:t.target.value})}))}break;case"select":if(r.value!==null){t.setAttribute("value",r.value);for(const t of e.children){if(t.attributes.value===r.value){t.attributes.selected=true}else if(t.attributes.hasOwnProperty("selected")){delete t.attributes.selected}}}t.addEventListener("input",(t=>{const e=t.target.options;const n=e.selectedIndex===-1?"":e[e.selectedIndex].value;i.setValue(s,{value:n})}));break}}static setAttributes({html:t,element:s,storage:e=null,intent:i,linkService:n}){const{attributes:r}=s;const o=t instanceof HTMLAnchorElement;if(r.type==="radio"){r.name=`${r.name}-${i}`}for(const[s,e]of Object.entries(r)){if(e===null||e===undefined){continue}switch(s){case"class":if(e.length){t.setAttribute(s,e.join(" "))}break;case"dataId":break;case"id":t.setAttribute("data-element-id",e);break;case"style":Object.assign(t.style,e);break;case"textContent":t.textContent=e;break;default:if(!o||s!=="href"&&s!=="newWindow"){t.setAttribute(s,e)}}}if(o){n.addLinkAttributes(t,r.href,r.newWindow)}if(e&&r.dataId){this.setupStorage(t,r.dataId,s,e)}}static render(t){const s=t.annotationStorage;const e=t.linkService;const i=t.xfaHtml;const n=t.intent||"display";const r=document.createElement(i.name);if(i.attributes){this.setAttributes({html:r,element:i,intent:n,linkService:e})}const o=n!=="richText";const h=t.div;h.append(r);if(t.viewport){const s=`matrix(${t.viewport.transform.join(",")})`;h.style.transform=s}if(o){h.setAttribute("class","xfaLayer xfaFont")}const a=[];if(i.children.length===0){if(i.value){const t=document.createTextNode(i.value);r.append(t);if(o&&Ne.shouldBuildText(i.name)){a.push(t)}}return{textDivs:a}}const c=[[i,-1,r]];while(c.length>0){const[t,i,r]=c.at(-1);if(i+1===t.children.length){c.pop();continue}const h=t.children[++c.at(-1)[1]];if(h===null){continue}const{name:l}=h;if(l==="#text"){const t=document.createTextNode(h.value);a.push(t);r.append(t);continue}const u=h?.attributes?.xmlns?document.createElementNS(h.attributes.xmlns,l):document.createElement(l);r.append(u);if(h.attributes){this.setAttributes({html:u,element:h,storage:s,intent:n,linkService:e})}if(h.children?.length>0){c.push([h,-1,u])}else if(h.value){const t=document.createTextNode(h.value);if(o&&Ne.shouldBuildText(l)){a.push(t)}u.append(t)}}for(const t of h.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea")){t.setAttribute("readOnly",true)}return{textDivs:a}}static update(t){const s=`matrix(${t.viewport.transform.join(",")})`;t.div.style.transform=s;t.div.hidden=false}}const ri=1e3;const oi=9;const hi=new WeakSet;class ai{static create(t){const s=t.data.annotationType;switch(s){case m.LINK:return new li(t);case m.TEXT:return new ui(t);case m.WIDGET:const s=t.data.fieldType;switch(s){case"Tx":return new di(t);case"Btn":if(t.data.radioButton){return new mi(t)}else if(t.data.checkBox){return new gi(t)}return new Ai(t);case"Ch":return new wi(t);case"Sig":return new pi(t)}return new fi(t);case m.POPUP:return new bi(t);case m.FREETEXT:return new vi(t);case m.LINE:return new xi(t);case m.SQUARE:return new Mi(t);case m.CIRCLE:return new ki(t);case m.POLYLINE:return new Si(t);case m.CARET:return new Ci(t);case m.INK:return new Ti(t);case m.POLYGON:return new Ei(t);case m.HIGHLIGHT:return new Pi(t);case m.UNDERLINE:return new Ni(t);case m.SQUIGGLY:return new Ii(t);case m.STRIKEOUT:return new Di(t);case m.STAMP:return new Ri(t);case m.FILEATTACHMENT:return new $i(t);default:return new ci(t)}}}class ci{#ji=null;#Hi=false;#zi=null;constructor(t,{isRenderable:s=false,ignoreBorder:e=false,createQuadrilaterals:i=false}={}){this.isRenderable=s;this.data=t.data;this.layer=t.layer;this.linkService=t.linkService;this.downloadManager=t.downloadManager;this.imageResourcesPath=t.imageResourcesPath;this.renderForms=t.renderForms;this.svgFactory=t.svgFactory;this.annotationStorage=t.annotationStorage;this.enableScripting=t.enableScripting;this.hasJSActions=t.hasJSActions;this._fieldObjects=t.fieldObjects;this.parent=t.parent;if(s){this.container=this._createContainer(e)}if(i){this._createQuadrilaterals()}}static _hasPopupData({titleObj:t,contentsObj:s,richText:e}){return!!(t?.str||s?.str||e?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return ci._hasPopupData(this.data)}updateEdited(t){if(!this.container){return}this.#ji||={rect:this.data.rect.slice(0)};const{rect:s}=t;if(s){this.#Gi(s)}this.#zi?.popup.updateEdited(t)}resetEdited(){if(!this.#ji){return}this.#Gi(this.#ji.rect);this.#zi?.popup.resetEdited();this.#ji=null}#Gi(t){const{container:{style:s},data:{rect:e,rotation:i},parent:{viewport:{rawDims:{pageWidth:n,pageHeight:r,pageX:o,pageY:h}}}}=this;e?.splice(0,4,...t);s.left=`${100*(t[0]-o)/n}%`;s.top=`${100*(r-t[3]+h)/r}%`;if(i===0){s.width=`${100*(t[2]-t[0])/n}%`;s.height=`${100*(t[3]-t[1])/r}%`}else{this.setRotation(i)}}_createContainer(t){const{data:s,parent:{page:e,viewport:i}}=this;const n=document.createElement("section");n.setAttribute("data-annotation-id",s.id);if(!(this instanceof fi)){n.tabIndex=ri}const{style:r}=n;r.zIndex=this.parent.zIndex++;if(s.alternativeText){n.title=s.alternativeText}if(s.noRotate){n.classList.add("norotate")}if(!s.rect||this instanceof bi){const{rotation:t}=s;if(!s.hasOwnCanvas&&t!==0){this.setRotation(t,n)}return n}const{width:o,height:h}=this;if(!t&&s.borderStyle.width>0){r.borderWidth=`${s.borderStyle.width}px`;const t=s.borderStyle.horizontalCornerRadius;const e=s.borderStyle.verticalCornerRadius;if(t>0||e>0){const s=`calc(${t}px * var(--total-scale-factor)) / calc(${e}px * var(--total-scale-factor))`;r.borderRadius=s}else if(this instanceof mi){const t=`calc(${o}px * var(--total-scale-factor)) / calc(${h}px * var(--total-scale-factor))`;r.borderRadius=t}switch(s.borderStyle.style){case A.SOLID:r.borderStyle="solid";break;case A.DASHED:r.borderStyle="dashed";break;case A.BEVELED:E("Unimplemented border style: beveled");break;case A.INSET:E("Unimplemented border style: inset");break;case A.UNDERLINE:r.borderBottomStyle="solid";break}const i=s.borderColor||null;if(i){this.#Hi=true;r.borderColor=X.makeHexColor(i[0]|0,i[1]|0,i[2]|0)}else{r.borderWidth=0}}const a=X.normalizeRect([s.rect[0],e.view[3]-s.rect[1]+e.view[1],s.rect[2],e.view[3]-s.rect[3]+e.view[1]]);const{pageWidth:c,pageHeight:l,pageX:u,pageY:f}=i.rawDims;r.left=`${100*(a[0]-u)/c}%`;r.top=`${100*(a[1]-f)/l}%`;const{rotation:d}=s;if(s.hasOwnCanvas||d===0){r.width=`${100*o/c}%`;r.height=`${100*h/l}%`}else{this.setRotation(d,n)}return n}setRotation(t,s=this.container){if(!this.data.rect){return}const{pageWidth:e,pageHeight:i}=this.parent.viewport.rawDims;let{width:n,height:r}=this;if(t%180!==0){[n,r]=[r,n]}s.style.width=`${100*n/e}%`;s.style.height=`${100*r/i}%`;s.setAttribute("data-main-rotation",(360-t)%360)}get _commonActions(){const t=(t,s,e)=>{const i=e.detail[t];const n=i[0];const r=i.slice(1);e.target.style[s]=si[`${n}_HTML`](r);this.annotationStorage.setValue(this.data.id,{[s]:si[`${n}_rgb`](r)})};return D(this,"_commonActions",{display:t=>{const{display:s}=t.detail;const e=s%2===1;this.container.style.visibility=e?"hidden":"visible";this.annotationStorage.setValue(this.data.id,{noView:e,noPrint:s===1||s===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{const{hidden:s}=t.detail;this.container.style.visibility=s?"hidden":"visible";this.annotationStorage.setValue(this.data.id,{noPrint:s,noView:s})},focus:t=>{setTimeout((()=>t.target.focus({preventScroll:false})),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:s=>{t("bgColor","backgroundColor",s)},fillColor:s=>{t("fillColor","backgroundColor",s)},fgColor:s=>{t("fgColor","color",s)},textColor:s=>{t("textColor","color",s)},borderColor:s=>{t("borderColor","borderColor",s)},strokeColor:s=>{t("strokeColor","borderColor",s)},rotation:t=>{const s=t.detail.rotation;this.setRotation(s);this.annotationStorage.setValue(this.data.id,{rotation:s})}})}_dispatchEventFromSandbox(t,s){const e=this._commonActions;for(const i of Object.keys(s.detail)){const n=t[i]||e[i];n?.(s)}}_setDefaultPropertiesFromJS(t){if(!this.enableScripting){return}const s=this.annotationStorage.getRawValue(this.data.id);if(!s){return}const e=this._commonActions;for(const[i,n]of Object.entries(s)){const r=e[i];if(r){const e={detail:{[i]:n},target:t};r(e);delete s[i]}}}_createQuadrilaterals(){if(!this.container){return}const{quadPoints:t}=this.data;if(!t){return}const[s,e,i,n]=this.data.rect.map((t=>Math.fround(t)));if(t.length===8){const[r,o,h,a]=t.subarray(2,6);if(i===r&&n===o&&s===h&&e===a){return}}const{style:r}=this.container;let o;if(this.#Hi){const{borderColor:t,borderWidth:s}=r;r.borderWidth=0;o=["url('data:image/svg+xml;utf8,",`<svg xmlns="http://www.w3.org/2000/svg"`,` preserveAspectRatio="none" viewBox="0 0 1 1">`,`<g fill="transparent" stroke="${t}" stroke-width="${s}">`];this.container.classList.add("hasBorder")}const h=i-s;const a=n-e;const{svgFactory:c}=this;const l=c.createElement("svg");l.classList.add("quadrilateralsContainer");l.setAttribute("width",0);l.setAttribute("height",0);const u=c.createElement("defs");l.append(u);const f=c.createElement("clipPath");const d=`clippath_${this.data.id}`;f.setAttribute("id",d);f.setAttribute("clipPathUnits","objectBoundingBox");u.append(f);for(let e=2,i=t.length;e<i;e+=8){const i=t[e];const r=t[e+1];const l=t[e+2];const u=t[e+3];const d=c.createElement("rect");const p=(l-s)/h;const g=(n-r)/a;const m=(i-l)/h;const A=(r-u)/a;d.setAttribute("x",p);d.setAttribute("y",g);d.setAttribute("width",m);d.setAttribute("height",A);f.append(d);o?.push(`<rect vector-effect="non-scaling-stroke" x="${p}" y="${g}" width="${m}" height="${A}"/>`)}if(this.#Hi){o.push(`</g></svg>')`);r.backgroundImage=o.join("")}this.container.append(l);this.container.style.clipPath=`url(#${d})`}_createPopup(){const{data:t}=this;const s=this.#zi=new bi({data:{color:t.color,titleObj:t.titleObj,modificationDate:t.modificationDate,contentsObj:t.contentsObj,richText:t.richText,parentRect:t.rect,borderStyle:0,id:`popup_${t.id}`,rotation:t.rotation},parent:this.parent,elements:[this]});this.parent.div.append(s.render())}render(){C("Abstract method `AnnotationElement.render` called")}_getElementsByName(t,s=null){const e=[];if(this._fieldObjects){const i=this._fieldObjects[t];if(i){for(const{page:t,id:n,exportValues:r}of i){if(t===-1){continue}if(n===s){continue}const i=typeof r==="string"?r:null;const o=document.querySelector(`[data-element-id="${n}"]`);if(o&&!hi.has(o)){E(`_getElementsByName - element not allowed: ${n}`);continue}e.push({id:n,exportValue:i,domElement:o})}}return e}for(const i of document.getElementsByName(t)){const{exportValue:t}=i;const n=i.getAttribute("data-element-id");if(n===s){continue}if(!hi.has(i)){continue}e.push({id:n,exportValue:t,domElement:i})}return e}show(){if(this.container){this.container.hidden=false}this.popup?.maybeShow()}hide(){if(this.container){this.container.hidden=true}this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const t=this.getElementsToTriggerPopup();if(Array.isArray(t)){for(const s of t){s.classList.add("highlightArea")}}else{t.classList.add("highlightArea")}}_editOnDoubleClick(){if(!this._isEditable){return}const{annotationEditorType:t,data:{id:s}}=this;this.container.addEventListener("dblclick",(()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:t,editId:s})}))}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}}class li extends ci{constructor(t,s=null){super(t,{isRenderable:true,ignoreBorder:!!s?.ignoreBorder,createQuadrilaterals:true});this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:s}=this;const e=document.createElement("a");e.setAttribute("data-element-id",t.id);let i=false;if(t.url){s.addLinkAttributes(e,t.url,t.newWindow);i=true}else if(t.action){this._bindNamedAction(e,t.action);i=true}else if(t.attachment){this.#Wi(e,t.attachment,t.attachmentDest);i=true}else if(t.setOCGState){this.#Vi(e,t.setOCGState);i=true}else if(t.dest){this._bindLink(e,t.dest);i=true}else{if(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions){this._bindJSAction(e,t);i=true}if(t.resetForm){this._bindResetFormAction(e,t.resetForm);i=true}else if(this.isTooltipOnly&&!i){this._bindLink(e,"");i=true}}this.container.classList.add("linkAnnotation");if(i){this.container.append(e)}return this.container}#Xi(){this.container.setAttribute("data-internal-link","")}_bindLink(t,s){t.href=this.linkService.getDestinationHash(s);t.onclick=()=>{if(s){this.linkService.goToDestination(s)}return false};if(s||s===""){this.#Xi()}}_bindNamedAction(t,s){t.href=this.linkService.getAnchorUrl("");t.onclick=()=>{this.linkService.executeNamedAction(s);return false};this.#Xi()}#Wi(t,s,e=null){t.href=this.linkService.getAnchorUrl("");if(s.description){t.title=s.description}t.onclick=()=>{this.downloadManager?.openOrDownloadData(s.content,s.filename,e);return false};this.#Xi()}#Vi(t,s){t.href=this.linkService.getAnchorUrl("");t.onclick=()=>{this.linkService.executeSetOCGState(s);return false};this.#Xi()}_bindJSAction(t,s){t.href=this.linkService.getAnchorUrl("");const e=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const i of Object.keys(s.actions)){const n=e.get(i);if(!n){continue}t[n]=()=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:s.id,name:i}});return false}}if(!t.onclick){t.onclick=()=>false}this.#Xi()}_bindResetFormAction(t,s){const e=t.onclick;if(!e){t.href=this.linkService.getAnchorUrl("")}this.#Xi();if(!this._fieldObjects){E(`_bindResetFormAction - "resetForm" action not supported, `+"ensure that the `fieldObjects` parameter is provided.");if(!e){t.onclick=()=>false}return}t.onclick=()=>{e?.();const{fields:t,refs:i,include:n}=s;const r=[];if(t.length!==0||i.length!==0){const s=new Set(i);for(const e of t){const t=this._fieldObjects[e]||[];for(const{id:e}of t){s.add(e)}}for(const t of Object.values(this._fieldObjects)){for(const e of t){if(s.has(e.id)===n){r.push(e)}}}}else{for(const t of Object.values(this._fieldObjects)){r.push(...t)}}const o=this.annotationStorage;const h=[];for(const t of r){const{id:s}=t;h.push(s);switch(t.type){case"text":{const e=t.defaultValue||"";o.setValue(s,{value:e});break}case"checkbox":case"radiobutton":{const e=t.defaultValue===t.exportValues;o.setValue(s,{value:e});break}case"combobox":case"listbox":{const e=t.defaultValue||"";o.setValue(s,{value:e});break}default:continue}const e=document.querySelector(`[data-element-id="${s}"]`);if(!e){continue}else if(!hi.has(e)){E(`_bindResetFormAction - element not allowed: ${s}`);continue}e.dispatchEvent(new Event("resetform"))}if(this.enableScripting){this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:h,name:"ResetForm"}})}return false}}}class ui extends ci{constructor(t){super(t,{isRenderable:true})}render(){this.container.classList.add("textAnnotation");const t=document.createElement("img");t.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg";t.setAttribute("data-l10n-id","pdfjs-text-annotation-type");t.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name}));if(!this.data.popupRef&&this.hasPopupData){this._createPopup()}this.container.append(t);return this.container}}class fi extends ci{render(){return this.container}showElementAndHideCanvas(t){if(this.data.hasOwnCanvas){if(t.previousSibling?.nodeName==="CANVAS"){t.previousSibling.hidden=true}t.hidden=false}}_getKeyModifier(t){return W.platform.isMac?t.metaKey:t.ctrlKey}_setEventListener(t,s,e,i,n){if(e.includes("mouse")){t.addEventListener(e,(t=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:n(t),shift:t.shiftKey,modifier:this._getKeyModifier(t)}})}))}else{t.addEventListener(e,(t=>{if(e==="blur"){if(!s.focused||!t.relatedTarget){return}s.focused=false}else if(e==="focus"){if(s.focused){return}s.focused=true}if(!n){return}this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:n(t)}})}))}}_setEventListeners(t,s,e,i){for(const[n,r]of e){if(r==="Action"||this.data.actions?.[r]){if(r==="Focus"||r==="Blur"){s||={focused:false}}this._setEventListener(t,s,n,r,i);if(r==="Focus"&&!this.data.actions?.Blur){this._setEventListener(t,s,"blur","Blur",null)}else if(r==="Blur"&&!this.data.actions?.Focus){this._setEventListener(t,s,"focus","Focus",null)}}}}_setBackgroundColor(t){const s=this.data.backgroundColor||null;t.style.backgroundColor=s===null?"transparent":X.makeHexColor(s[0],s[1],s[2])}_setTextStyle(t){const s=["left","center","right"];const{fontColor:e}=this.data.defaultAppearanceData;const i=this.data.defaultAppearanceData.fontSize||oi;const n=t.style;let r;const o=2;const a=t=>Math.round(10*t)/10;if(this.data.multiLine){const t=Math.abs(this.data.rect[3]-this.data.rect[1]-o);const s=Math.round(t/(h*i))||1;const e=t/s;r=Math.min(i,a(e/h))}else{const t=Math.abs(this.data.rect[3]-this.data.rect[1]-o);r=Math.min(i,a(t/h))}n.fontSize=`calc(${r}px * var(--total-scale-factor))`;n.color=X.makeHexColor(e[0],e[1],e[2]);if(this.data.textAlignment!==null){n.textAlign=s[this.data.textAlignment]}}_setRequired(t,s){if(s){t.setAttribute("required",true)}else{t.removeAttribute("required")}t.setAttribute("aria-required",s)}}class di extends fi{constructor(t){const s=t.renderForms||t.data.hasOwnCanvas||!t.data.hasAppearance&&!!t.data.fieldValue;super(t,{isRenderable:s})}setPropertyOnSiblings(t,s,e,i){const n=this.annotationStorage;for(const r of this._getElementsByName(t.name,t.id)){if(r.domElement){r.domElement[s]=e}n.setValue(r.id,{[i]:e})}}render(){const t=this.annotationStorage;const s=this.data.id;this.container.classList.add("textWidgetAnnotation");let e=null;if(this.renderForms){const i=t.getValue(s,{value:this.data.fieldValue});let n=i.value||"";const r=t.getValue(s,{charLimit:this.data.maxLen}).charLimit;if(r&&n.length>r){n=n.slice(0,r)}let o=i.formattedValue||this.data.textContent?.join("\n")||null;if(o&&this.data.comb){o=o.replaceAll(/\s+/g,"")}const h={userValue:n,formattedValue:o,lastCommittedValue:null,commitKey:1,focused:false};if(this.data.multiLine){e=document.createElement("textarea");e.textContent=o??n;if(this.data.doNotScroll){e.style.overflowY="hidden"}}else{e=document.createElement("input");e.type=this.data.password?"password":"text";e.setAttribute("value",o??n);if(this.data.doNotScroll){e.style.overflowX="hidden"}}if(this.data.hasOwnCanvas){e.hidden=true}hi.add(e);e.setAttribute("data-element-id",s);e.disabled=this.data.readOnly;e.name=this.data.fieldName;e.tabIndex=ri;this._setRequired(e,this.data.required);if(r){e.maxLength=r}e.addEventListener("input",(i=>{t.setValue(s,{value:i.target.value});this.setPropertyOnSiblings(e,"value",i.target.value,"value");h.formattedValue=null}));e.addEventListener("resetform",(t=>{const s=this.data.defaultFieldValue??"";e.value=h.userValue=s;h.formattedValue=null}));let a=t=>{const{formattedValue:s}=h;if(s!==null&&s!==undefined){t.target.value=s}t.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){e.addEventListener("focus",(t=>{if(h.focused){return}const{target:s}=t;if(h.userValue){s.value=h.userValue}h.lastCommittedValue=s.value;h.commitKey=1;if(!this.data.actions?.Focus){h.focused=true}}));e.addEventListener("updatefromsandbox",(e=>{this.showElementAndHideCanvas(e.target);const i={value(e){h.userValue=e.detail.value??"";t.setValue(s,{value:h.userValue.toString()});e.target.value=h.userValue},formattedValue(e){const{formattedValue:i}=e.detail;h.formattedValue=i;if(i!==null&&i!==undefined&&e.target!==document.activeElement){e.target.value=i}t.setValue(s,{formattedValue:i})},selRange(t){t.target.setSelectionRange(...t.detail.selRange)},charLimit:e=>{const{charLimit:i}=e.detail;const{target:n}=e;if(i===0){n.removeAttribute("maxLength");return}n.setAttribute("maxLength",i);let r=h.userValue;if(!r||r.length<=i){return}r=r.slice(0,i);n.value=h.userValue=r;t.setValue(s,{value:r});this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:s,name:"Keystroke",value:r,willCommit:true,commitKey:1,selStart:n.selectionStart,selEnd:n.selectionEnd}})}};this._dispatchEventFromSandbox(i,e)}));e.addEventListener("keydown",(t=>{h.commitKey=1;let e=-1;if(t.key==="Escape"){e=0}else if(t.key==="Enter"&&!this.data.multiLine){e=2}else if(t.key==="Tab"){h.commitKey=3}if(e===-1){return}const{value:i}=t.target;if(h.lastCommittedValue===i){return}h.lastCommittedValue=i;h.userValue=i;this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:s,name:"Keystroke",value:i,willCommit:true,commitKey:e,selStart:t.target.selectionStart,selEnd:t.target.selectionEnd}})}));const i=a;a=null;e.addEventListener("blur",(t=>{if(!h.focused||!t.relatedTarget){return}if(!this.data.actions?.Blur){h.focused=false}const{value:e}=t.target;h.userValue=e;if(h.lastCommittedValue!==e){this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:s,name:"Keystroke",value:e,willCommit:true,commitKey:h.commitKey,selStart:t.target.selectionStart,selEnd:t.target.selectionEnd}})}i(t)}));if(this.data.actions?.Keystroke){e.addEventListener("beforeinput",(t=>{h.lastCommittedValue=null;const{data:e,target:i}=t;const{value:n,selectionStart:r,selectionEnd:o}=i;let a=r,c=o;switch(t.inputType){case"deleteWordBackward":{const t=n.substring(0,r).match(/\w*[^\w]*$/);if(t){a-=t[0].length}break}case"deleteWordForward":{const t=n.substring(r).match(/^[^\w]*\w*/);if(t){c+=t[0].length}break}case"deleteContentBackward":if(r===o){a-=1}break;case"deleteContentForward":if(r===o){c+=1}break}t.preventDefault();this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:s,name:"Keystroke",value:n,change:e||"",willCommit:false,selStart:a,selEnd:c}})}))}this._setEventListeners(e,h,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],(t=>t.target.value))}if(a){e.addEventListener("blur",a)}if(this.data.comb){const t=this.data.rect[2]-this.data.rect[0];const s=t/r;e.classList.add("comb");e.style.letterSpacing=`calc(${s}px * var(--total-scale-factor) - 1ch)`}}else{e=document.createElement("div");e.textContent=this.data.fieldValue;e.style.verticalAlign="middle";e.style.display="table-cell";if(this.data.hasOwnCanvas){e.hidden=true}}this._setTextStyle(e);this._setBackgroundColor(e);this._setDefaultPropertiesFromJS(e);this.container.append(e);return this.container}}class pi extends fi{constructor(t){super(t,{isRenderable:!!t.data.hasOwnCanvas})}}class gi extends fi{constructor(t){super(t,{isRenderable:t.renderForms})}render(){const t=this.annotationStorage;const s=this.data;const e=s.id;let i=t.getValue(e,{value:s.exportValue===s.fieldValue}).value;if(typeof i==="string"){i=i!=="Off";t.setValue(e,{value:i})}this.container.classList.add("buttonWidgetAnnotation","checkBox");const n=document.createElement("input");hi.add(n);n.setAttribute("data-element-id",e);n.disabled=s.readOnly;this._setRequired(n,this.data.required);n.type="checkbox";n.name=s.fieldName;if(i){n.setAttribute("checked",true)}n.setAttribute("exportValue",s.exportValue);n.tabIndex=ri;n.addEventListener("change",(i=>{const{name:n,checked:r}=i.target;for(const i of this._getElementsByName(n,e)){const e=r&&i.exportValue===s.exportValue;if(i.domElement){i.domElement.checked=e}t.setValue(i.id,{value:e})}t.setValue(e,{value:r})}));n.addEventListener("resetform",(t=>{const e=s.defaultFieldValue||"Off";t.target.checked=e===s.exportValue}));if(this.enableScripting&&this.hasJSActions){n.addEventListener("updatefromsandbox",(s=>{const i={value(s){s.target.checked=s.detail.value!=="Off";t.setValue(e,{value:s.target.checked})}};this._dispatchEventFromSandbox(i,s)}));this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],(t=>t.target.checked))}this._setBackgroundColor(n);this._setDefaultPropertiesFromJS(n);this.container.append(n);return this.container}}class mi extends fi{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const t=this.annotationStorage;const s=this.data;const e=s.id;let i=t.getValue(e,{value:s.fieldValue===s.buttonValue}).value;if(typeof i==="string"){i=i!==s.buttonValue;t.setValue(e,{value:i})}if(i){for(const i of this._getElementsByName(s.fieldName,e)){t.setValue(i.id,{value:false})}}const n=document.createElement("input");hi.add(n);n.setAttribute("data-element-id",e);n.disabled=s.readOnly;this._setRequired(n,this.data.required);n.type="radio";n.name=s.fieldName;if(i){n.setAttribute("checked",true)}n.tabIndex=ri;n.addEventListener("change",(s=>{const{name:i,checked:n}=s.target;for(const s of this._getElementsByName(i,e)){t.setValue(s.id,{value:false})}t.setValue(e,{value:n})}));n.addEventListener("resetform",(t=>{const e=s.defaultFieldValue;t.target.checked=e!==null&&e!==undefined&&e===s.buttonValue}));if(this.enableScripting&&this.hasJSActions){const i=s.buttonValue;n.addEventListener("updatefromsandbox",(s=>{const n={value:s=>{const n=i===s.detail.value;for(const i of this._getElementsByName(s.target.name)){const s=n&&i.id===e;if(i.domElement){i.domElement.checked=s}t.setValue(i.id,{value:s})}}};this._dispatchEventFromSandbox(n,s)}));this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],(t=>t.target.checked))}this._setBackgroundColor(n);this._setDefaultPropertiesFromJS(n);this.container.append(n);return this.container}}class Ai extends li{constructor(t){super(t,{ignoreBorder:t.data.hasAppearance})}render(){const t=super.render();t.classList.add("buttonWidgetAnnotation","pushButton");const s=t.lastChild;if(this.enableScripting&&this.hasJSActions&&s){this._setDefaultPropertiesFromJS(s);s.addEventListener("updatefromsandbox",(t=>{this._dispatchEventFromSandbox({},t)}))}return t}}class wi extends fi{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const t=this.annotationStorage;const s=this.data.id;const e=t.getValue(s,{value:this.data.fieldValue});const i=document.createElement("select");hi.add(i);i.setAttribute("data-element-id",s);i.disabled=this.data.readOnly;this._setRequired(i,this.data.required);i.name=this.data.fieldName;i.tabIndex=ri;let n=this.data.combo&&this.data.options.length>0;if(!this.data.combo){i.size=this.data.options.length;if(this.data.multiSelect){i.multiple=true}}i.addEventListener("resetform",(t=>{const s=this.data.defaultFieldValue;for(const t of i.options){t.selected=t.value===s}}));for(const t of this.data.options){const s=document.createElement("option");s.textContent=t.displayValue;s.value=t.exportValue;if(e.value.includes(t.exportValue)){s.setAttribute("selected",true);n=false}i.append(s)}let r=null;if(n){const t=document.createElement("option");t.value=" ";t.setAttribute("hidden",true);t.setAttribute("selected",true);i.prepend(t);r=()=>{t.remove();i.removeEventListener("input",r);r=null};i.addEventListener("input",r)}const o=t=>{const s=t?"value":"textContent";const{options:e,multiple:n}=i;if(!n){return e.selectedIndex===-1?null:e[e.selectedIndex][s]}return Array.prototype.filter.call(e,(t=>t.selected)).map((t=>t[s]))};let h=o(false);const a=t=>{const s=t.target.options;return Array.prototype.map.call(s,(t=>({displayValue:t.textContent,exportValue:t.value})))};if(this.enableScripting&&this.hasJSActions){i.addEventListener("updatefromsandbox",(e=>{const n={value(e){r?.();const n=e.detail.value;const a=new Set(Array.isArray(n)?n:[n]);for(const t of i.options){t.selected=a.has(t.value)}t.setValue(s,{value:o(true)});h=o(false)},multipleSelection(t){i.multiple=true},remove(e){const n=i.options;const r=e.detail.remove;n[r].selected=false;i.remove(r);if(n.length>0){const t=Array.prototype.findIndex.call(n,(t=>t.selected));if(t===-1){n[0].selected=true}}t.setValue(s,{value:o(true),items:a(e)});h=o(false)},clear(e){while(i.length!==0){i.remove(0)}t.setValue(s,{value:null,items:[]});h=o(false)},insert(e){const{index:n,displayValue:r,exportValue:c}=e.detail.insert;const l=i.children[n];const u=document.createElement("option");u.textContent=r;u.value=c;if(l){l.before(u)}else{i.append(u)}t.setValue(s,{value:o(true),items:a(e)});h=o(false)},items(e){const{items:n}=e.detail;while(i.length!==0){i.remove(0)}for(const t of n){const{displayValue:s,exportValue:e}=t;const n=document.createElement("option");n.textContent=s;n.value=e;i.append(n)}if(i.options.length>0){i.options[0].selected=true}t.setValue(s,{value:o(true),items:a(e)});h=o(false)},indices(e){const i=new Set(e.detail.indices);for(const t of e.target.options){t.selected=i.has(t.index)}t.setValue(s,{value:o(true)});h=o(false)},editable(t){t.target.disabled=!t.detail.editable}};this._dispatchEventFromSandbox(n,e)}));i.addEventListener("input",(e=>{const i=o(true);const n=o(false);t.setValue(s,{value:i});e.preventDefault();this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:s,name:"Keystroke",value:h,change:n,changeEx:i,willCommit:false,commitKey:1,keyDown:false}})}));this._setEventListeners(i,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],(t=>t.target.value))}else{i.addEventListener("input",(function(e){t.setValue(s,{value:o(true)})}))}if(this.data.combo){this._setTextStyle(i)}this._setBackgroundColor(i);this._setDefaultPropertiesFromJS(i);this.container.append(i);return this.container}}class bi extends ci{constructor(t){const{data:s,elements:e}=t;super(t,{isRenderable:ci._hasPopupData(s)});this.elements=e;this.popup=null}render(){this.container.classList.add("popupAnnotation");const t=this.popup=new yi({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open});const s=[];for(const e of this.elements){e.popup=t;e.container.ariaHasPopup="dialog";s.push(e.data.id);e.addHighlightArea()}this.container.setAttribute("aria-controls",s.map((t=>`${Z}${t}`)).join(","));return this.container}}class yi{#Yi=this.#Qi.bind(this);#Ki=this.#qi.bind(this);#Ji=this.#Zi.bind(this);#tn=this.#sn.bind(this);#en=null;#mt=null;#in=null;#nn=null;#rn=null;#on=null;#hn=null;#an=false;#cn=null;#C=null;#ln=null;#un=null;#fn=null;#ji=null;#dn=false;constructor({container:t,color:s,elements:e,titleObj:i,modificationDate:n,contentsObj:r,richText:o,parent:h,rect:a,parentRect:c,open:l}){this.#mt=t;this.#fn=i;this.#in=r;this.#un=o;this.#on=h;this.#en=s;this.#ln=a;this.#hn=c;this.#rn=e;this.#nn=At.toDateObject(n);this.trigger=e.flatMap((t=>t.getElementsToTriggerPopup()));for(const t of this.trigger){t.addEventListener("click",this.#tn);t.addEventListener("mouseenter",this.#Ji);t.addEventListener("mouseleave",this.#Ki);t.classList.add("popupTriggerArea")}for(const t of e){t.container?.addEventListener("keydown",this.#Yi)}this.#mt.hidden=true;if(l){this.#sn()}}render(){if(this.#cn){return}const t=this.#cn=document.createElement("div");t.className="popup";if(this.#en){const s=t.style.outlineColor=X.makeHexColor(...this.#en);t.style.backgroundColor=`color-mix(in srgb, ${s} 30%, white)`}const s=document.createElement("span");s.className="header";const e=document.createElement("h1");s.append(e);({dir:e.dir,str:e.textContent}=this.#fn);t.append(s);if(this.#nn){const t=document.createElement("span");t.classList.add("popupDate");t.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string");t.setAttribute("data-l10n-args",JSON.stringify({dateObj:this.#nn.valueOf()}));s.append(t)}const i=this.#pn;if(i){ni.render({xfaHtml:i,intent:"richText",div:t});t.lastChild.classList.add("richText","popupContent")}else{const s=this._formatContents(this.#in);t.append(s)}this.#mt.append(t)}get#pn(){const t=this.#un;const s=this.#in;if(t?.str&&(!s?.str||s.str===t.str)){return this.#un.html||null}return null}get#gn(){return this.#pn?.attributes?.style?.fontSize||0}get#mn(){return this.#pn?.attributes?.style?.color||null}#An(t){const s=[];const e={str:t,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:s}]}};const i={style:{color:this.#mn,fontSize:this.#gn?`calc(${this.#gn}px * var(--total-scale-factor))`:""}};for(const e of t.split("\n")){s.push({name:"span",value:e,attributes:i})}return e}_formatContents({str:t,dir:s}){const e=document.createElement("p");e.classList.add("popupContent");e.dir=s;const i=t.split(/(?:\r\n?|\n)/);for(let t=0,s=i.length;t<s;++t){const n=i[t];e.append(document.createTextNode(n));if(t<s-1){e.append(document.createElement("br"))}}return e}#Qi(t){if(t.altKey||t.shiftKey||t.ctrlKey||t.metaKey){return}if(t.key==="Enter"||t.key==="Escape"&&this.#an){this.#sn()}}updateEdited({rect:t,popupContent:s}){this.#ji||={contentsObj:this.#in,richText:this.#un};if(t){this.#C=null}if(s){this.#un=this.#An(s);this.#in=null}this.#cn?.remove();this.#cn=null}resetEdited(){if(!this.#ji){return}({contentsObj:this.#in,richText:this.#un}=this.#ji);this.#ji=null;this.#cn?.remove();this.#cn=null;this.#C=null}#wn(){if(this.#C!==null){return}const{page:{view:t},viewport:{rawDims:{pageWidth:s,pageHeight:e,pageX:i,pageY:n}}}=this.#on;let r=!!this.#hn;let o=r?this.#hn:this.#ln;for(const t of this.#rn){if(!o||X.intersect(t.data.rect,o)!==null){o=t.data.rect;r=true;break}}const h=X.normalizeRect([o[0],t[3]-o[1]+t[1],o[2],t[3]-o[3]+t[1]]);const a=5;const c=r?o[2]-o[0]+a:0;const l=h[0]+c;const u=h[1];this.#C=[100*(l-i)/s,100*(u-n)/e];const{style:f}=this.#mt;f.left=`${this.#C[0]}%`;f.top=`${this.#C[1]}%`}#sn(){this.#an=!this.#an;if(this.#an){this.#Zi();this.#mt.addEventListener("click",this.#tn);this.#mt.addEventListener("keydown",this.#Yi)}else{this.#qi();this.#mt.removeEventListener("click",this.#tn);this.#mt.removeEventListener("keydown",this.#Yi)}}#Zi(){if(!this.#cn){this.render()}if(!this.isVisible){this.#wn();this.#mt.hidden=false;this.#mt.style.zIndex=parseInt(this.#mt.style.zIndex)+1e3}else if(this.#an){this.#mt.classList.add("focused")}}#qi(){this.#mt.classList.remove("focused");if(this.#an||!this.isVisible){return}this.#mt.hidden=true;this.#mt.style.zIndex=parseInt(this.#mt.style.zIndex)-1e3}forceHide(){this.#dn=this.isVisible;if(!this.#dn){return}this.#mt.hidden=true}maybeShow(){if(!this.#dn){return}if(!this.#cn){this.#Zi()}this.#dn=false;this.#mt.hidden=false}get isVisible(){return this.#mt.hidden===false}}class vi extends ci{constructor(t){super(t,{isRenderable:true,ignoreBorder:true});this.textContent=t.data.textContent;this.textPosition=t.data.textPosition;this.annotationEditorType=u.FREETEXT}render(){this.container.classList.add("freeTextAnnotation");if(this.textContent){const t=document.createElement("div");t.classList.add("annotationTextContent");t.setAttribute("role","comment");for(const s of this.textContent){const e=document.createElement("span");e.textContent=s;t.append(e)}this.container.append(t)}if(!this.data.popupRef&&this.hasPopupData){this._createPopup()}this._editOnDoubleClick();return this.container}}class xi extends ci{#bn=null;constructor(t){super(t,{isRenderable:true,ignoreBorder:true})}render(){this.container.classList.add("lineAnnotation");const{data:t,width:s,height:e}=this;const i=this.svgFactory.create(s,e,true);const n=this.#bn=this.svgFactory.createElement("svg:line");n.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]);n.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]);n.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]);n.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]);n.setAttribute("stroke-width",t.borderStyle.width||1);n.setAttribute("stroke","transparent");n.setAttribute("fill","transparent");i.append(n);this.container.append(i);if(!t.popupRef&&this.hasPopupData){this._createPopup()}return this.container}getElementsToTriggerPopup(){return this.#bn}addHighlightArea(){this.container.classList.add("highlightArea")}}class Mi extends ci{#yn=null;constructor(t){super(t,{isRenderable:true,ignoreBorder:true})}render(){this.container.classList.add("squareAnnotation");const{data:t,width:s,height:e}=this;const i=this.svgFactory.create(s,e,true);const n=t.borderStyle.width;const r=this.#yn=this.svgFactory.createElement("svg:rect");r.setAttribute("x",n/2);r.setAttribute("y",n/2);r.setAttribute("width",s-n);r.setAttribute("height",e-n);r.setAttribute("stroke-width",n||1);r.setAttribute("stroke","transparent");r.setAttribute("fill","transparent");i.append(r);this.container.append(i);if(!t.popupRef&&this.hasPopupData){this._createPopup()}return this.container}getElementsToTriggerPopup(){return this.#yn}addHighlightArea(){this.container.classList.add("highlightArea")}}class ki extends ci{#vn=null;constructor(t){super(t,{isRenderable:true,ignoreBorder:true})}render(){this.container.classList.add("circleAnnotation");const{data:t,width:s,height:e}=this;const i=this.svgFactory.create(s,e,true);const n=t.borderStyle.width;const r=this.#vn=this.svgFactory.createElement("svg:ellipse");r.setAttribute("cx",s/2);r.setAttribute("cy",e/2);r.setAttribute("rx",s/2-n/2);r.setAttribute("ry",e/2-n/2);r.setAttribute("stroke-width",n||1);r.setAttribute("stroke","transparent");r.setAttribute("fill","transparent");i.append(r);this.container.append(i);if(!t.popupRef&&this.hasPopupData){this._createPopup()}return this.container}getElementsToTriggerPopup(){return this.#vn}addHighlightArea(){this.container.classList.add("highlightArea")}}class Si extends ci{#xn=null;constructor(t){super(t,{isRenderable:true,ignoreBorder:true});this.containerClassName="polylineAnnotation";this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:s,borderStyle:e,popupRef:i},width:n,height:r}=this;if(!s){return this.container}const o=this.svgFactory.create(n,r,true);let h=[];for(let e=0,i=s.length;e<i;e+=2){const i=s[e]-t[0];const n=t[3]-s[e+1];h.push(`${i},${n}`)}h=h.join(" ");const a=this.#xn=this.svgFactory.createElement(this.svgElementName);a.setAttribute("points",h);a.setAttribute("stroke-width",e.width||1);a.setAttribute("stroke","transparent");a.setAttribute("fill","transparent");o.append(a);this.container.append(o);if(!i&&this.hasPopupData){this._createPopup()}return this.container}getElementsToTriggerPopup(){return this.#xn}addHighlightArea(){this.container.classList.add("highlightArea")}}class Ei extends Si{constructor(t){super(t);this.containerClassName="polygonAnnotation";this.svgElementName="svg:polygon"}}class Ci extends ci{constructor(t){super(t,{isRenderable:true,ignoreBorder:true})}render(){this.container.classList.add("caretAnnotation");if(!this.data.popupRef&&this.hasPopupData){this._createPopup()}return this.container}}class Ti extends ci{#Mn=null;#kn=[];constructor(t){super(t,{isRenderable:true,ignoreBorder:true});this.containerClassName="inkAnnotation";this.svgElementName="svg:polyline";this.annotationEditorType=this.data.it==="InkHighlight"?u.HIGHLIGHT:u.INK}#Sn(t,s){switch(t){case 90:return{transform:`rotate(90) translate(${-s[0]},${s[1]}) scale(1,-1)`,width:s[3]-s[1],height:s[2]-s[0]};case 180:return{transform:`rotate(180) translate(${-s[2]},${s[1]}) scale(1,-1)`,width:s[2]-s[0],height:s[3]-s[1]};case 270:return{transform:`rotate(270) translate(${-s[2]},${s[3]}) scale(1,-1)`,width:s[3]-s[1],height:s[2]-s[0]};default:return{transform:`translate(${-s[0]},${s[3]}) scale(1,-1)`,width:s[2]-s[0],height:s[3]-s[1]}}}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,rotation:s,inkLists:e,borderStyle:i,popupRef:n}}=this;const{transform:r,width:o,height:h}=this.#Sn(s,t);const a=this.svgFactory.create(o,h,true);const c=this.#Mn=this.svgFactory.createElement("svg:g");a.append(c);c.setAttribute("stroke-width",i.width||1);c.setAttribute("stroke-linecap","round");c.setAttribute("stroke-linejoin","round");c.setAttribute("stroke-miterlimit",10);c.setAttribute("stroke","transparent");c.setAttribute("fill","transparent");c.setAttribute("transform",r);for(let t=0,s=e.length;t<s;t++){const s=this.svgFactory.createElement(this.svgElementName);this.#kn.push(s);s.setAttribute("points",e[t].join(","));c.append(s)}if(!n&&this.hasPopupData){this._createPopup()}this.container.append(a);this._editOnDoubleClick();return this.container}updateEdited(t){super.updateEdited(t);const{thickness:s,points:e,rect:i}=t;const n=this.#Mn;if(s>=0){n.setAttribute("stroke-width",s||1)}if(e){for(let t=0,s=this.#kn.length;t<s;t++){this.#kn[t].setAttribute("points",e[t].join(","))}}if(i){const{transform:t,width:s,height:e}=this.#Sn(this.data.rotation,i);const r=n.parentElement;r.setAttribute("viewBox",`0 0 ${s} ${e}`);n.setAttribute("transform",t)}}getElementsToTriggerPopup(){return this.#kn}addHighlightArea(){this.container.classList.add("highlightArea")}}class Pi extends ci{constructor(t){super(t,{isRenderable:true,ignoreBorder:true,createQuadrilaterals:true});this.annotationEditorType=u.HIGHLIGHT}render(){if(!this.data.popupRef&&this.hasPopupData){this._createPopup()}this.container.classList.add("highlightAnnotation");this._editOnDoubleClick();return this.container}}class Ni extends ci{constructor(t){super(t,{isRenderable:true,ignoreBorder:true,createQuadrilaterals:true})}render(){if(!this.data.popupRef&&this.hasPopupData){this._createPopup()}this.container.classList.add("underlineAnnotation");return this.container}}class Ii extends ci{constructor(t){super(t,{isRenderable:true,ignoreBorder:true,createQuadrilaterals:true})}render(){if(!this.data.popupRef&&this.hasPopupData){this._createPopup()}this.container.classList.add("squigglyAnnotation");return this.container}}class Di extends ci{constructor(t){super(t,{isRenderable:true,ignoreBorder:true,createQuadrilaterals:true})}render(){if(!this.data.popupRef&&this.hasPopupData){this._createPopup()}this.container.classList.add("strikeoutAnnotation");return this.container}}class Ri extends ci{constructor(t){super(t,{isRenderable:true,ignoreBorder:true});this.annotationEditorType=u.STAMP}render(){this.container.classList.add("stampAnnotation");this.container.setAttribute("role","img");if(!this.data.popupRef&&this.hasPopupData){this._createPopup()}this._editOnDoubleClick();return this.container}}class $i extends ci{#En=null;constructor(t){super(t,{isRenderable:true});const{file:s}=this.data;this.filename=s.filename;this.content=s.content;this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,...s})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:s}=this;let e;if(s.hasAppearance||s.fillAlpha===0){e=document.createElement("div")}else{e=document.createElement("img");e.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(s.name)?"paperclip":"pushpin"}.svg`;if(s.fillAlpha&&s.fillAlpha<1){e.style=`filter: opacity(${Math.round(s.fillAlpha*100)}%);`}}e.addEventListener("dblclick",this.#Cn.bind(this));this.#En=e;const{isMac:i}=W.platform;t.addEventListener("keydown",(t=>{if(t.key==="Enter"&&(i?t.metaKey:t.ctrlKey)){this.#Cn()}}));if(!s.popupRef&&this.hasPopupData){this._createPopup()}else{e.classList.add("popupTriggerArea")}t.append(e);return t}getElementsToTriggerPopup(){return this.#En}addHighlightArea(){this.container.classList.add("highlightArea")}#Cn(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}class Fi{#Tn=null;#Pn=null;#Nn=new Map;#In=null;constructor({div:t,accessibilityManager:s,annotationCanvasMap:e,annotationEditorUIManager:i,page:n,viewport:r,structTreeLayer:o}){this.div=t;this.#Tn=s;this.#Pn=e;this.#In=o||null;this.page=n;this.viewport=r;this.zIndex=0;this._annotationEditorUIManager=i}hasEditableAnnotations(){return this.#Nn.size>0}async#Dn(t,s){const e=t.firstChild||t;const i=e.id=`${Z}${s}`;const n=await(this.#In?.getAriaAttributes(i));if(n){for(const[t,s]of n){e.setAttribute(t,s)}}this.div.append(t);this.#Tn?.moveElementInDOM(this.div,t,e,false)}async render(t){const{annotations:s}=t;const e=this.div;Mt(e,this.viewport);const i=new Map;const n={data:null,layer:e,linkService:t.linkService,downloadManager:t.downloadManager,imageResourcesPath:t.imageResourcesPath||"",renderForms:t.renderForms!==false,svgFactory:new ii,annotationStorage:t.annotationStorage||new Gt,enableScripting:t.enableScripting===true,hasJSActions:t.hasJSActions,fieldObjects:t.fieldObjects,parent:this,elements:null};for(const t of s){if(t.noHTML){continue}const s=t.annotationType===m.POPUP;if(!s){if(t.rect[2]===t.rect[0]||t.rect[3]===t.rect[1]){continue}}else{const s=i.get(t.id);if(!s){continue}n.elements=s}n.data=t;const e=ai.create(n);if(!e.isRenderable){continue}if(!s&&t.popupRef){const s=i.get(t.popupRef);if(!s){i.set(t.popupRef,[e])}else{s.push(e)}}const r=e.render();if(t.hidden){r.style.visibility="hidden"}await this.#Dn(r,t.id);if(e._isEditable){this.#Nn.set(e.data.id,e);this._annotationEditorUIManager?.renderAnnotationElement(e)}}this.#Rn()}async addLinkAnnotations(t,s){const e={data:null,layer:this.div,linkService:s,svgFactory:new ii,parent:this};for(const s of t){s.borderStyle||=Fi._defaultBorderStyle;e.data=s;const t=ai.create(e);if(!t.isRenderable){continue}const i=t.render();await this.#Dn(i,s.id)}}update({viewport:t}){const s=this.div;this.viewport=t;Mt(s,{rotation:t.rotation});this.#Rn();s.hidden=false}#Rn(){if(!this.#Pn){return}const t=this.div;for(const[s,e]of this.#Pn){const i=t.querySelector(`[data-annotation-id="${s}"]`);if(!i){continue}e.className="annotationContent";const{firstChild:n}=i;if(!n){i.append(e)}else if(n.nodeName==="CANVAS"){n.replaceWith(e)}else if(!n.classList.contains("annotationContent")){n.before(e)}else{n.after(e)}const r=this.#Nn.get(s);if(!r){continue}if(r._hasNoCanvas){this._annotationEditorUIManager?.setMissingCanvas(s,i.id,e);r._hasNoCanvas=false}else{r.canvas=e}}this.#Pn.clear()}getEditableAnnotations(){return Array.from(this.#Nn.values())}getEditableAnnotation(t){return this.#Nn.get(t)}static get _defaultBorderStyle(){return D(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:A.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}}const _i=/\r\n?|\n/g;class Oi extends Ot{#en;#$n="";#Fn=`${this.id}-editor`;#_n=null;#gn;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const t=Oi.prototype;const s=t=>t.isEmpty();const e=$t.TRANSLATE_SMALL;const i=$t.TRANSLATE_BIG;return D(this,"_keyboardManager",new Dt([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:true}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-e,0],checker:s}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-i,0],checker:s}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[e,0],checker:s}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[i,0],checker:s}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-e],checker:s}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-i],checker:s}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,e],checker:s}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,i],checker:s}]]))}static _type="freetext";static _editorType=u.FREETEXT;constructor(t){super({...t,name:"freeTextEditor"});this.#en=t.color||Oi._defaultColor||Ot._defaultLineColor;this.#gn=t.fontSize||Oi._defaultFontSize}static initialize(t,s){Ot.initialize(t,s);const e=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(e.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,s){switch(t){case f.FREETEXT_SIZE:Oi._defaultFontSize=s;break;case f.FREETEXT_COLOR:Oi._defaultColor=s;break}}updateParams(t,s){switch(t){case f.FREETEXT_SIZE:this.#On(s);break;case f.FREETEXT_COLOR:this.#Ln(s);break}}static get defaultPropertiesToUpdate(){return[[f.FREETEXT_SIZE,Oi._defaultFontSize],[f.FREETEXT_COLOR,Oi._defaultColor||Ot._defaultLineColor]]}get propertiesToUpdate(){return[[f.FREETEXT_SIZE,this.#gn],[f.FREETEXT_COLOR,this.#en]]}#On(t){const s=t=>{this.editorDiv.style.fontSize=`calc(${t}px * var(--total-scale-factor))`;this.translate(0,-(t-this.#gn)*this.parentScale);this.#gn=t;this.#Bn()};const e=this.#gn;this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,e),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:true,type:f.FREETEXT_SIZE,overwriteIfSameType:true,keepUndo:true})}#Ln(t){const s=t=>{this.#en=this.editorDiv.style.color=t};const e=this.#en;this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,e),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:true,type:f.FREETEXT_COLOR,overwriteIfSameType:true,keepUndo:true})}_translateEmpty(t,s){this._uiManager.translateSelectedEditors(t,s,true)}getInitialTranslation(){const t=this.parentScale;return[-Oi._internalPadding*t,-(Oi._internalPadding+this.#gn)*t]}rebuild(){if(!this.parent){return}super.rebuild();if(this.div===null){return}if(!this.isAttachedToDOM){this.parent.add(this)}}enableEditMode(){if(this.isInEditMode()){return}this.parent.setEditingState(false);this.parent.updateToolbar(u.FREETEXT);super.enableEditMode();this.overlayDiv.classList.remove("enabled");this.editorDiv.contentEditable=true;this._isDraggable=false;this.div.removeAttribute("aria-activedescendant");this.#_n=new AbortController;const t=this._uiManager.combinedSignal(this.#_n);this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t});this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t});this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t});this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t});this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t})}disableEditMode(){if(!this.isInEditMode()){return}this.parent.setEditingState(true);super.disableEditMode();this.overlayDiv.classList.add("enabled");this.editorDiv.contentEditable=false;this.div.setAttribute("aria-activedescendant",this.#Fn);this._isDraggable=true;this.#_n?.abort();this.#_n=null;this.div.focus({preventScroll:true});this.isEditing=false;this.parent.div.classList.add("freetextEditing")}focusin(t){if(!this._focusEventsAllowed){return}super.focusin(t);if(t.target!==this.editorDiv){this.editorDiv.focus()}}onceAdded(t){if(this.width){return}this.enableEditMode();if(t){this.editorDiv.focus()}if(this._initialOptions?.isCentered){this.center()}this._initialOptions=null}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=false;if(this.parent){this.parent.setEditingState(true);this.parent.div.classList.add("freetextEditing")}super.remove()}#Un(){const t=[];this.editorDiv.normalize();let s=null;for(const e of this.editorDiv.childNodes){if(s?.nodeType===Node.TEXT_NODE&&e.nodeName==="BR"){continue}t.push(Oi.#jn(e));s=e}return t.join("\n")}#Bn(){const[t,s]=this.parentDimensions;let e;if(this.isAttachedToDOM){e=this.div.getBoundingClientRect()}else{const{currentLayer:t,div:s}=this;const i=s.style.display;const n=s.classList.contains("hidden");s.classList.remove("hidden");s.style.display="hidden";t.div.append(this.div);e=s.getBoundingClientRect();s.remove();s.style.display=i;s.classList.toggle("hidden",n)}if(this.rotation%180===this.parentRotation%180){this.width=e.width/t;this.height=e.height/s}else{this.width=e.height/t;this.height=e.width/s}this.fixAndSetPosition()}commit(){if(!this.isInEditMode()){return}super.commit();this.disableEditMode();const t=this.#$n;const s=this.#$n=this.#Un().trimEnd();if(t===s){return}const e=t=>{this.#$n=t;if(!t){this.remove();return}this.#Hn();this._uiManager.rebuild(this);this.#Bn()};this.addCommands({cmd:()=>{e(s)},undo:()=>{e(t)},mustExec:false});this.#Bn()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode();this.editorDiv.focus()}dblclick(t){this.enterInEditMode()}keydown(t){if(t.target===this.div&&t.key==="Enter"){this.enterInEditMode();t.preventDefault()}}editorDivKeydown(t){Oi._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=true}editorDivBlur(t){this.isEditing=false}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment");this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox");this.editorDiv.setAttribute("aria-multiline",true)}render(){if(this.div){return this.div}let t,s;if(this._isCopy||this.annotationElementId){t=this.x;s=this.y}super.render();this.editorDiv=document.createElement("div");this.editorDiv.className="internal";this.editorDiv.setAttribute("id",this.#Fn);this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2");this.editorDiv.setAttribute("data-l10n-attrs","default-content");this.enableEditing();this.editorDiv.contentEditable=true;const{style:e}=this.editorDiv;e.fontSize=`calc(${this.#gn}px * var(--total-scale-factor))`;e.color=this.#en;this.div.append(this.editorDiv);this.overlayDiv=document.createElement("div");this.overlayDiv.classList.add("overlay","enabled");this.div.append(this.overlayDiv);Tt(this,this.div,["dblclick","keydown"]);if(this._isCopy||this.annotationElementId){const[e,i]=this.parentDimensions;if(this.annotationElementId){const{position:n}=this._initialData;let[r,o]=this.getInitialTranslation();[r,o]=this.pageTranslationToScreen(r,o);const[h,a]=this.pageDimensions;const[c,l]=this.pageTranslation;let u,f;switch(this.rotation){case 0:u=t+(n[0]-c)/h;f=s+this.height-(n[1]-l)/a;break;case 90:u=t+(n[0]-c)/h;f=s-(n[1]-l)/a;[r,o]=[o,-r];break;case 180:u=t-this.width+(n[0]-c)/h;f=s-(n[1]-l)/a;[r,o]=[-r,-o];break;case 270:u=t+(n[0]-c-this.height*a)/h;f=s+(n[1]-l-this.width*h)/a;[r,o]=[-o,r];break}this.setAt(u*e,f*i,r,o)}else{this._moveAfterPaste(t,s)}this.#Hn();this._isDraggable=true;this.editorDiv.contentEditable=false}else{this._isDraggable=false;this.editorDiv.contentEditable=true}return this.div}static#jn(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(_i,"")}editorDivPaste(t){const s=t.clipboardData||window.clipboardData;const{types:e}=s;if(e.length===1&&e[0]==="text/plain"){return}t.preventDefault();const i=Oi.#zn(s.getData("text")||"").replaceAll(_i,"\n");if(!i){return}const n=window.getSelection();if(!n.rangeCount){return}this.editorDiv.normalize();n.deleteFromDocument();const r=n.getRangeAt(0);if(!i.includes("\n")){r.insertNode(document.createTextNode(i));this.editorDiv.normalize();n.collapseToStart();return}const{startContainer:o,startOffset:h}=r;const a=[];const c=[];if(o.nodeType===Node.TEXT_NODE){const t=o.parentElement;c.push(o.nodeValue.slice(h).replaceAll(_i,""));if(t!==this.editorDiv){let s=a;for(const e of this.editorDiv.childNodes){if(e===t){s=c;continue}s.push(Oi.#jn(e))}}a.push(o.nodeValue.slice(0,h).replaceAll(_i,""))}else if(o===this.editorDiv){let t=a;let s=0;for(const e of this.editorDiv.childNodes){if(s++===h){t=c}t.push(Oi.#jn(e))}}this.#$n=`${a.join("\n")}${i}${c.join("\n")}`;this.#Hn();const l=new Range;let u=Math.sumPrecise(a.map((t=>t.length)));for(const{firstChild:t}of this.editorDiv.childNodes){if(t.nodeType===Node.TEXT_NODE){const s=t.nodeValue.length;if(u<=s){l.setStart(t,u);l.setEnd(t,u);break}u-=s}}n.removeAllRanges();n.addRange(l)}#Hn(){this.editorDiv.replaceChildren();if(!this.#$n){return}for(const t of this.#$n.split("\n")){const s=document.createElement("div");s.append(t?document.createTextNode(t):document.createElement("br"));this.editorDiv.append(s)}}#Gn(){return this.#$n.replaceAll(" "," ")}static#zn(t){return t.replaceAll(" "," ")}get contentDiv(){return this.editorDiv}static async deserialize(t,s,e){let i=null;if(t instanceof vi){const{data:{defaultAppearanceData:{fontSize:s,fontColor:e},rect:n,rotation:r,id:o,popupRef:h},textContent:a,textPosition:c,parent:{page:{pageNumber:l}}}=t;if(!a||a.length===0){return null}i=t={annotationType:u.FREETEXT,color:Array.from(e),fontSize:s,value:a.join("\n"),position:c,pageIndex:l-1,rect:n.slice(0),rotation:r,id:o,deleted:false,popupRef:h}}const n=await super.deserialize(t,s,e);n.#gn=t.fontSize;n.#en=X.makeHexColor(...t.color);n.#$n=Oi.#zn(t.value);n.annotationElementId=t.id||null;n._initialData=i;return n}serialize(t=false){if(this.isEmpty()){return null}if(this.deleted){return this.serializeDeleted()}const s=Oi._internalPadding*this.parentScale;const e=this.getRect(s,s);const i=Ot._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.#en);const n={annotationType:u.FREETEXT,color:i,fontSize:this.#gn,value:this.#Gn(),pageIndex:this.pageIndex,rect:e,rotation:this.rotation,structTreeParentId:this._structTreeParentId};if(t){n.isCopy=true;return n}if(this.annotationElementId&&!this.#Wn(n)){return null}n.id=this.annotationElementId;return n}#Wn(t){const{value:s,fontSize:e,color:i,pageIndex:n}=this._initialData;return this._hasBeenMoved||t.value!==s||t.fontSize!==e||t.color.some(((t,s)=>t!==i[s]))||t.pageIndex!==n}renderAnnotationElement(t){const s=super.renderAnnotationElement(t);if(this.deleted){return s}const{style:e}=s;e.fontSize=`calc(${this.#gn}px * var(--total-scale-factor))`;e.color=this.#en;s.replaceChildren();for(const t of this.#$n.split("\n")){const e=document.createElement("div");e.append(t?document.createTextNode(t):document.createElement("br"));s.append(e)}const i=Oi._internalPadding*this.parentScale;t.updateEdited({rect:this.getRect(i,i),popupContent:this.#$n});return s}resetAnnotationElement(t){super.resetAnnotationElement(t);t.resetEdited()}}class Li{static PRECISION=1e-4;toSVGPath(){C("Abstract method `toSVGPath` must be implemented.")}get box(){C("Abstract getter `box` must be implemented.")}serialize(t,s){C("Abstract method `serialize` must be implemented.")}static _rescale(t,s,e,i,n,r){r||=new Float32Array(t.length);for(let o=0,h=t.length;o<h;o+=2){r[o]=s+t[o]*i;r[o+1]=e+t[o+1]*n}return r}static _rescaleAndSwap(t,s,e,i,n,r){r||=new Float32Array(t.length);for(let o=0,h=t.length;o<h;o+=2){r[o]=s+t[o+1]*i;r[o+1]=e+t[o]*n}return r}static _translate(t,s,e,i){i||=new Float32Array(t.length);for(let n=0,r=t.length;n<r;n+=2){i[n]=s+t[n];i[n+1]=e+t[n+1]}return i}static svgRound(t){return Math.round(t*1e4)}static _normalizePoint(t,s,e,i,n){switch(n){case 90:return[1-s/e,t/i];case 180:return[1-t/e,1-s/i];case 270:return[s/e,1-t/i];default:return[t/e,s/i]}}static _normalizePagePoint(t,s,e){switch(e){case 90:return[1-s,t];case 180:return[1-t,1-s];case 270:return[s,1-t];default:return[t,s]}}static createBezierPoints(t,s,e,i,n,r){return[(t+5*e)/6,(s+5*i)/6,(5*e+n)/6,(5*i+r)/6,(e+n)/2,(i+r)/2]}}class Bi{#Vn;#Xn=[];#Yn;#Qn;#Kn=[];#qn=new Float32Array(18);#Jn;#Zn;#tr;#sr;#er;#ir;#nr=[];static#rr=8;static#or=2;static#hr=Bi.#rr+Bi.#or;constructor({x:t,y:s},e,i,n,r,o=0){this.#Vn=e;this.#ir=n*i;this.#Qn=r;this.#qn.set([NaN,NaN,NaN,NaN,t,s],6);this.#Yn=o;this.#sr=Bi.#rr*i;this.#tr=Bi.#hr*i;this.#er=i;this.#nr.push(t,s)}isEmpty(){return isNaN(this.#qn[8])}#ar(){const t=this.#qn.subarray(4,6);const s=this.#qn.subarray(16,18);const[e,i,n,r]=this.#Vn;return[(this.#Jn+(t[0]-s[0])/2-e)/n,(this.#Zn+(t[1]-s[1])/2-i)/r,(this.#Jn+(s[0]-t[0])/2-e)/n,(this.#Zn+(s[1]-t[1])/2-i)/r]}add({x:t,y:s}){this.#Jn=t;this.#Zn=s;const[e,i,n,r]=this.#Vn;let[o,h,a,c]=this.#qn.subarray(8,12);const l=t-a;const u=s-c;const f=Math.hypot(l,u);if(f<this.#tr){return false}const d=f-this.#sr;const p=d/f;const g=p*l;const m=p*u;let A=o;let w=h;o=a;h=c;a+=g;c+=m;this.#nr?.push(t,s);const b=-m/d;const y=g/d;const v=b*this.#ir;const x=y*this.#ir;this.#qn.set(this.#qn.subarray(2,8),0);this.#qn.set([a+v,c+x],4);this.#qn.set(this.#qn.subarray(14,18),12);this.#qn.set([a-v,c-x],16);if(isNaN(this.#qn[6])){if(this.#Kn.length===0){this.#qn.set([o+v,h+x],2);this.#Kn.push(NaN,NaN,NaN,NaN,(o+v-e)/n,(h+x-i)/r);this.#qn.set([o-v,h-x],14);this.#Xn.push(NaN,NaN,NaN,NaN,(o-v-e)/n,(h-x-i)/r)}this.#qn.set([A,w,o,h,a,c],6);return!this.isEmpty()}this.#qn.set([A,w,o,h,a,c],6);const M=Math.abs(Math.atan2(w-h,A-o)-Math.atan2(m,g));if(M<Math.PI/2){[o,h,a,c]=this.#qn.subarray(2,6);this.#Kn.push(NaN,NaN,NaN,NaN,((o+a)/2-e)/n,((h+c)/2-i)/r);[o,h,A,w]=this.#qn.subarray(14,18);this.#Xn.push(NaN,NaN,NaN,NaN,((A+o)/2-e)/n,((w+h)/2-i)/r);return true}[A,w,o,h,a,c]=this.#qn.subarray(0,6);this.#Kn.push(((A+5*o)/6-e)/n,((w+5*h)/6-i)/r,((5*o+a)/6-e)/n,((5*h+c)/6-i)/r,((o+a)/2-e)/n,((h+c)/2-i)/r);[a,c,o,h,A,w]=this.#qn.subarray(12,18);this.#Xn.push(((A+5*o)/6-e)/n,((w+5*h)/6-i)/r,((5*o+a)/6-e)/n,((5*h+c)/6-i)/r,((o+a)/2-e)/n,((h+c)/2-i)/r);return true}toSVGPath(){if(this.isEmpty()){return""}const t=this.#Kn;const s=this.#Xn;if(isNaN(this.#qn[6])&&!this.isEmpty()){return this.#cr()}const e=[];e.push(`M${t[4]} ${t[5]}`);for(let s=6;s<t.length;s+=6){if(isNaN(t[s])){e.push(`L${t[s+4]} ${t[s+5]}`)}else{e.push(`C${t[s]} ${t[s+1]} ${t[s+2]} ${t[s+3]} ${t[s+4]} ${t[s+5]}`)}}this.#lr(e);for(let t=s.length-6;t>=6;t-=6){if(isNaN(s[t])){e.push(`L${s[t+4]} ${s[t+5]}`)}else{e.push(`C${s[t]} ${s[t+1]} ${s[t+2]} ${s[t+3]} ${s[t+4]} ${s[t+5]}`)}}this.#ur(e);return e.join(" ")}#cr(){const[t,s,e,i]=this.#Vn;const[n,r,o,h]=this.#ar();return`M${(this.#qn[2]-t)/e} ${(this.#qn[3]-s)/i} L${(this.#qn[4]-t)/e} ${(this.#qn[5]-s)/i} L${n} ${r} L${o} ${h} L${(this.#qn[16]-t)/e} ${(this.#qn[17]-s)/i} L${(this.#qn[14]-t)/e} ${(this.#qn[15]-s)/i} Z`}#ur(t){const s=this.#Xn;t.push(`L${s[4]} ${s[5]} Z`)}#lr(t){const[s,e,i,n]=this.#Vn;const r=this.#qn.subarray(4,6);const o=this.#qn.subarray(16,18);const[h,a,c,l]=this.#ar();t.push(`L${(r[0]-s)/i} ${(r[1]-e)/n} L${h} ${a} L${c} ${l} L${(o[0]-s)/i} ${(o[1]-e)/n}`)}newFreeDrawOutline(t,s,e,i,n,r){return new Ui(t,s,e,i,n,r)}getOutlines(){const t=this.#Kn;const s=this.#Xn;const e=this.#qn;const[i,n,r,o]=this.#Vn;const h=new Float32Array((this.#nr?.length??0)+2);for(let t=0,s=h.length-2;t<s;t+=2){h[t]=(this.#nr[t]-i)/r;h[t+1]=(this.#nr[t+1]-n)/o}h[h.length-2]=(this.#Jn-i)/r;h[h.length-1]=(this.#Zn-n)/o;if(isNaN(e[6])&&!this.isEmpty()){return this.#fr(h)}const a=new Float32Array(this.#Kn.length+24+this.#Xn.length);let c=t.length;for(let s=0;s<c;s+=2){if(isNaN(t[s])){a[s]=a[s+1]=NaN;continue}a[s]=t[s];a[s+1]=t[s+1]}c=this.#dr(a,c);for(let t=s.length-6;t>=6;t-=6){for(let e=0;e<6;e+=2){if(isNaN(s[t+e])){a[c]=a[c+1]=NaN;c+=2;continue}a[c]=s[t+e];a[c+1]=s[t+e+1];c+=2}}this.#pr(a,c);return this.newFreeDrawOutline(a,h,this.#Vn,this.#er,this.#Yn,this.#Qn)}#fr(t){const s=this.#qn;const[e,i,n,r]=this.#Vn;const[o,h,a,c]=this.#ar();const l=new Float32Array(36);l.set([NaN,NaN,NaN,NaN,(s[2]-e)/n,(s[3]-i)/r,NaN,NaN,NaN,NaN,(s[4]-e)/n,(s[5]-i)/r,NaN,NaN,NaN,NaN,o,h,NaN,NaN,NaN,NaN,a,c,NaN,NaN,NaN,NaN,(s[16]-e)/n,(s[17]-i)/r,NaN,NaN,NaN,NaN,(s[14]-e)/n,(s[15]-i)/r],0);return this.newFreeDrawOutline(l,t,this.#Vn,this.#er,this.#Yn,this.#Qn)}#pr(t,s){const e=this.#Xn;t.set([NaN,NaN,NaN,NaN,e[4],e[5]],s);return s+=6}#dr(t,s){const e=this.#qn.subarray(4,6);const i=this.#qn.subarray(16,18);const[n,r,o,h]=this.#Vn;const[a,c,l,u]=this.#ar();t.set([NaN,NaN,NaN,NaN,(e[0]-n)/o,(e[1]-r)/h,NaN,NaN,NaN,NaN,a,c,NaN,NaN,NaN,NaN,l,u,NaN,NaN,NaN,NaN,(i[0]-n)/o,(i[1]-r)/h],s);return s+=24}}class Ui extends Li{#Vn;#gr=new Float32Array(4);#Yn;#Qn;#nr;#er;#mr;constructor(t,s,e,i,n,r){super();this.#mr=t;this.#nr=s;this.#Vn=e;this.#er=i;this.#Yn=n;this.#Qn=r;this.lastPoint=[NaN,NaN];this.#Ar(r);const[o,h,a,c]=this.#gr;for(let s=0,e=t.length;s<e;s+=2){t[s]=(t[s]-o)/a;t[s+1]=(t[s+1]-h)/c}for(let t=0,e=s.length;t<e;t+=2){s[t]=(s[t]-o)/a;s[t+1]=(s[t+1]-h)/c}}toSVGPath(){const t=[`M${this.#mr[4]} ${this.#mr[5]}`];for(let s=6,e=this.#mr.length;s<e;s+=6){if(isNaN(this.#mr[s])){t.push(`L${this.#mr[s+4]} ${this.#mr[s+5]}`);continue}t.push(`C${this.#mr[s]} ${this.#mr[s+1]} ${this.#mr[s+2]} ${this.#mr[s+3]} ${this.#mr[s+4]} ${this.#mr[s+5]}`)}t.push("Z");return t.join(" ")}serialize([t,s,e,i],n){const r=e-t;const o=i-s;let h;let a;switch(n){case 0:h=Li._rescale(this.#mr,t,i,r,-o);a=Li._rescale(this.#nr,t,i,r,-o);break;case 90:h=Li._rescaleAndSwap(this.#mr,t,s,r,o);a=Li._rescaleAndSwap(this.#nr,t,s,r,o);break;case 180:h=Li._rescale(this.#mr,e,s,-r,o);a=Li._rescale(this.#nr,e,s,-r,o);break;case 270:h=Li._rescaleAndSwap(this.#mr,e,i,-r,-o);a=Li._rescaleAndSwap(this.#nr,e,i,-r,-o);break}return{outline:Array.from(h),points:[Array.from(a)]}}#Ar(t){const s=this.#mr;let e=s[4];let i=s[5];const n=[e,i,e,i];let r=e;let o=i;const h=t?Math.max:Math.min;for(let t=6,a=s.length;t<a;t+=6){const a=s[t+4],c=s[t+5];if(isNaN(s[t])){X.pointBoundingBox(a,c,n);if(o<c){r=a;o=c}else if(o===c){r=h(r,a)}}else{const a=[Infinity,Infinity,-Infinity,-Infinity];X.bezierBoundingBox(e,i,...s.slice(t,t+6),a);X.rectBoundingBox(...a,n);if(o<a[3]){r=a[2];o=a[3]}else if(o===a[3]){r=h(r,a[2])}}e=a;i=c}const a=this.#gr;a[0]=n[0]-this.#Yn;a[1]=n[1]-this.#Yn;a[2]=n[2]-n[0]+2*this.#Yn;a[3]=n[3]-n[1]+2*this.#Yn;this.lastPoint=[r,o]}get box(){return this.#gr}newOutliner(t,s,e,i,n,r=0){return new Bi(t,s,e,i,n,r)}getNewOutline(t,s){const[e,i,n,r]=this.#gr;const[o,h,a,c]=this.#Vn;const l=n*a;const u=r*c;const f=e*a+o;const d=i*c+h;const p=this.newOutliner({x:this.#nr[0]*l+f,y:this.#nr[1]*u+d},this.#Vn,this.#er,t,this.#Qn,s??this.#Yn);for(let t=2;t<this.#nr.length;t+=2){p.add({x:this.#nr[t]*l+f,y:this.#nr[t+1]*u+d})}return p.getOutlines()}}class ji{#Vn;#wr;#br=[];#yr=[];constructor(t,s=0,e=0,i=true){const n=[Infinity,Infinity,-Infinity,-Infinity];const r=10**-4;for(const{x:e,y:i,width:o,height:h}of t){const t=Math.floor((e-s)/r)*r;const a=Math.ceil((e+o+s)/r)*r;const c=Math.floor((i-s)/r)*r;const l=Math.ceil((i+h+s)/r)*r;const u=[t,c,l,true];const f=[a,c,l,false];this.#br.push(u,f);X.rectBoundingBox(t,c,a,l,n)}const o=n[2]-n[0]+2*e;const h=n[3]-n[1]+2*e;const a=n[0]-e;const c=n[1]-e;const l=this.#br.at(i?-1:-2);const u=[l[0],l[2]];for(const t of this.#br){const[s,e,i]=t;t[0]=(s-a)/o;t[1]=(e-c)/h;t[2]=(i-c)/h}this.#Vn=new Float32Array([a,c,o,h]);this.#wr=u}getOutlines(){this.#br.sort(((t,s)=>t[0]-s[0]||t[1]-s[1]||t[2]-s[2]));const t=[];for(const s of this.#br){if(s[3]){t.push(...this.#vr(s));this.#xr(s)}else{this.#Mr(s);t.push(...this.#vr(s))}}return this.#kr(t)}#kr(t){const s=[];const e=new Set;for(const e of t){const[t,i,n]=e;s.push([t,i,e],[t,n,e])}s.sort(((t,s)=>t[1]-s[1]||t[0]-s[0]));for(let t=0,i=s.length;t<i;t+=2){const i=s[t][2];const n=s[t+1][2];i.push(n);n.push(i);e.add(i);e.add(n)}const i=[];let n;while(e.size>0){const t=e.values().next().value;let[s,r,o,h,a]=t;e.delete(t);let c=s;let l=r;n=[s,o];i.push(n);while(true){let t;if(e.has(h)){t=h}else if(e.has(a)){t=a}else{break}e.delete(t);[s,r,o,h,a]=t;if(c!==s){n.push(c,l,s,l===r?r:o);c=s}l=l===r?o:r}n.push(c,l)}return new Hi(i,this.#Vn,this.#wr)}#Sr(t){const s=this.#yr;let e=0;let i=s.length-1;while(e<=i){const n=e+i>>1;const r=s[n][0];if(r===t){return n}if(r<t){e=n+1}else{i=n-1}}return i+1}#xr([,t,s]){const e=this.#Sr(t);this.#yr.splice(e,0,[t,s])}#Mr([,t,s]){const e=this.#Sr(t);for(let i=e;i<this.#yr.length;i++){const[e,n]=this.#yr[i];if(e!==t){break}if(e===t&&n===s){this.#yr.splice(i,1);return}}for(let i=e-1;i>=0;i--){const[e,n]=this.#yr[i];if(e!==t){break}if(e===t&&n===s){this.#yr.splice(i,1);return}}}#vr(t){const[s,e,i]=t;const n=[[s,e,i]];const r=this.#Sr(i);for(let t=0;t<r;t++){const[e,i]=this.#yr[t];for(let t=0,r=n.length;t<r;t++){const[,o,h]=n[t];if(i<=o||h<=e){continue}if(o>=e){if(h>i){n[t][1]=i}else{if(r===1){return[]}n.splice(t,1);t--;r--}continue}n[t][2]=e;if(h>i){n.push([s,i,h])}}}return n}}class Hi extends Li{#Vn;#Er;constructor(t,s,e){super();this.#Er=t;this.#Vn=s;this.lastPoint=e}toSVGPath(){const t=[];for(const s of this.#Er){let[e,i]=s;t.push(`M${e} ${i}`);for(let n=2;n<s.length;n+=2){const r=s[n];const o=s[n+1];if(r===e){t.push(`V${o}`);i=o}else if(o===i){t.push(`H${r}`);e=r}}t.push("Z")}return t.join(" ")}serialize([t,s,e,i],n){const r=[];const o=e-t;const h=i-s;for(const s of this.#Er){const e=new Array(s.length);for(let n=0;n<s.length;n+=2){e[n]=t+s[n]*o;e[n+1]=i-s[n+1]*h}r.push(e)}return r}get box(){return this.#Vn}get classNamesForOutlining(){return["highlightOutline"]}}class zi extends Bi{newFreeDrawOutline(t,s,e,i,n,r){return new Gi(t,s,e,i,n,r)}}class Gi extends Ui{newOutliner(t,s,e,i,n,r=0){return new zi(t,s,e,i,n,r)}}class Wi{#Cr=null;#Tr=null;#Pr;#Nr=null;#Ir=false;#Dr=false;#r=null;#Rr;#$r=null;#m=null;#Fr;static#_r=null;static get _keyboardManager(){return D(this,"_keyboardManager",new Dt([[["Escape","mac+Escape"],Wi.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],Wi.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],Wi.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],Wi.prototype._moveToPrevious],[["Home","mac+Home"],Wi.prototype._moveToBeginning],[["End","mac+End"],Wi.prototype._moveToEnd]]))}constructor({editor:t=null,uiManager:s=null}){if(t){this.#Dr=false;this.#Fr=f.HIGHLIGHT_COLOR;this.#r=t}else{this.#Dr=true;this.#Fr=f.HIGHLIGHT_DEFAULT_COLOR}this.#m=t?._uiManager||s;this.#Rr=this.#m._eventBus;this.#Pr=t?.color||this.#m?.highlightColors.values().next().value||"#FFFF98";Wi.#_r||=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"})}renderButton(){const t=this.#Cr=document.createElement("button");t.className="colorPicker";t.tabIndex="0";t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button");t.setAttribute("aria-haspopup",true);const s=this.#m._signal;t.addEventListener("click",this.#Or.bind(this),{signal:s});t.addEventListener("keydown",this.#Qi.bind(this),{signal:s});const e=this.#Tr=document.createElement("span");e.className="swatch";e.setAttribute("aria-hidden",true);e.style.backgroundColor=this.#Pr;t.append(e);return t}renderMainDropdown(){const t=this.#Nr=this.#Lr();t.setAttribute("aria-orientation","horizontal");t.setAttribute("aria-labelledby","highlightColorPickerLabel");return t}#Lr(){const t=document.createElement("div");const s=this.#m._signal;t.addEventListener("contextmenu",gt,{signal:s});t.className="dropdown";t.role="listbox";t.setAttribute("aria-multiselectable",false);t.setAttribute("aria-orientation","vertical");t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(const[e,i]of this.#m.highlightColors){const n=document.createElement("button");n.tabIndex="0";n.role="option";n.setAttribute("data-color",i);n.title=e;n.setAttribute("data-l10n-id",Wi.#_r[e]);const r=document.createElement("span");n.append(r);r.className="swatch";r.style.backgroundColor=i;n.setAttribute("aria-selected",i===this.#Pr);n.addEventListener("click",this.#Br.bind(this,i),{signal:s});t.append(n)}t.addEventListener("keydown",this.#Qi.bind(this),{signal:s});return t}#Br(t,s){s.stopPropagation();this.#Rr.dispatch("switchannotationeditorparams",{source:this,type:this.#Fr,value:t})}_colorSelectFromKeyboard(t){if(t.target===this.#Cr){this.#Or(t);return}const s=t.target.getAttribute("data-color");if(!s){return}this.#Br(s,t)}_moveToNext(t){if(!this.#Ur){this.#Or(t);return}if(t.target===this.#Cr){this.#Nr.firstChild?.focus();return}t.target.nextSibling?.focus()}_moveToPrevious(t){if(t.target===this.#Nr?.firstChild||t.target===this.#Cr){if(this.#Ur){this._hideDropdownFromKeyboard()}return}if(!this.#Ur){this.#Or(t)}t.target.previousSibling?.focus()}_moveToBeginning(t){if(!this.#Ur){this.#Or(t);return}this.#Nr.firstChild?.focus()}_moveToEnd(t){if(!this.#Ur){this.#Or(t);return}this.#Nr.lastChild?.focus()}#Qi(t){Wi._keyboardManager.exec(this,t)}#Or(t){if(this.#Ur){this.hideDropdown();return}this.#Ir=t.detail===0;if(!this.#$r){this.#$r=new AbortController;window.addEventListener("pointerdown",this.#l.bind(this),{signal:this.#m.combinedSignal(this.#$r)})}if(this.#Nr){this.#Nr.classList.remove("hidden");return}const s=this.#Nr=this.#Lr();this.#Cr.append(s)}#l(t){if(this.#Nr?.contains(t.target)){return}this.hideDropdown()}hideDropdown(){this.#Nr?.classList.add("hidden");this.#$r?.abort();this.#$r=null}get#Ur(){return this.#Nr&&!this.#Nr.classList.contains("hidden")}_hideDropdownFromKeyboard(){if(this.#Dr){return}if(!this.#Ur){this.#r?.unselect();return}this.hideDropdown();this.#Cr.focus({preventScroll:true,focusVisible:this.#Ir})}updateColor(t){if(this.#Tr){this.#Tr.style.backgroundColor=t}if(!this.#Nr){return}const s=this.#m.highlightColors.values();for(const e of this.#Nr.children){e.setAttribute("aria-selected",s.next().value===t)}}destroy(){this.#Cr?.remove();this.#Cr=null;this.#Tr=null;this.#Nr?.remove();this.#Nr=null}}class Vi extends Ot{#jr=null;#Hr=0;#zr;#Gr=null;#n=null;#Wr=null;#Vr=null;#Xr=0;#Yr=null;#Qr=null;#y=null;#Kr=false;#wr=null;#qr;#Jr=null;#Zr="";#ir;#to="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _type="highlight";static _editorType=u.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){const t=Vi.prototype;return D(this,"_keyboardManager",new Dt([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}constructor(t){super({...t,name:"highlightEditor"});this.color=t.color||Vi._defaultColor;this.#ir=t.thickness||Vi._defaultThickness;this.#qr=t.opacity||Vi._defaultOpacity;this.#zr=t.boxes||null;this.#to=t.methodOfCreation||"";this.#Zr=t.text||"";this._isDraggable=false;this.defaultL10nId="pdfjs-editor-highlight-editor";if(t.highlightId>-1){this.#Kr=true;this.#so(t);this.#eo()}else if(this.#zr){this.#jr=t.anchorNode;this.#Hr=t.anchorOffset;this.#Vr=t.focusNode;this.#Xr=t.focusOffset;this.#io();this.#eo();this.rotate(this.rotation)}}get telemetryInitialData(){return{action:"added",type:this.#Kr?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:this.#ir,methodOfCreation:this.#to}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}#io(){const t=new ji(this.#zr,.001);this.#Qr=t.getOutlines();[this.x,this.y,this.width,this.height]=this.#Qr.box;const s=new ji(this.#zr,.0025,.001,this._uiManager.direction==="ltr");this.#Wr=s.getOutlines();const{lastPoint:e}=this.#Wr;this.#wr=[(e[0]-this.x)/this.width,(e[1]-this.y)/this.height]}#so({highlightOutlines:t,highlightId:s,clipPathId:e}){this.#Qr=t;const i=1.5;this.#Wr=t.getNewOutline(this.#ir/2+i,.0025);if(s>=0){this.#y=s;this.#Gr=e;this.parent.drawLayer.finalizeDraw(s,{bbox:t.box,path:{d:t.toSVGPath()}});this.#Jr=this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:true,free:true},bbox:this.#Wr.box,path:{d:this.#Wr.toSVGPath()}},true)}else if(this.parent){const s=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(this.#y,{bbox:Vi.#no(this.#Qr.box,(s-this.rotation+360)%360),path:{d:t.toSVGPath()}});this.parent.drawLayer.updateProperties(this.#Jr,{bbox:Vi.#no(this.#Wr.box,s),path:{d:this.#Wr.toSVGPath()}})}const[n,r,o,h]=t.box;switch(this.rotation){case 0:this.x=n;this.y=r;this.width=o;this.height=h;break;case 90:{const[t,s]=this.parentDimensions;this.x=r;this.y=1-n;this.width=o*s/t;this.height=h*t/s;break}case 180:this.x=1-n;this.y=1-r;this.width=o;this.height=h;break;case 270:{const[t,s]=this.parentDimensions;this.x=1-r;this.y=n;this.width=o*s/t;this.height=h*t/s;break}}const{lastPoint:a}=this.#Wr;this.#wr=[(a[0]-n)/o,(a[1]-r)/h]}static initialize(t,s){Ot.initialize(t,s);Vi._defaultColor||=s.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(t,s){switch(t){case f.HIGHLIGHT_DEFAULT_COLOR:Vi._defaultColor=s;break;case f.HIGHLIGHT_THICKNESS:Vi._defaultThickness=s;break}}translateInPage(t,s){}get toolbarPosition(){return this.#wr}updateParams(t,s){switch(t){case f.HIGHLIGHT_COLOR:this.#Ln(s);break;case f.HIGHLIGHT_THICKNESS:this.#ro(s);break}}static get defaultPropertiesToUpdate(){return[[f.HIGHLIGHT_DEFAULT_COLOR,Vi._defaultColor],[f.HIGHLIGHT_THICKNESS,Vi._defaultThickness]]}get propertiesToUpdate(){return[[f.HIGHLIGHT_COLOR,this.color||Vi._defaultColor],[f.HIGHLIGHT_THICKNESS,this.#ir||Vi._defaultThickness],[f.HIGHLIGHT_FREE,this.#Kr]]}#Ln(t){const s=(t,s)=>{this.color=t;this.#qr=s;this.parent?.drawLayer.updateProperties(this.#y,{root:{fill:t,"fill-opacity":s}});this.#n?.updateColor(t)};const e=this.color;const i=this.#qr;this.addCommands({cmd:s.bind(this,t,Vi._defaultOpacity),undo:s.bind(this,e,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:true,type:f.HIGHLIGHT_COLOR,overwriteIfSameType:true,keepUndo:true});this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(t)},true)}#ro(t){const s=this.#ir;const e=t=>{this.#ir=t;this.#oo(t)};this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:true,type:f.INK_THICKNESS,overwriteIfSameType:true,keepUndo:true});this._reportTelemetry({action:"thickness_changed",thickness:t},true)}async addEditToolbar(){const t=await super.addEditToolbar();if(!t){return null}if(this._uiManager.highlightColors){this.#n=new Wi({editor:this});t.addColorPicker(this.#n)}return t}disableEditing(){super.disableEditing();this.div.classList.toggle("disabled",true)}enableEditing(){super.enableEditing();this.div.classList.toggle("disabled",false)}fixAndSetPosition(){return super.fixAndSetPosition(this.#ho())}getBaseTranslation(){return[0,0]}getRect(t,s){return super.getRect(t,s,this.#ho())}onceAdded(t){if(!this.annotationElementId){this.parent.addUndoableEditor(this)}if(t){this.div.focus()}}remove(){this.#ao();this._reportTelemetry({action:"deleted"});super.remove()}rebuild(){if(!this.parent){return}super.rebuild();if(this.div===null){return}this.#eo();if(!this.isAttachedToDOM){this.parent.add(this)}}setParent(t){let s=false;if(this.parent&&!t){this.#ao()}else if(t){this.#eo(t);s=!this.parent&&this.div?.classList.contains("selectedEditor")}super.setParent(t);this.show(this._isVisible);if(s){this.select()}}#oo(t){if(!this.#Kr){return}this.#so({highlightOutlines:this.#Qr.getNewOutline(t/2)});this.fixAndSetPosition();const[s,e]=this.parentDimensions;this.setDims(this.width*s,this.height*e)}#ao(){if(this.#y===null||!this.parent){return}this.parent.drawLayer.remove(this.#y);this.#y=null;this.parent.drawLayer.remove(this.#Jr);this.#Jr=null}#eo(t=this.parent){if(this.#y!==null){return}({id:this.#y,clipPathId:this.#Gr}=t.drawLayer.draw({bbox:this.#Qr.box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.#qr},rootClass:{highlight:true,free:this.#Kr},path:{d:this.#Qr.toSVGPath()}},false,true));this.#Jr=t.drawLayer.drawOutline({rootClass:{highlightOutline:true,free:this.#Kr},bbox:this.#Wr.box,path:{d:this.#Wr.toSVGPath()}},this.#Kr);if(this.#Yr){this.#Yr.style.clipPath=this.#Gr}}static#no([t,s,e,i],n){switch(n){case 90:return[1-s-i,t,i,e];case 180:return[1-t-e,1-s-i,e,i];case 270:return[s,1-t-e,i,e]}return[t,s,e,i]}rotate(t){const{drawLayer:s}=this.parent;let e;if(this.#Kr){t=(t-this.rotation+360)%360;e=Vi.#no(this.#Qr.box,t)}else{e=Vi.#no([this.x,this.y,this.width,this.height],t)}s.updateProperties(this.#y,{bbox:e,root:{"data-main-rotation":t}});s.updateProperties(this.#Jr,{bbox:Vi.#no(this.#Wr.box,t),root:{"data-main-rotation":t}})}render(){if(this.div){return this.div}const t=super.render();if(this.#Zr){t.setAttribute("aria-label",this.#Zr);t.setAttribute("role","mark")}if(this.#Kr){t.classList.add("free")}else{this.div.addEventListener("keydown",this.#co.bind(this),{signal:this._uiManager._signal})}const s=this.#Yr=document.createElement("div");t.append(s);s.setAttribute("aria-hidden","true");s.className="internal";s.style.clipPath=this.#Gr;const[e,i]=this.parentDimensions;this.setDims(this.width*e,this.height*i);Tt(this,this.#Yr,["pointerover","pointerleave"]);this.enableEditing();return t}pointerover(){if(!this.isSelected){this.parent?.drawLayer.updateProperties(this.#Jr,{rootClass:{hovered:true}})}}pointerleave(){if(!this.isSelected){this.parent?.drawLayer.updateProperties(this.#Jr,{rootClass:{hovered:false}})}}#co(t){Vi._keyboardManager.exec(this,t)}_moveCaret(t){this.parent.unselect(this);switch(t){case 0:case 2:this.#lo(true);break;case 1:case 3:this.#lo(false);break}}#lo(t){if(!this.#jr){return}const s=window.getSelection();if(t){s.setPosition(this.#jr,this.#Hr)}else{s.setPosition(this.#Vr,this.#Xr)}}select(){super.select();if(!this.#Jr){return}this.parent?.drawLayer.updateProperties(this.#Jr,{rootClass:{hovered:false,selected:true}})}unselect(){super.unselect();if(!this.#Jr){return}this.parent?.drawLayer.updateProperties(this.#Jr,{rootClass:{selected:false}});if(!this.#Kr){this.#lo(false)}}get _mustFixPosition(){return!this.#Kr}show(t=this._isVisible){super.show(t);if(this.parent){this.parent.drawLayer.updateProperties(this.#y,{rootClass:{hidden:!t}});this.parent.drawLayer.updateProperties(this.#Jr,{rootClass:{hidden:!t}})}}#ho(){return this.#Kr?this.rotation:0}#uo(){if(this.#Kr){return null}const[t,s]=this.pageDimensions;const[e,i]=this.pageTranslation;const n=this.#zr;const r=new Float32Array(n.length*8);let o=0;for(const{x:h,y:a,width:c,height:l}of n){const n=h*t+e;const u=(1-a)*s+i;r[o]=r[o+4]=n;r[o+1]=r[o+3]=u;r[o+2]=r[o+6]=n+c*t;r[o+5]=r[o+7]=u-l*s;o+=8}return r}#fo(t){return this.#Qr.serialize(t,this.#ho())}static startHighlighting(t,s,{target:e,x:i,y:n}){const{x:r,y:o,width:h,height:a}=e.getBoundingClientRect();const c=new AbortController;const l=t.combinedSignal(c);const u=s=>{c.abort();this.#do(t,s)};window.addEventListener("blur",u,{signal:l});window.addEventListener("pointerup",u,{signal:l});window.addEventListener("pointerdown",mt,{capture:true,passive:false,signal:l});window.addEventListener("contextmenu",gt,{signal:l});e.addEventListener("pointermove",this.#po.bind(this,t),{signal:l});this._freeHighlight=new zi({x:i,y:n},[r,o,h,a],t.scale,this._defaultThickness/2,s,.001);({id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:true,free:true},path:{d:this._freeHighlight.toSVGPath()}},true,true))}static#po(t,s){if(this._freeHighlight.add(s)){t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})}}static#do(t,s){if(!this._freeHighlight.isEmpty()){t.createAndAddNewEditor(s,false,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"})}else{t.drawLayer.remove(this._freeHighlightId)}this._freeHighlightId=-1;this._freeHighlight=null;this._freeHighlightClipId=""}static async deserialize(t,s,e){let i=null;if(t instanceof Pi){const{data:{quadPoints:s,rect:e,rotation:n,id:r,color:o,opacity:h,popupRef:a},parent:{page:{pageNumber:c}}}=t;i=t={annotationType:u.HIGHLIGHT,color:Array.from(o),opacity:h,quadPoints:s,boxes:null,pageIndex:c-1,rect:e.slice(0),rotation:n,id:r,deleted:false,popupRef:a}}else if(t instanceof Ti){const{data:{inkLists:s,rect:e,rotation:n,id:r,color:o,borderStyle:{rawWidth:h},popupRef:a},parent:{page:{pageNumber:c}}}=t;i=t={annotationType:u.HIGHLIGHT,color:Array.from(o),thickness:h,inkLists:s,boxes:null,pageIndex:c-1,rect:e.slice(0),rotation:n,id:r,deleted:false,popupRef:a}}const{color:n,quadPoints:r,inkLists:o,opacity:h}=t;const a=await super.deserialize(t,s,e);a.color=X.makeHexColor(...n);a.#qr=h||1;if(o){a.#ir=t.thickness}a.annotationElementId=t.id||null;a._initialData=i;const[c,l]=a.pageDimensions;const[f,d]=a.pageTranslation;if(r){const t=a.#zr=[];for(let s=0;s<r.length;s+=8){t.push({x:(r[s]-f)/c,y:1-(r[s+1]-d)/l,width:(r[s+2]-r[s])/c,height:(r[s+1]-r[s+5])/l})}a.#io();a.#eo();a.rotate(a.rotation)}else if(o){a.#Kr=true;const t=o[0];const e={x:t[0]-f,y:l-(t[1]-d)};const i=new zi(e,[0,0,c,l],1,a.#ir/2,true,.001);for(let s=0,n=t.length;s<n;s+=2){e.x=t[s]-f;e.y=l-(t[s+1]-d);i.add(e)}const{id:n,clipPathId:r}=s.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:a.color,"fill-opacity":a._defaultOpacity},rootClass:{highlight:true,free:true},path:{d:i.toSVGPath()}},true,true);a.#so({highlightOutlines:i.getOutlines(),highlightId:n,clipPathId:r});a.#eo();a.rotate(a.parentRotation)}return a}serialize(t=false){if(this.isEmpty()||t){return null}if(this.deleted){return this.serializeDeleted()}const s=this.getRect(0,0);const e=Ot._colorManager.convert(this.color);const i={annotationType:u.HIGHLIGHT,color:e,opacity:this.#qr,thickness:this.#ir,quadPoints:this.#uo(),outlines:this.#fo(s),pageIndex:this.pageIndex,rect:s,rotation:this.#ho(),structTreeParentId:this._structTreeParentId};if(this.annotationElementId&&!this.#Wn(i)){return null}i.id=this.annotationElementId;return i}#Wn(t){const{color:s}=this._initialData;return t.color.some(((t,e)=>t!==s[e]))}renderAnnotationElement(t){t.updateEdited({rect:this.getRect(0,0)});return null}static canCreateNewEmptyEditor(){return false}}class Xi{#go=Object.create(null);updateProperty(t,s){this[t]=s;this.updateSVGProperty(t,s)}updateProperties(t){if(!t){return}for(const[s,e]of Object.entries(t)){if(!s.startsWith("_")){this.updateProperty(s,e)}}}updateSVGProperty(t,s){this.#go[t]=s}toSVGProperties(){const t=this.#go;this.#go=Object.create(null);return{root:t}}reset(){this.#go=Object.create(null)}updateAll(t=this){this.updateProperties(t)}clone(){C("Not implemented")}}class Yi extends Ot{#mo=null;#Ao;_drawId=null;static _currentDrawId=-1;static _currentParent=null;static#wo=null;static#bo=null;static#yo=null;static#vo=NaN;static#xo=null;static#Mo=null;static#ko=NaN;static _INNER_MARGIN=3;constructor(t){super(t);this.#Ao=t.mustBeCommitted||false;this._addOutlines(t)}_addOutlines(t){if(t.drawOutlines){this.#So(t);this.#eo()}}#So({drawOutlines:t,drawId:s,drawingOptions:e}){this.#mo=t;this._drawingOptions||=e;if(s>=0){this._drawId=s;this.parent.drawLayer.finalizeDraw(s,t.defaultProperties)}else{this._drawId=this.#Eo(t,this.parent)}this.#Co(t.box)}#Eo(t,s){const{id:e}=s.drawLayer.draw(Yi._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),false,false);return e}static _mergeSVGProperties(t,s){const e=new Set(Object.keys(t));for(const[i,n]of Object.entries(s)){if(e.has(i)){Object.assign(t[i],n)}else{t[i]=n}}return t}static getDefaultDrawingOptions(t){C("Not implemented")}static get typesMap(){C("Not implemented")}static get isDrawer(){return true}static get supportMultipleDrawings(){return false}static updateDefaultParams(t,s){const e=this.typesMap.get(t);if(e){this._defaultDrawingOptions.updateProperty(e,s)}if(this._currentParent){Yi.#wo.updateProperty(e,s);this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties())}}updateParams(t,s){const e=this.constructor.typesMap.get(t);if(e){this._updateProperty(t,e,s)}}static get defaultPropertiesToUpdate(){const t=[];const s=this._defaultDrawingOptions;for(const[e,i]of this.typesMap){t.push([e,s[i]])}return t}get propertiesToUpdate(){const t=[];const{_drawingOptions:s}=this;for(const[e,i]of this.constructor.typesMap){t.push([e,s[i]])}return t}_updateProperty(t,s,e){const i=this._drawingOptions;const n=i[s];const r=t=>{i.updateProperty(s,t);const e=this.#mo.updateProperty(s,t);if(e){this.#Co(e)}this.parent?.drawLayer.updateProperties(this._drawId,i.toSVGProperties())};this.addCommands({cmd:r.bind(this,e),undo:r.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:true,type:t,overwriteIfSameType:true,keepUndo:true})}_onResizing(){this.parent?.drawLayer.updateProperties(this._drawId,Yi._mergeSVGProperties(this.#mo.getPathResizingSVGProperties(this.#To()),{bbox:this.#Po()}))}_onResized(){this.parent?.drawLayer.updateProperties(this._drawId,Yi._mergeSVGProperties(this.#mo.getPathResizedSVGProperties(this.#To()),{bbox:this.#Po()}))}_onTranslating(t,s){this.parent?.drawLayer.updateProperties(this._drawId,{bbox:this.#Po()})}_onTranslated(){this.parent?.drawLayer.updateProperties(this._drawId,Yi._mergeSVGProperties(this.#mo.getPathTranslatedSVGProperties(this.#To(),this.parentDimensions),{bbox:this.#Po()}))}_onStartDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:true}})}_onStopDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:false}})}commit(){super.commit();this.disableEditMode();this.disableEditing()}disableEditing(){super.disableEditing();this.div.classList.toggle("disabled",true)}enableEditing(){super.enableEditing();this.div.classList.toggle("disabled",false)}getBaseTranslation(){return[0,0]}get isResizable(){return true}onceAdded(t){if(!this.annotationElementId){this.parent.addUndoableEditor(this)}this._isDraggable=true;if(this.#Ao){this.#Ao=false;this.commit();this.parent.setSelected(this);if(t&&this.isOnScreen){this.div.focus()}}}remove(){this.#ao();super.remove()}rebuild(){if(!this.parent){return}super.rebuild();if(this.div===null){return}this.#eo();this.#Co(this.#mo.box);if(!this.isAttachedToDOM){this.parent.add(this)}}setParent(t){let s=false;if(this.parent&&!t){this._uiManager.removeShouldRescale(this);this.#ao()}else if(t){this._uiManager.addShouldRescale(this);this.#eo(t);s=!this.parent&&this.div?.classList.contains("selectedEditor")}super.setParent(t);if(s){this.select()}}#ao(){if(this._drawId===null||!this.parent){return}this.parent.drawLayer.remove(this._drawId);this._drawId=null;this._drawingOptions.reset()}#eo(t=this.parent){if(this._drawId!==null&&this.parent===t){return}if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll();this._drawId=this.#Eo(this.#mo,t)}#No([t,s,e,i]){const{parentDimensions:[n,r],rotation:o}=this;switch(o){case 90:return[s,1-t,e*(r/n),i*(n/r)];case 180:return[1-t,1-s,e,i];case 270:return[1-s,t,e*(r/n),i*(n/r)];default:return[t,s,e,i]}}#To(){const{x:t,y:s,width:e,height:i,parentDimensions:[n,r],rotation:o}=this;switch(o){case 90:return[1-s,t,e*(n/r),i*(r/n)];case 180:return[1-t,1-s,e,i];case 270:return[s,1-t,e*(n/r),i*(r/n)];default:return[t,s,e,i]}}#Co(t){[this.x,this.y,this.width,this.height]=this.#No(t);if(this.div){this.fixAndSetPosition();const[t,s]=this.parentDimensions;this.setDims(this.width*t,this.height*s)}this._onResized()}#Po(){const{x:t,y:s,width:e,height:i,rotation:n,parentRotation:r,parentDimensions:[o,h]}=this;switch((n*4+r)/90){case 1:return[1-s-i,t,i,e];case 2:return[1-t-e,1-s-i,e,i];case 3:return[s,1-t-e,i,e];case 4:return[t,s-e*(o/h),i*(h/o),e*(o/h)];case 5:return[1-s,t,e*(o/h),i*(h/o)];case 6:return[1-t-i*(h/o),1-s,i*(h/o),e*(o/h)];case 7:return[s-e*(o/h),1-t-i*(h/o),e*(o/h),i*(h/o)];case 8:return[t-e,s-i,e,i];case 9:return[1-s,t-e,i,e];case 10:return[1-t,1-s,e,i];case 11:return[s-i,1-t,i,e];case 12:return[t-i*(h/o),s,i*(h/o),e*(o/h)];case 13:return[1-s-e*(o/h),t-i*(h/o),e*(o/h),i*(h/o)];case 14:return[1-t,1-s-e*(o/h),i*(h/o),e*(o/h)];case 15:return[s,1-t,e*(o/h),i*(h/o)];default:return[t,s,e,i]}}rotate(){if(!this.parent){return}this.parent.drawLayer.updateProperties(this._drawId,Yi._mergeSVGProperties({bbox:this.#Po()},this.#mo.updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){if(!this.parent){return}this.#Co(this.#mo.updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div){return this.div}let t,s;if(this._isCopy){t=this.x;s=this.y}const e=super.render();e.classList.add("draw");const i=document.createElement("div");e.append(i);i.setAttribute("aria-hidden","true");i.className="internal";const[n,r]=this.parentDimensions;this.setDims(this.width*n,this.height*r);this._uiManager.addShouldRescale(this);this.disableEditing();if(this._isCopy){this._moveAfterPaste(t,s)}return e}static createDrawerInstance(t,s,e,i,n){C("Not implemented")}static startDrawing(t,s,e,i){const{target:n,offsetX:r,offsetY:o,pointerId:h,pointerType:a}=i;if(Yi.#xo&&Yi.#xo!==a){return}const{viewport:{rotation:c}}=t;const{width:l,height:u}=n.getBoundingClientRect();const f=Yi.#bo=new AbortController;const d=t.combinedSignal(f);Yi.#vo||=h;Yi.#xo??=a;window.addEventListener("pointerup",(t=>{if(Yi.#vo===t.pointerId){this._endDraw(t)}else{Yi.#Mo?.delete(t.pointerId)}}),{signal:d});window.addEventListener("pointercancel",(t=>{if(Yi.#vo===t.pointerId){this._currentParent.endDrawingSession()}else{Yi.#Mo?.delete(t.pointerId)}}),{signal:d});window.addEventListener("pointerdown",(t=>{if(Yi.#xo!==t.pointerType){return}(Yi.#Mo||=new Set).add(t.pointerId);if(Yi.#wo.isCancellable()){Yi.#wo.removeLastElement();if(Yi.#wo.isEmpty()){this._currentParent.endDrawingSession(true)}else{this._endDraw(null)}}}),{capture:true,passive:false,signal:d});window.addEventListener("contextmenu",gt,{signal:d});n.addEventListener("pointermove",this._drawMove.bind(this),{signal:d});n.addEventListener("touchmove",(t=>{if(t.timeStamp===Yi.#ko){mt(t)}}),{signal:d});t.toggleDrawing();s._editorUndoBar?.hide();if(Yi.#wo){t.drawLayer.updateProperties(this._currentDrawId,Yi.#wo.startNew(r,o,l,u,c));return}s.updateUIForDefaultProperties(this);Yi.#wo=this.createDrawerInstance(r,o,l,u,c);Yi.#yo=this.getDefaultDrawingOptions();this._currentParent=t;({id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(Yi.#yo.toSVGProperties(),Yi.#wo.defaultSVGProperties),true,false))}static _drawMove(t){Yi.#ko=-1;if(!Yi.#wo){return}const{offsetX:s,offsetY:e,pointerId:i}=t;if(Yi.#vo!==i){return}if(Yi.#Mo?.size>=1){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,Yi.#wo.add(s,e));Yi.#ko=t.timeStamp;mt(t)}static _cleanup(t){if(t){this._currentDrawId=-1;this._currentParent=null;Yi.#wo=null;Yi.#yo=null;Yi.#xo=null;Yi.#ko=NaN}if(Yi.#bo){Yi.#bo.abort();Yi.#bo=null;Yi.#vo=NaN;Yi.#Mo=null}}static _endDraw(t){const s=this._currentParent;if(!s){return}s.toggleDrawing(true);this._cleanup(false);if(t?.target===s.div){s.drawLayer.updateProperties(this._currentDrawId,Yi.#wo.end(t.offsetX,t.offsetY))}if(this.supportMultipleDrawings){const t=Yi.#wo;const e=this._currentDrawId;const i=t.getLastElement();s.addCommands({cmd:()=>{s.drawLayer.updateProperties(e,t.setLastElement(i))},undo:()=>{s.drawLayer.updateProperties(e,t.removeLastElement())},mustExec:false,type:f.DRAW_STEP});return}this.endDrawing(false)}static endDrawing(t){const s=this._currentParent;if(!s){return null}s.toggleDrawing(true);s.cleanUndoStack(f.DRAW_STEP);if(!Yi.#wo.isEmpty()){const{pageDimensions:[e,i],scale:n}=s;const r=s.createAndAddNewEditor({offsetX:0,offsetY:0},false,{drawId:this._currentDrawId,drawOutlines:Yi.#wo.getOutlines(e*n,i*n,n,this._INNER_MARGIN),drawingOptions:Yi.#yo,mustBeCommitted:!t});this._cleanup(true);return r}s.drawLayer.remove(this._currentDrawId);this._cleanup(true);return null}createDrawingOptions(t){}static deserializeDraw(t,s,e,i,n,r){C("Not implemented")}static async deserialize(t,s,e){const{rawDims:{pageWidth:i,pageHeight:n,pageX:r,pageY:o}}=s.viewport;const h=this.deserializeDraw(r,o,i,n,this._INNER_MARGIN,t);const a=await super.deserialize(t,s,e);a.createDrawingOptions(t);a.#So({drawOutlines:h});a.#eo();a.onScaleChanging();a.rotate();return a}serializeDraw(t){const[s,e]=this.pageTranslation;const[i,n]=this.pageDimensions;return this.#mo.serialize([s,e,i,n],t)}renderAnnotationElement(t){t.updateEdited({rect:this.getRect(0,0)});return null}static canCreateNewEmptyEditor(){return false}}class Qi{#qn=new Float64Array(6);#bn;#Io;#si;#ir;#nr;#Do="";#Ro=0;#Er=new Ki;#$o;#Fo;constructor(t,s,e,i,n,r){this.#$o=e;this.#Fo=i;this.#si=n;this.#ir=r;[t,s]=this.#_o(t,s);const o=this.#bn=[NaN,NaN,NaN,NaN,t,s];this.#nr=[t,s];this.#Io=[{line:o,points:this.#nr}];this.#qn.set(o,0)}updateProperty(t,s){if(t==="stroke-width"){this.#ir=s}}#_o(t,s){return Li._normalizePoint(t,s,this.#$o,this.#Fo,this.#si)}isEmpty(){return!this.#Io||this.#Io.length===0}isCancellable(){return this.#nr.length<=10}add(t,s){[t,s]=this.#_o(t,s);const[e,i,n,r]=this.#qn.subarray(2,6);const o=t-n;const h=s-r;const a=Math.hypot(this.#$o*o,this.#Fo*h);if(a<=2){return null}this.#nr.push(t,s);if(isNaN(e)){this.#qn.set([n,r,t,s],2);this.#bn.push(NaN,NaN,NaN,NaN,t,s);return{path:{d:this.toSVGPath()}}}if(isNaN(this.#qn[0])){this.#bn.splice(6,6)}this.#qn.set([e,i,n,r,t,s],0);this.#bn.push(...Li.createBezierPoints(e,i,n,r,t,s));return{path:{d:this.toSVGPath()}}}end(t,s){const e=this.add(t,s);if(e){return e}if(this.#nr.length===2){return{path:{d:this.toSVGPath()}}}return null}startNew(t,s,e,i,n){this.#$o=e;this.#Fo=i;this.#si=n;[t,s]=this.#_o(t,s);const r=this.#bn=[NaN,NaN,NaN,NaN,t,s];this.#nr=[t,s];const o=this.#Io.at(-1);if(o){o.line=new Float32Array(o.line);o.points=new Float32Array(o.points)}this.#Io.push({line:r,points:this.#nr});this.#qn.set(r,0);this.#Ro=0;this.toSVGPath();return null}getLastElement(){return this.#Io.at(-1)}setLastElement(t){if(!this.#Io){return this.#Er.setLastElement(t)}this.#Io.push(t);this.#bn=t.line;this.#nr=t.points;this.#Ro=0;return{path:{d:this.toSVGPath()}}}removeLastElement(){if(!this.#Io){return this.#Er.removeLastElement()}this.#Io.pop();this.#Do="";for(let t=0,s=this.#Io.length;t<s;t++){const{line:s,points:e}=this.#Io[t];this.#bn=s;this.#nr=e;this.#Ro=0;this.toSVGPath()}return{path:{d:this.#Do}}}toSVGPath(){const t=Li.svgRound(this.#bn[4]);const s=Li.svgRound(this.#bn[5]);if(this.#nr.length===2){this.#Do=`${this.#Do} M ${t} ${s} Z`;return this.#Do}if(this.#nr.length<=6){const e=this.#Do.lastIndexOf("M");this.#Do=`${this.#Do.slice(0,e)} M ${t} ${s}`;this.#Ro=6}if(this.#nr.length===4){const t=Li.svgRound(this.#bn[10]);const s=Li.svgRound(this.#bn[11]);this.#Do=`${this.#Do} L ${t} ${s}`;this.#Ro=12;return this.#Do}const e=[];if(this.#Ro===0){e.push(`M ${t} ${s}`);this.#Ro=6}for(let t=this.#Ro,s=this.#bn.length;t<s;t+=6){const[s,i,n,r,o,h]=this.#bn.slice(t,t+6).map(Li.svgRound);e.push(`C${s} ${i} ${n} ${r} ${o} ${h}`)}this.#Do+=e.join(" ");this.#Ro=this.#bn.length;return this.#Do}getOutlines(t,s,e,i){const n=this.#Io.at(-1);n.line=new Float32Array(n.line);n.points=new Float32Array(n.points);this.#Er.build(this.#Io,t,s,e,this.#si,this.#ir,i);this.#qn=null;this.#bn=null;this.#Io=null;this.#Do=null;return this.#Er}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:true},bbox:[0,0,1,1]}}}class Ki extends Li{#gr;#Oo=0;#Yn;#Io;#$o;#Fo;#Lo;#si;#ir;build(t,s,e,i,n,r,o){this.#$o=s;this.#Fo=e;this.#Lo=i;this.#si=n;this.#ir=r;this.#Yn=o??0;this.#Io=t;this.#Bo()}get thickness(){return this.#ir}setLastElement(t){this.#Io.push(t);return{path:{d:this.toSVGPath()}}}removeLastElement(){this.#Io.pop();return{path:{d:this.toSVGPath()}}}toSVGPath(){const t=[];for(const{line:s}of this.#Io){t.push(`M${Li.svgRound(s[4])} ${Li.svgRound(s[5])}`);if(s.length===6){t.push("Z");continue}if(s.length===12&&isNaN(s[6])){t.push(`L${Li.svgRound(s[10])} ${Li.svgRound(s[11])}`);continue}for(let e=6,i=s.length;e<i;e+=6){const[i,n,r,o,h,a]=s.subarray(e,e+6).map(Li.svgRound);t.push(`C${i} ${n} ${r} ${o} ${h} ${a}`)}}return t.join("")}serialize([t,s,e,i],n){const r=[];const o=[];const[h,a,c,l]=this.#Uo();let u,f,d,p,g,m,A,w,b;switch(this.#si){case 0:b=Li._rescale;u=t;f=s+i;d=e;p=-i;g=t+h*e;m=s+(1-a-l)*i;A=t+(h+c)*e;w=s+(1-a)*i;break;case 90:b=Li._rescaleAndSwap;u=t;f=s;d=e;p=i;g=t+a*e;m=s+h*i;A=t+(a+l)*e;w=s+(h+c)*i;break;case 180:b=Li._rescale;u=t+e;f=s;d=-e;p=i;g=t+(1-h-c)*e;m=s+a*i;A=t+(1-h)*e;w=s+(a+l)*i;break;case 270:b=Li._rescaleAndSwap;u=t+e;f=s+i;d=-e;p=-i;g=t+(1-a-l)*e;m=s+(1-h-c)*i;A=t+(1-a)*e;w=s+(1-h)*i;break}for(const{line:t,points:s}of this.#Io){r.push(b(t,u,f,d,p,n?new Array(t.length):null));o.push(b(s,u,f,d,p,n?new Array(s.length):null))}return{lines:r,points:o,rect:[g,m,A,w]}}static deserialize(t,s,e,i,n,{paths:{lines:r,points:o},rotation:h,thickness:a}){const c=[];let l,u,f,d,p;switch(h){case 0:p=Li._rescale;l=-t/e;u=s/i+1;f=1/e;d=-1/i;break;case 90:p=Li._rescaleAndSwap;l=-s/i;u=-t/e;f=1/i;d=1/e;break;case 180:p=Li._rescale;l=t/e+1;u=-s/i;f=-1/e;d=1/i;break;case 270:p=Li._rescaleAndSwap;l=s/i+1;u=t/e+1;f=-1/i;d=-1/e;break}if(!r){r=[];for(const t of o){const s=t.length;if(s===2){r.push(new Float32Array([NaN,NaN,NaN,NaN,t[0],t[1]]));continue}if(s===4){r.push(new Float32Array([NaN,NaN,NaN,NaN,t[0],t[1],NaN,NaN,NaN,NaN,t[2],t[3]]));continue}const e=new Float32Array(3*(s-2));r.push(e);let[i,n,o,h]=t.subarray(0,4);e.set([NaN,NaN,NaN,NaN,i,n],0);for(let r=4;r<s;r+=2){const s=t[r];const a=t[r+1];e.set(Li.createBezierPoints(i,n,o,h,s,a),(r-2)*3);[i,n,o,h]=[o,h,s,a]}}}for(let t=0,s=r.length;t<s;t++){c.push({line:p(r[t].map((t=>t??NaN)),l,u,f,d),points:p(o[t].map((t=>t??NaN)),l,u,f,d)})}const g=new this.prototype.constructor;g.build(c,e,i,1,h,a,n);return g}#jo(t=this.#ir){const s=this.#Yn+t/2*this.#Lo;return this.#si%180===0?[s/this.#$o,s/this.#Fo]:[s/this.#Fo,s/this.#$o]}#Uo(){const[t,s,e,i]=this.#gr;const[n,r]=this.#jo(0);return[t+n,s+r,e-2*n,i-2*r]}#Bo(){const t=this.#gr=new Float32Array([Infinity,Infinity,-Infinity,-Infinity]);for(const{line:s}of this.#Io){if(s.length<=12){for(let e=4,i=s.length;e<i;e+=6){X.pointBoundingBox(s[e],s[e+1],t)}continue}let e=s[4],i=s[5];for(let n=6,r=s.length;n<r;n+=6){const[r,o,h,a,c,l]=s.subarray(n,n+6);X.bezierBoundingBox(e,i,r,o,h,a,c,l,t);e=c;i=l}}const[s,e]=this.#jo();t[0]=st(t[0]-s,0,1);t[1]=st(t[1]-e,0,1);t[2]=st(t[2]+s,0,1);t[3]=st(t[3]+e,0,1);t[2]-=t[0];t[3]-=t[1]}get box(){return this.#gr}updateProperty(t,s){if(t==="stroke-width"){return this.#ro(s)}return null}#ro(t){const[s,e]=this.#jo();this.#ir=t;const[i,n]=this.#jo();const[r,o]=[i-s,n-e];const h=this.#gr;h[0]-=r;h[1]-=o;h[2]+=2*r;h[3]+=2*o;return h}updateParentDimensions([t,s],e){const[i,n]=this.#jo();this.#$o=t;this.#Fo=s;this.#Lo=e;const[r,o]=this.#jo();const h=r-i;const a=o-n;const c=this.#gr;c[0]-=h;c[1]-=a;c[2]+=2*h;c[3]+=2*a;return c}updateRotation(t){this.#Oo=t;return{path:{transform:this.rotationTransform}}}get viewBox(){return this.#gr.map(Li.svgRound).join(" ")}get defaultProperties(){const[t,s]=this.#gr;return{root:{viewBox:this.viewBox},path:{"transform-origin":`${Li.svgRound(t)} ${Li.svgRound(s)}`}}}get rotationTransform(){const[,,t,s]=this.#gr;let e=0,i=0,n=0,r=0,o=0,h=0;switch(this.#Oo){case 90:i=s/t;n=-t/s;o=t;break;case 180:e=-1;r=-1;o=t;h=s;break;case 270:i=-s/t;n=t/s;h=s;break;default:return""}return`matrix(${e} ${i} ${n} ${r} ${Li.svgRound(o)} ${Li.svgRound(h)})`}getPathResizingSVGProperties([t,s,e,i]){const[n,r]=this.#jo();const[o,h,a,c]=this.#gr;if(Math.abs(a-n)<=Li.PRECISION||Math.abs(c-r)<=Li.PRECISION){const n=t+e/2-(o+a/2);const r=s+i/2-(h+c/2);return{path:{"transform-origin":`${Li.svgRound(t)} ${Li.svgRound(s)}`,transform:`${this.rotationTransform} translate(${n} ${r})`}}}const l=(e-2*n)/(a-2*n);const u=(i-2*r)/(c-2*r);const f=a/e;const d=c/i;return{path:{"transform-origin":`${Li.svgRound(o)} ${Li.svgRound(h)}`,transform:`${this.rotationTransform} scale(${f} ${d}) `+`translate(${Li.svgRound(n)} ${Li.svgRound(r)}) scale(${l} ${u}) `+`translate(${Li.svgRound(-n)} ${Li.svgRound(-r)})`}}}getPathResizedSVGProperties([t,s,e,i]){const[n,r]=this.#jo();const o=this.#gr;const[h,a,c,l]=o;o[0]=t;o[1]=s;o[2]=e;o[3]=i;if(Math.abs(c-n)<=Li.PRECISION||Math.abs(l-r)<=Li.PRECISION){const n=t+e/2-(h+c/2);const r=s+i/2-(a+l/2);for(const{line:t,points:s}of this.#Io){Li._translate(t,n,r,t);Li._translate(s,n,r,s)}return{root:{viewBox:this.viewBox},path:{"transform-origin":`${Li.svgRound(t)} ${Li.svgRound(s)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const u=(e-2*n)/(c-2*n);const f=(i-2*r)/(l-2*r);const d=-u*(h+n)+t+n;const p=-f*(a+r)+s+r;if(u!==1||f!==1||d!==0||p!==0){for(const{line:t,points:s}of this.#Io){Li._rescale(t,d,p,u,f,t);Li._rescale(s,d,p,u,f,s)}}return{root:{viewBox:this.viewBox},path:{"transform-origin":`${Li.svgRound(t)} ${Li.svgRound(s)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,s],e){const[i,n]=e;const r=this.#gr;const o=t-r[0];const h=s-r[1];if(this.#$o===i&&this.#Fo===n){for(const{line:t,points:s}of this.#Io){Li._translate(t,o,h,t);Li._translate(s,o,h,s)}}else{const t=this.#$o/i;const s=this.#Fo/n;this.#$o=i;this.#Fo=n;for(const{line:e,points:i}of this.#Io){Li._rescale(e,o,h,t,s,e);Li._rescale(i,o,h,t,s,i)}r[2]*=t;r[3]*=s}r[0]=t;r[1]=s;return{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${Li.svgRound(t)} ${Li.svgRound(s)}`}}}get defaultSVGProperties(){const t=this.#gr;return{root:{viewBox:this.viewBox},rootClass:{draw:true},path:{d:this.toSVGPath(),"transform-origin":`${Li.svgRound(t[0])} ${Li.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}}class qi extends Xi{constructor(t){super();this._viewParameters=t;super.updateProperties({fill:"none",stroke:Ot._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(t,s){if(t==="stroke-width"){s??=this["stroke-width"];s*=this._viewParameters.realScale}super.updateSVGProperty(t,s)}clone(){const t=new qi(this._viewParameters);t.updateAll(this);return t}}class Ji extends Yi{static _type="ink";static _editorType=u.INK;static _defaultDrawingOptions=null;constructor(t){super({...t,name:"inkEditor"});this._willKeepAspectRatio=true;this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(t,s){Ot.initialize(t,s);this._defaultDrawingOptions=new qi(s.viewParameters)}static getDefaultDrawingOptions(t){const s=this._defaultDrawingOptions.clone();s.updateProperties(t);return s}static get supportMultipleDrawings(){return true}static get typesMap(){return D(this,"typesMap",new Map([[f.INK_THICKNESS,"stroke-width"],[f.INK_COLOR,"stroke"],[f.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,s,e,i,n){return new Qi(t,s,e,i,n,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,s,e,i,n,r){return Ki.deserialize(t,s,e,i,n,r)}static async deserialize(t,s,e){let i=null;if(t instanceof Ti){const{data:{inkLists:s,rect:e,rotation:n,id:r,color:o,opacity:h,borderStyle:{rawWidth:a},popupRef:c},parent:{page:{pageNumber:l}}}=t;i=t={annotationType:u.INK,color:Array.from(o),thickness:a,opacity:h,paths:{points:s},boxes:null,pageIndex:l-1,rect:e.slice(0),rotation:n,id:r,deleted:false,popupRef:c}}const n=await super.deserialize(t,s,e);n.annotationElementId=t.id||null;n._initialData=i;return n}onScaleChanging(){if(!this.parent){return}super.onScaleChanging();const{_drawId:t,_drawingOptions:s,parent:e}=this;s.updateSVGProperty("stroke-width");e.drawLayer.updateProperties(t,s.toSVGProperties())}static onScaleChangingWhenDrawing(){const t=this._currentParent;if(!t){return}super.onScaleChangingWhenDrawing();this._defaultDrawingOptions.updateSVGProperty("stroke-width");t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties())}createDrawingOptions({color:t,thickness:s,opacity:e}){this._drawingOptions=Ji.getDefaultDrawingOptions({stroke:X.makeHexColor(...t),"stroke-width":s,"stroke-opacity":e})}serialize(t=false){if(this.isEmpty()){return null}if(this.deleted){return this.serializeDeleted()}const{lines:s,points:e,rect:i}=this.serializeDraw(t);const{_drawingOptions:{stroke:n,"stroke-opacity":r,"stroke-width":o}}=this;const h={annotationType:u.INK,color:Ot._colorManager.convert(n),opacity:r,thickness:o,paths:{lines:s,points:e},pageIndex:this.pageIndex,rect:i,rotation:this.rotation,structTreeParentId:this._structTreeParentId};if(t){h.isCopy=true;return h}if(this.annotationElementId&&!this.#Wn(h)){return null}h.id=this.annotationElementId;return h}#Wn(t){const{color:s,thickness:e,opacity:i,pageIndex:n}=this._initialData;return this._hasBeenMoved||this._hasBeenResized||t.color.some(((t,e)=>t!==s[e]))||t.thickness!==e||t.opacity!==i||t.pageIndex!==n}renderAnnotationElement(t){const{points:s,rect:e}=this.serializeDraw(false);t.updateEdited({rect:e,thickness:this._drawingOptions["stroke-width"],points:s});return null}}class Zi extends Ki{toSVGPath(){let t=super.toSVGPath();if(!t.endsWith("Z")){t+="Z"}return t}}const tn=8;const sn=3;class en{static#Ho={maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16};static#zo(t,s,e,i){e-=t;i-=s;if(e===0){return i>0?0:4}if(e===1){return i+6}return 2-i}static#Go=new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]);static#Wo(t,s,e,i,n,r,o){const h=this.#zo(e,i,n,r);for(let n=0;n<8;n++){const r=(-n+h-o+16)%8;const a=this.#Go[2*r];const c=this.#Go[2*r+1];if(t[(e+a)*s+(i+c)]!==0){return r}}return-1}static#Vo(t,s,e,i,n,r,o){const h=this.#zo(e,i,n,r);for(let n=0;n<8;n++){const r=(n+h+o+16)%8;const a=this.#Go[2*r];const c=this.#Go[2*r+1];if(t[(e+a)*s+(i+c)]!==0){return r}}return-1}static#Xo(t,s,e,i){const n=t.length;const r=new Int32Array(n);for(let s=0;s<n;s++){r[s]=t[s]<=i?1:0}for(let t=1;t<e-1;t++){r[t*s]=r[t*s+s-1]=0}for(let t=0;t<s;t++){r[t]=r[s*e-1-t]=0}let o=1;let h;const a=[];for(let t=1;t<e-1;t++){h=1;for(let e=1;e<s-1;e++){const i=t*s+e;const n=r[i];if(n===0){continue}let c=t;let l=e;if(n===1&&r[i-1]===0){o+=1;l-=1}else if(n>=1&&r[i+1]===0){o+=1;l+=1;if(n>1){h=n}}else{if(n!==1){h=Math.abs(n)}continue}const u=[e,t];const f=l===e+1;const d={isHole:f,points:u,id:o,parent:0};a.push(d);let p;for(const t of a){if(t.id===h){p=t;break}}if(!p){d.parent=f?h:0}else if(p.isHole){d.parent=f?p.parent:h}else{d.parent=f?h:p.parent}const g=this.#Wo(r,s,t,e,c,l,0);if(g===-1){r[i]=-o;if(r[i]!==1){h=Math.abs(r[i])}continue}let m=this.#Go[2*g];let A=this.#Go[2*g+1];const w=t+m;const b=e+A;c=w;l=b;let y=t;let v=e;while(true){const n=this.#Vo(r,s,y,v,c,l,1);m=this.#Go[2*n];A=this.#Go[2*n+1];const a=y+m;const f=v+A;u.push(f,a);const d=y*s+v;if(r[d+1]===0){r[d]=-o}else if(r[d]===1){r[d]=o}if(a===t&&f===e&&y===w&&v===b){if(r[i]!==1){h=Math.abs(r[i])}break}else{c=y;l=v;y=a;v=f}}}}return a}static#Yo(t,s,e,i){if(e-s<=4){for(let n=s;n<e-2;n+=2){i.push(t[n],t[n+1])}return}const n=t[s];const r=t[s+1];const o=t[e-4]-n;const h=t[e-3]-r;const a=Math.hypot(o,h);const c=o/a;const l=h/a;const u=c*r-l*n;const f=h/o;const d=1/a;const p=Math.atan(f);const g=Math.cos(p);const m=Math.sin(p);const A=d*(Math.abs(g)+Math.abs(m));const w=d*(1-A+A**2);const b=Math.max(Math.atan(Math.abs(m+g)*w),Math.atan(Math.abs(m-g)*w));let y=0;let v=s;for(let i=s+2;i<e-2;i+=2){const s=Math.abs(u-c*t[i+1]+l*t[i]);if(s>y){v=i;y=s}}if(y>(a*b)**2){this.#Yo(t,s,v+2,i);this.#Yo(t,v,e,i)}else{i.push(n,r)}}static#Qo(t){const s=[];const e=t.length;this.#Yo(t,0,e,s);s.push(t[e-2],t[e-1]);return s.length<=4?null:s}static#Ko(t,s,e,i,n,r){const o=new Float32Array(r**2);const h=-2*i**2;const a=r>>1;for(let t=0;t<r;t++){const s=(t-a)**2;for(let e=0;e<r;e++){o[t*r+e]=Math.exp((s+(e-a)**2)/h)}}const c=new Float32Array(256);const l=-2*n**2;for(let t=0;t<256;t++){c[t]=Math.exp(t**2/l)}const u=t.length;const f=new Uint8Array(u);const d=new Uint32Array(256);for(let i=0;i<e;i++){for(let n=0;n<s;n++){const h=i*s+n;const l=t[h];let u=0;let p=0;for(let h=0;h<r;h++){const f=i+h-a;if(f<0||f>=e){continue}for(let e=0;e<r;e++){const i=n+e-a;if(i<0||i>=s){continue}const d=t[f*s+i];const g=o[h*r+e]*c[Math.abs(d-l)];u+=d*g;p+=g}}const g=f[h]=Math.round(u/p);d[g]++}}return[f,d]}static#qo(t){const s=new Uint32Array(256);for(const e of t){s[e]++}return s}static#Jo(t){const s=t.length;const e=new Uint8ClampedArray(s>>2);let i=-Infinity;let n=Infinity;for(let s=0,r=e.length;s<r;s++){const r=t[(s<<2)+3];if(r===0){i=e[s]=255;continue}const o=e[s]=t[s<<2];if(o>i){i=o}if(o<n){n=o}}const r=255/(i-n);for(let t=0;t<s;t++){e[t]=(e[t]-n)*r}return e}static#Zo(t){let s;let e=-Infinity;let i=-Infinity;const n=t.findIndex((t=>t!==0));let r=n;let o=n;for(s=n;s<256;s++){const n=t[s];if(n>e){if(s-r>i){i=s-r;o=s-1}e=n;r=s}}for(s=o-1;s>=0;s--){if(t[s]>t[s+1]){break}}return s}static#th(t){const s=t;const{width:e,height:i}=t;const{maxDim:n}=this.#Ho;let r=e;let o=i;if(e>n||i>n){let h=e;let a=i;let c=Math.log2(Math.max(e,i)/n);const l=Math.floor(c);c=c===l?l-1:l;for(let e=0;e<c;e++){r=h;o=a;if(r>n){r=Math.ceil(r/2)}if(o>n){o=Math.ceil(o/2)}const e=new OffscreenCanvas(r,o);const i=e.getContext("2d");i.drawImage(t,0,0,h,a,0,0,r,o);h=r;a=o;if(t!==s){t.close()}t=e.transferToImageBitmap()}const u=Math.min(n/r,n/o);r=Math.round(r*u);o=Math.round(o*u)}const h=new OffscreenCanvas(r,o);const a=h.getContext("2d",{willReadFrequently:true});a.filter="grayscale(1)";a.drawImage(t,0,0,t.width,t.height,0,0,r,o);const c=a.getImageData(0,0,r,o).data;const l=this.#Jo(c);return[l,r,o]}static extractContoursFromText(t,{fontFamily:s,fontStyle:e,fontWeight:i},n,r,o,h){let a=new OffscreenCanvas(1,1);let c=a.getContext("2d",{alpha:false});const l=200;const u=c.font=`${e} ${i} ${l}px ${s}`;const{actualBoundingBoxLeft:f,actualBoundingBoxRight:d,actualBoundingBoxAscent:p,actualBoundingBoxDescent:g,fontBoundingBoxAscent:m,fontBoundingBoxDescent:A,width:w}=c.measureText(t);const b=1.5;const y=Math.ceil(Math.max(Math.abs(f)+Math.abs(d)||0,w)*b);const v=Math.ceil(Math.max(Math.abs(p)+Math.abs(g)||l,Math.abs(m)+Math.abs(A)||l)*b);a=new OffscreenCanvas(y,v);c=a.getContext("2d",{alpha:true,willReadFrequently:true});c.font=u;c.filter="grayscale(1)";c.fillStyle="white";c.fillRect(0,0,y,v);c.fillStyle="black";c.fillText(t,y*(b-1)/2,v*(3-b)/2);const x=this.#Jo(c.getImageData(0,0,y,v).data);const M=this.#qo(x);const k=this.#Zo(M);const S=this.#Xo(x,y,v,k);return this.processDrawnLines({lines:{curves:S,width:y,height:v},pageWidth:n,pageHeight:r,rotation:o,innerMargin:h,mustSmooth:true,areContours:true})}static process(t,s,e,i,n){const[r,o,h]=this.#th(t);const[a,c]=this.#Ko(r,o,h,Math.hypot(o,h)*this.#Ho.sigmaSFactor,this.#Ho.sigmaR,this.#Ho.kernelSize);const l=this.#Zo(c);const u=this.#Xo(a,o,h,l);return this.processDrawnLines({lines:{curves:u,width:o,height:h},pageWidth:s,pageHeight:e,rotation:i,innerMargin:n,mustSmooth:true,areContours:true})}static processDrawnLines({lines:t,pageWidth:s,pageHeight:e,rotation:i,innerMargin:n,mustSmooth:r,areContours:o}){if(i%180!==0){[s,e]=[e,s]}const{curves:h,width:a,height:c}=t;const l=t.thickness??0;const u=[];const f=Math.min(s/a,e/c);const d=f/s;const p=f/e;const g=[];for(const{points:t}of h){const s=r?this.#Qo(t):t;if(!s){continue}g.push(s);const e=s.length;const i=new Float32Array(e);const n=new Float32Array(3*(e===2?2:e-2));u.push({line:n,points:i});if(e===2){i[0]=s[0]*d;i[1]=s[1]*p;n.set([NaN,NaN,NaN,NaN,i[0],i[1]],0);continue}let[o,h,a,c]=s;o*=d;h*=p;a*=d;c*=p;i.set([o,h,a,c],0);n.set([NaN,NaN,NaN,NaN,o,h],0);for(let t=4;t<e;t+=2){const e=i[t]=s[t]*d;const r=i[t+1]=s[t+1]*p;n.set(Li.createBezierPoints(o,h,a,c,e,r),(t-2)*3);[o,h,a,c]=[a,c,e,r]}}if(u.length===0){return null}const m=o?new Zi:new Ki;m.build(u,s,e,1,i,o?0:l,n);return{outline:m,newCurves:g,areContours:o,thickness:l,width:a,height:c}}static async compressSignature({outlines:t,areContours:s,thickness:e,width:i,height:n}){let r=Infinity;let o=-Infinity;let h=0;for(const s of t){h+=s.length;for(let t=2,e=s.length;t<e;t++){const e=s[t]-s[t-2];r=Math.min(r,e);o=Math.max(o,e)}}let a;if(r>=-128&&o<=127){a=Int8Array}else if(r>=-32768&&o<=32767){a=Int16Array}else{a=Int32Array}const c=t.length;const l=tn+sn*c;const u=new Uint32Array(l);let f=0;u[f++]=l*Uint32Array.BYTES_PER_ELEMENT+(h-2*c)*a.BYTES_PER_ELEMENT;u[f++]=0;u[f++]=i;u[f++]=n;u[f++]=s?0:1;u[f++]=Math.max(0,Math.floor(e??0));u[f++]=c;u[f++]=a.BYTES_PER_ELEMENT;for(const s of t){u[f++]=s.length-2;u[f++]=s[0];u[f++]=s[1]}const d=new CompressionStream("deflate-raw");const p=d.writable.getWriter();await p.ready;p.write(u);const g=a.prototype.constructor;for(const s of t){const t=new g(s.length-2);for(let e=2,i=s.length;e<i;e++){t[e-2]=s[e]-s[e-2]}p.write(t)}p.close();const m=await new Response(d.readable).arrayBuffer();const A=new Uint8Array(m);return et(A)}static async decompressSignature(t){try{const s=it(t);const{readable:e,writable:i}=new DecompressionStream("deflate-raw");const n=i.getWriter();await n.ready;n.write(s).then((async()=>{await n.ready;await n.close()})).catch((()=>{}));let r=null;let o=0;for await(const t of e){r||=new Uint8Array(new Uint32Array(t.buffer,0,4)[0]);r.set(t,o);o+=t.length}const h=new Uint32Array(r.buffer,0,r.length>>2);const a=h[1];if(a!==0){throw new Error(`Invalid version: ${a}`)}const c=h[2];const l=h[3];const u=h[4]===0;const f=h[5];const d=h[6];const p=h[7];const g=[];const m=(tn+sn*d)*Uint32Array.BYTES_PER_ELEMENT;let A;switch(p){case Int8Array.BYTES_PER_ELEMENT:A=new Int8Array(r.buffer,m);break;case Int16Array.BYTES_PER_ELEMENT:A=new Int16Array(r.buffer,m);break;case Int32Array.BYTES_PER_ELEMENT:A=new Int32Array(r.buffer,m);break}o=0;for(let t=0;t<d;t++){const s=h[sn*t+tn];const e=new Float32Array(s+2);g.push(e);for(let s=0;s<sn-1;s++){e[s]=h[sn*t+tn+s+1]}for(let t=0;t<s;t++){e[t+2]=e[t]+A[o++]}}return{areContours:u,thickness:f,outlines:g,width:c,height:l}}catch(t){E(`decompressSignature: ${t}`);return null}}}class nn extends Xi{constructor(){super();super.updateProperties({fill:Ot._defaultLineColor,"stroke-width":0})}clone(){const t=new nn;t.updateAll(this);return t}}class rn extends qi{constructor(t){super(t);super.updateProperties({stroke:Ot._defaultLineColor,"stroke-width":1})}clone(){const t=new rn(this._viewParameters);t.updateAll(this);return t}}class on extends Yi{#sh=false;#eh=null;#ih=null;#nh=null;static _type="signature";static _editorType=u.SIGNATURE;static _defaultDrawingOptions=null;constructor(t){super({...t,mustBeCommitted:true,name:"signatureEditor"});this._willKeepAspectRatio=true;this.#ih=t.signatureData||null;this.#eh=null;this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(t,s){Ot.initialize(t,s);this._defaultDrawingOptions=new nn;this._defaultDrawnSignatureOptions=new rn(s.viewParameters)}static getDefaultDrawingOptions(t){const s=this._defaultDrawingOptions.clone();s.updateProperties(t);return s}static get supportMultipleDrawings(){return false}static get typesMap(){return D(this,"typesMap",new Map)}static get isDrawer(){return false}get telemetryFinalData(){return{type:"signature",hasDescription:!!this.#eh}}static computeTelemetryFinalData(t){const s=t.get("hasDescription");return{hasAltText:s.get(true)??0,hasNoAltText:s.get(false)??0}}get isResizable(){return true}onScaleChanging(){if(this._drawId===null){return}super.onScaleChanging()}render(){if(this.div){return this.div}let t,s;const{_isCopy:e}=this;if(e){this._isCopy=false;t=this.x;s=this.y}super.render();if(this._drawId===null){if(this.#ih){const{lines:t,mustSmooth:s,areContours:e,description:i,uuid:n,heightInPage:r}=this.#ih;const{rawDims:{pageWidth:o,pageHeight:h},rotation:a}=this.parent.viewport;const c=en.processDrawnLines({lines:t,pageWidth:o,pageHeight:h,rotation:a,innerMargin:on._INNER_MARGIN,mustSmooth:s,areContours:e});this.addSignature(c,r,i,n)}else{this.div.setAttribute("data-l10n-args",JSON.stringify({description:""}));this.div.hidden=true;this._uiManager.getSignature(this)}}if(e){this._isCopy=true;this._moveAfterPaste(t,s)}return this.div}setUuid(t){this.#nh=t;this.addEditToolbar()}getUuid(){return this.#nh}get description(){return this.#eh}set description(t){this.#eh=t;super.addEditToolbar().then((s=>{s?.updateEditSignatureButton(t)}))}getSignaturePreview(){const{newCurves:t,areContours:s,thickness:e,width:i,height:n}=this.#ih;const r=Math.max(i,n);const o=en.processDrawnLines({lines:{curves:t.map((t=>({points:t}))),thickness:e,width:i,height:n},pageWidth:r,pageHeight:r,rotation:0,innerMargin:0,mustSmooth:false,areContours:s});return{areContours:s,outline:o.outline}}async addEditToolbar(){const t=await super.addEditToolbar();if(!t){return null}if(this._uiManager.signatureManager&&this.#eh!==null){await t.addEditSignatureButton(this._uiManager.signatureManager,this.#nh,this.#eh);t.show()}return t}addSignature(t,s,e,i){const{x:n,y:r}=this;const{outline:o}=this.#ih=t;this.#sh=o instanceof Zi;this.#eh=e;this.div.setAttribute("data-l10n-args",JSON.stringify({description:e}));let h;if(this.#sh){h=on.getDefaultDrawingOptions()}else{h=on._defaultDrawnSignatureOptions.clone();h.updateProperties({"stroke-width":o.thickness})}this._addOutlines({drawOutlines:o,drawingOptions:h});const[a,c]=this.parentDimensions;const[,l]=this.pageDimensions;let u=s/l;u=u>=1?.5:u;this.width*=u/this.height;if(this.width>=1){u*=.9/this.width;this.width=.9}this.height=u;this.setDims(a*this.width,c*this.height);this.x=n;this.y=r;this.center();this._onResized();this.onScaleChanging();this.rotate();this._uiManager.addToAnnotationStorage(this);this.setUuid(i);this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!i,hasDescription:!!e}});this.div.hidden=false}getFromImage(t){const{rawDims:{pageWidth:s,pageHeight:e},rotation:i}=this.parent.viewport;return en.process(t,s,e,i,on._INNER_MARGIN)}getFromText(t,s){const{rawDims:{pageWidth:e,pageHeight:i},rotation:n}=this.parent.viewport;return en.extractContoursFromText(t,s,e,i,n,on._INNER_MARGIN)}getDrawnSignature(t){const{rawDims:{pageWidth:s,pageHeight:e},rotation:i}=this.parent.viewport;return en.processDrawnLines({lines:t,pageWidth:s,pageHeight:e,rotation:i,innerMargin:on._INNER_MARGIN,mustSmooth:false,areContours:false})}createDrawingOptions({areContours:t,thickness:s}){if(t){this._drawingOptions=on.getDefaultDrawingOptions()}else{this._drawingOptions=on._defaultDrawnSignatureOptions.clone();this._drawingOptions.updateProperties({"stroke-width":s})}}serialize(t=false){if(this.isEmpty()){return null}const{lines:s,points:e,rect:i}=this.serializeDraw(t);const{_drawingOptions:{"stroke-width":n}}=this;const r={annotationType:u.SIGNATURE,isSignature:true,areContours:this.#sh,color:[0,0,0],thickness:this.#sh?0:n,pageIndex:this.pageIndex,rect:i,rotation:this.rotation,structTreeParentId:this._structTreeParentId};if(t){r.paths={lines:s,points:e};r.uuid=this.#nh;r.isCopy=true}else{r.lines=s}if(this.#eh){r.accessibilityData={type:"Figure",alt:this.#eh}}return r}static deserializeDraw(t,s,e,i,n,r){if(r.areContours){return Zi.deserialize(t,s,e,i,n,r)}return Ki.deserialize(t,s,e,i,n,r)}static async deserialize(t,s,e){const i=await super.deserialize(t,s,e);i.#sh=t.areContours;i.#eh=t.accessibilityData?.alt||"";i.#nh=t.uuid;return i}}class hn extends Ot{#rh=null;#oh=null;#hh=null;#ah=null;#ch=null;#lh="";#uh=null;#fh=false;#dh=null;#ph=false;#gh=false;static _type="stamp";static _editorType=u.STAMP;constructor(t){super({...t,name:"stampEditor"});this.#ah=t.bitmapUrl;this.#ch=t.bitmapFile;this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(t,s){Ot.initialize(t,s)}static isHandlingMimeForPasting(t){return St.includes(t)}static paste(t,s){s.pasteEditor(u.STAMP,{bitmapFile:t.getAsFile()})}altTextFinish(){if(this._uiManager.useNewAltTextFlow){this.div.hidden=false}super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(t){const s=t.get("hasAltText");return{hasAltText:s.get(true)??0,hasNoAltText:s.get(false)??0}}#mh(t,s=false){if(!t){this.remove();return}this.#rh=t.bitmap;if(!s){this.#oh=t.id;this.#ph=t.isSvg}if(t.file){this.#lh=t.file.name}this.#Ah()}#wh(){this.#hh=null;this._uiManager.enableWaiting(false);if(!this.#uh){return}if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#rh){this._editToolbar.hide();this._uiManager.editAltText(this,true);return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#rh){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:false,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}async mlGuessAltText(t=null,s=true){if(this.hasAltTextData()){return null}const{mlManager:e}=this._uiManager;if(!e){throw new Error("No ML.")}if(!await e.isEnabledFor("altText")){throw new Error("ML isn't enabled for alt text.")}const{data:i,width:n,height:r}=t||this.copyCanvas(null,null,true).imageData;const o=await e.guess({name:"altText",request:{data:i,width:n,height:r,channels:i.length/(n*r)}});if(!o){throw new Error("No response from the AI service.")}if(o.error){throw new Error("Error from the AI service.")}if(o.cancel){return null}if(!o.output){throw new Error("No valid response from the AI service.")}const h=o.output;await this.setGuessedAltText(h);if(s&&!this.hasAltTextData()){this.altTextData={alt:h,decorative:false}}return h}#bh(){if(this.#oh){this._uiManager.enableWaiting(true);this._uiManager.imageManager.getFromId(this.#oh).then((t=>this.#mh(t,true))).finally((()=>this.#wh()));return}if(this.#ah){const t=this.#ah;this.#ah=null;this._uiManager.enableWaiting(true);this.#hh=this._uiManager.imageManager.getFromUrl(t).then((t=>this.#mh(t))).finally((()=>this.#wh()));return}if(this.#ch){const t=this.#ch;this.#ch=null;this._uiManager.enableWaiting(true);this.#hh=this._uiManager.imageManager.getFromFile(t).then((t=>this.#mh(t))).finally((()=>this.#wh()));return}const t=document.createElement("input");t.type="file";t.accept=St.join(",");const s=this._uiManager._signal;this.#hh=new Promise((e=>{t.addEventListener("change",(async()=>{if(!t.files||t.files.length===0){this.remove()}else{this._uiManager.enableWaiting(true);const s=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}});this.#mh(s)}e()}),{signal:s});t.addEventListener("cancel",(()=>{this.remove();e()}),{signal:s})})).finally((()=>this.#wh()));t.click()}remove(){if(this.#oh){this.#rh=null;this._uiManager.imageManager.deleteId(this.#oh);this.#uh?.remove();this.#uh=null;if(this.#dh){clearTimeout(this.#dh);this.#dh=null}}super.remove()}rebuild(){if(!this.parent){if(this.#oh){this.#bh()}return}super.rebuild();if(this.div===null){return}if(this.#oh&&this.#uh===null){this.#bh()}if(!this.isAttachedToDOM){this.parent.add(this)}}onceAdded(t){this._isDraggable=true;if(t){this.div.focus()}}isEmpty(){return!(this.#hh||this.#rh||this.#ah||this.#ch||this.#oh||this.#fh)}get isResizable(){return true}render(){if(this.div){return this.div}let t,s;if(this._isCopy){t=this.x;s=this.y}super.render();this.div.hidden=true;this.addAltTextButton();if(!this.#fh){if(this.#rh){this.#Ah()}else{this.#bh()}}if(this._isCopy){this._moveAfterPaste(t,s)}this._uiManager.addShouldRescale(this);return this.div}setCanvas(t,s){const{id:e,bitmap:i}=this._uiManager.imageManager.getFromCanvas(t,s);s.remove();if(e&&this._uiManager.imageManager.isValidId(e)){this.#oh=e;if(i){this.#rh=i}this.#fh=false;this.#Ah()}}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent){return}if(this.#dh!==null){clearTimeout(this.#dh)}const t=200;this.#dh=setTimeout((()=>{this.#dh=null;this.#yh()}),t)}#Ah(){const{div:t}=this;let{width:s,height:e}=this.#rh;const[i,n]=this.pageDimensions;const r=.75;if(this.width){s=this.width*i;e=this.height*n}else if(s>r*i||e>r*n){const t=Math.min(r*i/s,r*n/e);s*=t;e*=t}const[o,h]=this.parentDimensions;this.setDims(s*o/i,e*h/n);this._uiManager.enableWaiting(false);const a=this.#uh=document.createElement("canvas");a.setAttribute("role","img");this.addContainer(a);this.width=s/i;this.height=e/n;if(this._initialOptions?.isCentered){this.center()}else{this.fixAndSetPosition()}this._initialOptions=null;if(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId){t.hidden=false}this.#yh();if(!this.#gh){this.parent.addUndoableEditor(this);this.#gh=true}this._reportTelemetry({action:"inserted_image"});if(this.#lh){this.div.setAttribute("aria-description",this.#lh)}}copyCanvas(t,s,e=false){if(!t){t=224}const{width:i,height:n}=this.#rh;const r=new kt;let o=this.#rh;let h=i,a=n;let c=null;if(s){if(i>s||n>s){const t=Math.min(s/i,s/n);h=Math.floor(i*t);a=Math.floor(n*t)}c=document.createElement("canvas");const t=c.width=Math.ceil(h*r.sx);const e=c.height=Math.ceil(a*r.sy);if(!this.#ph){o=this.#vh(t,e)}const l=c.getContext("2d");l.filter=this._uiManager.hcmFilter;let u="white",f="#cfcfd8";if(this._uiManager.hcmFilter!=="none"){f="black"}else if(window.matchMedia?.("(prefers-color-scheme: dark)").matches){u="#8f8f9d";f="#42414d"}const d=15;const p=d*r.sx;const g=d*r.sy;const m=new OffscreenCanvas(p*2,g*2);const A=m.getContext("2d");A.fillStyle=u;A.fillRect(0,0,p*2,g*2);A.fillStyle=f;A.fillRect(0,0,p,g);A.fillRect(p,g,p,g);l.fillStyle=l.createPattern(m,"repeat");l.fillRect(0,0,t,e);l.drawImage(o,0,0,o.width,o.height,0,0,t,e)}let l=null;if(e){let s,e;if(r.symmetric&&o.width<t&&o.height<t){s=o.width;e=o.height}else{o=this.#rh;if(i>t||n>t){const r=Math.min(t/i,t/n);s=Math.floor(i*r);e=Math.floor(n*r);if(!this.#ph){o=this.#vh(s,e)}}}const h=new OffscreenCanvas(s,e);const a=h.getContext("2d",{willReadFrequently:true});a.drawImage(o,0,0,o.width,o.height,0,0,s,e);l={width:s,height:e,data:a.getImageData(0,0,s,e).data}}return{canvas:c,width:h,height:a,imageData:l}}#vh(t,s){const{width:e,height:i}=this.#rh;let n=e;let r=i;let o=this.#rh;while(n>2*t||r>2*s){const e=n;const i=r;if(n>2*t){n=n>=16384?Math.floor(n/2)-1:Math.ceil(n/2)}if(r>2*s){r=r>=16384?Math.floor(r/2)-1:Math.ceil(r/2)}const h=new OffscreenCanvas(n,r);const a=h.getContext("2d");a.drawImage(o,0,0,e,i,0,0,n,r);o=h.transferToImageBitmap()}return o}#yh(){const[t,s]=this.parentDimensions;const{width:e,height:i}=this;const n=new kt;const r=Math.ceil(e*t*n.sx);const o=Math.ceil(i*s*n.sy);const h=this.#uh;if(!h||h.width===r&&h.height===o){return}h.width=r;h.height=o;const a=this.#ph?this.#rh:this.#vh(r,o);const c=h.getContext("2d");c.filter=this._uiManager.hcmFilter;c.drawImage(a,0,0,a.width,a.height,0,0,r,o)}#xh(t){if(t){if(this.#ph){const t=this._uiManager.imageManager.getSvgUrl(this.#oh);if(t){return t}}const t=document.createElement("canvas");({width:t.width,height:t.height}=this.#rh);const s=t.getContext("2d");s.drawImage(this.#rh,0,0);return t.toDataURL()}if(this.#ph){const[t,s]=this.pageDimensions;const e=Math.round(this.width*t*rt.PDF_TO_CSS_UNITS);const i=Math.round(this.height*s*rt.PDF_TO_CSS_UNITS);const n=new OffscreenCanvas(e,i);const r=n.getContext("2d");r.drawImage(this.#rh,0,0,this.#rh.width,this.#rh.height,0,0,e,i);return n.transferToImageBitmap()}return structuredClone(this.#rh)}static async deserialize(t,s,e){let i=null;let n=false;if(t instanceof Ri){const{data:{rect:r,rotation:o,id:h,structParent:a,popupRef:c},container:l,parent:{page:{pageNumber:f}},canvas:d}=t;let p,g;if(d){delete t.canvas;({id:p,bitmap:g}=e.imageManager.getFromCanvas(l.id,d));d.remove()}else{n=true;t._hasNoCanvas=true}const m=(await s._structTree.getAriaAttributes(`${Z}${h}`))?.get("aria-label")||"";i=t={annotationType:u.STAMP,bitmapId:p,bitmap:g,pageIndex:f-1,rect:r.slice(0),rotation:o,id:h,deleted:false,accessibilityData:{decorative:false,altText:m},isSvg:false,structParent:a,popupRef:c}}const r=await super.deserialize(t,s,e);const{rect:o,bitmap:h,bitmapUrl:a,bitmapId:c,isSvg:l,accessibilityData:f}=t;if(n){e.addMissingCanvas(t.id,r);r.#fh=true}else if(c&&e.imageManager.isValidId(c)){r.#oh=c;if(h){r.#rh=h}}else{r.#ah=a}r.#ph=l;const[d,p]=r.pageDimensions;r.width=(o[2]-o[0])/d;r.height=(o[3]-o[1])/p;r.annotationElementId=t.id||null;if(f){r.altTextData=f}r._initialData=i;r.#gh=!!i;return r}serialize(t=false,s=null){if(this.isEmpty()){return null}if(this.deleted){return this.serializeDeleted()}const e={annotationType:u.STAMP,bitmapId:this.#oh,pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:this.#ph,structTreeParentId:this._structTreeParentId};if(t){e.bitmapUrl=this.#xh(true);e.accessibilityData=this.serializeAltText(true);e.isCopy=true;return e}const{decorative:i,altText:n}=this.serializeAltText(false);if(!i&&n){e.accessibilityData={type:"Figure",alt:n}}if(this.annotationElementId){const t=this.#Wn(e);if(t.isSame){return null}if(t.isSameAltText){delete e.accessibilityData}else{e.accessibilityData.structParent=this._initialData.structParent??-1}}e.id=this.annotationElementId;if(s===null){return e}s.stamps||=new Map;const r=this.#ph?(e.rect[2]-e.rect[0])*(e.rect[3]-e.rect[1]):null;if(!s.stamps.has(this.#oh)){s.stamps.set(this.#oh,{area:r,serialized:e});e.bitmap=this.#xh(false)}else if(this.#ph){const t=s.stamps.get(this.#oh);if(r>t.area){t.area=r;t.serialized.bitmap.close();t.serialized.bitmap=this.#xh(false)}}return e}#Wn(t){const{pageIndex:s,accessibilityData:{altText:e}}=this._initialData;const i=t.pageIndex===s;const n=(t.accessibilityData?.alt||"")===e;return{isSame:!this._hasBeenMoved&&!this._hasBeenResized&&i&&n,isSameAltText:n}}renderAnnotationElement(t){t.updateEdited({rect:this.getRect(0,0)});return null}}class an{#Tn;#Mh=false;#kh=null;#Sh=null;#Eh=null;#Ch=new Map;#Th=false;#Ph=false;#Nh=false;#Ih=null;#Dh=null;#Rh=null;#$h=null;#m;static _initialized=false;static#H=new Map([Oi,Ji,hn,Vi,on].map((t=>[t._editorType,t])));constructor({uiManager:t,pageIndex:s,div:e,structTreeLayer:i,accessibilityManager:n,annotationLayer:r,drawLayer:o,textLayer:h,viewport:a,l10n:c}){const l=[...an.#H.values()];if(!an._initialized){an._initialized=true;for(const s of l){s.initialize(c,t)}}t.registerEditorTypes(l);this.#m=t;this.pageIndex=s;this.div=e;this.#Tn=n;this.#kh=r;this.viewport=a;this.#Rh=h;this.drawLayer=o;this._structTree=i;this.#m.addLayer(this)}get isEmpty(){return this.#Ch.size===0}get isInvisible(){return this.isEmpty&&this.#m.getMode()===u.NONE}updateToolbar(t){this.#m.updateToolbar(t)}updateMode(t=this.#m.getMode()){this.#Fh();switch(t){case u.NONE:this.disableTextSelection();this.togglePointerEvents(false);this.toggleAnnotationLayerPointerEvents(true);this.disableClick();return;case u.INK:this.disableTextSelection();this.togglePointerEvents(true);this.enableClick();break;case u.HIGHLIGHT:this.enableTextSelection();this.togglePointerEvents(false);this.disableClick();break;default:this.disableTextSelection();this.togglePointerEvents(true);this.enableClick()}this.toggleAnnotationLayerPointerEvents(false);const{classList:s}=this.div;for(const e of an.#H.values()){s.toggle(`${e._type}Editing`,t===e._editorType)}this.div.hidden=false}hasTextLayer(t){return t===this.#Rh?.div}setEditingState(t){this.#m.setEditingState(t)}addCommands(t){this.#m.addCommands(t)}cleanUndoStack(t){this.#m.cleanUndoStack(t)}toggleDrawing(t=false){this.div.classList.toggle("drawing",!t)}togglePointerEvents(t=false){this.div.classList.toggle("disabled",!t)}toggleAnnotationLayerPointerEvents(t=false){this.#kh?.div.classList.toggle("disabled",!t)}async enable(){this.#Nh=true;this.div.tabIndex=0;this.togglePointerEvents(true);const t=new Set;for(const s of this.#Ch.values()){s.enableEditing();s.show(true);if(s.annotationElementId){this.#m.removeChangedExistingAnnotation(s);t.add(s.annotationElementId)}}if(!this.#kh){this.#Nh=false;return}const s=this.#kh.getEditableAnnotations();for(const e of s){e.hide();if(this.#m.isDeletedAnnotationElement(e.data.id)){continue}if(t.has(e.data.id)){continue}const s=await this.deserialize(e);if(!s){continue}this.addOrRebuild(s);s.enableEditing()}this.#Nh=false}disable(){this.#Ph=true;this.div.tabIndex=-1;this.togglePointerEvents(false);const t=new Map;const s=new Map;for(const e of this.#Ch.values()){e.disableEditing();if(!e.annotationElementId){continue}if(e.serialize()!==null){t.set(e.annotationElementId,e);continue}else{s.set(e.annotationElementId,e)}this.getEditableAnnotation(e.annotationElementId)?.show();e.remove()}if(this.#kh){const e=this.#kh.getEditableAnnotations();for(const i of e){const{id:e}=i.data;if(this.#m.isDeletedAnnotationElement(e)){continue}let n=s.get(e);if(n){n.resetAnnotationElement(i);n.show(false);i.show();continue}n=t.get(e);if(n){this.#m.addChangedExistingAnnotation(n);if(n.renderAnnotationElement(i)){n.show(false)}}i.show()}}this.#Fh();if(this.isEmpty){this.div.hidden=true}const{classList:e}=this.div;for(const t of an.#H.values()){e.remove(`${t._type}Editing`)}this.disableTextSelection();this.toggleAnnotationLayerPointerEvents(true);this.#Ph=false}getEditableAnnotation(t){return this.#kh?.getEditableAnnotation(t)||null}setActiveEditor(t){const s=this.#m.getActive();if(s===t){return}this.#m.setActiveEditor(t)}enableTextSelection(){this.div.tabIndex=-1;if(this.#Rh?.div&&!this.#$h){this.#$h=new AbortController;const t=this.#m.combinedSignal(this.#$h);this.#Rh.div.addEventListener("pointerdown",this.#_h.bind(this),{signal:t});this.#Rh.div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0;if(this.#Rh?.div&&this.#$h){this.#$h.abort();this.#$h=null;this.#Rh.div.classList.remove("highlighting")}}#_h(t){this.#m.unselectAll();const{target:s}=t;if(s===this.#Rh.div||(s.getAttribute("role")==="img"||s.classList.contains("endOfContent"))&&this.#Rh.div.contains(s)){const{isMac:s}=W.platform;if(t.button!==0||t.ctrlKey&&s){return}this.#m.showAllEditors("highlight",true,true);this.#Rh.div.classList.add("free");this.toggleDrawing();Vi.startHighlighting(this,this.#m.direction==="ltr",{target:this.#Rh.div,x:t.x,y:t.y});this.#Rh.div.addEventListener("pointerup",(()=>{this.#Rh.div.classList.remove("free");this.toggleDrawing(true)}),{once:true,signal:this.#m._signal});t.preventDefault()}}enableClick(){if(this.#Sh){return}this.#Sh=new AbortController;const t=this.#m.combinedSignal(this.#Sh);this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:t});const s=this.pointerup.bind(this);this.div.addEventListener("pointerup",s,{signal:t});this.div.addEventListener("pointercancel",s,{signal:t})}disableClick(){this.#Sh?.abort();this.#Sh=null}attach(t){this.#Ch.set(t.id,t);const{annotationElementId:s}=t;if(s&&this.#m.isDeletedAnnotationElement(s)){this.#m.removeDeletedAnnotationElement(t)}}detach(t){this.#Ch.delete(t.id);this.#Tn?.removePointerInTextLayer(t.contentDiv);if(!this.#Ph&&t.annotationElementId){this.#m.addDeletedAnnotationElement(t)}}remove(t){this.detach(t);this.#m.removeEditor(t);t.div.remove();t.isAttachedToDOM=false}changeParent(t){if(t.parent===this){return}if(t.parent&&t.annotationElementId){this.#m.addDeletedAnnotationElement(t.annotationElementId);Ot.deleteAnnotationElement(t);t.annotationElementId=null}this.attach(t);t.parent?.detach(t);t.setParent(this);if(t.div&&t.isAttachedToDOM){t.div.remove();this.div.append(t.div)}}add(t){if(t.parent===this&&t.isAttachedToDOM){return}this.changeParent(t);this.#m.addEditor(t);this.attach(t);if(!t.isAttachedToDOM){const s=t.render();this.div.append(s);t.isAttachedToDOM=true}t.fixAndSetPosition();t.onceAdded(!this.#Nh);this.#m.addToAnnotationStorage(t);t._reportTelemetry(t.telemetryInitialData)}moveEditorInDOM(t){if(!t.isAttachedToDOM){return}const{activeElement:s}=document;if(t.div.contains(s)&&!this.#Eh){t._focusEventsAllowed=false;this.#Eh=setTimeout((()=>{this.#Eh=null;if(!t.div.contains(document.activeElement)){t.div.addEventListener("focusin",(()=>{t._focusEventsAllowed=true}),{once:true,signal:this.#m._signal});s.focus()}else{t._focusEventsAllowed=true}}),0)}t._structTreeParentId=this.#Tn?.moveElementInDOM(this.div,t.div,t.contentDiv,true)}addOrRebuild(t){if(t.needsToBeRebuilt()){t.parent||=this;t.rebuild();t.show()}else{this.add(t)}}addUndoableEditor(t){const s=()=>t._uiManager.rebuild(t);const e=()=>{t.remove()};this.addCommands({cmd:s,undo:e,mustExec:false})}getNextId(){return this.#m.getId()}get#Oh(){return an.#H.get(this.#m.getMode())}combinedSignal(t){return this.#m.combinedSignal(t)}#Lh(t){const s=this.#Oh;return s?new s.prototype.constructor(t):null}canCreateNewEmptyEditor(){return this.#Oh?.canCreateNewEmptyEditor()}async pasteEditor(t,s){this.#m.updateToolbar(t);await this.#m.updateMode(t);const{offsetX:e,offsetY:i}=this.#Bh();const n=this.getNextId();const r=this.#Lh({parent:this,id:n,x:e,y:i,uiManager:this.#m,isCentered:true,...s});if(r){this.add(r)}}async deserialize(t){return await(an.#H.get(t.annotationType??t.annotationEditorType)?.deserialize(t,this,this.#m))||null}createAndAddNewEditor(t,s,e={}){const i=this.getNextId();const n=this.#Lh({parent:this,id:i,x:t.offsetX,y:t.offsetY,uiManager:this.#m,isCentered:s,...e});if(n){this.add(n)}return n}#Bh(){const{x:t,y:s,width:e,height:i}=this.div.getBoundingClientRect();const n=Math.max(0,t);const r=Math.max(0,s);const o=Math.min(window.innerWidth,t+e);const h=Math.min(window.innerHeight,s+i);const a=(n+o)/2-t;const c=(r+h)/2-s;const[l,u]=this.viewport.rotation%180===0?[a,c]:[c,a];return{offsetX:l,offsetY:u}}addNewEditor(t={}){this.createAndAddNewEditor(this.#Bh(),true,t)}setSelected(t){this.#m.setSelected(t)}toggleSelected(t){this.#m.toggleSelected(t)}unselect(t){this.#m.unselect(t)}pointerup(t){const{isMac:s}=W.platform;if(t.button!==0||t.ctrlKey&&s){return}if(t.target!==this.div){return}if(!this.#Th){return}this.#Th=false;if(this.#Oh?.isDrawer&&this.#Oh.supportMultipleDrawings){return}if(!this.#Mh){this.#Mh=true;return}const e=this.#m.getMode();if(e===u.STAMP||e===u.SIGNATURE){this.#m.unselectAll();return}this.createAndAddNewEditor(t,false)}pointerdown(t){if(this.#m.getMode()===u.HIGHLIGHT){this.enableTextSelection()}if(this.#Th){this.#Th=false;return}const{isMac:s}=W.platform;if(t.button!==0||t.ctrlKey&&s){return}if(t.target!==this.div){return}this.#Th=true;if(this.#Oh?.isDrawer){this.startDrawingSession(t);return}const e=this.#m.getActive();this.#Mh=!e||e.isEmpty()}startDrawingSession(t){this.div.focus({preventScroll:true});if(this.#Ih){this.#Oh.startDrawing(this,this.#m,false,t);return}this.#m.setCurrentDrawingSession(this);this.#Ih=new AbortController;const s=this.#m.combinedSignal(this.#Ih);this.div.addEventListener("blur",(({relatedTarget:t})=>{if(t&&!this.div.contains(t)){this.#Dh=null;this.commitOrRemove()}}),{signal:s});this.#Oh.startDrawing(this,this.#m,false,t)}pause(t){if(t){const{activeElement:t}=document;if(this.div.contains(t)){this.#Dh=t}return}if(this.#Dh){setTimeout((()=>{this.#Dh?.focus();this.#Dh=null}),0)}}endDrawingSession(t=false){if(!this.#Ih){return null}this.#m.setCurrentDrawingSession(null);this.#Ih.abort();this.#Ih=null;this.#Dh=null;return this.#Oh.endDrawing(t)}findNewParent(t,s,e){const i=this.#m.findParent(s,e);if(i===null||i===this){return false}i.changeParent(t);return true}commitOrRemove(){if(this.#Ih){this.endDrawingSession();return true}return false}onScaleChanging(){if(!this.#Ih){return}this.#Oh.onScaleChangingWhenDrawing(this)}destroy(){this.commitOrRemove();if(this.#m.getActive()?.parent===this){this.#m.commitOrRemove();this.#m.setActiveEditor(null)}if(this.#Eh){clearTimeout(this.#Eh);this.#Eh=null}for(const t of this.#Ch.values()){this.#Tn?.removePointerInTextLayer(t.contentDiv);t.setParent(null);t.isAttachedToDOM=false;t.div.remove()}this.div=null;this.#Ch.clear();this.#m.removeLayer(this)}#Fh(){for(const t of this.#Ch.values()){if(t.isEmpty()){t.remove()}}}render({viewport:t}){this.viewport=t;Mt(this.div,t);for(const t of this.#m.getEditors(this.pageIndex)){this.add(t);t.rebuild()}this.updateMode()}update({viewport:t}){this.#m.commitOrRemove();this.#Fh();const s=this.viewport.rotation;const e=t.rotation;this.viewport=t;Mt(this.div,{rotation:e});if(s!==e){for(const t of this.#Ch.values()){t.rotate(e)}}}get pageDimensions(){const{pageWidth:t,pageHeight:s}=this.viewport.rawDims;return[t,s]}get scale(){return this.#m.viewParameters.realScale}}class cn{#on=null;#Uh=new Map;#jh=new Map;static#y=0;constructor({pageIndex:t}){this.pageIndex=t}setParent(t){if(!this.#on){this.#on=t;return}if(this.#on!==t){if(this.#Uh.size>0){for(const s of this.#Uh.values()){s.remove();t.append(s)}}this.#on=t}}static get _svgFactory(){return D(this,"_svgFactory",new ii)}static#Hh(t,[s,e,i,n]){const{style:r}=t;r.top=`${100*e}%`;r.left=`${100*s}%`;r.width=`${100*i}%`;r.height=`${100*n}%`}#zh(){const t=cn._svgFactory.create(1,1,true);this.#on.append(t);t.setAttribute("aria-hidden",true);return t}#Gh(t,s){const e=cn._svgFactory.createElement("clipPath");t.append(e);const i=`clip_${s}`;e.setAttribute("id",i);e.setAttribute("clipPathUnits","objectBoundingBox");const n=cn._svgFactory.createElement("use");e.append(n);n.setAttribute("href",`#${s}`);n.classList.add("clip");return i}#Wh(t,s){for(const[e,i]of Object.entries(s)){if(i===null){t.removeAttribute(e)}else{t.setAttribute(e,i)}}}draw(t,s=false,e=false){const i=cn.#y++;const n=this.#zh();const r=cn._svgFactory.createElement("defs");n.append(r);const o=cn._svgFactory.createElement("path");r.append(o);const h=`path_p${this.pageIndex}_${i}`;o.setAttribute("id",h);o.setAttribute("vector-effect","non-scaling-stroke");if(s){this.#jh.set(i,o)}const a=e?this.#Gh(r,h):null;const c=cn._svgFactory.createElement("use");n.append(c);c.setAttribute("href",`#${h}`);this.updateProperties(n,t);this.#Uh.set(i,n);return{id:i,clipPathId:`url(#${a})`}}drawOutline(t,s){const e=cn.#y++;const i=this.#zh();const n=cn._svgFactory.createElement("defs");i.append(n);const r=cn._svgFactory.createElement("path");n.append(r);const o=`path_p${this.pageIndex}_${e}`;r.setAttribute("id",o);r.setAttribute("vector-effect","non-scaling-stroke");let h;if(s){const t=cn._svgFactory.createElement("mask");n.append(t);h=`mask_p${this.pageIndex}_${e}`;t.setAttribute("id",h);t.setAttribute("maskUnits","objectBoundingBox");const s=cn._svgFactory.createElement("rect");t.append(s);s.setAttribute("width","1");s.setAttribute("height","1");s.setAttribute("fill","white");const i=cn._svgFactory.createElement("use");t.append(i);i.setAttribute("href",`#${o}`);i.setAttribute("stroke","none");i.setAttribute("fill","black");i.setAttribute("fill-rule","nonzero");i.classList.add("mask")}const a=cn._svgFactory.createElement("use");i.append(a);a.setAttribute("href",`#${o}`);if(h){a.setAttribute("mask",`url(#${h})`)}const c=a.cloneNode();i.append(c);a.classList.add("mainOutline");c.classList.add("secondaryOutline");this.updateProperties(i,t);this.#Uh.set(e,i);return e}finalizeDraw(t,s){this.#jh.delete(t);this.updateProperties(t,s)}updateProperties(t,s){if(!s){return}const{root:e,bbox:i,rootClass:n,path:r}=s;const o=typeof t==="number"?this.#Uh.get(t):t;if(!o){return}if(e){this.#Wh(o,e)}if(i){cn.#Hh(o,i)}if(n){const{classList:t}=o;for(const[s,e]of Object.entries(n)){t.toggle(s,e)}}if(r){const t=o.firstChild;const s=t.firstChild;this.#Wh(s,r)}}updateParent(t,s){if(s===this){return}const e=this.#Uh.get(t);if(!e){return}s.#on.append(e);this.#Uh.delete(t);s.#Uh.set(t,e)}remove(t){this.#jh.delete(t);if(this.#on===null){return}this.#Uh.get(t).remove();this.#Uh.delete(t)}destroy(){this.#on=null;for(const t of this.#Uh.values()){t.remove()}this.#Uh.clear();this.#jh.clear()}}{globalThis.pdfjsTestingUtils={HighlightOutliner:ji}}globalThis.pdfjsLib={AbortException:B,AnnotationEditorLayer:an,AnnotationEditorParamsType:f,AnnotationEditorType:u,AnnotationEditorUIManager:$t,AnnotationLayer:Fi,AnnotationMode:c,AnnotationType:m,build:Je,ColorPicker:Wi,createValidAbsoluteUrl:N,DOMSVGFactory:ii,DrawLayer:cn,FeatureTest:W,fetchData:ot,getDocument:Re,getFilenameFromUrl:ut,getPdfFilenameFromUrl:ft,getUuid:J,getXfaPageViewport:wt,GlobalWorkerOptions:Qs,ImageKind:g,InvalidPDFException:_,isDataScheme:ct,isPdfFile:lt,isValidExplicitDest:Be,MathClamp:st,noContextMenu:gt,normalizeUnicode:q,OPS:b,OutputScale:kt,PasswordResponses:v,PDFDataRangeTransport:je,PDFDateString:At,PDFWorker:We,PermissionFlag:d,PixelsPerInch:rt,RenderingCancelledException:at,ResponseException:O,setLayerDimensions:Mt,shadow:D,SignatureExtractor:en,stopEvent:mt,SupportedImageMimeTypes:St,TextLayer:Pe,TouchManager:_t,updateUrlHash:I,Util:X,VerbosityLevel:w,version:qe,XfaLayer:ni};const ln=":host{display:block;font-family:sans-serif}.toolbar{display:flex;gap:10px;margin-bottom:12px;justify-content:center}.toolbar button{padding:6px 14px;border:1px solid #ccc;border-radius:20px;background:#f9f9f9;cursor:pointer;transition:all 0.2s}.toolbar button.active{background:#007bff;color:#fff;border-color:#007bff}.pdf-container{display:flex;flex-direction:column;gap:24px}.page{position:relative;margin:auto;border:1px solid #ddd;box-shadow:0 2px 6px rgba(0, 0, 0, 0.1);cursor:crosshair}canvas{width:100%;height:auto;display:block}.field{position:absolute;background:rgba(255, 255, 0, 0.4);border:1px solid #333;border-radius:4px;display:flex;align-items:center;justify-content:space-between;padding:2px 6px;font-size:12px;cursor:move}.field button{background:red;color:white;border:none;border-radius:50%;width:18px;height:18px;font-size:12px;margin-left:4px;cursor:pointer}";const un=class{constructor(e){t(this,e);this.fieldsChanged=s(this,"fieldsChanged")}get el(){return e(this)}fileUrl;pdfDoc;totalPages=0;scale=1.2;fields=[];selectedFieldType=null;pageDims={};fieldsChanged;draggingField=null;dragOffsetX=0;dragOffsetY=0;fieldTypes=[{type:"signature",label:"✍ Signature",width:150,height:50},{type:"text",label:"📝 Text",width:120,height:40},{type:"date",label:"📅 Date",width:100,height:40}];componentWillLoad(){Qs.workerSrc="/assets/pdf.worker.min.mjs";if(this.fileUrl)this.loadPdf()}fileUrlChanged(){this.loadPdf()}async loadPdf(){const t=Re(this.fileUrl);this.pdfDoc=await t.promise;this.totalPages=this.pdfDoc.numPages;this.pageDims={};await this.renderPages()}async renderPages(){for(let t=1;t<=this.totalPages;t++){const s=await this.pdfDoc.getPage(t);const e=s.getViewport({scale:this.scale});this.pageDims[t]={width:e.width,height:e.height};const i=this.el.shadowRoot.querySelector(`#canvas-${t}`);const n=i.getContext("2d");i.height=e.height;i.width=e.width;await s.render({canvasContext:n,viewport:e}).promise}}handleAddField(t,s){if(!this.selectedFieldType)return;const e=t.currentTarget;const i=e.getBoundingClientRect();const n=t.clientX-i.left;const r=t.clientY-i.top;const o=this.fieldTypes.find((t=>t.type===this.selectedFieldType));const h={id:`${Date.now()}`,type:this.selectedFieldType,page:s,x:n,y:r,width:o.width,height:o.height};this.fields=[...this.fields,h];this.fieldsChanged.emit(this.fields);this.selectedFieldType=null}startDrag(t,s){t.stopPropagation();this.draggingField=s;const e=t.currentTarget.getBoundingClientRect();this.dragOffsetX=t.clientX-e.left;this.dragOffsetY=t.clientY-e.top;document.addEventListener("mousemove",this.handleDrag);document.addEventListener("mouseup",this.stopDrag)}handleDrag=t=>{if(!this.draggingField)return;const s=this.el.shadowRoot.querySelector(`.page[data-page="${this.draggingField.page}"]`);const e=s.getBoundingClientRect();const i=Math.min(Math.max(0,t.clientX-e.left-this.dragOffsetX),e.width-this.draggingField.width);const n=Math.min(Math.max(0,t.clientY-e.top-this.dragOffsetY),e.height-this.draggingField.height);this.fields=this.fields.map((t=>t.id===this.draggingField.id?{...t,x:i,y:n}:t));this.fieldsChanged.emit(this.fields)};stopDrag=()=>{this.draggingField=null;document.removeEventListener("mousemove",this.handleDrag);document.removeEventListener("mouseup",this.stopDrag)};deleteField(t){this.fields=this.fields.filter((s=>s.id!==t));this.fieldsChanged.emit(this.fields)}render(){return i(n,{key:"901b33e87166494a64cac8e14670214f12ad241f"},i("div",{key:"52eb6a77af331294cd7676e3dc227e6bfbae5c36",class:"toolbar"},this.fieldTypes.map((t=>i("button",{class:{active:this.selectedFieldType===t.type},onClick:()=>this.selectedFieldType=t.type},t.label)))),i("div",{key:"66c73d893d4043fac3dab930d6ebed1e11875783",class:"pdf-container"},Array.from({length:this.totalPages},((t,s)=>s+1)).map((t=>i("div",{class:"page","data-page":t,onClick:s=>this.handleAddField(s,t),style:{width:`${this.pageDims[t]?.width||600}px`,height:`${this.pageDims[t]?.height||800}px`}},i("canvas",{id:`canvas-${t}`}),this.fields.filter((s=>s.page===t)).map((t=>i("div",{class:`field ${t.type}`,style:{left:`${t.x}px`,top:`${t.y}px`,width:`${t.width}px`,height:`${t.height}px`},onMouseDown:s=>this.startDrag(s,t)},i("span",null,t.type),i("button",{onClick:()=>this.deleteField(t.id)},"×")))))))))}static get watchers(){return{fileUrl:["fileUrlChanged"]}}};un.style=ln;export{un as signiture_builder};
//# sourceMappingURL=p-bf272aab.entry.js.map